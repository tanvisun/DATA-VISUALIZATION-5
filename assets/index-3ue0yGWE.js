var NO=Object.defineProperty;var zO=(t,e,i)=>e in t?NO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var q=(t,e,i)=>zO(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const u of s)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&n(f)}).observe(document,{childList:!0,subtree:!0});function i(s){const u={};return s.integrity&&(u.integrity=s.integrity),s.referrerPolicy&&(u.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?u.credentials="include":s.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function n(s){if(s.ep)return;s.ep=!0;const u=i(s);fetch(s.href,u)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Lb(t){const e=Object.create(null);for(const i of t.split(","))e[i]=1;return i=>i in e}const hn={},bh=[],zo=()=>{},UO=()=>!1,vy=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),Bb=t=>t.startsWith("onUpdate:"),jr=Object.assign,Fb=(t,e)=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)},VO=Object.prototype.hasOwnProperty,en=(t,e)=>VO.call(t,e),bi=Array.isArray,Fd=t=>by(t)==="[object Map]",jO=t=>by(t)==="[object Set]",Ei=t=>typeof t=="function",ur=t=>typeof t=="string",Hh=t=>typeof t=="symbol",Hn=t=>t!==null&&typeof t=="object",_I=t=>(Hn(t)||Ei(t))&&Ei(t.then)&&Ei(t.catch),$O=Object.prototype.toString,by=t=>$O.call(t),WO=t=>by(t).slice(8,-1),HO=t=>by(t)==="[object Object]",Nb=t=>ur(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Nd=Lb(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),wy=t=>{const e=Object.create(null);return i=>e[i]||(e[i]=t(i))},XO=/-(\w)/g,Tl=wy(t=>t.replace(XO,(e,i)=>i?i.toUpperCase():"")),qO=/\B([A-Z])/g,Wc=wy(t=>t.replace(qO,"-$1").toLowerCase()),yI=wy(t=>t.charAt(0).toUpperCase()+t.slice(1)),sx=wy(t=>t?`on${yI(t)}`:""),xl=(t,e)=>!Object.is(t,e),ox=(t,...e)=>{for(let i=0;i<t.length;i++)t[i](...e)},xI=(t,e,i,n=!1)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:n,value:i})},GO=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let OE;const Ty=()=>OE||(OE=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function zb(t){if(bi(t)){const e={};for(let i=0;i<t.length;i++){const n=t[i],s=ur(n)?JO(n):zb(n);if(s)for(const u in s)e[u]=s[u]}return e}else if(ur(t)||Hn(t))return t}const ZO=/;(?![^(]*\))/g,YO=/:([^]+)/,KO=/\/\*[^]*?\*\//g;function JO(t){const e={};return t.replace(KO,"").split(ZO).forEach(i=>{if(i){const n=i.split(YO);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function Ub(t){let e="";if(ur(t))e=t;else if(bi(t))for(let i=0;i<t.length;i++){const n=Ub(t[i]);n&&(e+=n+" ")}else if(Hn(t))for(const i in t)t[i]&&(e+=i+" ");return e.trim()}const QO="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",e4=Lb(QO);function vI(t){return!!t||t===""}/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let hs;class t4{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=hs,!e&&hs&&(this.index=(hs.scopes||(hs.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,i;if(this.scopes)for(e=0,i=this.scopes.length;e<i;e++)this.scopes[e].pause();for(e=0,i=this.effects.length;e<i;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,i;if(this.scopes)for(e=0,i=this.scopes.length;e<i;e++)this.scopes[e].resume();for(e=0,i=this.effects.length;e<i;e++)this.effects[e].resume()}}run(e){if(this._active){const i=hs;try{return hs=this,e()}finally{hs=i}}}on(){hs=this}off(){hs=this.parent}stop(e){if(this._active){this._active=!1;let i,n;for(i=0,n=this.effects.length;i<n;i++)this.effects[i].stop();for(this.effects.length=0,i=0,n=this.cleanups.length;i<n;i++)this.cleanups[i]();if(this.cleanups.length=0,this.scopes){for(i=0,n=this.scopes.length;i<n;i++)this.scopes[i].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function i4(){return hs}let un;const ax=new WeakSet;class bI{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,hs&&hs.active&&hs.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,ax.has(this)&&(ax.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||TI(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,LE(this),EI(this);const e=un,i=to;un=this,to=!0;try{return this.fn()}finally{AI(this),un=e,to=i,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)$b(e);this.deps=this.depsTail=void 0,LE(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?ax.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){uv(this)&&this.run()}get dirty(){return uv(this)}}let wI=0,zd,Ud;function TI(t,e=!1){if(t.flags|=8,e){t.next=Ud,Ud=t;return}t.next=zd,zd=t}function Vb(){wI++}function jb(){if(--wI>0)return;if(Ud){let e=Ud;for(Ud=void 0;e;){const i=e.next;e.next=void 0,e.flags&=-9,e=i}}let t;for(;zd;){let e=zd;for(zd=void 0;e;){const i=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(n){t||(t=n)}e=i}}if(t)throw t}function EI(t){for(let e=t.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function AI(t){let e,i=t.depsTail,n=i;for(;n;){const s=n.prevDep;n.version===-1?(n===i&&(i=s),$b(n),n4(n)):e=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=s}t.deps=e,t.depsTail=i}function uv(t){for(let e=t.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(SI(e.dep.computed)||e.dep.version!==e.version))return!0;return!!t._dirty}function SI(t){if(t.flags&4&&!(t.flags&16)||(t.flags&=-17,t.globalVersion===tp))return;t.globalVersion=tp;const e=t.dep;if(t.flags|=2,e.version>0&&!t.isSSR&&t.deps&&!uv(t)){t.flags&=-3;return}const i=un,n=to;un=t,to=!0;try{EI(t);const s=t.fn(t._value);(e.version===0||xl(s,t._value))&&(t._value=s,e.version++)}catch(s){throw e.version++,s}finally{un=i,to=n,AI(t),t.flags&=-3}}function $b(t,e=!1){const{dep:i,prevSub:n,nextSub:s}=t;if(n&&(n.nextSub=s,t.prevSub=void 0),s&&(s.prevSub=n,t.nextSub=void 0),i.subs===t&&(i.subs=n,!n&&i.computed)){i.computed.flags&=-5;for(let u=i.computed.deps;u;u=u.nextDep)$b(u,!0)}!e&&!--i.sc&&i.map&&i.map.delete(i.key)}function n4(t){const{prevDep:e,nextDep:i}=t;e&&(e.nextDep=i,t.prevDep=void 0),i&&(i.prevDep=e,t.nextDep=void 0)}let to=!0;const II=[];function Sl(){II.push(to),to=!1}function Il(){const t=II.pop();to=t===void 0?!0:t}function LE(t){const{cleanup:e}=t;if(t.cleanup=void 0,e){const i=un;un=void 0;try{e()}finally{un=i}}}let tp=0;class r4{constructor(e,i){this.sub=e,this.dep=i,this.version=i.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Wb{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!un||!to||un===this.computed)return;let i=this.activeLink;if(i===void 0||i.sub!==un)i=this.activeLink=new r4(un,this),un.deps?(i.prevDep=un.depsTail,un.depsTail.nextDep=i,un.depsTail=i):un.deps=un.depsTail=i,CI(i);else if(i.version===-1&&(i.version=this.version,i.nextDep)){const n=i.nextDep;n.prevDep=i.prevDep,i.prevDep&&(i.prevDep.nextDep=n),i.prevDep=un.depsTail,i.nextDep=void 0,un.depsTail.nextDep=i,un.depsTail=i,un.deps===i&&(un.deps=n)}return i}trigger(e){this.version++,tp++,this.notify(e)}notify(e){Vb();try{for(let i=this.subs;i;i=i.prevSub)i.sub.notify()&&i.sub.dep.notify()}finally{jb()}}}function CI(t){if(t.dep.sc++,t.sub.flags&4){const e=t.dep.computed;if(e&&!t.dep.subs){e.flags|=20;for(let n=e.deps;n;n=n.nextDep)CI(n)}const i=t.dep.subs;i!==t&&(t.prevSub=i,i&&(i.nextSub=t)),t.dep.subs=t}}const hv=new WeakMap,Cc=Symbol(""),fv=Symbol(""),ip=Symbol("");function Rr(t,e,i){if(to&&un){let n=hv.get(t);n||hv.set(t,n=new Map);let s=n.get(i);s||(n.set(i,s=new Wb),s.map=n,s.key=i),s.track()}}function va(t,e,i,n,s,u){const f=hv.get(t);if(!f){tp++;return}const m=o=>{o&&o.trigger()};if(Vb(),e==="clear")f.forEach(m);else{const o=bi(t),v=o&&Nb(i);if(o&&i==="length"){const w=Number(n);f.forEach((S,R)=>{(R==="length"||R===ip||!Hh(R)&&R>=w)&&m(S)})}else switch((i!==void 0||f.has(void 0))&&m(f.get(i)),v&&m(f.get(ip)),e){case"add":o?v&&m(f.get("length")):(m(f.get(Cc)),Fd(t)&&m(f.get(fv)));break;case"delete":o||(m(f.get(Cc)),Fd(t)&&m(f.get(fv)));break;case"set":Fd(t)&&m(f.get(Cc));break}}jb()}function ih(t){const e=Qi(t);return e===t?e:(Rr(e,"iterate",ip),io(t)?e:e.map(zr))}function Hb(t){return Rr(t=Qi(t),"iterate",ip),t}const s4={__proto__:null,[Symbol.iterator](){return lx(this,Symbol.iterator,zr)},concat(...t){return ih(this).concat(...t.map(e=>bi(e)?ih(e):e))},entries(){return lx(this,"entries",t=>(t[1]=zr(t[1]),t))},every(t,e){return pa(this,"every",t,e,void 0,arguments)},filter(t,e){return pa(this,"filter",t,e,i=>i.map(zr),arguments)},find(t,e){return pa(this,"find",t,e,zr,arguments)},findIndex(t,e){return pa(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return pa(this,"findLast",t,e,zr,arguments)},findLastIndex(t,e){return pa(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return pa(this,"forEach",t,e,void 0,arguments)},includes(...t){return cx(this,"includes",t)},indexOf(...t){return cx(this,"indexOf",t)},join(t){return ih(this).join(t)},lastIndexOf(...t){return cx(this,"lastIndexOf",t)},map(t,e){return pa(this,"map",t,e,void 0,arguments)},pop(){return gd(this,"pop")},push(...t){return gd(this,"push",t)},reduce(t,...e){return BE(this,"reduce",t,e)},reduceRight(t,...e){return BE(this,"reduceRight",t,e)},shift(){return gd(this,"shift")},some(t,e){return pa(this,"some",t,e,void 0,arguments)},splice(...t){return gd(this,"splice",t)},toReversed(){return ih(this).toReversed()},toSorted(t){return ih(this).toSorted(t)},toSpliced(...t){return ih(this).toSpliced(...t)},unshift(...t){return gd(this,"unshift",t)},values(){return lx(this,"values",zr)}};function lx(t,e,i){const n=Hb(t),s=n[e]();return n!==t&&!io(t)&&(s._next=s.next,s.next=()=>{const u=s._next();return u.value&&(u.value=i(u.value)),u}),s}const o4=Array.prototype;function pa(t,e,i,n,s,u){const f=Hb(t),m=f!==t&&!io(t),o=f[e];if(o!==o4[e]){const S=o.apply(t,u);return m?zr(S):S}let v=i;f!==t&&(m?v=function(S,R){return i.call(this,zr(S),R,t)}:i.length>2&&(v=function(S,R){return i.call(this,S,R,t)}));const w=o.call(f,v,n);return m&&s?s(w):w}function BE(t,e,i,n){const s=Hb(t);let u=i;return s!==t&&(io(t)?i.length>3&&(u=function(f,m,o){return i.call(this,f,m,o,t)}):u=function(f,m,o){return i.call(this,f,zr(m),o,t)}),s[e](u,...n)}function cx(t,e,i){const n=Qi(t);Rr(n,"iterate",ip);const s=n[e](...i);return(s===-1||s===!1)&&Zb(i[0])?(i[0]=Qi(i[0]),n[e](...i)):s}function gd(t,e,i=[]){Sl(),Vb();const n=Qi(t)[e].apply(t,i);return jb(),Il(),n}const a4=Lb("__proto__,__v_isRef,__isVue"),MI=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Hh));function l4(t){Hh(t)||(t=String(t));const e=Qi(this);return Rr(e,"has",t),e.hasOwnProperty(t)}class RI{constructor(e=!1,i=!1){this._isReadonly=e,this._isShallow=i}get(e,i,n){if(i==="__v_skip")return e.__v_skip;const s=this._isReadonly,u=this._isShallow;if(i==="__v_isReactive")return!s;if(i==="__v_isReadonly")return s;if(i==="__v_isShallow")return u;if(i==="__v_raw")return n===(s?u?y4:OI:u?DI:kI).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:void 0;const f=bi(e);if(!s){let o;if(f&&(o=s4[i]))return o;if(i==="hasOwnProperty")return l4}const m=Reflect.get(e,i,kr(e)?e:n);return(Hh(i)?MI.has(i):a4(i))||(s||Rr(e,"get",i),u)?m:kr(m)?f&&Nb(i)?m:m.value:Hn(m)?s?LI(m):qb(m):m}}class PI extends RI{constructor(e=!1){super(!1,e)}set(e,i,n,s){let u=e[i];if(!this._isShallow){const o=Oc(u);if(!io(n)&&!Oc(n)&&(u=Qi(u),n=Qi(n)),!bi(e)&&kr(u)&&!kr(n))return o?!1:(u.value=n,!0)}const f=bi(e)&&Nb(i)?Number(i)<e.length:en(e,i),m=Reflect.set(e,i,n,kr(e)?e:s);return e===Qi(s)&&(f?xl(n,u)&&va(e,"set",i,n):va(e,"add",i,n)),m}deleteProperty(e,i){const n=en(e,i);e[i];const s=Reflect.deleteProperty(e,i);return s&&n&&va(e,"delete",i,void 0),s}has(e,i){const n=Reflect.has(e,i);return(!Hh(i)||!MI.has(i))&&Rr(e,"has",i),n}ownKeys(e){return Rr(e,"iterate",bi(e)?"length":Cc),Reflect.ownKeys(e)}}class c4 extends RI{constructor(e=!1){super(!0,e)}set(e,i){return!0}deleteProperty(e,i){return!0}}const u4=new PI,h4=new c4,f4=new PI(!0);const dv=t=>t,dg=t=>Reflect.getPrototypeOf(t);function d4(t,e,i){return function(...n){const s=this.__v_raw,u=Qi(s),f=Fd(u),m=t==="entries"||t===Symbol.iterator&&f,o=t==="keys"&&f,v=s[t](...n),w=i?dv:e?pv:zr;return!e&&Rr(u,"iterate",o?fv:Cc),{next(){const{value:S,done:R}=v.next();return R?{value:S,done:R}:{value:m?[w(S[0]),w(S[1])]:w(S),done:R}},[Symbol.iterator](){return this}}}}function pg(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function p4(t,e){const i={get(s){const u=this.__v_raw,f=Qi(u),m=Qi(s);t||(xl(s,m)&&Rr(f,"get",s),Rr(f,"get",m));const{has:o}=dg(f),v=e?dv:t?pv:zr;if(o.call(f,s))return v(u.get(s));if(o.call(f,m))return v(u.get(m));u!==f&&u.get(s)},get size(){const s=this.__v_raw;return!t&&Rr(Qi(s),"iterate",Cc),Reflect.get(s,"size",s)},has(s){const u=this.__v_raw,f=Qi(u),m=Qi(s);return t||(xl(s,m)&&Rr(f,"has",s),Rr(f,"has",m)),s===m?u.has(s):u.has(s)||u.has(m)},forEach(s,u){const f=this,m=f.__v_raw,o=Qi(m),v=e?dv:t?pv:zr;return!t&&Rr(o,"iterate",Cc),m.forEach((w,S)=>s.call(u,v(w),v(S),f))}};return jr(i,t?{add:pg("add"),set:pg("set"),delete:pg("delete"),clear:pg("clear")}:{add(s){!e&&!io(s)&&!Oc(s)&&(s=Qi(s));const u=Qi(this);return dg(u).has.call(u,s)||(u.add(s),va(u,"add",s,s)),this},set(s,u){!e&&!io(u)&&!Oc(u)&&(u=Qi(u));const f=Qi(this),{has:m,get:o}=dg(f);let v=m.call(f,s);v||(s=Qi(s),v=m.call(f,s));const w=o.call(f,s);return f.set(s,u),v?xl(u,w)&&va(f,"set",s,u):va(f,"add",s,u),this},delete(s){const u=Qi(this),{has:f,get:m}=dg(u);let o=f.call(u,s);o||(s=Qi(s),o=f.call(u,s)),m&&m.call(u,s);const v=u.delete(s);return o&&va(u,"delete",s,void 0),v},clear(){const s=Qi(this),u=s.size!==0,f=s.clear();return u&&va(s,"clear",void 0,void 0),f}}),["keys","values","entries",Symbol.iterator].forEach(s=>{i[s]=d4(s,t,e)}),i}function Xb(t,e){const i=p4(t,e);return(n,s,u)=>s==="__v_isReactive"?!t:s==="__v_isReadonly"?t:s==="__v_raw"?n:Reflect.get(en(i,s)&&s in n?i:n,s,u)}const m4={get:Xb(!1,!1)},g4={get:Xb(!1,!0)},_4={get:Xb(!0,!1)};const kI=new WeakMap,DI=new WeakMap,OI=new WeakMap,y4=new WeakMap;function x4(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function v4(t){return t.__v_skip||!Object.isExtensible(t)?0:x4(WO(t))}function qb(t){return Oc(t)?t:Gb(t,!1,u4,m4,kI)}function b4(t){return Gb(t,!1,f4,g4,DI)}function LI(t){return Gb(t,!0,h4,_4,OI)}function Gb(t,e,i,n,s){if(!Hn(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const u=s.get(t);if(u)return u;const f=v4(t);if(f===0)return t;const m=new Proxy(t,f===2?n:i);return s.set(t,m),m}function Vd(t){return Oc(t)?Vd(t.__v_raw):!!(t&&t.__v_isReactive)}function Oc(t){return!!(t&&t.__v_isReadonly)}function io(t){return!!(t&&t.__v_isShallow)}function Zb(t){return t?!!t.__v_raw:!1}function Qi(t){const e=t&&t.__v_raw;return e?Qi(e):t}function w4(t){return!en(t,"__v_skip")&&Object.isExtensible(t)&&xI(t,"__v_skip",!0),t}const zr=t=>Hn(t)?qb(t):t,pv=t=>Hn(t)?LI(t):t;function kr(t){return t?t.__v_isRef===!0:!1}function Ta(t){return T4(t,!1)}function T4(t,e){return kr(t)?t:new E4(t,e)}class E4{constructor(e,i){this.dep=new Wb,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=i?e:Qi(e),this._value=i?e:zr(e),this.__v_isShallow=i}get value(){return this.dep.track(),this._value}set value(e){const i=this._rawValue,n=this.__v_isShallow||io(e)||Oc(e);e=n?e:Qi(e),xl(e,i)&&(this._rawValue=e,this._value=n?e:zr(e),this.dep.trigger())}}function A4(t){return kr(t)?t.value:t}const S4={get:(t,e,i)=>e==="__v_raw"?t:A4(Reflect.get(t,e,i)),set:(t,e,i,n)=>{const s=t[e];return kr(s)&&!kr(i)?(s.value=i,!0):Reflect.set(t,e,i,n)}};function BI(t){return Vd(t)?t:new Proxy(t,S4)}class I4{constructor(e,i,n){this.fn=e,this.setter=i,this._value=void 0,this.dep=new Wb(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=tp-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!i,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&un!==this)return TI(this,!0),!0}get value(){const e=this.dep.track();return SI(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function C4(t,e,i=!1){let n,s;return Ei(t)?n=t:(n=t.get,s=t.set),new I4(n,s,i)}const mg={},o_=new WeakMap;let Ec;function M4(t,e=!1,i=Ec){if(i){let n=o_.get(i);n||o_.set(i,n=[]),n.push(t)}}function R4(t,e,i=hn){const{immediate:n,deep:s,once:u,scheduler:f,augmentJob:m,call:o}=i,v=oe=>s?oe:io(oe)||s===!1||s===0?gl(oe,1):gl(oe);let w,S,R,L,j=!1,Z=!1;if(kr(t)?(S=()=>t.value,j=io(t)):Vd(t)?(S=()=>v(t),j=!0):bi(t)?(Z=!0,j=t.some(oe=>Vd(oe)||io(oe)),S=()=>t.map(oe=>{if(kr(oe))return oe.value;if(Vd(oe))return v(oe);if(Ei(oe))return o?o(oe,2):oe()})):Ei(t)?e?S=o?()=>o(t,2):t:S=()=>{if(R){Sl();try{R()}finally{Il()}}const oe=Ec;Ec=w;try{return o?o(t,3,[L]):t(L)}finally{Ec=oe}}:S=zo,e&&s){const oe=S,Ie=s===!0?1/0:s;S=()=>gl(oe(),Ie)}const re=i4(),xe=()=>{w.stop(),re&&re.active&&Fb(re.effects,w)};if(u&&e){const oe=e;e=(...Ie)=>{oe(...Ie),xe()}}let be=Z?new Array(t.length).fill(mg):mg;const ue=oe=>{if(!(!(w.flags&1)||!w.dirty&&!oe))if(e){const Ie=w.run();if(s||j||(Z?Ie.some((me,ot)=>xl(me,be[ot])):xl(Ie,be))){R&&R();const me=Ec;Ec=w;try{const ot=[Ie,be===mg?void 0:Z&&be[0]===mg?[]:be,L];o?o(e,3,ot):e(...ot),be=Ie}finally{Ec=me}}}else w.run()};return m&&m(ue),w=new bI(S),w.scheduler=f?()=>f(ue,!1):ue,L=oe=>M4(oe,!1,w),R=w.onStop=()=>{const oe=o_.get(w);if(oe){if(o)o(oe,4);else for(const Ie of oe)Ie();o_.delete(w)}},e?n?ue(!0):be=w.run():f?f(ue.bind(null,!0),!0):w.run(),xe.pause=w.pause.bind(w),xe.resume=w.resume.bind(w),xe.stop=xe,xe}function gl(t,e=1/0,i){if(e<=0||!Hn(t)||t.__v_skip||(i=i||new Set,i.has(t)))return t;if(i.add(t),e--,kr(t))gl(t.value,e,i);else if(bi(t))for(let n=0;n<t.length;n++)gl(t[n],e,i);else if(jO(t)||Fd(t))t.forEach(n=>{gl(n,e,i)});else if(HO(t)){for(const n in t)gl(t[n],e,i);for(const n of Object.getOwnPropertySymbols(t))Object.prototype.propertyIsEnumerable.call(t,n)&&gl(t[n],e,i)}return t}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function bp(t,e,i,n){try{return n?t(...n):t()}catch(s){Ey(s,e,i)}}function Vo(t,e,i,n){if(Ei(t)){const s=bp(t,e,i,n);return s&&_I(s)&&s.catch(u=>{Ey(u,e,i)}),s}if(bi(t)){const s=[];for(let u=0;u<t.length;u++)s.push(Vo(t[u],e,i,n));return s}}function Ey(t,e,i,n=!0){const s=e?e.vnode:null,{errorHandler:u,throwUnhandledErrorInProduction:f}=e&&e.appContext.config||hn;if(e){let m=e.parent;const o=e.proxy,v=`https://vuejs.org/error-reference/#runtime-${i}`;for(;m;){const w=m.ec;if(w){for(let S=0;S<w.length;S++)if(w[S](t,o,v)===!1)return}m=m.parent}if(u){Sl(),bp(u,null,10,[t,o,v]),Il();return}}P4(t,i,s,n,f)}function P4(t,e,i,n=!0,s=!1){if(s)throw t;console.error(t)}const Ur=[];let Mo=-1;const wh=[];let hl=null,uh=0;const FI=Promise.resolve();let a_=null;function k4(t){const e=a_||FI;return t?e.then(this?t.bind(this):t):e}function D4(t){let e=Mo+1,i=Ur.length;for(;e<i;){const n=e+i>>>1,s=Ur[n],u=np(s);u<t||u===t&&s.flags&2?e=n+1:i=n}return e}function Yb(t){if(!(t.flags&1)){const e=np(t),i=Ur[Ur.length-1];!i||!(t.flags&2)&&e>=np(i)?Ur.push(t):Ur.splice(D4(e),0,t),t.flags|=1,NI()}}function NI(){a_||(a_=FI.then(UI))}function O4(t){bi(t)?wh.push(...t):hl&&t.id===-1?hl.splice(uh+1,0,t):t.flags&1||(wh.push(t),t.flags|=1),NI()}function FE(t,e,i=Mo+1){for(;i<Ur.length;i++){const n=Ur[i];if(n&&n.flags&2){if(t&&n.id!==t.uid)continue;Ur.splice(i,1),i--,n.flags&4&&(n.flags&=-2),n(),n.flags&4||(n.flags&=-2)}}}function zI(t){if(wh.length){const e=[...new Set(wh)].sort((i,n)=>np(i)-np(n));if(wh.length=0,hl){hl.push(...e);return}for(hl=e,uh=0;uh<hl.length;uh++){const i=hl[uh];i.flags&4&&(i.flags&=-2),i.flags&8||i(),i.flags&=-2}hl=null,uh=0}}const np=t=>t.id==null?t.flags&2?-1:1/0:t.id;function UI(t){try{for(Mo=0;Mo<Ur.length;Mo++){const e=Ur[Mo];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),bp(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;Mo<Ur.length;Mo++){const e=Ur[Mo];e&&(e.flags&=-2)}Mo=-1,Ur.length=0,zI(),a_=null,(Ur.length||wh.length)&&UI()}}let Lo=null,VI=null;function l_(t){const e=Lo;return Lo=t,VI=t&&t.type.__scopeId||null,e}function L4(t,e=Lo,i){if(!e||t._n)return t;const n=(...s)=>{n._d&&XE(-1);const u=l_(e);let f;try{f=t(...s)}finally{l_(u),n._d&&XE(1)}return f};return n._n=!0,n._c=!0,n._d=!0,n}function xc(t,e,i,n){const s=t.dirs,u=e&&e.dirs;for(let f=0;f<s.length;f++){const m=s[f];u&&(m.oldValue=u[f].value);let o=m.dir[n];o&&(Sl(),Vo(o,i,8,[t.el,m,t,e]),Il())}}const B4=Symbol("_vte"),F4=t=>t.__isTeleport;function Kb(t,e){t.shapeFlag&6&&t.component?(t.transition=e,Kb(t.component.subTree,e)):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function jI(t){t.ids=[t.ids[0]+t.ids[2]+++"-",0,0]}function c_(t,e,i,n,s=!1){if(bi(t)){t.forEach((j,Z)=>c_(j,e&&(bi(e)?e[Z]:e),i,n,s));return}if(jd(n)&&!s){n.shapeFlag&512&&n.type.__asyncResolved&&n.component.subTree.component&&c_(t,e,i,n.component.subTree);return}const u=n.shapeFlag&4?t1(n.component):n.el,f=s?null:u,{i:m,r:o}=t,v=e&&e.r,w=m.refs===hn?m.refs={}:m.refs,S=m.setupState,R=Qi(S),L=S===hn?()=>!1:j=>en(R,j);if(v!=null&&v!==o&&(ur(v)?(w[v]=null,L(v)&&(S[v]=null)):kr(v)&&(v.value=null)),Ei(o))bp(o,m,12,[f,w]);else{const j=ur(o),Z=kr(o);if(j||Z){const re=()=>{if(t.f){const xe=j?L(o)?S[o]:w[o]:o.value;s?bi(xe)&&Fb(xe,u):bi(xe)?xe.includes(u)||xe.push(u):j?(w[o]=[u],L(o)&&(S[o]=w[o])):(o.value=[u],t.k&&(w[t.k]=o.value))}else j?(w[o]=f,L(o)&&(S[o]=f)):Z&&(o.value=f,t.k&&(w[t.k]=f))};f?(re.id=-1,us(re,i)):re()}}}Ty().requestIdleCallback;Ty().cancelIdleCallback;const jd=t=>!!t.type.__asyncLoader,$I=t=>t.type.__isKeepAlive;function N4(t,e){WI(t,"a",e)}function z4(t,e){WI(t,"da",e)}function WI(t,e,i=Vr){const n=t.__wdc||(t.__wdc=()=>{let s=i;for(;s;){if(s.isDeactivated)return;s=s.parent}return t()});if(Ay(e,n,i),i){let s=i.parent;for(;s&&s.parent;)$I(s.parent.vnode)&&U4(n,e,i,s),s=s.parent}}function U4(t,e,i,n){const s=Ay(e,t,n,!0);HI(()=>{Fb(n[e],s)},i)}function Ay(t,e,i=Vr,n=!1){if(i){const s=i[t]||(i[t]=[]),u=e.__weh||(e.__weh=(...f)=>{Sl();const m=wp(i),o=Vo(e,i,t,f);return m(),Il(),o});return n?s.unshift(u):s.push(u),u}}const Sa=t=>(e,i=Vr)=>{(!sp||t==="sp")&&Ay(t,(...n)=>e(...n),i)},V4=Sa("bm"),Hc=Sa("m"),j4=Sa("bu"),$4=Sa("u"),W4=Sa("bum"),HI=Sa("um"),H4=Sa("sp"),X4=Sa("rtg"),q4=Sa("rtc");function G4(t,e=Vr){Ay("ec",t,e)}const Z4=Symbol.for("v-ndc"),mv=t=>t?pC(t)?t1(t):mv(t.parent):null,$d=jr(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>mv(t.parent),$root:t=>mv(t.root),$host:t=>t.ce,$emit:t=>t.emit,$options:t=>qI(t),$forceUpdate:t=>t.f||(t.f=()=>{Yb(t.update)}),$nextTick:t=>t.n||(t.n=k4.bind(t.proxy)),$watch:t=>_L.bind(t)}),ux=(t,e)=>t!==hn&&!t.__isScriptSetup&&en(t,e),Y4={get({_:t},e){if(e==="__v_skip")return!0;const{ctx:i,setupState:n,data:s,props:u,accessCache:f,type:m,appContext:o}=t;let v;if(e[0]!=="$"){const L=f[e];if(L!==void 0)switch(L){case 1:return n[e];case 2:return s[e];case 4:return i[e];case 3:return u[e]}else{if(ux(n,e))return f[e]=1,n[e];if(s!==hn&&en(s,e))return f[e]=2,s[e];if((v=t.propsOptions[0])&&en(v,e))return f[e]=3,u[e];if(i!==hn&&en(i,e))return f[e]=4,i[e];gv&&(f[e]=0)}}const w=$d[e];let S,R;if(w)return e==="$attrs"&&Rr(t.attrs,"get",""),w(t);if((S=m.__cssModules)&&(S=S[e]))return S;if(i!==hn&&en(i,e))return f[e]=4,i[e];if(R=o.config.globalProperties,en(R,e))return R[e]},set({_:t},e,i){const{data:n,setupState:s,ctx:u}=t;return ux(s,e)?(s[e]=i,!0):n!==hn&&en(n,e)?(n[e]=i,!0):en(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(u[e]=i,!0)},has({_:{data:t,setupState:e,accessCache:i,ctx:n,appContext:s,propsOptions:u}},f){let m;return!!i[f]||t!==hn&&en(t,f)||ux(e,f)||(m=u[0])&&en(m,f)||en(n,f)||en($d,f)||en(s.config.globalProperties,f)},defineProperty(t,e,i){return i.get!=null?t._.accessCache[e]=0:en(i,"value")&&this.set(t,e,i.value,null),Reflect.defineProperty(t,e,i)}};function NE(t){return bi(t)?t.reduce((e,i)=>(e[i]=null,e),{}):t}let gv=!0;function K4(t){const e=qI(t),i=t.proxy,n=t.ctx;gv=!1,e.beforeCreate&&zE(e.beforeCreate,t,"bc");const{data:s,computed:u,methods:f,watch:m,provide:o,inject:v,created:w,beforeMount:S,mounted:R,beforeUpdate:L,updated:j,activated:Z,deactivated:re,beforeDestroy:xe,beforeUnmount:be,destroyed:ue,unmounted:oe,render:Ie,renderTracked:me,renderTriggered:ot,errorCaptured:lt,serverPrefetch:_t,expose:rt,inheritAttrs:Ge,components:Ut,directives:Vt,filters:Ot}=e;if(v&&J4(v,n,null),f)for(const ei in f){const ti=f[ei];Ei(ti)&&(n[ei]=ti.bind(i))}if(s){const ei=s.call(i,i);Hn(ei)&&(t.data=qb(ei))}if(gv=!0,u)for(const ei in u){const ti=u[ei],wi=Ei(ti)?ti.bind(i,i):Ei(ti.get)?ti.get.bind(i,i):zo,On=!Ei(ti)&&Ei(ti.set)?ti.set.bind(i):zo,yi=zL({get:wi,set:On});Object.defineProperty(n,ei,{enumerable:!0,configurable:!0,get:()=>yi.value,set:tn=>yi.value=tn})}if(m)for(const ei in m)XI(m[ei],n,i,ei);if(o){const ei=Ei(o)?o.call(i):o;Reflect.ownKeys(ei).forEach(ti=>{rL(ti,ei[ti])})}w&&zE(w,t,"c");function xt(ei,ti){bi(ti)?ti.forEach(wi=>ei(wi.bind(i))):ti&&ei(ti.bind(i))}if(xt(V4,S),xt(Hc,R),xt(j4,L),xt($4,j),xt(N4,Z),xt(z4,re),xt(G4,lt),xt(q4,me),xt(X4,ot),xt(W4,be),xt(HI,oe),xt(H4,_t),bi(rt))if(rt.length){const ei=t.exposed||(t.exposed={});rt.forEach(ti=>{Object.defineProperty(ei,ti,{get:()=>i[ti],set:wi=>i[ti]=wi})})}else t.exposed||(t.exposed={});Ie&&t.render===zo&&(t.render=Ie),Ge!=null&&(t.inheritAttrs=Ge),Ut&&(t.components=Ut),Vt&&(t.directives=Vt),_t&&jI(t)}function J4(t,e,i=zo){bi(t)&&(t=_v(t));for(const n in t){const s=t[n];let u;Hn(s)?"default"in s?u=Vg(s.from||n,s.default,!0):u=Vg(s.from||n):u=Vg(s),kr(u)?Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:()=>u.value,set:f=>u.value=f}):e[n]=u}}function zE(t,e,i){Vo(bi(t)?t.map(n=>n.bind(e.proxy)):t.bind(e.proxy),e,i)}function XI(t,e,i,n){let s=n.includes(".")?aC(i,n):()=>i[n];if(ur(t)){const u=e[t];Ei(u)&&fx(s,u)}else if(Ei(t))fx(s,t.bind(i));else if(Hn(t))if(bi(t))t.forEach(u=>XI(u,e,i,n));else{const u=Ei(t.handler)?t.handler.bind(i):e[t.handler];Ei(u)&&fx(s,u,t)}}function qI(t){const e=t.type,{mixins:i,extends:n}=e,{mixins:s,optionsCache:u,config:{optionMergeStrategies:f}}=t.appContext,m=u.get(e);let o;return m?o=m:!s.length&&!i&&!n?o=e:(o={},s.length&&s.forEach(v=>u_(o,v,f,!0)),u_(o,e,f)),Hn(e)&&u.set(e,o),o}function u_(t,e,i,n=!1){const{mixins:s,extends:u}=e;u&&u_(t,u,i,!0),s&&s.forEach(f=>u_(t,f,i,!0));for(const f in e)if(!(n&&f==="expose")){const m=Q4[f]||i&&i[f];t[f]=m?m(t[f],e[f]):e[f]}return t}const Q4={data:UE,props:VE,emits:VE,methods:Ed,computed:Ed,beforeCreate:Nr,created:Nr,beforeMount:Nr,mounted:Nr,beforeUpdate:Nr,updated:Nr,beforeDestroy:Nr,beforeUnmount:Nr,destroyed:Nr,unmounted:Nr,activated:Nr,deactivated:Nr,errorCaptured:Nr,serverPrefetch:Nr,components:Ed,directives:Ed,watch:tL,provide:UE,inject:eL};function UE(t,e){return e?t?function(){return jr(Ei(t)?t.call(this,this):t,Ei(e)?e.call(this,this):e)}:e:t}function eL(t,e){return Ed(_v(t),_v(e))}function _v(t){if(bi(t)){const e={};for(let i=0;i<t.length;i++)e[t[i]]=t[i];return e}return t}function Nr(t,e){return t?[...new Set([].concat(t,e))]:e}function Ed(t,e){return t?jr(Object.create(null),t,e):e}function VE(t,e){return t?bi(t)&&bi(e)?[...new Set([...t,...e])]:jr(Object.create(null),NE(t),NE(e??{})):e}function tL(t,e){if(!t)return e;if(!e)return t;const i=jr(Object.create(null),t);for(const n in e)i[n]=Nr(t[n],e[n]);return i}function GI(){return{app:null,config:{isNativeTag:UO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let iL=0;function nL(t,e){return function(n,s=null){Ei(n)||(n=jr({},n)),s!=null&&!Hn(s)&&(s=null);const u=GI(),f=new WeakSet,m=[];let o=!1;const v=u.app={_uid:iL++,_component:n,_props:s,_container:null,_context:u,_instance:null,version:UL,get config(){return u.config},set config(w){},use(w,...S){return f.has(w)||(w&&Ei(w.install)?(f.add(w),w.install(v,...S)):Ei(w)&&(f.add(w),w(v,...S))),v},mixin(w){return u.mixins.includes(w)||u.mixins.push(w),v},component(w,S){return S?(u.components[w]=S,v):u.components[w]},directive(w,S){return S?(u.directives[w]=S,v):u.directives[w]},mount(w,S,R){if(!o){const L=v._ceVNode||Pr(n,s);return L.appContext=u,R===!0?R="svg":R===!1&&(R=void 0),t(L,w,R),o=!0,v._container=w,w.__vue_app__=v,t1(L.component)}},onUnmount(w){m.push(w)},unmount(){o&&(Vo(m,v._instance,16),t(null,v._container),delete v._container.__vue_app__)},provide(w,S){return u.provides[w]=S,v},runWithContext(w){const S=Th;Th=v;try{return w()}finally{Th=S}}};return v}}let Th=null;function rL(t,e){if(Vr){let i=Vr.provides;const n=Vr.parent&&Vr.parent.provides;n===i&&(i=Vr.provides=Object.create(n)),i[t]=e}}function Vg(t,e,i=!1){const n=Vr||Lo;if(n||Th){const s=Th?Th._context.provides:n?n.parent==null?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(s&&t in s)return s[t];if(arguments.length>1)return i&&Ei(e)?e.call(n&&n.proxy):e}}const ZI={},YI=()=>Object.create(ZI),KI=t=>Object.getPrototypeOf(t)===ZI;function sL(t,e,i,n=!1){const s={},u=YI();t.propsDefaults=Object.create(null),JI(t,e,s,u);for(const f in t.propsOptions[0])f in s||(s[f]=void 0);i?t.props=n?s:b4(s):t.type.props?t.props=s:t.props=u,t.attrs=u}function oL(t,e,i,n){const{props:s,attrs:u,vnode:{patchFlag:f}}=t,m=Qi(s),[o]=t.propsOptions;let v=!1;if((n||f>0)&&!(f&16)){if(f&8){const w=t.vnode.dynamicProps;for(let S=0;S<w.length;S++){let R=w[S];if(Sy(t.emitsOptions,R))continue;const L=e[R];if(o)if(en(u,R))L!==u[R]&&(u[R]=L,v=!0);else{const j=Tl(R);s[j]=yv(o,m,j,L,t,!1)}else L!==u[R]&&(u[R]=L,v=!0)}}}else{JI(t,e,s,u)&&(v=!0);let w;for(const S in m)(!e||!en(e,S)&&((w=Wc(S))===S||!en(e,w)))&&(o?i&&(i[S]!==void 0||i[w]!==void 0)&&(s[S]=yv(o,m,S,void 0,t,!0)):delete s[S]);if(u!==m)for(const S in u)(!e||!en(e,S))&&(delete u[S],v=!0)}v&&va(t.attrs,"set","")}function JI(t,e,i,n){const[s,u]=t.propsOptions;let f=!1,m;if(e)for(let o in e){if(Nd(o))continue;const v=e[o];let w;s&&en(s,w=Tl(o))?!u||!u.includes(w)?i[w]=v:(m||(m={}))[w]=v:Sy(t.emitsOptions,o)||(!(o in n)||v!==n[o])&&(n[o]=v,f=!0)}if(u){const o=Qi(i),v=m||hn;for(let w=0;w<u.length;w++){const S=u[w];i[S]=yv(s,o,S,v[S],t,!en(v,S))}}return f}function yv(t,e,i,n,s,u){const f=t[i];if(f!=null){const m=en(f,"default");if(m&&n===void 0){const o=f.default;if(f.type!==Function&&!f.skipFactory&&Ei(o)){const{propsDefaults:v}=s;if(i in v)n=v[i];else{const w=wp(s);n=v[i]=o.call(null,e),w()}}else n=o;s.ce&&s.ce._setProp(i,n)}f[0]&&(u&&!m?n=!1:f[1]&&(n===""||n===Wc(i))&&(n=!0))}return n}const aL=new WeakMap;function QI(t,e,i=!1){const n=i?aL:e.propsCache,s=n.get(t);if(s)return s;const u=t.props,f={},m=[];let o=!1;if(!Ei(t)){const w=S=>{o=!0;const[R,L]=QI(S,e,!0);jr(f,R),L&&m.push(...L)};!i&&e.mixins.length&&e.mixins.forEach(w),t.extends&&w(t.extends),t.mixins&&t.mixins.forEach(w)}if(!u&&!o)return Hn(t)&&n.set(t,bh),bh;if(bi(u))for(let w=0;w<u.length;w++){const S=Tl(u[w]);jE(S)&&(f[S]=hn)}else if(u)for(const w in u){const S=Tl(w);if(jE(S)){const R=u[w],L=f[S]=bi(R)||Ei(R)?{type:R}:jr({},R),j=L.type;let Z=!1,re=!0;if(bi(j))for(let xe=0;xe<j.length;++xe){const be=j[xe],ue=Ei(be)&&be.name;if(ue==="Boolean"){Z=!0;break}else ue==="String"&&(re=!1)}else Z=Ei(j)&&j.name==="Boolean";L[0]=Z,L[1]=re,(Z||en(L,"default"))&&m.push(S)}}const v=[f,m];return Hn(t)&&n.set(t,v),v}function jE(t){return t[0]!=="$"&&!Nd(t)}const eC=t=>t[0]==="_"||t==="$stable",Jb=t=>bi(t)?t.map(Po):[Po(t)],lL=(t,e,i)=>{if(e._n)return e;const n=L4((...s)=>Jb(e(...s)),i);return n._c=!1,n},tC=(t,e,i)=>{const n=t._ctx;for(const s in t){if(eC(s))continue;const u=t[s];if(Ei(u))e[s]=lL(s,u,n);else if(u!=null){const f=Jb(u);e[s]=()=>f}}},iC=(t,e)=>{const i=Jb(e);t.slots.default=()=>i},nC=(t,e,i)=>{for(const n in e)(i||n!=="_")&&(t[n]=e[n])},cL=(t,e,i)=>{const n=t.slots=YI();if(t.vnode.shapeFlag&32){const s=e._;s?(nC(n,e,i),i&&xI(n,"_",s,!0)):tC(e,n)}else e&&iC(t,e)},uL=(t,e,i)=>{const{vnode:n,slots:s}=t;let u=!0,f=hn;if(n.shapeFlag&32){const m=e._;m?i&&m===1?u=!1:nC(s,e,i):(u=!e.$stable,tC(e,s)),f=e}else e&&(iC(t,e),f={default:1});if(u)for(const m in s)!eC(m)&&f[m]==null&&delete s[m]},us=EL;function hL(t){return fL(t)}function fL(t,e){const i=Ty();i.__VUE__=!0;const{insert:n,remove:s,patchProp:u,createElement:f,createText:m,createComment:o,setText:v,setElementText:w,parentNode:S,nextSibling:R,setScopeId:L=zo,insertStaticContent:j}=t,Z=(Te,Se,Ke,tt=null,pt=null,yt=null,kt=void 0,At=null,It=!!Se.dynamicChildren)=>{if(Te===Se)return;Te&&!_d(Te,Se)&&(tt=Dr(Te),tn(Te,pt,yt,!0),Te=null),Se.patchFlag===-2&&(It=!1,Se.dynamicChildren=null);const{type:vt,ref:Qt,shapeFlag:Pt}=Se;switch(vt){case Iy:re(Te,Se,Ke,tt);break;case Lc:xe(Te,Se,Ke,tt);break;case jg:Te==null&&be(Se,Ke,tt,kt);break;case _a:Ut(Te,Se,Ke,tt,pt,yt,kt,At,It);break;default:Pt&1?Ie(Te,Se,Ke,tt,pt,yt,kt,At,It):Pt&6?Vt(Te,Se,Ke,tt,pt,yt,kt,At,It):(Pt&64||Pt&128)&&vt.process(Te,Se,Ke,tt,pt,yt,kt,At,It,Or)}Qt!=null&&pt&&c_(Qt,Te&&Te.ref,yt,Se||Te,!Se)},re=(Te,Se,Ke,tt)=>{if(Te==null)n(Se.el=m(Se.children),Ke,tt);else{const pt=Se.el=Te.el;Se.children!==Te.children&&v(pt,Se.children)}},xe=(Te,Se,Ke,tt)=>{Te==null?n(Se.el=o(Se.children||""),Ke,tt):Se.el=Te.el},be=(Te,Se,Ke,tt)=>{[Te.el,Te.anchor]=j(Te.children,Se,Ke,tt,Te.el,Te.anchor)},ue=({el:Te,anchor:Se},Ke,tt)=>{let pt;for(;Te&&Te!==Se;)pt=R(Te),n(Te,Ke,tt),Te=pt;n(Se,Ke,tt)},oe=({el:Te,anchor:Se})=>{let Ke;for(;Te&&Te!==Se;)Ke=R(Te),s(Te),Te=Ke;s(Se)},Ie=(Te,Se,Ke,tt,pt,yt,kt,At,It)=>{Se.type==="svg"?kt="svg":Se.type==="math"&&(kt="mathml"),Te==null?me(Se,Ke,tt,pt,yt,kt,At,It):_t(Te,Se,pt,yt,kt,At,It)},me=(Te,Se,Ke,tt,pt,yt,kt,At)=>{let It,vt;const{props:Qt,shapeFlag:Pt,transition:Ht,dirs:ii}=Te;if(It=Te.el=f(Te.type,yt,Qt&&Qt.is,Qt),Pt&8?w(It,Te.children):Pt&16&&lt(Te.children,It,null,tt,pt,hx(Te,yt),kt,At),ii&&xc(Te,null,tt,"created"),ot(It,Te,Te.scopeId,kt,tt),Qt){for(const ki in Qt)ki!=="value"&&!Nd(ki)&&u(It,ki,null,Qt[ki],yt,tt);"value"in Qt&&u(It,"value",null,Qt.value,yt),(vt=Qt.onVnodeBeforeMount)&&So(vt,tt,Te)}ii&&xc(Te,null,tt,"beforeMount");const pi=dL(pt,Ht);pi&&Ht.beforeEnter(It),n(It,Se,Ke),((vt=Qt&&Qt.onVnodeMounted)||pi||ii)&&us(()=>{vt&&So(vt,tt,Te),pi&&Ht.enter(It),ii&&xc(Te,null,tt,"mounted")},pt)},ot=(Te,Se,Ke,tt,pt)=>{if(Ke&&L(Te,Ke),tt)for(let yt=0;yt<tt.length;yt++)L(Te,tt[yt]);if(pt){let yt=pt.subTree;if(Se===yt||cC(yt.type)&&(yt.ssContent===Se||yt.ssFallback===Se)){const kt=pt.vnode;ot(Te,kt,kt.scopeId,kt.slotScopeIds,pt.parent)}}},lt=(Te,Se,Ke,tt,pt,yt,kt,At,It=0)=>{for(let vt=It;vt<Te.length;vt++){const Qt=Te[vt]=At?fl(Te[vt]):Po(Te[vt]);Z(null,Qt,Se,Ke,tt,pt,yt,kt,At)}},_t=(Te,Se,Ke,tt,pt,yt,kt)=>{const At=Se.el=Te.el;let{patchFlag:It,dynamicChildren:vt,dirs:Qt}=Se;It|=Te.patchFlag&16;const Pt=Te.props||hn,Ht=Se.props||hn;let ii;if(Ke&&vc(Ke,!1),(ii=Ht.onVnodeBeforeUpdate)&&So(ii,Ke,Se,Te),Qt&&xc(Se,Te,Ke,"beforeUpdate"),Ke&&vc(Ke,!0),(Pt.innerHTML&&Ht.innerHTML==null||Pt.textContent&&Ht.textContent==null)&&w(At,""),vt?rt(Te.dynamicChildren,vt,At,Ke,tt,hx(Se,pt),yt):kt||ti(Te,Se,At,null,Ke,tt,hx(Se,pt),yt,!1),It>0){if(It&16)Ge(At,Pt,Ht,Ke,pt);else if(It&2&&Pt.class!==Ht.class&&u(At,"class",null,Ht.class,pt),It&4&&u(At,"style",Pt.style,Ht.style,pt),It&8){const pi=Se.dynamicProps;for(let ki=0;ki<pi.length;ki++){const xi=pi[ki],Cn=Pt[xi],vn=Ht[xi];(vn!==Cn||xi==="value")&&u(At,xi,Cn,vn,pt,Ke)}}It&1&&Te.children!==Se.children&&w(At,Se.children)}else!kt&&vt==null&&Ge(At,Pt,Ht,Ke,pt);((ii=Ht.onVnodeUpdated)||Qt)&&us(()=>{ii&&So(ii,Ke,Se,Te),Qt&&xc(Se,Te,Ke,"updated")},tt)},rt=(Te,Se,Ke,tt,pt,yt,kt)=>{for(let At=0;At<Se.length;At++){const It=Te[At],vt=Se[At],Qt=It.el&&(It.type===_a||!_d(It,vt)||It.shapeFlag&70)?S(It.el):Ke;Z(It,vt,Qt,null,tt,pt,yt,kt,!0)}},Ge=(Te,Se,Ke,tt,pt)=>{if(Se!==Ke){if(Se!==hn)for(const yt in Se)!Nd(yt)&&!(yt in Ke)&&u(Te,yt,Se[yt],null,pt,tt);for(const yt in Ke){if(Nd(yt))continue;const kt=Ke[yt],At=Se[yt];kt!==At&&yt!=="value"&&u(Te,yt,At,kt,pt,tt)}"value"in Ke&&u(Te,"value",Se.value,Ke.value,pt)}},Ut=(Te,Se,Ke,tt,pt,yt,kt,At,It)=>{const vt=Se.el=Te?Te.el:m(""),Qt=Se.anchor=Te?Te.anchor:m("");let{patchFlag:Pt,dynamicChildren:Ht,slotScopeIds:ii}=Se;ii&&(At=At?At.concat(ii):ii),Te==null?(n(vt,Ke,tt),n(Qt,Ke,tt),lt(Se.children||[],Ke,Qt,pt,yt,kt,At,It)):Pt>0&&Pt&64&&Ht&&Te.dynamicChildren?(rt(Te.dynamicChildren,Ht,Ke,pt,yt,kt,At),(Se.key!=null||pt&&Se===pt.subTree)&&rC(Te,Se,!0)):ti(Te,Se,Ke,Qt,pt,yt,kt,At,It)},Vt=(Te,Se,Ke,tt,pt,yt,kt,At,It)=>{Se.slotScopeIds=At,Te==null?Se.shapeFlag&512?pt.ctx.activate(Se,Ke,tt,kt,It):Ot(Se,Ke,tt,pt,yt,kt,It):mt(Te,Se,It)},Ot=(Te,Se,Ke,tt,pt,yt,kt)=>{const At=Te.component=DL(Te,tt,pt);if($I(Te)&&(At.ctx.renderer=Or),OL(At,!1,kt),At.asyncDep){if(pt&&pt.registerDep(At,xt,kt),!Te.el){const It=At.subTree=Pr(Lc);xe(null,It,Se,Ke)}}else xt(At,Te,Se,Ke,pt,yt,kt)},mt=(Te,Se,Ke)=>{const tt=Se.component=Te.component;if(wL(Te,Se,Ke))if(tt.asyncDep&&!tt.asyncResolved){ei(tt,Se,Ke);return}else tt.next=Se,tt.update();else Se.el=Te.el,tt.vnode=Se},xt=(Te,Se,Ke,tt,pt,yt,kt)=>{const At=()=>{if(Te.isMounted){let{next:Pt,bu:Ht,u:ii,parent:pi,vnode:ki}=Te;{const cn=sC(Te);if(cn){Pt&&(Pt.el=ki.el,ei(Te,Pt,kt)),cn.asyncDep.then(()=>{Te.isUnmounted||At()});return}}let xi=Pt,Cn;vc(Te,!1),Pt?(Pt.el=ki.el,ei(Te,Pt,kt)):Pt=ki,Ht&&ox(Ht),(Cn=Pt.props&&Pt.props.onVnodeBeforeUpdate)&&So(Cn,pi,Pt,ki),vc(Te,!0);const vn=WE(Te),qn=Te.subTree;Te.subTree=vn,Z(qn,vn,S(qn.el),Dr(qn),Te,pt,yt),Pt.el=vn.el,xi===null&&TL(Te,vn.el),ii&&us(ii,pt),(Cn=Pt.props&&Pt.props.onVnodeUpdated)&&us(()=>So(Cn,pi,Pt,ki),pt)}else{let Pt;const{el:Ht,props:ii}=Se,{bm:pi,m:ki,parent:xi,root:Cn,type:vn}=Te,qn=jd(Se);vc(Te,!1),pi&&ox(pi),!qn&&(Pt=ii&&ii.onVnodeBeforeMount)&&So(Pt,xi,Se),vc(Te,!0);{Cn.ce&&Cn.ce._injectChildStyle(vn);const cn=Te.subTree=WE(Te);Z(null,cn,Ke,tt,Te,pt,yt),Se.el=cn.el}if(ki&&us(ki,pt),!qn&&(Pt=ii&&ii.onVnodeMounted)){const cn=Se;us(()=>So(Pt,xi,cn),pt)}(Se.shapeFlag&256||xi&&jd(xi.vnode)&&xi.vnode.shapeFlag&256)&&Te.a&&us(Te.a,pt),Te.isMounted=!0,Se=Ke=tt=null}};Te.scope.on();const It=Te.effect=new bI(At);Te.scope.off();const vt=Te.update=It.run.bind(It),Qt=Te.job=It.runIfDirty.bind(It);Qt.i=Te,Qt.id=Te.uid,It.scheduler=()=>Yb(Qt),vc(Te,!0),vt()},ei=(Te,Se,Ke)=>{Se.component=Te;const tt=Te.vnode.props;Te.vnode=Se,Te.next=null,oL(Te,Se.props,tt,Ke),uL(Te,Se.children,Ke),Sl(),FE(Te),Il()},ti=(Te,Se,Ke,tt,pt,yt,kt,At,It=!1)=>{const vt=Te&&Te.children,Qt=Te?Te.shapeFlag:0,Pt=Se.children,{patchFlag:Ht,shapeFlag:ii}=Se;if(Ht>0){if(Ht&128){On(vt,Pt,Ke,tt,pt,yt,kt,At,It);return}else if(Ht&256){wi(vt,Pt,Ke,tt,pt,yt,kt,At,It);return}}ii&8?(Qt&16&&$r(vt,pt,yt),Pt!==vt&&w(Ke,Pt)):Qt&16?ii&16?On(vt,Pt,Ke,tt,pt,yt,kt,At,It):$r(vt,pt,yt,!0):(Qt&8&&w(Ke,""),ii&16&&lt(Pt,Ke,tt,pt,yt,kt,At,It))},wi=(Te,Se,Ke,tt,pt,yt,kt,At,It)=>{Te=Te||bh,Se=Se||bh;const vt=Te.length,Qt=Se.length,Pt=Math.min(vt,Qt);let Ht;for(Ht=0;Ht<Pt;Ht++){const ii=Se[Ht]=It?fl(Se[Ht]):Po(Se[Ht]);Z(Te[Ht],ii,Ke,null,pt,yt,kt,At,It)}vt>Qt?$r(Te,pt,yt,!0,!1,Pt):lt(Se,Ke,tt,pt,yt,kt,At,It,Pt)},On=(Te,Se,Ke,tt,pt,yt,kt,At,It)=>{let vt=0;const Qt=Se.length;let Pt=Te.length-1,Ht=Qt-1;for(;vt<=Pt&&vt<=Ht;){const ii=Te[vt],pi=Se[vt]=It?fl(Se[vt]):Po(Se[vt]);if(_d(ii,pi))Z(ii,pi,Ke,null,pt,yt,kt,At,It);else break;vt++}for(;vt<=Pt&&vt<=Ht;){const ii=Te[Pt],pi=Se[Ht]=It?fl(Se[Ht]):Po(Se[Ht]);if(_d(ii,pi))Z(ii,pi,Ke,null,pt,yt,kt,At,It);else break;Pt--,Ht--}if(vt>Pt){if(vt<=Ht){const ii=Ht+1,pi=ii<Qt?Se[ii].el:tt;for(;vt<=Ht;)Z(null,Se[vt]=It?fl(Se[vt]):Po(Se[vt]),Ke,pi,pt,yt,kt,At,It),vt++}}else if(vt>Ht)for(;vt<=Pt;)tn(Te[vt],pt,yt,!0),vt++;else{const ii=vt,pi=vt,ki=new Map;for(vt=pi;vt<=Ht;vt++){const bn=Se[vt]=It?fl(Se[vt]):Po(Se[vt]);bn.key!=null&&ki.set(bn.key,vt)}let xi,Cn=0;const vn=Ht-pi+1;let qn=!1,cn=0;const is=new Array(vn);for(vt=0;vt<vn;vt++)is[vt]=0;for(vt=ii;vt<=Pt;vt++){const bn=Te[vt];if(Cn>=vn){tn(bn,pt,yt,!0);continue}let ir;if(bn.key!=null)ir=ki.get(bn.key);else for(xi=pi;xi<=Ht;xi++)if(is[xi-pi]===0&&_d(bn,Se[xi])){ir=xi;break}ir===void 0?tn(bn,pt,yt,!0):(is[ir-pi]=vt+1,ir>=cn?cn=ir:qn=!0,Z(bn,Se[ir],Ke,null,pt,yt,kt,At,It),Cn++)}const ns=qn?pL(is):bh;for(xi=ns.length-1,vt=vn-1;vt>=0;vt--){const bn=pi+vt,ir=Se[bn],Os=bn+1<Qt?Se[bn+1].el:tt;is[vt]===0?Z(null,ir,Ke,Os,pt,yt,kt,At,It):qn&&(xi<0||vt!==ns[xi]?yi(ir,Ke,Os,2):xi--)}}},yi=(Te,Se,Ke,tt,pt=null)=>{const{el:yt,type:kt,transition:At,children:It,shapeFlag:vt}=Te;if(vt&6){yi(Te.component.subTree,Se,Ke,tt);return}if(vt&128){Te.suspense.move(Se,Ke,tt);return}if(vt&64){kt.move(Te,Se,Ke,Or);return}if(kt===_a){n(yt,Se,Ke);for(let Pt=0;Pt<It.length;Pt++)yi(It[Pt],Se,Ke,tt);n(Te.anchor,Se,Ke);return}if(kt===jg){ue(Te,Se,Ke);return}if(tt!==2&&vt&1&&At)if(tt===0)At.beforeEnter(yt),n(yt,Se,Ke),us(()=>At.enter(yt),pt);else{const{leave:Pt,delayLeave:Ht,afterLeave:ii}=At,pi=()=>n(yt,Se,Ke),ki=()=>{Pt(yt,()=>{pi(),ii&&ii()})};Ht?Ht(yt,pi,ki):ki()}else n(yt,Se,Ke)},tn=(Te,Se,Ke,tt=!1,pt=!1)=>{const{type:yt,props:kt,ref:At,children:It,dynamicChildren:vt,shapeFlag:Qt,patchFlag:Pt,dirs:Ht,cacheIndex:ii}=Te;if(Pt===-2&&(pt=!1),At!=null&&c_(At,null,Ke,Te,!0),ii!=null&&(Se.renderCache[ii]=void 0),Qt&256){Se.ctx.deactivate(Te);return}const pi=Qt&1&&Ht,ki=!jd(Te);let xi;if(ki&&(xi=kt&&kt.onVnodeBeforeUnmount)&&So(xi,Se,Te),Qt&6)Bn(Te.component,Ke,tt);else{if(Qt&128){Te.suspense.unmount(Ke,tt);return}pi&&xc(Te,null,Se,"beforeUnmount"),Qt&64?Te.type.remove(Te,Se,Ke,Or,tt):vt&&!vt.hasOnce&&(yt!==_a||Pt>0&&Pt&64)?$r(vt,Se,Ke,!1,!0):(yt===_a&&Pt&384||!pt&&Qt&16)&&$r(It,Se,Ke),tt&&Ln(Te)}(ki&&(xi=kt&&kt.onVnodeUnmounted)||pi)&&us(()=>{xi&&So(xi,Se,Te),pi&&xc(Te,null,Se,"unmounted")},Ke)},Ln=Te=>{const{type:Se,el:Ke,anchor:tt,transition:pt}=Te;if(Se===_a){Xn(Ke,tt);return}if(Se===jg){oe(Te);return}const yt=()=>{s(Ke),pt&&!pt.persisted&&pt.afterLeave&&pt.afterLeave()};if(Te.shapeFlag&1&&pt&&!pt.persisted){const{leave:kt,delayLeave:At}=pt,It=()=>kt(Ke,yt);At?At(Te.el,yt,It):It()}else yt()},Xn=(Te,Se)=>{let Ke;for(;Te!==Se;)Ke=R(Te),s(Te),Te=Ke;s(Se)},Bn=(Te,Se,Ke)=>{const{bum:tt,scope:pt,job:yt,subTree:kt,um:At,m:It,a:vt}=Te;$E(It),$E(vt),tt&&ox(tt),pt.stop(),yt&&(yt.flags|=8,tn(kt,Te,Se,Ke)),At&&us(At,Se),us(()=>{Te.isUnmounted=!0},Se),Se&&Se.pendingBranch&&!Se.isUnmounted&&Te.asyncDep&&!Te.asyncResolved&&Te.suspenseId===Se.pendingId&&(Se.deps--,Se.deps===0&&Se.resolve())},$r=(Te,Se,Ke,tt=!1,pt=!1,yt=0)=>{for(let kt=yt;kt<Te.length;kt++)tn(Te[kt],Se,Ke,tt,pt)},Dr=Te=>{if(Te.shapeFlag&6)return Dr(Te.component.subTree);if(Te.shapeFlag&128)return Te.suspense.next();const Se=R(Te.anchor||Te.el),Ke=Se&&Se[B4];return Ke?R(Ke):Se};let gr=!1;const Wr=(Te,Se,Ke)=>{Te==null?Se._vnode&&tn(Se._vnode,null,null,!0):Z(Se._vnode||null,Te,Se,null,null,null,Ke),Se._vnode=Te,gr||(gr=!0,FE(),zI(),gr=!1)},Or={p:Z,um:tn,m:yi,r:Ln,mt:Ot,mc:lt,pc:ti,pbc:rt,n:Dr,o:t};return{render:Wr,hydrate:void 0,createApp:nL(Wr)}}function hx({type:t,props:e},i){return i==="svg"&&t==="foreignObject"||i==="mathml"&&t==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:i}function vc({effect:t,job:e},i){i?(t.flags|=32,e.flags|=4):(t.flags&=-33,e.flags&=-5)}function dL(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}function rC(t,e,i=!1){const n=t.children,s=e.children;if(bi(n)&&bi(s))for(let u=0;u<n.length;u++){const f=n[u];let m=s[u];m.shapeFlag&1&&!m.dynamicChildren&&((m.patchFlag<=0||m.patchFlag===32)&&(m=s[u]=fl(s[u]),m.el=f.el),!i&&m.patchFlag!==-2&&rC(f,m)),m.type===Iy&&(m.el=f.el)}}function pL(t){const e=t.slice(),i=[0];let n,s,u,f,m;const o=t.length;for(n=0;n<o;n++){const v=t[n];if(v!==0){if(s=i[i.length-1],t[s]<v){e[n]=s,i.push(n);continue}for(u=0,f=i.length-1;u<f;)m=u+f>>1,t[i[m]]<v?u=m+1:f=m;v<t[i[u]]&&(u>0&&(e[n]=i[u-1]),i[u]=n)}}for(u=i.length,f=i[u-1];u-- >0;)i[u]=f,f=e[f];return i}function sC(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:sC(e)}function $E(t){if(t)for(let e=0;e<t.length;e++)t[e].flags|=8}const mL=Symbol.for("v-scx"),gL=()=>Vg(mL);function fx(t,e,i){return oC(t,e,i)}function oC(t,e,i=hn){const{immediate:n,deep:s,flush:u,once:f}=i,m=jr({},i),o=e&&n||!e&&u!=="post";let v;if(sp){if(u==="sync"){const L=gL();v=L.__watcherHandles||(L.__watcherHandles=[])}else if(!o){const L=()=>{};return L.stop=zo,L.resume=zo,L.pause=zo,L}}const w=Vr;m.call=(L,j,Z)=>Vo(L,w,j,Z);let S=!1;u==="post"?m.scheduler=L=>{us(L,w&&w.suspense)}:u!=="sync"&&(S=!0,m.scheduler=(L,j)=>{j?L():Yb(L)}),m.augmentJob=L=>{e&&(L.flags|=4),S&&(L.flags|=2,w&&(L.id=w.uid,L.i=w))};const R=R4(t,e,m);return sp&&(v?v.push(R):o&&R()),R}function _L(t,e,i){const n=this.proxy,s=ur(t)?t.includes(".")?aC(n,t):()=>n[t]:t.bind(n,n);let u;Ei(e)?u=e:(u=e.handler,i=e);const f=wp(this),m=oC(s,u.bind(n),i);return f(),m}function aC(t,e){const i=e.split(".");return()=>{let n=t;for(let s=0;s<i.length&&n;s++)n=n[i[s]];return n}}const yL=(t,e)=>e==="modelValue"||e==="model-value"?t.modelModifiers:t[`${e}Modifiers`]||t[`${Tl(e)}Modifiers`]||t[`${Wc(e)}Modifiers`];function xL(t,e,...i){if(t.isUnmounted)return;const n=t.vnode.props||hn;let s=i;const u=e.startsWith("update:"),f=u&&yL(n,e.slice(7));f&&(f.trim&&(s=i.map(w=>ur(w)?w.trim():w)),f.number&&(s=i.map(GO)));let m,o=n[m=sx(e)]||n[m=sx(Tl(e))];!o&&u&&(o=n[m=sx(Wc(e))]),o&&Vo(o,t,6,s);const v=n[m+"Once"];if(v){if(!t.emitted)t.emitted={};else if(t.emitted[m])return;t.emitted[m]=!0,Vo(v,t,6,s)}}function lC(t,e,i=!1){const n=e.emitsCache,s=n.get(t);if(s!==void 0)return s;const u=t.emits;let f={},m=!1;if(!Ei(t)){const o=v=>{const w=lC(v,e,!0);w&&(m=!0,jr(f,w))};!i&&e.mixins.length&&e.mixins.forEach(o),t.extends&&o(t.extends),t.mixins&&t.mixins.forEach(o)}return!u&&!m?(Hn(t)&&n.set(t,null),null):(bi(u)?u.forEach(o=>f[o]=null):jr(f,u),Hn(t)&&n.set(t,f),f)}function Sy(t,e){return!t||!vy(e)?!1:(e=e.slice(2).replace(/Once$/,""),en(t,e[0].toLowerCase()+e.slice(1))||en(t,Wc(e))||en(t,e))}function WE(t){const{type:e,vnode:i,proxy:n,withProxy:s,propsOptions:[u],slots:f,attrs:m,emit:o,render:v,renderCache:w,props:S,data:R,setupState:L,ctx:j,inheritAttrs:Z}=t,re=l_(t);let xe,be;try{if(i.shapeFlag&4){const oe=s||n,Ie=oe;xe=Po(v.call(Ie,oe,w,S,L,R,j)),be=m}else{const oe=e;xe=Po(oe.length>1?oe(S,{attrs:m,slots:f,emit:o}):oe(S,null)),be=e.props?m:vL(m)}}catch(oe){Wd.length=0,Ey(oe,t,1),xe=Pr(Lc)}let ue=xe;if(be&&Z!==!1){const oe=Object.keys(be),{shapeFlag:Ie}=ue;oe.length&&Ie&7&&(u&&oe.some(Bb)&&(be=bL(be,u)),ue=Ih(ue,be,!1,!0))}return i.dirs&&(ue=Ih(ue,null,!1,!0),ue.dirs=ue.dirs?ue.dirs.concat(i.dirs):i.dirs),i.transition&&Kb(ue,i.transition),xe=ue,l_(re),xe}const vL=t=>{let e;for(const i in t)(i==="class"||i==="style"||vy(i))&&((e||(e={}))[i]=t[i]);return e},bL=(t,e)=>{const i={};for(const n in t)(!Bb(n)||!(n.slice(9)in e))&&(i[n]=t[n]);return i};function wL(t,e,i){const{props:n,children:s,component:u}=t,{props:f,children:m,patchFlag:o}=e,v=u.emitsOptions;if(e.dirs||e.transition)return!0;if(i&&o>=0){if(o&1024)return!0;if(o&16)return n?HE(n,f,v):!!f;if(o&8){const w=e.dynamicProps;for(let S=0;S<w.length;S++){const R=w[S];if(f[R]!==n[R]&&!Sy(v,R))return!0}}}else return(s||m)&&(!m||!m.$stable)?!0:n===f?!1:n?f?HE(n,f,v):!0:!!f;return!1}function HE(t,e,i){const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!0;for(let s=0;s<n.length;s++){const u=n[s];if(e[u]!==t[u]&&!Sy(i,u))return!0}return!1}function TL({vnode:t,parent:e},i){for(;e;){const n=e.subTree;if(n.suspense&&n.suspense.activeBranch===t&&(n.el=t.el),n===t)(t=e.vnode).el=i,e=e.parent;else break}}const cC=t=>t.__isSuspense;function EL(t,e){e&&e.pendingBranch?bi(t)?e.effects.push(...t):e.effects.push(t):O4(t)}const _a=Symbol.for("v-fgt"),Iy=Symbol.for("v-txt"),Lc=Symbol.for("v-cmt"),jg=Symbol.for("v-stc"),Wd=[];let ms=null;function no(t=!1){Wd.push(ms=t?null:[])}function AL(){Wd.pop(),ms=Wd[Wd.length-1]||null}let rp=1;function XE(t,e=!1){rp+=t,t<0&&ms&&e&&(ms.hasOnce=!0)}function uC(t){return t.dynamicChildren=rp>0?ms||bh:null,AL(),rp>0&&ms&&ms.push(t),t}function jo(t,e,i,n,s,u){return uC(Li(t,e,i,n,s,u,!0))}function SL(t,e,i,n,s){return uC(Pr(t,e,i,n,s,!0))}function hC(t){return t?t.__v_isVNode===!0:!1}function _d(t,e){return t.type===e.type&&t.key===e.key}const fC=({key:t})=>t??null,$g=({ref:t,ref_key:e,ref_for:i})=>(typeof t=="number"&&(t=""+t),t!=null?ur(t)||kr(t)||Ei(t)?{i:Lo,r:t,k:e,f:!!i}:t:null);function Li(t,e=null,i=null,n=0,s=null,u=t===_a?0:1,f=!1,m=!1){const o={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&fC(e),ref:e&&$g(e),scopeId:VI,slotScopeIds:null,children:i,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:u,patchFlag:n,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Lo};return m?(e1(o,i),u&128&&t.normalize(o)):i&&(o.shapeFlag|=ur(i)?8:16),rp>0&&!f&&ms&&(o.patchFlag>0||u&6)&&o.patchFlag!==32&&ms.push(o),o}const Pr=IL;function IL(t,e=null,i=null,n=0,s=null,u=!1){if((!t||t===Z4)&&(t=Lc),hC(t)){const m=Ih(t,e,!0);return i&&e1(m,i),rp>0&&!u&&ms&&(m.shapeFlag&6?ms[ms.indexOf(t)]=m:ms.push(m)),m.patchFlag=-2,m}if(NL(t)&&(t=t.__vccOpts),e){e=CL(e);let{class:m,style:o}=e;m&&!ur(m)&&(e.class=Ub(m)),Hn(o)&&(Zb(o)&&!bi(o)&&(o=jr({},o)),e.style=zb(o))}const f=ur(t)?1:cC(t)?128:F4(t)?64:Hn(t)?4:Ei(t)?2:0;return Li(t,e,i,n,s,f,u,!0)}function CL(t){return t?Zb(t)||KI(t)?jr({},t):t:null}function Ih(t,e,i=!1,n=!1){const{props:s,ref:u,patchFlag:f,children:m,transition:o}=t,v=e?RL(s||{},e):s,w={__v_isVNode:!0,__v_skip:!0,type:t.type,props:v,key:v&&fC(v),ref:e&&e.ref?i&&u?bi(u)?u.concat($g(e)):[u,$g(e)]:$g(e):u,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:m,target:t.target,targetStart:t.targetStart,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==_a?f===-1?16:f|16:f,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:o,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Ih(t.ssContent),ssFallback:t.ssFallback&&Ih(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return o&&n&&Kb(w,o.clone(w)),w}function ML(t=" ",e=0){return Pr(Iy,null,t,e)}function dC(t,e){const i=Pr(jg,null,t);return i.staticCount=e,i}function Qb(t="",e=!1){return e?(no(),SL(Lc,null,t)):Pr(Lc,null,t)}function Po(t){return t==null||typeof t=="boolean"?Pr(Lc):bi(t)?Pr(_a,null,t.slice()):hC(t)?fl(t):Pr(Iy,null,String(t))}function fl(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:Ih(t)}function e1(t,e){let i=0;const{shapeFlag:n}=t;if(e==null)e=null;else if(bi(e))i=16;else if(typeof e=="object")if(n&65){const s=e.default;s&&(s._c&&(s._d=!1),e1(t,s()),s._c&&(s._d=!0));return}else{i=32;const s=e._;!s&&!KI(e)?e._ctx=Lo:s===3&&Lo&&(Lo.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else Ei(e)?(e={default:e,_ctx:Lo},i=32):(e=String(e),n&64?(i=16,e=[ML(e)]):i=8);t.children=e,t.shapeFlag|=i}function RL(...t){const e={};for(let i=0;i<t.length;i++){const n=t[i];for(const s in n)if(s==="class")e.class!==n.class&&(e.class=Ub([e.class,n.class]));else if(s==="style")e.style=zb([e.style,n.style]);else if(vy(s)){const u=e[s],f=n[s];f&&u!==f&&!(bi(u)&&u.includes(f))&&(e[s]=u?[].concat(u,f):f)}else s!==""&&(e[s]=n[s])}return e}function So(t,e,i,n=null){Vo(t,e,7,[i,n])}const PL=GI();let kL=0;function DL(t,e,i){const n=t.type,s=(e?e.appContext:t.appContext)||PL,u={uid:kL++,vnode:t,type:n,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new t4(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:QI(n,s),emitsOptions:lC(n,s),emit:null,emitted:null,propsDefaults:hn,inheritAttrs:n.inheritAttrs,ctx:hn,data:hn,props:hn,attrs:hn,slots:hn,refs:hn,setupState:hn,setupContext:null,suspense:i,suspenseId:i?i.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return u.ctx={_:u},u.root=e?e.root:u,u.emit=xL.bind(null,u),t.ce&&t.ce(u),u}let Vr=null,h_,xv;{const t=Ty(),e=(i,n)=>{let s;return(s=t[i])||(s=t[i]=[]),s.push(n),u=>{s.length>1?s.forEach(f=>f(u)):s[0](u)}};h_=e("__VUE_INSTANCE_SETTERS__",i=>Vr=i),xv=e("__VUE_SSR_SETTERS__",i=>sp=i)}const wp=t=>{const e=Vr;return h_(t),t.scope.on(),()=>{t.scope.off(),h_(e)}},qE=()=>{Vr&&Vr.scope.off(),h_(null)};function pC(t){return t.vnode.shapeFlag&4}let sp=!1;function OL(t,e=!1,i=!1){e&&xv(e);const{props:n,children:s}=t.vnode,u=pC(t);sL(t,n,u,e),cL(t,s,i);const f=u?LL(t,e):void 0;return e&&xv(!1),f}function LL(t,e){const i=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,Y4);const{setup:n}=i;if(n){Sl();const s=t.setupContext=n.length>1?FL(t):null,u=wp(t),f=bp(n,t,0,[t.props,s]),m=_I(f);if(Il(),u(),(m||t.sp)&&!jd(t)&&jI(t),m){if(f.then(qE,qE),e)return f.then(o=>{GE(t,o)}).catch(o=>{Ey(o,t,0)});t.asyncDep=f}else GE(t,f)}else mC(t)}function GE(t,e,i){Ei(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:Hn(e)&&(t.setupState=BI(e)),mC(t)}function mC(t,e,i){const n=t.type;t.render||(t.render=n.render||zo);{const s=wp(t);Sl();try{K4(t)}finally{Il(),s()}}}const BL={get(t,e){return Rr(t,"get",""),t[e]}};function FL(t){const e=i=>{t.exposed=i||{}};return{attrs:new Proxy(t.attrs,BL),slots:t.slots,emit:t.emit,expose:e}}function t1(t){return t.exposed?t.exposeProxy||(t.exposeProxy=new Proxy(BI(w4(t.exposed)),{get(e,i){if(i in e)return e[i];if(i in $d)return $d[i](t)},has(e,i){return i in e||i in $d}})):t.proxy}function NL(t){return Ei(t)&&"__vccOpts"in t}const zL=(t,e)=>C4(t,e,sp),UL="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let vv;const ZE=typeof window<"u"&&window.trustedTypes;if(ZE)try{vv=ZE.createPolicy("vue",{createHTML:t=>t})}catch{}const gC=vv?t=>vv.createHTML(t):t=>t,VL="http://www.w3.org/2000/svg",jL="http://www.w3.org/1998/Math/MathML",ga=typeof document<"u"?document:null,YE=ga&&ga.createElement("template"),$L={insert:(t,e,i)=>{e.insertBefore(t,i||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,i,n)=>{const s=e==="svg"?ga.createElementNS(VL,t):e==="mathml"?ga.createElementNS(jL,t):i?ga.createElement(t,{is:i}):ga.createElement(t);return t==="select"&&n&&n.multiple!=null&&s.setAttribute("multiple",n.multiple),s},createText:t=>ga.createTextNode(t),createComment:t=>ga.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>ga.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,i,n,s,u){const f=i?i.previousSibling:e.lastChild;if(s&&(s===u||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),i),!(s===u||!(s=s.nextSibling)););else{YE.innerHTML=gC(n==="svg"?`<svg>${t}</svg>`:n==="mathml"?`<math>${t}</math>`:t);const m=YE.content;if(n==="svg"||n==="mathml"){const o=m.firstChild;for(;o.firstChild;)m.appendChild(o.firstChild);m.removeChild(o)}e.insertBefore(m,i)}return[f?f.nextSibling:e.firstChild,i?i.previousSibling:e.lastChild]}},WL=Symbol("_vtc");function HL(t,e,i){const n=t[WL];n&&(e=(e?[e,...n]:[...n]).join(" ")),e==null?t.removeAttribute("class"):i?t.setAttribute("class",e):t.className=e}const KE=Symbol("_vod"),XL=Symbol("_vsh"),qL=Symbol(""),GL=/(^|;)\s*display\s*:/;function ZL(t,e,i){const n=t.style,s=ur(i);let u=!1;if(i&&!s){if(e)if(ur(e))for(const f of e.split(";")){const m=f.slice(0,f.indexOf(":")).trim();i[m]==null&&Wg(n,m,"")}else for(const f in e)i[f]==null&&Wg(n,f,"");for(const f in i)f==="display"&&(u=!0),Wg(n,f,i[f])}else if(s){if(e!==i){const f=n[qL];f&&(i+=";"+f),n.cssText=i,u=GL.test(i)}}else e&&t.removeAttribute("style");KE in t&&(t[KE]=u?n.display:"",t[XL]&&(n.display="none"))}const JE=/\s*!important$/;function Wg(t,e,i){if(bi(i))i.forEach(n=>Wg(t,e,n));else if(i==null&&(i=""),e.startsWith("--"))t.setProperty(e,i);else{const n=YL(t,e);JE.test(i)?t.setProperty(Wc(n),i.replace(JE,""),"important"):t[n]=i}}const QE=["Webkit","Moz","ms"],dx={};function YL(t,e){const i=dx[e];if(i)return i;let n=Tl(e);if(n!=="filter"&&n in t)return dx[e]=n;n=yI(n);for(let s=0;s<QE.length;s++){const u=QE[s]+n;if(u in t)return dx[e]=u}return e}const eA="http://www.w3.org/1999/xlink";function tA(t,e,i,n,s,u=e4(e)){n&&e.startsWith("xlink:")?i==null?t.removeAttributeNS(eA,e.slice(6,e.length)):t.setAttributeNS(eA,e,i):i==null||u&&!vI(i)?t.removeAttribute(e):t.setAttribute(e,u?"":Hh(i)?String(i):i)}function iA(t,e,i,n,s){if(e==="innerHTML"||e==="textContent"){i!=null&&(t[e]=e==="innerHTML"?gC(i):i);return}const u=t.tagName;if(e==="value"&&u!=="PROGRESS"&&!u.includes("-")){const m=u==="OPTION"?t.getAttribute("value")||"":t.value,o=i==null?t.type==="checkbox"?"on":"":String(i);(m!==o||!("_value"in t))&&(t.value=o),i==null&&t.removeAttribute(e),t._value=i;return}let f=!1;if(i===""||i==null){const m=typeof t[e];m==="boolean"?i=vI(i):i==null&&m==="string"?(i="",f=!0):m==="number"&&(i=0,f=!0)}try{t[e]=i}catch{}f&&t.removeAttribute(s||e)}function KL(t,e,i,n){t.addEventListener(e,i,n)}function JL(t,e,i,n){t.removeEventListener(e,i,n)}const nA=Symbol("_vei");function QL(t,e,i,n,s=null){const u=t[nA]||(t[nA]={}),f=u[e];if(n&&f)f.value=n;else{const[m,o]=eB(e);if(n){const v=u[e]=nB(n,s);KL(t,m,v,o)}else f&&(JL(t,m,f,o),u[e]=void 0)}}const rA=/(?:Once|Passive|Capture)$/;function eB(t){let e;if(rA.test(t)){e={};let n;for(;n=t.match(rA);)t=t.slice(0,t.length-n[0].length),e[n[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Wc(t.slice(2)),e]}let px=0;const tB=Promise.resolve(),iB=()=>px||(tB.then(()=>px=0),px=Date.now());function nB(t,e){const i=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=i.attached)return;Vo(rB(n,i.value),e,5,[n])};return i.value=t,i.attached=iB(),i}function rB(t,e){if(bi(e)){const i=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{i.call(t),t._stopped=!0},e.map(n=>s=>!s._stopped&&n&&n(s))}else return e}const sA=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,sB=(t,e,i,n,s,u)=>{const f=s==="svg";e==="class"?HL(t,n,f):e==="style"?ZL(t,i,n):vy(e)?Bb(e)||QL(t,e,i,n,u):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):oB(t,e,n,f))?(iA(t,e,n),!t.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&tA(t,e,n,f,u,e!=="value")):t._isVueCE&&(/[A-Z]/.test(e)||!ur(n))?iA(t,Tl(e),n,u,e):(e==="true-value"?t._trueValue=n:e==="false-value"&&(t._falseValue=n),tA(t,e,n,f))};function oB(t,e,i,n){if(n)return!!(e==="innerHTML"||e==="textContent"||e in t&&sA(e)&&Ei(i));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=t.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return sA(e)&&ur(i)?!1:e in t}const aB=jr({patchProp:sB},$L);let oA;function lB(){return oA||(oA=hL(aB))}const cB=(...t)=>{const e=lB().createApp(...t),{mount:i}=e;return e.mount=n=>{const s=hB(n);if(!s)return;const u=e._component;!Ei(u)&&!u.render&&!u.template&&(u.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const f=i(s,!1,uB(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),f},e};function uB(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function hB(t){return ur(t)?document.querySelector(t):t}function Hg(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function fB(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function _C(t){let e,i,n;t.length!==2?(e=Hg,i=(m,o)=>Hg(t(m),o),n=(m,o)=>t(m)-o):(e=t===Hg||t===fB?t:dB,i=t,n=t);function s(m,o,v=0,w=m.length){if(v<w){if(e(o,o)!==0)return w;do{const S=v+w>>>1;i(m[S],o)<0?v=S+1:w=S}while(v<w)}return v}function u(m,o,v=0,w=m.length){if(v<w){if(e(o,o)!==0)return w;do{const S=v+w>>>1;i(m[S],o)<=0?v=S+1:w=S}while(v<w)}return v}function f(m,o,v=0,w=m.length){const S=s(m,o,v,w-1);return S>v&&n(m[S-1],o)>-n(m[S],o)?S-1:S}return{left:s,center:f,right:u}}function dB(){return 0}function pB(t){return t===null?NaN:+t}const mB=_C(Hg),gB=mB.right;_C(pB).center;function _B(t,e){let i,n;if(e===void 0)for(const s of t)s!=null&&(i===void 0?s>=s&&(i=n=s):(i>s&&(i=s),n<s&&(n=s)));else{let s=-1;for(let u of t)(u=e(u,++s,t))!=null&&(i===void 0?u>=u&&(i=n=u):(i>u&&(i=u),n<u&&(n=u)))}return[i,n]}class Bc{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const i=this._partials;let n=0;for(let s=0;s<this._n&&s<32;s++){const u=i[s],f=e+u,m=Math.abs(e)<Math.abs(u)?e-(f-u):u-(f-e);m&&(i[n++]=m),e=f}return i[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let i=this._n,n,s,u,f=0;if(i>0){for(f=e[--i];i>0&&(n=f,s=e[--i],f=n+s,u=s-(f-n),!u););i>0&&(u<0&&e[i-1]<0||u>0&&e[i-1]>0)&&(s=u*2,n=f+s,s==n-f&&(f=n))}return f}}const yB=Math.sqrt(50),xB=Math.sqrt(10),vB=Math.sqrt(2);function f_(t,e,i){const n=(e-t)/Math.max(0,i),s=Math.floor(Math.log10(n)),u=n/Math.pow(10,s),f=u>=yB?10:u>=xB?5:u>=vB?2:1;let m,o,v;return s<0?(v=Math.pow(10,-s)/f,m=Math.round(t*v),o=Math.round(e*v),m/v<t&&++m,o/v>e&&--o,v=-v):(v=Math.pow(10,s)*f,m=Math.round(t/v),o=Math.round(e/v),m*v<t&&++m,o*v>e&&--o),o<m&&.5<=i&&i<2?f_(t,e,i*2):[m,o,v]}function yC(t,e,i){if(e=+e,t=+t,i=+i,!(i>0))return[];if(t===e)return[t];const n=e<t,[s,u,f]=n?f_(e,t,i):f_(t,e,i);if(!(u>=s))return[];const m=u-s+1,o=new Array(m);if(n)if(f<0)for(let v=0;v<m;++v)o[v]=(u-v)/-f;else for(let v=0;v<m;++v)o[v]=(u-v)*f;else if(f<0)for(let v=0;v<m;++v)o[v]=(s+v)/-f;else for(let v=0;v<m;++v)o[v]=(s+v)*f;return o}function bv(t,e,i){return e=+e,t=+t,i=+i,f_(t,e,i)[2]}function bB(t,e,i){e=+e,t=+t,i=+i;const n=e<t,s=n?bv(e,t,i):bv(t,e,i);return(n?-1:1)*(s<0?1/-s:s)}function xC(t,e){let i;if(e===void 0)for(const n of t)n!=null&&(i<n||i===void 0&&n>=n)&&(i=n);else{let n=-1;for(let s of t)(s=e(s,++n,t))!=null&&(i<s||i===void 0&&s>=s)&&(i=s)}return i}function wB(t,e){let i;for(const n of t)n!=null&&(i>n||i===void 0&&n>=n)&&(i=n);return i}function*TB(t){for(const e of t)yield*e}function vC(t){return Array.from(TB(t))}function EB(t){return t}var AB=3,aA=1e-6;function SB(t){return"translate("+t+",0)"}function IB(t){return e=>+t(e)}function CB(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),i=>+t(i)+e}function MB(){return!this.__axis}function RB(t,e){var i=[],n=null,s=null,u=6,f=6,m=3,o=typeof window<"u"&&window.devicePixelRatio>1?0:.5,v=1,w="y",S=SB;function R(L){var j=n??(e.ticks?e.ticks.apply(e,i):e.domain()),Z=s??(e.tickFormat?e.tickFormat.apply(e,i):EB),re=Math.max(u,0)+m,xe=e.range(),be=+xe[0]+o,ue=+xe[xe.length-1]+o,oe=(e.bandwidth?CB:IB)(e.copy(),o),Ie=L.selection?L.selection():L,me=Ie.selectAll(".domain").data([null]),ot=Ie.selectAll(".tick").data(j,e).order(),lt=ot.exit(),_t=ot.enter().append("g").attr("class","tick"),rt=ot.select("line"),Ge=ot.select("text");me=me.merge(me.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),ot=ot.merge(_t),rt=rt.merge(_t.append("line").attr("stroke","currentColor").attr(w+"2",v*u)),Ge=Ge.merge(_t.append("text").attr("fill","currentColor").attr(w,v*re).attr("dy","0.71em")),L!==Ie&&(me=me.transition(L),ot=ot.transition(L),rt=rt.transition(L),Ge=Ge.transition(L),lt=lt.transition(L).attr("opacity",aA).attr("transform",function(Ut){return isFinite(Ut=oe(Ut))?S(Ut+o):this.getAttribute("transform")}),_t.attr("opacity",aA).attr("transform",function(Ut){var Vt=this.parentNode.__axis;return S((Vt&&isFinite(Vt=Vt(Ut))?Vt:oe(Ut))+o)})),lt.remove(),me.attr("d",f?"M"+be+","+v*f+"V"+o+"H"+ue+"V"+v*f:"M"+be+","+o+"H"+ue),ot.attr("opacity",1).attr("transform",function(Ut){return S(oe(Ut)+o)}),rt.attr(w+"2",v*u),Ge.attr(w,v*re).text(Z),Ie.filter(MB).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor","middle"),Ie.each(function(){this.__axis=oe})}return R.scale=function(L){return arguments.length?(e=L,R):e},R.ticks=function(){return i=Array.from(arguments),R},R.tickArguments=function(L){return arguments.length?(i=L==null?[]:Array.from(L),R):i.slice()},R.tickValues=function(L){return arguments.length?(n=L==null?null:Array.from(L),R):n&&n.slice()},R.tickFormat=function(L){return arguments.length?(s=L,R):s},R.tickSize=function(L){return arguments.length?(u=f=+L,R):u},R.tickSizeInner=function(L){return arguments.length?(u=+L,R):u},R.tickSizeOuter=function(L){return arguments.length?(f=+L,R):f},R.tickPadding=function(L){return arguments.length?(m=+L,R):m},R.offset=function(L){return arguments.length?(o=+L,R):o},R}function PB(t){return RB(AB,t)}var kB={value:()=>{}};function bC(){for(var t=0,e=arguments.length,i={},n;t<e;++t){if(!(n=arguments[t]+"")||n in i||/[\s.]/.test(n))throw new Error("illegal type: "+n);i[n]=[]}return new Xg(i)}function Xg(t){this._=t}function DB(t,e){return t.trim().split(/^|\s+/).map(function(i){var n="",s=i.indexOf(".");if(s>=0&&(n=i.slice(s+1),i=i.slice(0,s)),i&&!e.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:n}})}Xg.prototype=bC.prototype={constructor:Xg,on:function(t,e){var i=this._,n=DB(t+"",i),s,u=-1,f=n.length;if(arguments.length<2){for(;++u<f;)if((s=(t=n[u]).type)&&(s=OB(i[s],t.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++u<f;)if(s=(t=n[u]).type)i[s]=lA(i[s],t.name,e);else if(e==null)for(s in i)i[s]=lA(i[s],t.name,null);return this},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new Xg(t)},call:function(t,e){if((s=arguments.length-2)>0)for(var i=new Array(s),n=0,s,u;n<s;++n)i[n]=arguments[n+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(u=this._[t],n=0,s=u.length;n<s;++n)u[n].value.apply(e,i)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],s=0,u=n.length;s<u;++s)n[s].value.apply(e,i)}};function OB(t,e){for(var i=0,n=t.length,s;i<n;++i)if((s=t[i]).name===e)return s.value}function lA(t,e,i){for(var n=0,s=t.length;n<s;++n)if(t[n].name===e){t[n]=kB,t=t.slice(0,n).concat(t.slice(n+1));break}return i!=null&&t.push({name:e,value:i}),t}var wv="http://www.w3.org/1999/xhtml";const cA={svg:"http://www.w3.org/2000/svg",xhtml:wv,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Cy(t){var e=t+="",i=e.indexOf(":");return i>=0&&(e=t.slice(0,i))!=="xmlns"&&(t=t.slice(i+1)),cA.hasOwnProperty(e)?{space:cA[e],local:t}:t}function LB(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===wv&&e.documentElement.namespaceURI===wv?e.createElement(t):e.createElementNS(i,t)}}function BB(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function wC(t){var e=Cy(t);return(e.local?BB:LB)(e)}function FB(){}function i1(t){return t==null?FB:function(){return this.querySelector(t)}}function NB(t){typeof t!="function"&&(t=i1(t));for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s)for(var u=e[s],f=u.length,m=n[s]=new Array(f),o,v,w=0;w<f;++w)(o=u[w])&&(v=t.call(o,o.__data__,w,u))&&("__data__"in o&&(v.__data__=o.__data__),m[w]=v);return new _s(n,this._parents)}function zB(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function UB(){return[]}function TC(t){return t==null?UB:function(){return this.querySelectorAll(t)}}function VB(t){return function(){return zB(t.apply(this,arguments))}}function jB(t){typeof t=="function"?t=VB(t):t=TC(t);for(var e=this._groups,i=e.length,n=[],s=[],u=0;u<i;++u)for(var f=e[u],m=f.length,o,v=0;v<m;++v)(o=f[v])&&(n.push(t.call(o,o.__data__,v,f)),s.push(o));return new _s(n,s)}function EC(t){return function(){return this.matches(t)}}function AC(t){return function(e){return e.matches(t)}}var $B=Array.prototype.find;function WB(t){return function(){return $B.call(this.children,t)}}function HB(){return this.firstElementChild}function XB(t){return this.select(t==null?HB:WB(typeof t=="function"?t:AC(t)))}var qB=Array.prototype.filter;function GB(){return Array.from(this.children)}function ZB(t){return function(){return qB.call(this.children,t)}}function YB(t){return this.selectAll(t==null?GB:ZB(typeof t=="function"?t:AC(t)))}function KB(t){typeof t!="function"&&(t=EC(t));for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s)for(var u=e[s],f=u.length,m=n[s]=[],o,v=0;v<f;++v)(o=u[v])&&t.call(o,o.__data__,v,u)&&m.push(o);return new _s(n,this._parents)}function SC(t){return new Array(t.length)}function JB(){return new _s(this._enter||this._groups.map(SC),this._parents)}function d_(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}d_.prototype={constructor:d_,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function QB(t){return function(){return t}}function eF(t,e,i,n,s,u){for(var f=0,m,o=e.length,v=u.length;f<v;++f)(m=e[f])?(m.__data__=u[f],n[f]=m):i[f]=new d_(t,u[f]);for(;f<o;++f)(m=e[f])&&(s[f]=m)}function tF(t,e,i,n,s,u,f){var m,o,v=new Map,w=e.length,S=u.length,R=new Array(w),L;for(m=0;m<w;++m)(o=e[m])&&(R[m]=L=f.call(o,o.__data__,m,e)+"",v.has(L)?s[m]=o:v.set(L,o));for(m=0;m<S;++m)L=f.call(t,u[m],m,u)+"",(o=v.get(L))?(n[m]=o,o.__data__=u[m],v.delete(L)):i[m]=new d_(t,u[m]);for(m=0;m<w;++m)(o=e[m])&&v.get(R[m])===o&&(s[m]=o)}function iF(t){return t.__data__}function nF(t,e){if(!arguments.length)return Array.from(this,iF);var i=e?tF:eF,n=this._parents,s=this._groups;typeof t!="function"&&(t=QB(t));for(var u=s.length,f=new Array(u),m=new Array(u),o=new Array(u),v=0;v<u;++v){var w=n[v],S=s[v],R=S.length,L=rF(t.call(w,w&&w.__data__,v,n)),j=L.length,Z=m[v]=new Array(j),re=f[v]=new Array(j),xe=o[v]=new Array(R);i(w,S,Z,re,xe,L,e);for(var be=0,ue=0,oe,Ie;be<j;++be)if(oe=Z[be]){for(be>=ue&&(ue=be+1);!(Ie=re[ue])&&++ue<j;);oe._next=Ie||null}}return f=new _s(f,n),f._enter=m,f._exit=o,f}function rF(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function sF(){return new _s(this._exit||this._groups.map(SC),this._parents)}function oF(t,e,i){var n=this.enter(),s=this,u=this.exit();return typeof t=="function"?(n=t(n),n&&(n=n.selection())):n=n.append(t+""),e!=null&&(s=e(s),s&&(s=s.selection())),i==null?u.remove():i(u),n&&s?n.merge(s).order():s}function aF(t){for(var e=t.selection?t.selection():t,i=this._groups,n=e._groups,s=i.length,u=n.length,f=Math.min(s,u),m=new Array(s),o=0;o<f;++o)for(var v=i[o],w=n[o],S=v.length,R=m[o]=new Array(S),L,j=0;j<S;++j)(L=v[j]||w[j])&&(R[j]=L);for(;o<s;++o)m[o]=i[o];return new _s(m,this._parents)}function lF(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var n=t[e],s=n.length-1,u=n[s],f;--s>=0;)(f=n[s])&&(u&&f.compareDocumentPosition(u)^4&&u.parentNode.insertBefore(f,u),u=f);return this}function cF(t){t||(t=uF);function e(S,R){return S&&R?t(S.__data__,R.__data__):!S-!R}for(var i=this._groups,n=i.length,s=new Array(n),u=0;u<n;++u){for(var f=i[u],m=f.length,o=s[u]=new Array(m),v,w=0;w<m;++w)(v=f[w])&&(o[w]=v);o.sort(e)}return new _s(s,this._parents).order()}function uF(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function hF(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function fF(){return Array.from(this)}function dF(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],s=0,u=n.length;s<u;++s){var f=n[s];if(f)return f}return null}function pF(){let t=0;for(const e of this)++t;return t}function mF(){return!this.node()}function gF(t){for(var e=this._groups,i=0,n=e.length;i<n;++i)for(var s=e[i],u=0,f=s.length,m;u<f;++u)(m=s[u])&&t.call(m,m.__data__,u,s);return this}function _F(t){return function(){this.removeAttribute(t)}}function yF(t){return function(){this.removeAttributeNS(t.space,t.local)}}function xF(t,e){return function(){this.setAttribute(t,e)}}function vF(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function bF(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(t):this.setAttribute(t,i)}}function wF(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function TF(t,e){var i=Cy(t);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((e==null?i.local?yF:_F:typeof e=="function"?i.local?wF:bF:i.local?vF:xF)(i,e))}function IC(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function EF(t){return function(){this.style.removeProperty(t)}}function AF(t,e,i){return function(){this.style.setProperty(t,e,i)}}function SF(t,e,i){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(t):this.style.setProperty(t,n,i)}}function IF(t,e,i){return arguments.length>1?this.each((e==null?EF:typeof e=="function"?SF:AF)(t,e,i??"")):Ch(this.node(),t)}function Ch(t,e){return t.style.getPropertyValue(e)||IC(t).getComputedStyle(t,null).getPropertyValue(e)}function CF(t){return function(){delete this[t]}}function MF(t,e){return function(){this[t]=e}}function RF(t,e){return function(){var i=e.apply(this,arguments);i==null?delete this[t]:this[t]=i}}function PF(t,e){return arguments.length>1?this.each((e==null?CF:typeof e=="function"?RF:MF)(t,e)):this.node()[t]}function CC(t){return t.trim().split(/^|\s+/)}function n1(t){return t.classList||new MC(t)}function MC(t){this._node=t,this._names=CC(t.getAttribute("class")||"")}MC.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function RC(t,e){for(var i=n1(t),n=-1,s=e.length;++n<s;)i.add(e[n])}function PC(t,e){for(var i=n1(t),n=-1,s=e.length;++n<s;)i.remove(e[n])}function kF(t){return function(){RC(this,t)}}function DF(t){return function(){PC(this,t)}}function OF(t,e){return function(){(e.apply(this,arguments)?RC:PC)(this,t)}}function LF(t,e){var i=CC(t+"");if(arguments.length<2){for(var n=n1(this.node()),s=-1,u=i.length;++s<u;)if(!n.contains(i[s]))return!1;return!0}return this.each((typeof e=="function"?OF:e?kF:DF)(i,e))}function BF(){this.textContent=""}function FF(t){return function(){this.textContent=t}}function NF(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function zF(t){return arguments.length?this.each(t==null?BF:(typeof t=="function"?NF:FF)(t)):this.node().textContent}function UF(){this.innerHTML=""}function VF(t){return function(){this.innerHTML=t}}function jF(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function $F(t){return arguments.length?this.each(t==null?UF:(typeof t=="function"?jF:VF)(t)):this.node().innerHTML}function WF(){this.nextSibling&&this.parentNode.appendChild(this)}function HF(){return this.each(WF)}function XF(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function qF(){return this.each(XF)}function GF(t){var e=typeof t=="function"?t:wC(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function ZF(){return null}function YF(t,e){var i=typeof t=="function"?t:wC(t),n=e==null?ZF:typeof e=="function"?e:i1(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)})}function KF(){var t=this.parentNode;t&&t.removeChild(this)}function JF(){return this.each(KF)}function QF(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function eN(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function tN(t){return this.select(t?eN:QF)}function iN(t){return arguments.length?this.property("__data__",t):this.node().__data__}function nN(t){return function(e){t.call(this,e,this.__data__)}}function rN(t){return t.trim().split(/^|\s+/).map(function(e){var i="",n=e.indexOf(".");return n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),{type:e,name:i}})}function sN(t){return function(){var e=this.__on;if(e){for(var i=0,n=-1,s=e.length,u;i<s;++i)u=e[i],(!t.type||u.type===t.type)&&u.name===t.name?this.removeEventListener(u.type,u.listener,u.options):e[++n]=u;++n?e.length=n:delete this.__on}}}function oN(t,e,i){return function(){var n=this.__on,s,u=nN(e);if(n){for(var f=0,m=n.length;f<m;++f)if((s=n[f]).type===t.type&&s.name===t.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=u,s.options=i),s.value=e;return}}this.addEventListener(t.type,u,i),s={type:t.type,name:t.name,value:e,listener:u,options:i},n?n.push(s):this.__on=[s]}}function aN(t,e,i){var n=rN(t+""),s,u=n.length,f;if(arguments.length<2){var m=this.node().__on;if(m){for(var o=0,v=m.length,w;o<v;++o)for(s=0,w=m[o];s<u;++s)if((f=n[s]).type===w.type&&f.name===w.name)return w.value}return}for(m=e?oN:sN,s=0;s<u;++s)this.each(m(n[s],e,i));return this}function kC(t,e,i){var n=IC(t),s=n.CustomEvent;typeof s=="function"?s=new s(e,i):(s=n.document.createEvent("Event"),i?(s.initEvent(e,i.bubbles,i.cancelable),s.detail=i.detail):s.initEvent(e,!1,!1)),t.dispatchEvent(s)}function lN(t,e){return function(){return kC(this,t,e)}}function cN(t,e){return function(){return kC(this,t,e.apply(this,arguments))}}function uN(t,e){return this.each((typeof e=="function"?cN:lN)(t,e))}function*hN(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],s=0,u=n.length,f;s<u;++s)(f=n[s])&&(yield f)}var DC=[null];function _s(t,e){this._groups=t,this._parents=e}function Tp(){return new _s([[document.documentElement]],DC)}function fN(){return this}_s.prototype=Tp.prototype={constructor:_s,select:NB,selectAll:jB,selectChild:XB,selectChildren:YB,filter:KB,data:nF,enter:JB,exit:sF,join:oF,merge:aF,selection:fN,order:lF,sort:cF,call:hF,nodes:fF,node:dF,size:pF,empty:mF,each:gF,attr:TF,style:IF,property:PF,classed:LF,text:zF,html:$F,raise:HF,lower:qF,append:GF,insert:YF,remove:JF,clone:tN,datum:iN,on:aN,dispatch:uN,[Symbol.iterator]:hN};function Mh(t){return typeof t=="string"?new _s([[document.querySelector(t)]],[document.documentElement]):new _s([[t]],DC)}function r1(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function OC(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}function Ep(){}var op=.7,p_=1/op,Eh="\\s*([+-]?\\d+)\\s*",ap="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Uo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",dN=/^#([0-9a-f]{3,8})$/,pN=new RegExp(`^rgb\\(${Eh},${Eh},${Eh}\\)$`),mN=new RegExp(`^rgb\\(${Uo},${Uo},${Uo}\\)$`),gN=new RegExp(`^rgba\\(${Eh},${Eh},${Eh},${ap}\\)$`),_N=new RegExp(`^rgba\\(${Uo},${Uo},${Uo},${ap}\\)$`),yN=new RegExp(`^hsl\\(${ap},${Uo},${Uo}\\)$`),xN=new RegExp(`^hsla\\(${ap},${Uo},${Uo},${ap}\\)$`),uA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};r1(Ep,Fc,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:hA,formatHex:hA,formatHex8:vN,formatHsl:bN,formatRgb:fA,toString:fA});function hA(){return this.rgb().formatHex()}function vN(){return this.rgb().formatHex8()}function bN(){return LC(this).formatHsl()}function fA(){return this.rgb().formatRgb()}function Fc(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=dN.exec(t))?(i=e[1].length,e=parseInt(e[1],16),i===6?dA(e):i===3?new Qr(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?gg(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?gg(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=pN.exec(t))?new Qr(e[1],e[2],e[3],1):(e=mN.exec(t))?new Qr(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=gN.exec(t))?gg(e[1],e[2],e[3],e[4]):(e=_N.exec(t))?gg(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=yN.exec(t))?gA(e[1],e[2]/100,e[3]/100,1):(e=xN.exec(t))?gA(e[1],e[2]/100,e[3]/100,e[4]):uA.hasOwnProperty(t)?dA(uA[t]):t==="transparent"?new Qr(NaN,NaN,NaN,0):null}function dA(t){return new Qr(t>>16&255,t>>8&255,t&255,1)}function gg(t,e,i,n){return n<=0&&(t=e=i=NaN),new Qr(t,e,i,n)}function wN(t){return t instanceof Ep||(t=Fc(t)),t?(t=t.rgb(),new Qr(t.r,t.g,t.b,t.opacity)):new Qr}function Tv(t,e,i,n){return arguments.length===1?wN(t):new Qr(t,e,i,n??1)}function Qr(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}r1(Qr,Tv,OC(Ep,{brighter(t){return t=t==null?p_:Math.pow(p_,t),new Qr(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?op:Math.pow(op,t),new Qr(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Qr(Mc(this.r),Mc(this.g),Mc(this.b),m_(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:pA,formatHex:pA,formatHex8:TN,formatRgb:mA,toString:mA}));function pA(){return`#${Sc(this.r)}${Sc(this.g)}${Sc(this.b)}`}function TN(){return`#${Sc(this.r)}${Sc(this.g)}${Sc(this.b)}${Sc((isNaN(this.opacity)?1:this.opacity)*255)}`}function mA(){const t=m_(this.opacity);return`${t===1?"rgb(":"rgba("}${Mc(this.r)}, ${Mc(this.g)}, ${Mc(this.b)}${t===1?")":`, ${t})`}`}function m_(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Mc(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Sc(t){return t=Mc(t),(t<16?"0":"")+t.toString(16)}function gA(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new Qs(t,e,i,n)}function LC(t){if(t instanceof Qs)return new Qs(t.h,t.s,t.l,t.opacity);if(t instanceof Ep||(t=Fc(t)),!t)return new Qs;if(t instanceof Qs)return t;t=t.rgb();var e=t.r/255,i=t.g/255,n=t.b/255,s=Math.min(e,i,n),u=Math.max(e,i,n),f=NaN,m=u-s,o=(u+s)/2;return m?(e===u?f=(i-n)/m+(i<n)*6:i===u?f=(n-e)/m+2:f=(e-i)/m+4,m/=o<.5?u+s:2-u-s,f*=60):m=o>0&&o<1?0:f,new Qs(f,m,o,t.opacity)}function EN(t,e,i,n){return arguments.length===1?LC(t):new Qs(t,e,i,n??1)}function Qs(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}r1(Qs,EN,OC(Ep,{brighter(t){return t=t==null?p_:Math.pow(p_,t),new Qs(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?op:Math.pow(op,t),new Qs(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,s=2*i-n;return new Qr(mx(t>=240?t-240:t+120,s,n),mx(t,s,n),mx(t<120?t+240:t-120,s,n),this.opacity)},clamp(){return new Qs(_A(this.h),_g(this.s),_g(this.l),m_(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=m_(this.opacity);return`${t===1?"hsl(":"hsla("}${_A(this.h)}, ${_g(this.s)*100}%, ${_g(this.l)*100}%${t===1?")":`, ${t})`}`}}));function _A(t){return t=(t||0)%360,t<0?t+360:t}function _g(t){return Math.max(0,Math.min(1,t||0))}function mx(t,e,i){return(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)*255}const s1=t=>()=>t;function AN(t,e){return function(i){return t+i*e}}function SN(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}function IN(t){return(t=+t)==1?BC:function(e,i){return i-e?SN(e,i,t):s1(isNaN(e)?i:e)}}function BC(t,e){var i=e-t;return i?AN(t,i):s1(isNaN(t)?e:t)}const g_=function t(e){var i=IN(e);function n(s,u){var f=i((s=Tv(s)).r,(u=Tv(u)).r),m=i(s.g,u.g),o=i(s.b,u.b),v=BC(s.opacity,u.opacity);return function(w){return s.r=f(w),s.g=m(w),s.b=o(w),s.opacity=v(w),s+""}}return n.gamma=t,n}(1);function CN(t,e){e||(e=[]);var i=t?Math.min(e.length,t.length):0,n=e.slice(),s;return function(u){for(s=0;s<i;++s)n[s]=t[s]*(1-u)+e[s]*u;return n}}function MN(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function RN(t,e){var i=e?e.length:0,n=t?Math.min(i,t.length):0,s=new Array(n),u=new Array(i),f;for(f=0;f<n;++f)s[f]=o1(t[f],e[f]);for(;f<i;++f)u[f]=e[f];return function(m){for(f=0;f<n;++f)u[f]=s[f](m);return u}}function PN(t,e){var i=new Date;return t=+t,e=+e,function(n){return i.setTime(t*(1-n)+e*n),i}}function Js(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}function kN(t,e){var i={},n={},s;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in t?i[s]=o1(t[s],e[s]):n[s]=e[s];return function(u){for(s in i)n[s]=i[s](u);return n}}var Ev=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,gx=new RegExp(Ev.source,"g");function DN(t){return function(){return t}}function ON(t){return function(e){return t(e)+""}}function FC(t,e){var i=Ev.lastIndex=gx.lastIndex=0,n,s,u,f=-1,m=[],o=[];for(t=t+"",e=e+"";(n=Ev.exec(t))&&(s=gx.exec(e));)(u=s.index)>i&&(u=e.slice(i,u),m[f]?m[f]+=u:m[++f]=u),(n=n[0])===(s=s[0])?m[f]?m[f]+=s:m[++f]=s:(m[++f]=null,o.push({i:f,x:Js(n,s)})),i=gx.lastIndex;return i<e.length&&(u=e.slice(i),m[f]?m[f]+=u:m[++f]=u),m.length<2?o[0]?ON(o[0].x):DN(e):(e=o.length,function(v){for(var w=0,S;w<e;++w)m[(S=o[w]).i]=S.x(v);return m.join("")})}function o1(t,e){var i=typeof e,n;return e==null||i==="boolean"?s1(e):(i==="number"?Js:i==="string"?(n=Fc(e))?(e=n,g_):FC:e instanceof Fc?g_:e instanceof Date?PN:MN(e)?CN:Array.isArray(e)?RN:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?kN:Js)(t,e)}function LN(t,e){return t=+t,e=+e,function(i){return Math.round(t*(1-i)+e*i)}}var yA=180/Math.PI,Av={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function NC(t,e,i,n,s,u){var f,m,o;return(f=Math.sqrt(t*t+e*e))&&(t/=f,e/=f),(o=t*i+e*n)&&(i-=t*o,n-=e*o),(m=Math.sqrt(i*i+n*n))&&(i/=m,n/=m,o/=m),t*n<e*i&&(t=-t,e=-e,o=-o,f=-f),{translateX:s,translateY:u,rotate:Math.atan2(e,t)*yA,skewX:Math.atan(o)*yA,scaleX:f,scaleY:m}}var yg;function BN(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Av:NC(e.a,e.b,e.c,e.d,e.e,e.f)}function FN(t){return t==null||(yg||(yg=document.createElementNS("http://www.w3.org/2000/svg","g")),yg.setAttribute("transform",t),!(t=yg.transform.baseVal.consolidate()))?Av:(t=t.matrix,NC(t.a,t.b,t.c,t.d,t.e,t.f))}function zC(t,e,i,n){function s(v){return v.length?v.pop()+" ":""}function u(v,w,S,R,L,j){if(v!==S||w!==R){var Z=L.push("translate(",null,e,null,i);j.push({i:Z-4,x:Js(v,S)},{i:Z-2,x:Js(w,R)})}else(S||R)&&L.push("translate("+S+e+R+i)}function f(v,w,S,R){v!==w?(v-w>180?w+=360:w-v>180&&(v+=360),R.push({i:S.push(s(S)+"rotate(",null,n)-2,x:Js(v,w)})):w&&S.push(s(S)+"rotate("+w+n)}function m(v,w,S,R){v!==w?R.push({i:S.push(s(S)+"skewX(",null,n)-2,x:Js(v,w)}):w&&S.push(s(S)+"skewX("+w+n)}function o(v,w,S,R,L,j){if(v!==S||w!==R){var Z=L.push(s(L)+"scale(",null,",",null,")");j.push({i:Z-4,x:Js(v,S)},{i:Z-2,x:Js(w,R)})}else(S!==1||R!==1)&&L.push(s(L)+"scale("+S+","+R+")")}return function(v,w){var S=[],R=[];return v=t(v),w=t(w),u(v.translateX,v.translateY,w.translateX,w.translateY,S,R),f(v.rotate,w.rotate,S,R),m(v.skewX,w.skewX,S,R),o(v.scaleX,v.scaleY,w.scaleX,w.scaleY,S,R),v=w=null,function(L){for(var j=-1,Z=R.length,re;++j<Z;)S[(re=R[j]).i]=re.x(L);return S.join("")}}}var NN=zC(BN,"px, ","px)","deg)"),zN=zC(FN,", ",")",")"),Rh=0,Ad=0,yd=0,UC=1e3,__,Sd,y_=0,Nc=0,My=0,lp=typeof performance=="object"&&performance.now?performance:Date,VC=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function a1(){return Nc||(VC(UN),Nc=lp.now()+My)}function UN(){Nc=0}function x_(){this._call=this._time=this._next=null}x_.prototype=jC.prototype={constructor:x_,restart:function(t,e,i){if(typeof t!="function")throw new TypeError("callback is not a function");i=(i==null?a1():+i)+(e==null?0:+e),!this._next&&Sd!==this&&(Sd?Sd._next=this:__=this,Sd=this),this._call=t,this._time=i,Sv()},stop:function(){this._call&&(this._call=null,this._time=1/0,Sv())}};function jC(t,e,i){var n=new x_;return n.restart(t,e,i),n}function VN(){a1(),++Rh;for(var t=__,e;t;)(e=Nc-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Rh}function xA(){Nc=(y_=lp.now())+My,Rh=Ad=0;try{VN()}finally{Rh=0,$N(),Nc=0}}function jN(){var t=lp.now(),e=t-y_;e>UC&&(My-=e,y_=t)}function $N(){for(var t,e=__,i,n=1/0;e;)e._call?(n>e._time&&(n=e._time),t=e,e=e._next):(i=e._next,e._next=null,e=t?t._next=i:__=i);Sd=t,Sv(n)}function Sv(t){if(!Rh){Ad&&(Ad=clearTimeout(Ad));var e=t-Nc;e>24?(t<1/0&&(Ad=setTimeout(xA,t-lp.now()-My)),yd&&(yd=clearInterval(yd))):(yd||(y_=lp.now(),yd=setInterval(jN,UC)),Rh=1,VC(xA))}}function vA(t,e,i){var n=new x_;return e=e==null?0:+e,n.restart(s=>{n.stop(),t(s+e)},e,i),n}var WN=bC("start","end","cancel","interrupt"),HN=[],$C=0,bA=1,Iv=2,qg=3,wA=4,Cv=5,Gg=6;function Ry(t,e,i,n,s,u){var f=t.__transition;if(!f)t.__transition={};else if(i in f)return;XN(t,i,{name:e,index:n,group:s,on:WN,tween:HN,time:u.time,delay:u.delay,duration:u.duration,ease:u.ease,timer:null,state:$C})}function l1(t,e){var i=so(t,e);if(i.state>$C)throw new Error("too late; already scheduled");return i}function Ho(t,e){var i=so(t,e);if(i.state>qg)throw new Error("too late; already running");return i}function so(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function XN(t,e,i){var n=t.__transition,s;n[e]=i,i.timer=jC(u,0,i.time);function u(v){i.state=bA,i.timer.restart(f,i.delay,i.time),i.delay<=v&&f(v-i.delay)}function f(v){var w,S,R,L;if(i.state!==bA)return o();for(w in n)if(L=n[w],L.name===i.name){if(L.state===qg)return vA(f);L.state===wA?(L.state=Gg,L.timer.stop(),L.on.call("interrupt",t,t.__data__,L.index,L.group),delete n[w]):+w<e&&(L.state=Gg,L.timer.stop(),L.on.call("cancel",t,t.__data__,L.index,L.group),delete n[w])}if(vA(function(){i.state===qg&&(i.state=wA,i.timer.restart(m,i.delay,i.time),m(v))}),i.state=Iv,i.on.call("start",t,t.__data__,i.index,i.group),i.state===Iv){for(i.state=qg,s=new Array(R=i.tween.length),w=0,S=-1;w<R;++w)(L=i.tween[w].value.call(t,t.__data__,i.index,i.group))&&(s[++S]=L);s.length=S+1}}function m(v){for(var w=v<i.duration?i.ease.call(null,v/i.duration):(i.timer.restart(o),i.state=Cv,1),S=-1,R=s.length;++S<R;)s[S].call(t,w);i.state===Cv&&(i.on.call("end",t,t.__data__,i.index,i.group),o())}function o(){i.state=Gg,i.timer.stop(),delete n[e];for(var v in n)return;delete t.__transition}}function qN(t,e){var i=t.__transition,n,s,u=!0,f;if(i){e=e==null?null:e+"";for(f in i){if((n=i[f]).name!==e){u=!1;continue}s=n.state>Iv&&n.state<Cv,n.state=Gg,n.timer.stop(),n.on.call(s?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete i[f]}u&&delete t.__transition}}function GN(t){return this.each(function(){qN(this,t)})}function ZN(t,e){var i,n;return function(){var s=Ho(this,t),u=s.tween;if(u!==i){n=i=u;for(var f=0,m=n.length;f<m;++f)if(n[f].name===e){n=n.slice(),n.splice(f,1);break}}s.tween=n}}function YN(t,e,i){var n,s;if(typeof i!="function")throw new Error;return function(){var u=Ho(this,t),f=u.tween;if(f!==n){s=(n=f).slice();for(var m={name:e,value:i},o=0,v=s.length;o<v;++o)if(s[o].name===e){s[o]=m;break}o===v&&s.push(m)}u.tween=s}}function KN(t,e){var i=this._id;if(t+="",arguments.length<2){for(var n=so(this.node(),i).tween,s=0,u=n.length,f;s<u;++s)if((f=n[s]).name===t)return f.value;return null}return this.each((e==null?ZN:YN)(i,t,e))}function c1(t,e,i){var n=t._id;return t.each(function(){var s=Ho(this,n);(s.value||(s.value={}))[e]=i.apply(this,arguments)}),function(s){return so(s,n).value[e]}}function WC(t,e){var i;return(typeof e=="number"?Js:e instanceof Fc?g_:(i=Fc(e))?(e=i,g_):FC)(t,e)}function JN(t){return function(){this.removeAttribute(t)}}function QN(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ez(t,e,i){var n,s=i+"",u;return function(){var f=this.getAttribute(t);return f===s?null:f===n?u:u=e(n=f,i)}}function tz(t,e,i){var n,s=i+"",u;return function(){var f=this.getAttributeNS(t.space,t.local);return f===s?null:f===n?u:u=e(n=f,i)}}function iz(t,e,i){var n,s,u;return function(){var f,m=i(this),o;return m==null?void this.removeAttribute(t):(f=this.getAttribute(t),o=m+"",f===o?null:f===n&&o===s?u:(s=o,u=e(n=f,m)))}}function nz(t,e,i){var n,s,u;return function(){var f,m=i(this),o;return m==null?void this.removeAttributeNS(t.space,t.local):(f=this.getAttributeNS(t.space,t.local),o=m+"",f===o?null:f===n&&o===s?u:(s=o,u=e(n=f,m)))}}function rz(t,e){var i=Cy(t),n=i==="transform"?zN:WC;return this.attrTween(t,typeof e=="function"?(i.local?nz:iz)(i,n,c1(this,"attr."+t,e)):e==null?(i.local?QN:JN)(i):(i.local?tz:ez)(i,n,e))}function sz(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}function oz(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}function az(t,e){var i,n;function s(){var u=e.apply(this,arguments);return u!==n&&(i=(n=u)&&oz(t,u)),i}return s._value=e,s}function lz(t,e){var i,n;function s(){var u=e.apply(this,arguments);return u!==n&&(i=(n=u)&&sz(t,u)),i}return s._value=e,s}function cz(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;var n=Cy(t);return this.tween(i,(n.local?az:lz)(n,e))}function uz(t,e){return function(){l1(this,t).delay=+e.apply(this,arguments)}}function hz(t,e){return e=+e,function(){l1(this,t).delay=e}}function fz(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?uz:hz)(e,t)):so(this.node(),e).delay}function dz(t,e){return function(){Ho(this,t).duration=+e.apply(this,arguments)}}function pz(t,e){return e=+e,function(){Ho(this,t).duration=e}}function mz(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?dz:pz)(e,t)):so(this.node(),e).duration}function gz(t,e){if(typeof e!="function")throw new Error;return function(){Ho(this,t).ease=e}}function _z(t){var e=this._id;return arguments.length?this.each(gz(e,t)):so(this.node(),e).ease}function yz(t,e){return function(){var i=e.apply(this,arguments);if(typeof i!="function")throw new Error;Ho(this,t).ease=i}}function xz(t){if(typeof t!="function")throw new Error;return this.each(yz(this._id,t))}function vz(t){typeof t!="function"&&(t=EC(t));for(var e=this._groups,i=e.length,n=new Array(i),s=0;s<i;++s)for(var u=e[s],f=u.length,m=n[s]=[],o,v=0;v<f;++v)(o=u[v])&&t.call(o,o.__data__,v,u)&&m.push(o);return new Ea(n,this._parents,this._name,this._id)}function bz(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,n=e.length,s=i.length,u=Math.min(n,s),f=new Array(n),m=0;m<u;++m)for(var o=e[m],v=i[m],w=o.length,S=f[m]=new Array(w),R,L=0;L<w;++L)(R=o[L]||v[L])&&(S[L]=R);for(;m<n;++m)f[m]=e[m];return new Ea(f,this._parents,this._name,this._id)}function wz(t){return(t+"").trim().split(/^|\s+/).every(function(e){var i=e.indexOf(".");return i>=0&&(e=e.slice(0,i)),!e||e==="start"})}function Tz(t,e,i){var n,s,u=wz(e)?l1:Ho;return function(){var f=u(this,t),m=f.on;m!==n&&(s=(n=m).copy()).on(e,i),f.on=s}}function Ez(t,e){var i=this._id;return arguments.length<2?so(this.node(),i).on.on(t):this.each(Tz(i,t,e))}function Az(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}function Sz(){return this.on("end.remove",Az(this._id))}function Iz(t){var e=this._name,i=this._id;typeof t!="function"&&(t=i1(t));for(var n=this._groups,s=n.length,u=new Array(s),f=0;f<s;++f)for(var m=n[f],o=m.length,v=u[f]=new Array(o),w,S,R=0;R<o;++R)(w=m[R])&&(S=t.call(w,w.__data__,R,m))&&("__data__"in w&&(S.__data__=w.__data__),v[R]=S,Ry(v[R],e,i,R,v,so(w,i)));return new Ea(u,this._parents,e,i)}function Cz(t){var e=this._name,i=this._id;typeof t!="function"&&(t=TC(t));for(var n=this._groups,s=n.length,u=[],f=[],m=0;m<s;++m)for(var o=n[m],v=o.length,w,S=0;S<v;++S)if(w=o[S]){for(var R=t.call(w,w.__data__,S,o),L,j=so(w,i),Z=0,re=R.length;Z<re;++Z)(L=R[Z])&&Ry(L,e,i,Z,R,j);u.push(R),f.push(w)}return new Ea(u,f,e,i)}var Mz=Tp.prototype.constructor;function Rz(){return new Mz(this._groups,this._parents)}function Pz(t,e){var i,n,s;return function(){var u=Ch(this,t),f=(this.style.removeProperty(t),Ch(this,t));return u===f?null:u===i&&f===n?s:s=e(i=u,n=f)}}function HC(t){return function(){this.style.removeProperty(t)}}function kz(t,e,i){var n,s=i+"",u;return function(){var f=Ch(this,t);return f===s?null:f===n?u:u=e(n=f,i)}}function Dz(t,e,i){var n,s,u;return function(){var f=Ch(this,t),m=i(this),o=m+"";return m==null&&(o=m=(this.style.removeProperty(t),Ch(this,t))),f===o?null:f===n&&o===s?u:(s=o,u=e(n=f,m))}}function Oz(t,e){var i,n,s,u="style."+e,f="end."+u,m;return function(){var o=Ho(this,t),v=o.on,w=o.value[u]==null?m||(m=HC(e)):void 0;(v!==i||s!==w)&&(n=(i=v).copy()).on(f,s=w),o.on=n}}function Lz(t,e,i){var n=(t+="")=="transform"?NN:WC;return e==null?this.styleTween(t,Pz(t,n)).on("end.style."+t,HC(t)):typeof e=="function"?this.styleTween(t,Dz(t,n,c1(this,"style."+t,e))).each(Oz(this._id,t)):this.styleTween(t,kz(t,n,e),i).on("end.style."+t,null)}function Bz(t,e,i){return function(n){this.style.setProperty(t,e.call(this,n),i)}}function Fz(t,e,i){var n,s;function u(){var f=e.apply(this,arguments);return f!==s&&(n=(s=f)&&Bz(t,f,i)),n}return u._value=e,u}function Nz(t,e,i){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,Fz(t,e,i??""))}function zz(t){return function(){this.textContent=t}}function Uz(t){return function(){var e=t(this);this.textContent=e??""}}function Vz(t){return this.tween("text",typeof t=="function"?Uz(c1(this,"text",t)):zz(t==null?"":t+""))}function jz(t){return function(e){this.textContent=t.call(this,e)}}function $z(t){var e,i;function n(){var s=t.apply(this,arguments);return s!==i&&(e=(i=s)&&jz(s)),e}return n._value=t,n}function Wz(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,$z(t))}function Hz(){for(var t=this._name,e=this._id,i=XC(),n=this._groups,s=n.length,u=0;u<s;++u)for(var f=n[u],m=f.length,o,v=0;v<m;++v)if(o=f[v]){var w=so(o,e);Ry(o,t,i,v,f,{time:w.time+w.delay+w.duration,delay:0,duration:w.duration,ease:w.ease})}return new Ea(n,this._parents,t,i)}function Xz(){var t,e,i=this,n=i._id,s=i.size();return new Promise(function(u,f){var m={value:f},o={value:function(){--s===0&&u()}};i.each(function(){var v=Ho(this,n),w=v.on;w!==t&&(e=(t=w).copy(),e._.cancel.push(m),e._.interrupt.push(m),e._.end.push(o)),v.on=e}),s===0&&u()})}var qz=0;function Ea(t,e,i,n){this._groups=t,this._parents=e,this._name=i,this._id=n}function XC(){return++qz}var ma=Tp.prototype;Ea.prototype={constructor:Ea,select:Iz,selectAll:Cz,selectChild:ma.selectChild,selectChildren:ma.selectChildren,filter:vz,merge:bz,selection:Rz,transition:Hz,call:ma.call,nodes:ma.nodes,node:ma.node,size:ma.size,empty:ma.empty,each:ma.each,on:Ez,attr:rz,attrTween:cz,style:Lz,styleTween:Nz,text:Vz,textTween:Wz,remove:Sz,tween:KN,delay:fz,duration:mz,ease:_z,easeVarying:xz,end:Xz,[Symbol.iterator]:ma[Symbol.iterator]};function Gz(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Zz={time:null,delay:0,duration:250,ease:Gz};function Yz(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return i}function Kz(t){var e,i;t instanceof Ea?(e=t._id,t=t._name):(e=XC(),(i=Zz).time=a1(),t=t==null?null:t+"");for(var n=this._groups,s=n.length,u=0;u<s;++u)for(var f=n[u],m=f.length,o,v=0;v<m;++v)(o=f[v])&&Ry(o,t,e,v,f,i||Yz(o,e));return new Ea(n,this._parents,t,e)}Tp.prototype.interrupt=GN;Tp.prototype.transition=Kz;var TA={},_x={},yx=34,xd=10,xx=13;function qC(t){return new Function("d","return {"+t.map(function(e,i){return JSON.stringify(e)+": d["+i+'] || ""'}).join(",")+"}")}function Jz(t,e){var i=qC(t);return function(n,s){return e(i(n),s,t)}}function EA(t){var e=Object.create(null),i=[];return t.forEach(function(n){for(var s in n)s in e||i.push(e[s]=s)}),i}function Jr(t,e){var i=t+"",n=i.length;return n<e?new Array(e-n+1).join(0)+i:i}function Qz(t){return t<0?"-"+Jr(-t,6):t>9999?"+"+Jr(t,6):Jr(t,4)}function e2(t){var e=t.getUTCHours(),i=t.getUTCMinutes(),n=t.getUTCSeconds(),s=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":Qz(t.getUTCFullYear())+"-"+Jr(t.getUTCMonth()+1,2)+"-"+Jr(t.getUTCDate(),2)+(s?"T"+Jr(e,2)+":"+Jr(i,2)+":"+Jr(n,2)+"."+Jr(s,3)+"Z":n?"T"+Jr(e,2)+":"+Jr(i,2)+":"+Jr(n,2)+"Z":i||e?"T"+Jr(e,2)+":"+Jr(i,2)+"Z":"")}function t2(t){var e=new RegExp('["'+t+`
\r]`),i=t.charCodeAt(0);function n(S,R){var L,j,Z=s(S,function(re,xe){if(L)return L(re,xe-1);j=re,L=R?Jz(re,R):qC(re)});return Z.columns=j||[],Z}function s(S,R){var L=[],j=S.length,Z=0,re=0,xe,be=j<=0,ue=!1;S.charCodeAt(j-1)===xd&&--j,S.charCodeAt(j-1)===xx&&--j;function oe(){if(be)return _x;if(ue)return ue=!1,TA;var me,ot=Z,lt;if(S.charCodeAt(ot)===yx){for(;Z++<j&&S.charCodeAt(Z)!==yx||S.charCodeAt(++Z)===yx;);return(me=Z)>=j?be=!0:(lt=S.charCodeAt(Z++))===xd?ue=!0:lt===xx&&(ue=!0,S.charCodeAt(Z)===xd&&++Z),S.slice(ot+1,me-1).replace(/""/g,'"')}for(;Z<j;){if((lt=S.charCodeAt(me=Z++))===xd)ue=!0;else if(lt===xx)ue=!0,S.charCodeAt(Z)===xd&&++Z;else if(lt!==i)continue;return S.slice(ot,me)}return be=!0,S.slice(ot,j)}for(;(xe=oe())!==_x;){for(var Ie=[];xe!==TA&&xe!==_x;)Ie.push(xe),xe=oe();R&&(Ie=R(Ie,re++))==null||L.push(Ie)}return L}function u(S,R){return S.map(function(L){return R.map(function(j){return w(L[j])}).join(t)})}function f(S,R){return R==null&&(R=EA(S)),[R.map(w).join(t)].concat(u(S,R)).join(`
`)}function m(S,R){return R==null&&(R=EA(S)),u(S,R).join(`
`)}function o(S){return S.map(v).join(`
`)}function v(S){return S.map(w).join(t)}function w(S){return S==null?"":S instanceof Date?e2(S):e.test(S+="")?'"'+S.replace(/"/g,'""')+'"':S}return{parse:n,parseRows:s,format:f,formatBody:m,formatRows:o,formatRow:v,formatValue:w}}var i2=t2(","),Py=i2.parse;function n2(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function r2(t,e){return fetch(t,e).then(n2)}function s2(t){return function(e,i,n){return arguments.length===2&&typeof i=="function"&&(n=i,i=void 0),r2(e,i).then(function(s){return t(s,n)})}}var u1=s2(Py);function o2(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(!(t.status===204||t.status===205))return t.json()}function h1(t,e){return fetch(t,e).then(o2)}function a2(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function v_(t,e){if((i=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var i,n=t.slice(0,i);return[n.length>1?n[0]+n.slice(2):n,+t.slice(i+1)]}function Ph(t){return t=v_(Math.abs(t)),t?t[1]:NaN}function l2(t,e){return function(i,n){for(var s=i.length,u=[],f=0,m=t[0],o=0;s>0&&m>0&&(o+m+1>n&&(m=Math.max(1,n-o)),u.push(i.substring(s-=m,s+m)),!((o+=m+1)>n));)m=t[f=(f+1)%t.length];return u.reverse().join(e)}}function c2(t){return function(e){return e.replace(/[0-9]/g,function(i){return t[+i]})}}var u2=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function b_(t){if(!(e=u2.exec(t)))throw new Error("invalid format: "+t);var e;return new f1({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}b_.prototype=f1.prototype;function f1(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}f1.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function h2(t){e:for(var e=t.length,i=1,n=-1,s;i<e;++i)switch(t[i]){case".":n=s=i;break;case"0":n===0&&(n=i),s=i;break;default:if(!+t[i])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(s+1):t}var GC;function f2(t,e){var i=v_(t,e);if(!i)return t+"";var n=i[0],s=i[1],u=s-(GC=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,f=n.length;return u===f?n:u>f?n+new Array(u-f+1).join("0"):u>0?n.slice(0,u)+"."+n.slice(u):"0."+new Array(1-u).join("0")+v_(t,Math.max(0,e+u-1))[0]}function AA(t,e){var i=v_(t,e);if(!i)return t+"";var n=i[0],s=i[1];return s<0?"0."+new Array(-s).join("0")+n:n.length>s+1?n.slice(0,s+1)+"."+n.slice(s+1):n+new Array(s-n.length+2).join("0")}const SA={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:a2,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>AA(t*100,e),r:AA,s:f2,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function IA(t){return t}var CA=Array.prototype.map,MA=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function d2(t){var e=t.grouping===void 0||t.thousands===void 0?IA:l2(CA.call(t.grouping,Number),t.thousands+""),i=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",s=t.decimal===void 0?".":t.decimal+"",u=t.numerals===void 0?IA:c2(CA.call(t.numerals,String)),f=t.percent===void 0?"%":t.percent+"",m=t.minus===void 0?"":t.minus+"",o=t.nan===void 0?"NaN":t.nan+"";function v(S){S=b_(S);var R=S.fill,L=S.align,j=S.sign,Z=S.symbol,re=S.zero,xe=S.width,be=S.comma,ue=S.precision,oe=S.trim,Ie=S.type;Ie==="n"?(be=!0,Ie="g"):SA[Ie]||(ue===void 0&&(ue=12),oe=!0,Ie="g"),(re||R==="0"&&L==="=")&&(re=!0,R="0",L="=");var me=Z==="$"?i:Z==="#"&&/[boxX]/.test(Ie)?"0"+Ie.toLowerCase():"",ot=Z==="$"?n:/[%p]/.test(Ie)?f:"",lt=SA[Ie],_t=/[defgprs%]/.test(Ie);ue=ue===void 0?6:/[gprs]/.test(Ie)?Math.max(1,Math.min(21,ue)):Math.max(0,Math.min(20,ue));function rt(Ge){var Ut=me,Vt=ot,Ot,mt,xt;if(Ie==="c")Vt=lt(Ge)+Vt,Ge="";else{Ge=+Ge;var ei=Ge<0||1/Ge<0;if(Ge=isNaN(Ge)?o:lt(Math.abs(Ge),ue),oe&&(Ge=h2(Ge)),ei&&+Ge==0&&j!=="+"&&(ei=!1),Ut=(ei?j==="("?j:m:j==="-"||j==="("?"":j)+Ut,Vt=(Ie==="s"?MA[8+GC/3]:"")+Vt+(ei&&j==="("?")":""),_t){for(Ot=-1,mt=Ge.length;++Ot<mt;)if(xt=Ge.charCodeAt(Ot),48>xt||xt>57){Vt=(xt===46?s+Ge.slice(Ot+1):Ge.slice(Ot))+Vt,Ge=Ge.slice(0,Ot);break}}}be&&!re&&(Ge=e(Ge,1/0));var ti=Ut.length+Ge.length+Vt.length,wi=ti<xe?new Array(xe-ti+1).join(R):"";switch(be&&re&&(Ge=e(wi+Ge,wi.length?xe-Vt.length:1/0),wi=""),L){case"<":Ge=Ut+Ge+Vt+wi;break;case"=":Ge=Ut+wi+Ge+Vt;break;case"^":Ge=wi.slice(0,ti=wi.length>>1)+Ut+Ge+Vt+wi.slice(ti);break;default:Ge=wi+Ut+Ge+Vt;break}return u(Ge)}return rt.toString=function(){return S+""},rt}function w(S,R){var L=v((S=b_(S),S.type="f",S)),j=Math.max(-8,Math.min(8,Math.floor(Ph(R)/3)))*3,Z=Math.pow(10,-j),re=MA[8+j/3];return function(xe){return L(Z*xe)+re}}return{format:v,formatPrefix:w}}var xg,kh,ZC;p2({thousands:",",grouping:[3],currency:["$",""]});function p2(t){return xg=d2(t),kh=xg.format,ZC=xg.formatPrefix,xg}function m2(t){return Math.max(0,-Ph(Math.abs(t)))}function g2(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ph(e)/3)))*3-Ph(Math.abs(t)))}function _2(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Ph(e)-Ph(t))+1}var pn=1e-6,Bi=Math.PI,es=Bi/2,RA=Bi/4,ys=Bi*2,fs=180/Bi,$n=Bi/180,In=Math.abs,YC=Math.atan,cp=Math.atan2,Nn=Math.cos,y2=Math.exp,x2=Math.log,zn=Math.sin,v2=Math.sign||function(t){return t>0?1:t<0?-1:0},Xc=Math.sqrt,b2=Math.tan;function w2(t){return t>1?0:t<-1?Bi:Math.acos(t)}function up(t){return t>1?es:t<-1?-es:Math.asin(t)}function Cs(){}function w_(t,e){t&&kA.hasOwnProperty(t.type)&&kA[t.type](t,e)}var PA={Feature:function(t,e){w_(t.geometry,e)},FeatureCollection:function(t,e){for(var i=t.features,n=-1,s=i.length;++n<s;)w_(i[n].geometry,e)}},kA={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var i=t.coordinates,n=-1,s=i.length;++n<s;)t=i[n],e.point(t[0],t[1],t[2])},LineString:function(t,e){Mv(t.coordinates,e,0)},MultiLineString:function(t,e){for(var i=t.coordinates,n=-1,s=i.length;++n<s;)Mv(i[n],e,0)},Polygon:function(t,e){DA(t.coordinates,e)},MultiPolygon:function(t,e){for(var i=t.coordinates,n=-1,s=i.length;++n<s;)DA(i[n],e)},GeometryCollection:function(t,e){for(var i=t.geometries,n=-1,s=i.length;++n<s;)w_(i[n],e)}};function Mv(t,e,i){var n=-1,s=t.length-i,u;for(e.lineStart();++n<s;)u=t[n],e.point(u[0],u[1],u[2]);e.lineEnd()}function DA(t,e){var i=-1,n=t.length;for(e.polygonStart();++i<n;)Mv(t[i],e,1);e.polygonEnd()}function hh(t,e){t&&PA.hasOwnProperty(t.type)?PA[t.type](t,e):w_(t,e)}function Rv(t){return[cp(t[1],t[0]),up(t[2])]}function Dh(t){var e=t[0],i=t[1],n=Nn(i);return[n*Nn(e),n*zn(e),zn(i)]}function vg(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function T_(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function vx(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function bg(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Pv(t){var e=Xc(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function kv(t,e){function i(n,s){return n=t(n,s),e(n[0],n[1])}return t.invert&&e.invert&&(i.invert=function(n,s){return n=e.invert(n,s),n&&t.invert(n[0],n[1])}),i}function Dv(t,e){return In(t)>Bi&&(t-=Math.round(t/ys)*ys),[t,e]}Dv.invert=Dv;function KC(t,e,i){return(t%=ys)?e||i?kv(LA(t),BA(e,i)):LA(t):e||i?BA(e,i):Dv}function OA(t){return function(e,i){return e+=t,In(e)>Bi&&(e-=Math.round(e/ys)*ys),[e,i]}}function LA(t){var e=OA(t);return e.invert=OA(-t),e}function BA(t,e){var i=Nn(t),n=zn(t),s=Nn(e),u=zn(e);function f(m,o){var v=Nn(o),w=Nn(m)*v,S=zn(m)*v,R=zn(o),L=R*i+w*n;return[cp(S*s-L*u,w*i-R*n),up(L*s+S*u)]}return f.invert=function(m,o){var v=Nn(o),w=Nn(m)*v,S=zn(m)*v,R=zn(o),L=R*s-S*u;return[cp(S*s+R*u,w*i+L*n),up(L*i-w*n)]},f}function T2(t){t=KC(t[0]*$n,t[1]*$n,t.length>2?t[2]*$n:0);function e(i){return i=t(i[0]*$n,i[1]*$n),i[0]*=fs,i[1]*=fs,i}return e.invert=function(i){return i=t.invert(i[0]*$n,i[1]*$n),i[0]*=fs,i[1]*=fs,i},e}function E2(t,e,i,n,s,u){if(i){var f=Nn(e),m=zn(e),o=n*i;s==null?(s=e+n*ys,u=e-o/2):(s=FA(f,s),u=FA(f,u),(n>0?s<u:s>u)&&(s+=n*ys));for(var v,w=s;n>0?w>u:w<u;w-=o)v=Rv([f,-m*Nn(w),-m*zn(w)]),t.point(v[0],v[1])}}function FA(t,e){e=Dh(e),e[0]-=t,Pv(e);var i=w2(-e[1]);return((-e[2]<0?-i:i)+ys-pn)%ys}function JC(){var t=[],e;return{point:function(i,n,s){e.push([i,n,s])},lineStart:function(){t.push(e=[])},lineEnd:Cs,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var i=t;return t=[],e=null,i}}}function Zg(t,e){return In(t[0]-e[0])<pn&&In(t[1]-e[1])<pn}function wg(t,e,i,n){this.x=t,this.z=e,this.o=i,this.e=n,this.v=!1,this.n=this.p=null}function QC(t,e,i,n,s){var u=[],f=[],m,o;if(t.forEach(function(j){if(!((Z=j.length-1)<=0)){var Z,re=j[0],xe=j[Z],be;if(Zg(re,xe)){if(!re[2]&&!xe[2]){for(s.lineStart(),m=0;m<Z;++m)s.point((re=j[m])[0],re[1]);s.lineEnd();return}xe[0]+=2*pn}u.push(be=new wg(re,j,null,!0)),f.push(be.o=new wg(re,null,be,!1)),u.push(be=new wg(xe,j,null,!1)),f.push(be.o=new wg(xe,null,be,!0))}}),!!u.length){for(f.sort(e),NA(u),NA(f),m=0,o=f.length;m<o;++m)f[m].e=i=!i;for(var v=u[0],w,S;;){for(var R=v,L=!0;R.v;)if((R=R.n)===v)return;w=R.z,s.lineStart();do{if(R.v=R.o.v=!0,R.e){if(L)for(m=0,o=w.length;m<o;++m)s.point((S=w[m])[0],S[1]);else n(R.x,R.n.x,1,s);R=R.n}else{if(L)for(w=R.p.z,m=w.length-1;m>=0;--m)s.point((S=w[m])[0],S[1]);else n(R.x,R.p.x,-1,s);R=R.p}R=R.o,w=R.z,L=!L}while(!R.v);s.lineEnd()}}}function NA(t){if(e=t.length){for(var e,i=0,n=t[0],s;++i<e;)n.n=s=t[i],s.p=n,n=s;n.n=s=t[0],s.p=n}}function bx(t){return In(t[0])<=Bi?t[0]:v2(t[0])*((In(t[0])+Bi)%ys-Bi)}function A2(t,e){var i=bx(e),n=e[1],s=zn(n),u=[zn(i),-Nn(i),0],f=0,m=0,o=new Bc;s===1?n=es+pn:s===-1&&(n=-es-pn);for(var v=0,w=t.length;v<w;++v)if(R=(S=t[v]).length)for(var S,R,L=S[R-1],j=bx(L),Z=L[1]/2+RA,re=zn(Z),xe=Nn(Z),be=0;be<R;++be,j=oe,re=me,xe=ot,L=ue){var ue=S[be],oe=bx(ue),Ie=ue[1]/2+RA,me=zn(Ie),ot=Nn(Ie),lt=oe-j,_t=lt>=0?1:-1,rt=_t*lt,Ge=rt>Bi,Ut=re*me;if(o.add(cp(Ut*_t*zn(rt),xe*ot+Ut*Nn(rt))),f+=Ge?lt+_t*ys:lt,Ge^j>=i^oe>=i){var Vt=T_(Dh(L),Dh(ue));Pv(Vt);var Ot=T_(u,Vt);Pv(Ot);var mt=(Ge^lt>=0?-1:1)*up(Ot[2]);(n>mt||n===mt&&(Vt[0]||Vt[1]))&&(m+=Ge^lt>=0?1:-1)}}return(f<-1e-6||f<pn&&o<-1e-12)^m&1}function eM(t,e,i,n){return function(s){var u=e(s),f=JC(),m=e(f),o=!1,v,w,S,R={point:L,lineStart:Z,lineEnd:re,polygonStart:function(){R.point=xe,R.lineStart=be,R.lineEnd=ue,w=[],v=[]},polygonEnd:function(){R.point=L,R.lineStart=Z,R.lineEnd=re,w=vC(w);var oe=A2(v,n);w.length?(o||(s.polygonStart(),o=!0),QC(w,I2,oe,i,s)):oe&&(o||(s.polygonStart(),o=!0),s.lineStart(),i(null,null,1,s),s.lineEnd()),o&&(s.polygonEnd(),o=!1),w=v=null},sphere:function(){s.polygonStart(),s.lineStart(),i(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function L(oe,Ie){t(oe,Ie)&&s.point(oe,Ie)}function j(oe,Ie){u.point(oe,Ie)}function Z(){R.point=j,u.lineStart()}function re(){R.point=L,u.lineEnd()}function xe(oe,Ie){S.push([oe,Ie]),m.point(oe,Ie)}function be(){m.lineStart(),S=[]}function ue(){xe(S[0][0],S[0][1]),m.lineEnd();var oe=m.clean(),Ie=f.result(),me,ot=Ie.length,lt,_t,rt;if(S.pop(),v.push(S),S=null,!!ot){if(oe&1){if(_t=Ie[0],(lt=_t.length-1)>0){for(o||(s.polygonStart(),o=!0),s.lineStart(),me=0;me<lt;++me)s.point((rt=_t[me])[0],rt[1]);s.lineEnd()}return}ot>1&&oe&2&&Ie.push(Ie.pop().concat(Ie.shift())),w.push(Ie.filter(S2))}}return R}}function S2(t){return t.length>1}function I2(t,e){return((t=t.x)[0]<0?t[1]-es-pn:es-t[1])-((e=e.x)[0]<0?e[1]-es-pn:es-e[1])}const zA=eM(function(){return!0},C2,R2,[-Bi,-es]);function C2(t){var e=NaN,i=NaN,n=NaN,s;return{lineStart:function(){t.lineStart(),s=1},point:function(u,f){var m=u>0?Bi:-Bi,o=In(u-e);In(o-Bi)<pn?(t.point(e,i=(i+f)/2>0?es:-es),t.point(n,i),t.lineEnd(),t.lineStart(),t.point(m,i),t.point(u,i),s=0):n!==m&&o>=Bi&&(In(e-n)<pn&&(e-=n*pn),In(u-m)<pn&&(u-=m*pn),i=M2(e,i,u,f),t.point(n,i),t.lineEnd(),t.lineStart(),t.point(m,i),s=0),t.point(e=u,i=f),n=m},lineEnd:function(){t.lineEnd(),e=i=NaN},clean:function(){return 2-s}}}function M2(t,e,i,n){var s,u,f=zn(t-i);return In(f)>pn?YC((zn(e)*(u=Nn(n))*zn(i)-zn(n)*(s=Nn(e))*zn(t))/(s*u*f)):(e+n)/2}function R2(t,e,i,n){var s;if(t==null)s=i*es,n.point(-Bi,s),n.point(0,s),n.point(Bi,s),n.point(Bi,0),n.point(Bi,-s),n.point(0,-s),n.point(-Bi,-s),n.point(-Bi,0),n.point(-Bi,s);else if(In(t[0]-e[0])>pn){var u=t[0]<e[0]?Bi:-Bi;s=i*u/2,n.point(-u,s),n.point(0,s),n.point(u,s)}else n.point(e[0],e[1])}function P2(t){var e=Nn(t),i=2*$n,n=e>0,s=In(e)>pn;function u(w,S,R,L){E2(L,t,i,R,w,S)}function f(w,S){return Nn(w)*Nn(S)>e}function m(w){var S,R,L,j,Z;return{lineStart:function(){j=L=!1,Z=1},point:function(re,xe){var be=[re,xe],ue,oe=f(re,xe),Ie=n?oe?0:v(re,xe):oe?v(re+(re<0?Bi:-Bi),xe):0;if(!S&&(j=L=oe)&&w.lineStart(),oe!==L&&(ue=o(S,be),(!ue||Zg(S,ue)||Zg(be,ue))&&(be[2]=1)),oe!==L)Z=0,oe?(w.lineStart(),ue=o(be,S),w.point(ue[0],ue[1])):(ue=o(S,be),w.point(ue[0],ue[1],2),w.lineEnd()),S=ue;else if(s&&S&&n^oe){var me;!(Ie&R)&&(me=o(be,S,!0))&&(Z=0,n?(w.lineStart(),w.point(me[0][0],me[0][1]),w.point(me[1][0],me[1][1]),w.lineEnd()):(w.point(me[1][0],me[1][1]),w.lineEnd(),w.lineStart(),w.point(me[0][0],me[0][1],3)))}oe&&(!S||!Zg(S,be))&&w.point(be[0],be[1]),S=be,L=oe,R=Ie},lineEnd:function(){L&&w.lineEnd(),S=null},clean:function(){return Z|(j&&L)<<1}}}function o(w,S,R){var L=Dh(w),j=Dh(S),Z=[1,0,0],re=T_(L,j),xe=vg(re,re),be=re[0],ue=xe-be*be;if(!ue)return!R&&w;var oe=e*xe/ue,Ie=-e*be/ue,me=T_(Z,re),ot=bg(Z,oe),lt=bg(re,Ie);vx(ot,lt);var _t=me,rt=vg(ot,_t),Ge=vg(_t,_t),Ut=rt*rt-Ge*(vg(ot,ot)-1);if(!(Ut<0)){var Vt=Xc(Ut),Ot=bg(_t,(-rt-Vt)/Ge);if(vx(Ot,ot),Ot=Rv(Ot),!R)return Ot;var mt=w[0],xt=S[0],ei=w[1],ti=S[1],wi;xt<mt&&(wi=mt,mt=xt,xt=wi);var On=xt-mt,yi=In(On-Bi)<pn,tn=yi||On<pn;if(!yi&&ti<ei&&(wi=ei,ei=ti,ti=wi),tn?yi?ei+ti>0^Ot[1]<(In(Ot[0]-mt)<pn?ei:ti):ei<=Ot[1]&&Ot[1]<=ti:On>Bi^(mt<=Ot[0]&&Ot[0]<=xt)){var Ln=bg(_t,(-rt+Vt)/Ge);return vx(Ln,ot),[Ot,Rv(Ln)]}}}function v(w,S){var R=n?t:Bi-t,L=0;return w<-R?L|=1:w>R&&(L|=2),S<-R?L|=4:S>R&&(L|=8),L}return eM(f,m,u,n?[0,-t]:[-Bi,t-Bi])}function k2(t,e,i,n,s,u){var f=t[0],m=t[1],o=e[0],v=e[1],w=0,S=1,R=o-f,L=v-m,j;if(j=i-f,!(!R&&j>0)){if(j/=R,R<0){if(j<w)return;j<S&&(S=j)}else if(R>0){if(j>S)return;j>w&&(w=j)}if(j=s-f,!(!R&&j<0)){if(j/=R,R<0){if(j>S)return;j>w&&(w=j)}else if(R>0){if(j<w)return;j<S&&(S=j)}if(j=n-m,!(!L&&j>0)){if(j/=L,L<0){if(j<w)return;j<S&&(S=j)}else if(L>0){if(j>S)return;j>w&&(w=j)}if(j=u-m,!(!L&&j<0)){if(j/=L,L<0){if(j>S)return;j>w&&(w=j)}else if(L>0){if(j<w)return;j<S&&(S=j)}return w>0&&(t[0]=f+w*R,t[1]=m+w*L),S<1&&(e[0]=f+S*R,e[1]=m+S*L),!0}}}}}var Tg=1e9,Eg=-1e9;function D2(t,e,i,n){function s(v,w){return t<=v&&v<=i&&e<=w&&w<=n}function u(v,w,S,R){var L=0,j=0;if(v==null||(L=f(v,S))!==(j=f(w,S))||o(v,w)<0^S>0)do R.point(L===0||L===3?t:i,L>1?n:e);while((L=(L+S+4)%4)!==j);else R.point(w[0],w[1])}function f(v,w){return In(v[0]-t)<pn?w>0?0:3:In(v[0]-i)<pn?w>0?2:1:In(v[1]-e)<pn?w>0?1:0:w>0?3:2}function m(v,w){return o(v.x,w.x)}function o(v,w){var S=f(v,1),R=f(w,1);return S!==R?S-R:S===0?w[1]-v[1]:S===1?v[0]-w[0]:S===2?v[1]-w[1]:w[0]-v[0]}return function(v){var w=v,S=JC(),R,L,j,Z,re,xe,be,ue,oe,Ie,me,ot={point:lt,lineStart:Ut,lineEnd:Vt,polygonStart:rt,polygonEnd:Ge};function lt(mt,xt){s(mt,xt)&&w.point(mt,xt)}function _t(){for(var mt=0,xt=0,ei=L.length;xt<ei;++xt)for(var ti=L[xt],wi=1,On=ti.length,yi=ti[0],tn,Ln,Xn=yi[0],Bn=yi[1];wi<On;++wi)tn=Xn,Ln=Bn,yi=ti[wi],Xn=yi[0],Bn=yi[1],Ln<=n?Bn>n&&(Xn-tn)*(n-Ln)>(Bn-Ln)*(t-tn)&&++mt:Bn<=n&&(Xn-tn)*(n-Ln)<(Bn-Ln)*(t-tn)&&--mt;return mt}function rt(){w=S,R=[],L=[],me=!0}function Ge(){var mt=_t(),xt=me&&mt,ei=(R=vC(R)).length;(xt||ei)&&(v.polygonStart(),xt&&(v.lineStart(),u(null,null,1,v),v.lineEnd()),ei&&QC(R,m,mt,u,v),v.polygonEnd()),w=v,R=L=j=null}function Ut(){ot.point=Ot,L&&L.push(j=[]),Ie=!0,oe=!1,be=ue=NaN}function Vt(){R&&(Ot(Z,re),xe&&oe&&S.rejoin(),R.push(S.result())),ot.point=lt,oe&&w.lineEnd()}function Ot(mt,xt){var ei=s(mt,xt);if(L&&j.push([mt,xt]),Ie)Z=mt,re=xt,xe=ei,Ie=!1,ei&&(w.lineStart(),w.point(mt,xt));else if(ei&&oe)w.point(mt,xt);else{var ti=[be=Math.max(Eg,Math.min(Tg,be)),ue=Math.max(Eg,Math.min(Tg,ue))],wi=[mt=Math.max(Eg,Math.min(Tg,mt)),xt=Math.max(Eg,Math.min(Tg,xt))];k2(ti,wi,t,e,i,n)?(oe||(w.lineStart(),w.point(ti[0],ti[1])),w.point(wi[0],wi[1]),ei||w.lineEnd(),me=!1):ei&&(w.lineStart(),w.point(mt,xt),me=!1)}be=mt,ue=xt,oe=ei}return ot}}const Ov=t=>t;var wx=new Bc,Lv=new Bc,tM,iM,Bv,Fv,ba={point:Cs,lineStart:Cs,lineEnd:Cs,polygonStart:function(){ba.lineStart=O2,ba.lineEnd=B2},polygonEnd:function(){ba.lineStart=ba.lineEnd=ba.point=Cs,wx.add(In(Lv)),Lv=new Bc},result:function(){var t=wx/2;return wx=new Bc,t}};function O2(){ba.point=L2}function L2(t,e){ba.point=nM,tM=Bv=t,iM=Fv=e}function nM(t,e){Lv.add(Fv*t-Bv*e),Bv=t,Fv=e}function B2(){nM(tM,iM)}var Oh=1/0,E_=Oh,hp=-Oh,A_=hp,S_={point:F2,lineStart:Cs,lineEnd:Cs,polygonStart:Cs,polygonEnd:Cs,result:function(){var t=[[Oh,E_],[hp,A_]];return hp=A_=-(E_=Oh=1/0),t}};function F2(t,e){t<Oh&&(Oh=t),t>hp&&(hp=t),e<E_&&(E_=e),e>A_&&(A_=e)}var Nv=0,zv=0,Id=0,I_=0,C_=0,dh=0,Uv=0,Vv=0,Cd=0,rM,sM,ko,Do,Is={point:zc,lineStart:UA,lineEnd:VA,polygonStart:function(){Is.lineStart=U2,Is.lineEnd=V2},polygonEnd:function(){Is.point=zc,Is.lineStart=UA,Is.lineEnd=VA},result:function(){var t=Cd?[Uv/Cd,Vv/Cd]:dh?[I_/dh,C_/dh]:Id?[Nv/Id,zv/Id]:[NaN,NaN];return Nv=zv=Id=I_=C_=dh=Uv=Vv=Cd=0,t}};function zc(t,e){Nv+=t,zv+=e,++Id}function UA(){Is.point=N2}function N2(t,e){Is.point=z2,zc(ko=t,Do=e)}function z2(t,e){var i=t-ko,n=e-Do,s=Xc(i*i+n*n);I_+=s*(ko+t)/2,C_+=s*(Do+e)/2,dh+=s,zc(ko=t,Do=e)}function VA(){Is.point=zc}function U2(){Is.point=j2}function V2(){oM(rM,sM)}function j2(t,e){Is.point=oM,zc(rM=ko=t,sM=Do=e)}function oM(t,e){var i=t-ko,n=e-Do,s=Xc(i*i+n*n);I_+=s*(ko+t)/2,C_+=s*(Do+e)/2,dh+=s,s=Do*t-ko*e,Uv+=s*(ko+t),Vv+=s*(Do+e),Cd+=s*3,zc(ko=t,Do=e)}function aM(t){this._context=t}aM.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:{this._context.moveTo(t,e),this._point=1;break}case 1:{this._context.lineTo(t,e);break}default:{this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,ys);break}}},result:Cs};var jv=new Bc,Tx,lM,cM,Md,Rd,fp={point:Cs,lineStart:function(){fp.point=$2},lineEnd:function(){Tx&&uM(lM,cM),fp.point=Cs},polygonStart:function(){Tx=!0},polygonEnd:function(){Tx=null},result:function(){var t=+jv;return jv=new Bc,t}};function $2(t,e){fp.point=uM,lM=Md=t,cM=Rd=e}function uM(t,e){Md-=t,Rd-=e,jv.add(Xc(Md*Md+Rd*Rd)),Md=t,Rd=e}let jA,M_,$A,WA;class HA{constructor(e){this._append=e==null?hM:W2(e),this._radius=4.5,this._=""}pointRadius(e){return this._radius=+e,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(e,i){switch(this._point){case 0:{this._append`M${e},${i}`,this._point=1;break}case 1:{this._append`L${e},${i}`;break}default:{if(this._append`M${e},${i}`,this._radius!==$A||this._append!==M_){const n=this._radius,s=this._;this._="",this._append`m0,${n}a${n},${n} 0 1,1 0,${-2*n}a${n},${n} 0 1,1 0,${2*n}z`,$A=n,M_=this._append,WA=this._,this._=s}this._+=WA;break}}}result(){const e=this._;return this._="",e.length?e:null}}function hM(t){let e=1;this._+=t[0];for(const i=t.length;e<i;++e)this._+=arguments[e]+t[e]}function W2(t){const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);if(e>15)return hM;if(e!==jA){const i=10**e;jA=e,M_=function(s){let u=1;this._+=s[0];for(const f=s.length;u<f;++u)this._+=Math.round(arguments[u]*i)/i+s[u]}}return M_}function d1(t,e){let i=3,n=4.5,s,u;function f(m){return m&&(typeof n=="function"&&u.pointRadius(+n.apply(this,arguments)),hh(m,s(u))),u.result()}return f.area=function(m){return hh(m,s(ba)),ba.result()},f.measure=function(m){return hh(m,s(fp)),fp.result()},f.bounds=function(m){return hh(m,s(S_)),S_.result()},f.centroid=function(m){return hh(m,s(Is)),Is.result()},f.projection=function(m){return arguments.length?(s=m==null?(t=null,Ov):(t=m).stream,f):t},f.context=function(m){return arguments.length?(u=m==null?(e=null,new HA(i)):new aM(e=m),typeof n!="function"&&u.pointRadius(n),f):e},f.pointRadius=function(m){return arguments.length?(n=typeof m=="function"?m:(u.pointRadius(+m),+m),f):n},f.digits=function(m){if(!arguments.length)return i;if(m==null)i=null;else{const o=Math.floor(m);if(!(o>=0))throw new RangeError(`invalid digits: ${m}`);i=o}return e===null&&(u=new HA(i)),f},f.projection(t).digits(i).context(e)}function p1(t){return function(e){var i=new $v;for(var n in t)i[n]=t[n];return i.stream=e,i}}function $v(){}$v.prototype={constructor:$v,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function m1(t,e,i){var n=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),n!=null&&t.clipExtent(null),hh(i,t.stream(S_)),e(S_.result()),n!=null&&t.clipExtent(n),t}function fM(t,e,i){return m1(t,function(n){var s=e[1][0]-e[0][0],u=e[1][1]-e[0][1],f=Math.min(s/(n[1][0]-n[0][0]),u/(n[1][1]-n[0][1])),m=+e[0][0]+(s-f*(n[1][0]+n[0][0]))/2,o=+e[0][1]+(u-f*(n[1][1]+n[0][1]))/2;t.scale(150*f).translate([m,o])},i)}function H2(t,e,i){return fM(t,[[0,0],e],i)}function X2(t,e,i){return m1(t,function(n){var s=+e,u=s/(n[1][0]-n[0][0]),f=(s-u*(n[1][0]+n[0][0]))/2,m=-u*n[0][1];t.scale(150*u).translate([f,m])},i)}function q2(t,e,i){return m1(t,function(n){var s=+e,u=s/(n[1][1]-n[0][1]),f=-u*n[0][0],m=(s-u*(n[1][1]+n[0][1]))/2;t.scale(150*u).translate([f,m])},i)}var XA=16,G2=Nn(30*$n);function qA(t,e){return+e?Y2(t,e):Z2(t)}function Z2(t){return p1({point:function(e,i){e=t(e,i),this.stream.point(e[0],e[1])}})}function Y2(t,e){function i(n,s,u,f,m,o,v,w,S,R,L,j,Z,re){var xe=v-n,be=w-s,ue=xe*xe+be*be;if(ue>4*e&&Z--){var oe=f+R,Ie=m+L,me=o+j,ot=Xc(oe*oe+Ie*Ie+me*me),lt=up(me/=ot),_t=In(In(me)-1)<pn||In(u-S)<pn?(u+S)/2:cp(Ie,oe),rt=t(_t,lt),Ge=rt[0],Ut=rt[1],Vt=Ge-n,Ot=Ut-s,mt=be*Vt-xe*Ot;(mt*mt/ue>e||In((xe*Vt+be*Ot)/ue-.5)>.3||f*R+m*L+o*j<G2)&&(i(n,s,u,f,m,o,Ge,Ut,_t,oe/=ot,Ie/=ot,me,Z,re),re.point(Ge,Ut),i(Ge,Ut,_t,oe,Ie,me,v,w,S,R,L,j,Z,re))}}return function(n){var s,u,f,m,o,v,w,S,R,L,j,Z,re={point:xe,lineStart:be,lineEnd:oe,polygonStart:function(){n.polygonStart(),re.lineStart=Ie},polygonEnd:function(){n.polygonEnd(),re.lineStart=be}};function xe(lt,_t){lt=t(lt,_t),n.point(lt[0],lt[1])}function be(){S=NaN,re.point=ue,n.lineStart()}function ue(lt,_t){var rt=Dh([lt,_t]),Ge=t(lt,_t);i(S,R,w,L,j,Z,S=Ge[0],R=Ge[1],w=lt,L=rt[0],j=rt[1],Z=rt[2],XA,n),n.point(S,R)}function oe(){re.point=xe,n.lineEnd()}function Ie(){be(),re.point=me,re.lineEnd=ot}function me(lt,_t){ue(s=lt,_t),u=S,f=R,m=L,o=j,v=Z,re.point=ue}function ot(){i(S,R,w,L,j,Z,u,f,s,m,o,v,XA,n),re.lineEnd=oe,oe()}return re}}var K2=p1({point:function(t,e){this.stream.point(t*$n,e*$n)}});function J2(t){return p1({point:function(e,i){var n=t(e,i);return this.stream.point(n[0],n[1])}})}function Q2(t,e,i,n,s){function u(f,m){return f*=n,m*=s,[e+t*f,i-t*m]}return u.invert=function(f,m){return[(f-e)/t*n,(i-m)/t*s]},u}function GA(t,e,i,n,s,u){if(!u)return Q2(t,e,i,n,s);var f=Nn(u),m=zn(u),o=f*t,v=m*t,w=f/t,S=m/t,R=(m*i-f*e)/t,L=(m*e+f*i)/t;function j(Z,re){return Z*=n,re*=s,[o*Z-v*re+e,i-v*Z-o*re]}return j.invert=function(Z,re){return[n*(w*Z-S*re+R),s*(L-S*Z-w*re)]},j}function eU(t){return tU(function(){return t})()}function tU(t){var e,i=150,n=480,s=250,u=0,f=0,m=0,o=0,v=0,w,S=0,R=1,L=1,j=null,Z=zA,re=null,xe,be,ue,oe=Ov,Ie=.5,me,ot,lt,_t,rt;function Ge(mt){return lt(mt[0]*$n,mt[1]*$n)}function Ut(mt){return mt=lt.invert(mt[0],mt[1]),mt&&[mt[0]*fs,mt[1]*fs]}Ge.stream=function(mt){return _t&&rt===mt?_t:_t=K2(J2(w)(Z(me(oe(rt=mt)))))},Ge.preclip=function(mt){return arguments.length?(Z=mt,j=void 0,Ot()):Z},Ge.postclip=function(mt){return arguments.length?(oe=mt,re=xe=be=ue=null,Ot()):oe},Ge.clipAngle=function(mt){return arguments.length?(Z=+mt?P2(j=mt*$n):(j=null,zA),Ot()):j*fs},Ge.clipExtent=function(mt){return arguments.length?(oe=mt==null?(re=xe=be=ue=null,Ov):D2(re=+mt[0][0],xe=+mt[0][1],be=+mt[1][0],ue=+mt[1][1]),Ot()):re==null?null:[[re,xe],[be,ue]]},Ge.scale=function(mt){return arguments.length?(i=+mt,Vt()):i},Ge.translate=function(mt){return arguments.length?(n=+mt[0],s=+mt[1],Vt()):[n,s]},Ge.center=function(mt){return arguments.length?(u=mt[0]%360*$n,f=mt[1]%360*$n,Vt()):[u*fs,f*fs]},Ge.rotate=function(mt){return arguments.length?(m=mt[0]%360*$n,o=mt[1]%360*$n,v=mt.length>2?mt[2]%360*$n:0,Vt()):[m*fs,o*fs,v*fs]},Ge.angle=function(mt){return arguments.length?(S=mt%360*$n,Vt()):S*fs},Ge.reflectX=function(mt){return arguments.length?(R=mt?-1:1,Vt()):R<0},Ge.reflectY=function(mt){return arguments.length?(L=mt?-1:1,Vt()):L<0},Ge.precision=function(mt){return arguments.length?(me=qA(ot,Ie=mt*mt),Ot()):Xc(Ie)},Ge.fitExtent=function(mt,xt){return fM(Ge,mt,xt)},Ge.fitSize=function(mt,xt){return H2(Ge,mt,xt)},Ge.fitWidth=function(mt,xt){return X2(Ge,mt,xt)},Ge.fitHeight=function(mt,xt){return q2(Ge,mt,xt)};function Vt(){var mt=GA(i,0,0,R,L,S).apply(null,e(u,f)),xt=GA(i,n-mt[0],s-mt[1],R,L,S);return w=KC(m,o,v),ot=kv(e,xt),lt=kv(w,ot),me=qA(ot,Ie),Ot()}function Ot(){return _t=rt=null,Ge}return function(){return e=t.apply(this,arguments),Ge.invert=e.invert&&Ut,Vt()}}function g1(t,e){return[t,x2(b2((es+e)/2))]}g1.invert=function(t,e){return[t,2*YC(y2(e))-es]};function _1(){return iU(g1).scale(961/ys)}function iU(t){var e=eU(t),i=e.center,n=e.scale,s=e.translate,u=e.clipExtent,f=null,m,o,v;e.scale=function(S){return arguments.length?(n(S),w()):n()},e.translate=function(S){return arguments.length?(s(S),w()):s()},e.center=function(S){return arguments.length?(i(S),w()):i()},e.clipExtent=function(S){return arguments.length?(S==null?f=m=o=v=null:(f=+S[0][0],m=+S[0][1],o=+S[1][0],v=+S[1][1]),w()):f==null?null:[[f,m],[o,v]]};function w(){var S=Bi*n(),R=e(T2(e.rotate()).invert([0,0]));return u(f==null?[[R[0]-S,R[1]-S],[R[0]+S,R[1]+S]]:t===g1?[[Math.max(R[0]-S,f),m],[Math.min(R[0]+S,o),v]]:[[f,Math.max(R[1]-S,m)],[o,Math.min(R[1]+S,v)]])}return w()}function dM(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function nU(t){return function(){return t}}function rU(t){return+t}var ZA=[0,1];function Bo(t){return t}function Wv(t,e){return(e-=t=+t)?function(i){return(i-t)/e}:nU(isNaN(e)?NaN:.5)}function sU(t,e){var i;return t>e&&(i=t,t=e,e=i),function(n){return Math.max(t,Math.min(e,n))}}function oU(t,e,i){var n=t[0],s=t[1],u=e[0],f=e[1];return s<n?(n=Wv(s,n),u=i(f,u)):(n=Wv(n,s),u=i(u,f)),function(m){return u(n(m))}}function aU(t,e,i){var n=Math.min(t.length,e.length)-1,s=new Array(n),u=new Array(n),f=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++f<n;)s[f]=Wv(t[f],t[f+1]),u[f]=i(e[f],e[f+1]);return function(m){var o=gB(t,m,1,n)-1;return u[o](s[o](m))}}function pM(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function mM(){var t=ZA,e=ZA,i=o1,n,s,u,f=Bo,m,o,v;function w(){var R=Math.min(t.length,e.length);return f!==Bo&&(f=sU(t[0],t[R-1])),m=R>2?aU:oU,o=v=null,S}function S(R){return R==null||isNaN(R=+R)?u:(o||(o=m(t.map(n),e,i)))(n(f(R)))}return S.invert=function(R){return f(s((v||(v=m(e,t.map(n),Js)))(R)))},S.domain=function(R){return arguments.length?(t=Array.from(R,rU),w()):t.slice()},S.range=function(R){return arguments.length?(e=Array.from(R),w()):e.slice()},S.rangeRound=function(R){return e=Array.from(R),i=LN,w()},S.clamp=function(R){return arguments.length?(f=R?!0:Bo,w()):f!==Bo},S.interpolate=function(R){return arguments.length?(i=R,w()):i},S.unknown=function(R){return arguments.length?(u=R,S):u},function(R,L){return n=R,s=L,w()}}function lU(){return mM()(Bo,Bo)}function cU(t,e,i,n){var s=bB(t,e,i),u;switch(n=b_(n??",f"),n.type){case"s":{var f=Math.max(Math.abs(t),Math.abs(e));return n.precision==null&&!isNaN(u=g2(s,f))&&(n.precision=u),ZC(n,f)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(u=_2(s,Math.max(Math.abs(t),Math.abs(e))))&&(n.precision=u-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(u=m2(s))&&(n.precision=u-(n.type==="%")*2);break}}return kh(n)}function gM(t){var e=t.domain;return t.ticks=function(i){var n=e();return yC(n[0],n[n.length-1],i??10)},t.tickFormat=function(i,n){var s=e();return cU(s[0],s[s.length-1],i??10,n)},t.nice=function(i){i==null&&(i=10);var n=e(),s=0,u=n.length-1,f=n[s],m=n[u],o,v,w=10;for(m<f&&(v=f,f=m,m=v,v=s,s=u,u=v);w-- >0;){if(v=bv(f,m,i),v===o)return n[s]=f,n[u]=m,e(n);if(v>0)f=Math.floor(f/v)*v,m=Math.ceil(m/v)*v;else if(v<0)f=Math.ceil(f*v)/v,m=Math.floor(m*v)/v;else break;o=v}return t},t}function Hv(){var t=lU();return t.copy=function(){return pM(t,Hv())},dM.apply(t,arguments),gM(t)}function YA(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function uU(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function hU(t){return t<0?-t*t:t*t}function fU(t){var e=t(Bo,Bo),i=1;function n(){return i===1?t(Bo,Bo):i===.5?t(uU,hU):t(YA(i),YA(1/i))}return e.exponent=function(s){return arguments.length?(i=+s,n()):i},gM(e)}function _M(){var t=fU(mM());return t.copy=function(){return pM(t,_M()).exponent(t.exponent())},dM.apply(t,arguments),t}function dU(){return _M.apply(null,arguments).exponent(.5)}function Pd(t,e,i){this.k=t,this.x=e,this.y=i}Pd.prototype={constructor:Pd,scale:function(t){return t===1?this:new Pd(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Pd(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Pd.prototype;function pU(t){return t}function mU(t){if(t==null)return pU;var e,i,n=t.scale[0],s=t.scale[1],u=t.translate[0],f=t.translate[1];return function(m,o){o||(e=i=0);var v=2,w=m.length,S=new Array(w);for(S[0]=(e+=m[0])*n+u,S[1]=(i+=m[1])*s+f;v<w;)S[v]=m[v],++v;return S}}function gU(t,e){for(var i,n=t.length,s=n-e;s<--n;)i=t[s],t[s++]=t[n],t[n]=i}function y1(t,e){return typeof e=="string"&&(e=t.objects[e]),e.type==="GeometryCollection"?{type:"FeatureCollection",features:e.geometries.map(function(i){return KA(t,i)})}:KA(t,e)}function KA(t,e){var i=e.id,n=e.bbox,s=e.properties==null?{}:e.properties,u=_U(t,e);return i==null&&n==null?{type:"Feature",properties:s,geometry:u}:n==null?{type:"Feature",id:i,properties:s,geometry:u}:{type:"Feature",id:i,bbox:n,properties:s,geometry:u}}function _U(t,e){var i=mU(t.transform),n=t.arcs;function s(w,S){S.length&&S.pop();for(var R=n[w<0?~w:w],L=0,j=R.length;L<j;++L)S.push(i(R[L],L));w<0&&gU(S,j)}function u(w){return i(w)}function f(w){for(var S=[],R=0,L=w.length;R<L;++R)s(w[R],S);return S.length<2&&S.push(S[0]),S}function m(w){for(var S=f(w);S.length<4;)S.push(S[0]);return S}function o(w){return w.map(m)}function v(w){var S=w.type,R;switch(S){case"GeometryCollection":return{type:S,geometries:w.geometries.map(v)};case"Point":R=u(w.coordinates);break;case"MultiPoint":R=w.coordinates.map(u);break;case"LineString":R=f(w.arcs);break;case"MultiLineString":R=w.arcs.map(f);break;case"Polygon":R=o(w.arcs);break;case"MultiPolygon":R=w.arcs.map(o);break;default:return null}return{type:S,coordinates:R}}return v(e)}const qc=(t,e)=>{const i=t.__vccOpts||t;for(const[n,s]of e)i[n]=s;return i},yU={key:0},xU={__name:"D3SymbolMap",setup(t){const e=Ta(null),i=Ta(!0);return Hc(async()=>{const u=await h1("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json"),f=y1(u,u.objects.countries),v=(await u1("/worlddataset.csv")).map(oe=>{var Ie;return{...oe,Population:+((Ie=oe.Population)==null?void 0:Ie.replace(/[\$,]/g,"")),Latitude:+oe.Latitude,Longitude:+oe.Longitude}}).filter(oe=>!isNaN(oe.Latitude)&&!isNaN(oe.Longitude)&&!isNaN(oe.Population)),w=_1().scale(140).translate([920/2,500/1.5]),S=d1().projection(w),R=Mh(e.value).append("svg").attr("width",920).attr("height",500).style("background-color","#121212");R.append("g").selectAll("path").data(f.features).enter().append("path").attr("d",S).attr("fill","#2a2a2a").attr("stroke","#555").attr("stroke-width",.5);const L=_B(v,oe=>oe.Population),j=dU().domain(L).range([3,20]),Z=Mh("#tooltip");R.append("g").selectAll("circle").data(v).enter().append("circle").attr("cx",oe=>w([+oe.Longitude,+oe.Latitude])[0]).attr("cy",oe=>w([+oe.Longitude,+oe.Latitude])[1]).attr("r",oe=>j(oe.Population)).attr("fill","#ff8da1").attr("opacity",.7).on("mouseover",function(oe,Ie){Z.style("opacity",1).html(`<strong>${Ie.Country}</strong><br>Population: ${kh(",")(Ie.Population)}`)}).on("mousemove",function(oe){Z.style("left",oe.pageX+10+"px").style("top",oe.pageY-28+"px")}).on("mouseout",function(){Z.style("opacity",0)});const re=790,xe=40,be=[1e6,1e7,1e8],ue=R.append("g").attr("transform",`translate(${re}, ${xe})`);ue.append("text").attr("x",0).attr("y",-30).style("font-weight","bold").style("font-size","14px").style("fill","#eee").text("Population Legend"),be.forEach((oe,Ie)=>{const me=j(oe),ot=Ie*35;ue.append("circle").attr("cx",0).attr("cy",ot).attr("r",me).attr("fill","#ff8da1").attr("opacity",.7),ue.append("text").attr("x",35).attr("y",ot).attr("alignment-baseline","middle").style("font-size","12px").style("fill","#eee").text(kh(",")(oe))}),i.value=!1}),(n,s)=>(no(),jo("div",{ref_key:"chartContainer",ref:e,class:"map-container"},[i.value?(no(),jo("p",yU,"Loading map...")):Qb("",!0),s[0]||(s[0]=Li("div",{id:"tooltip",class:"tooltip",style:{opacity:"0"}},null,-1))],512))}},vU=qc(xU,[["__scopeId","data-v-955a8be2"]]),bU={key:0},wU={__name:"D3ChoroplethMap",setup(t){const e=Ta(null),i=Ta(!0);return Hc(async()=>{const u=await h1("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json"),f=y1(u,u.objects.countries),o=(await u1("/worlddataset.csv")).map(Ie=>{var me,ot;return{...Ie,GDP:+((me=String(Ie.GDP))==null?void 0:me.replace(/[\$,]/g,"")),Country:(ot=Ie.Country)==null?void 0:ot.trim()}}),v=new Map(o.map(Ie=>[Ie.Country,Ie.GDP])),w=_1().scale(140).translate([960/2,500/1.5]),S=d1().projection(w),R=Mh(e.value).append("svg").attr("width",960).attr("height",500).style("background-color","#121212"),L=Array.from(v.values()).filter(Ie=>!isNaN(Ie)),j=Hv().domain([wB(L),xC(L)]).range(["#b9cde5","#f4c2c2"]),Z=Mh("#tooltip");R.append("g").selectAll("path").data(f.features).enter().append("path").attr("d",S).attr("fill",Ie=>{const me=Ie.properties.name,ot=v.get(me);return isNaN(ot)?"#2a2a2a":j(ot)}).attr("stroke","#444").attr("stroke-width",.5).on("mouseover",function(Ie,me){const ot=me.properties.name,lt=v.get(ot);Z.style("opacity",1).html(`<strong>${ot}</strong><br>GDP: $${lt?kh(",")(lt):"N/A"}`)}).on("mousemove",function(Ie){Z.style("left",Ie.pageX+10+"px").style("top",Ie.pageY-28+"px")}).on("mouseout",function(){Z.style("opacity",0)});const re=300,xe=10,be=R.append("g").attr("transform","translate(30, 460)"),ue=Hv().domain(j.domain()).range([0,re]),oe=PB(ue).ticks(5).tickFormat(kh("$.2s"));R.append("defs").append("linearGradient").attr("id","legend-gradient").attr("x1","0%").attr("x2","100%").selectAll("stop").data(yC(0,1,10)).enter().append("stop").attr("offset",Ie=>`${Ie*100}%`).attr("stop-color",Ie=>j(j.domain()[0]+Ie*(j.domain()[1]-j.domain()[0]))),be.append("rect").attr("width",re).attr("height",xe).style("fill","url(#legend-gradient)"),be.append("g").attr("transform",`translate(0, ${xe})`).call(oe).selectAll("text").style("fill","#eee"),i.value=!1}),(n,s)=>(no(),jo("div",{ref_key:"chartContainer",ref:e,class:"map-container"},[i.value?(no(),jo("p",bU,"Loading Choropleth map...")):Qb("",!0),s[0]||(s[0]=Li("div",{id:"tooltip",class:"tooltip",style:{opacity:"0"}},null,-1))],512))}},TU=qc(wU,[["__scopeId","data-v-1934a704"]]),EU={key:0},AU={__name:"D3DotMap",setup(t){const e=Ta(null),i=Ta(!0);return Hc(async()=>{const u=await h1("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json"),f=y1(u,u.objects.countries),v=(await u1("/worlddataset.csv")).map(j=>{var Z;return{Country:(Z=j.Country)==null?void 0:Z.trim(),Latitude:+j.Latitude,Longitude:+j.Longitude}}).filter(j=>!isNaN(j.Latitude)&&!isNaN(j.Longitude)),w=_1().scale(140).translate([960/2,500/1.5]),S=d1().projection(w),R=Mh(e.value).append("svg").attr("width",960).attr("height",500).style("background-color","#121212");R.append("g").selectAll("path").data(f.features).enter().append("path").attr("d",S).attr("fill","#2b2b2b").attr("stroke","#444").attr("stroke-width",.5);const L=Mh("#tooltip");R.append("g").selectAll("circle").data(v).enter().append("circle").attr("cx",j=>w([j.Longitude,j.Latitude])[0]).attr("cy",j=>w([j.Longitude,j.Latitude])[1]).attr("r",3).attr("fill","#C3B1E1").attr("stroke","white").attr("stroke-width",.4).attr("opacity",.9).on("mouseover",function(j,Z){L.style("opacity",1).html(`<strong>${Z.Country}</strong>`)}).on("mousemove",function(j){L.style("left",j.pageX+10+"px").style("top",j.pageY-28+"px")}).on("mouseout",function(){L.style("opacity",0)}),i.value=!1}),(n,s)=>(no(),jo("div",{ref_key:"chartContainer",ref:e,class:"map-container"},[i.value?(no(),jo("p",EU,"Loading dot map...")):Qb("",!0),s[0]||(s[0]=Li("div",{id:"tooltip",class:"tooltip",style:{opacity:"0"}},null,-1))],512))}},SU=qc(AU,[["__scopeId","data-v-0b7ee828"]]);function IU(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Yg={exports:{}},CU=Yg.exports,JA;function MU(){return JA||(JA=1,function(t,e){var i={};(function(n,s){t.exports=s()})(CU,function(){var n,s,u;function f(o,v){if(!n)n=v;else if(!s)s=v;else{var w="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",S={};n(S),u=v(S),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}f(["exports"],function(o){var v=typeof self<"u"?self:{},w="2.14.1";let S;const R={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(S==null){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{S=i.API_URL_REGEX!=null?new RegExp(i.API_URL_REGEX):a}catch{S=a}}return S},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!R.API_URL)return null;try{const a=new URL(R.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},L={supported:!1,testSupport:function(a){!re&&Z&&(xe?be(a):j=a)}};let j,Z,re=!1,xe=!1;function be(a){const r=a.createTexture();a.bindTexture(a.TEXTURE_2D,r);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Z),a.isContextLost())return;L.supported=!0}catch{}a.deleteTexture(r),re=!0}v.document&&(Z=v.document.createElement("img"),Z.onload=function(){j&&be(j),j=null,xe=!0},Z.onerror=function(){re=!0,j=null},Z.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ue="01";var oe=Ie;function Ie(a,r,l,h){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=r,this.p2x=l,this.p2y=h}Ie.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,r){if(r===void 0&&(r=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,h=0;h<8;h++){var p=this.sampleCurveX(l)-a;if(Math.abs(p)<r)return l;var _=this.sampleCurveDerivativeX(l);if(Math.abs(_)<1e-6)break;l-=p/_}var x=0,T=1;for(l=a,h=0;h<20&&(p=this.sampleCurveX(l),!(Math.abs(p-a)<r));h++)a>p?x=l:T=l,l=.5*(T-x)+x;return l},solve:function(a,r){return this.sampleCurveY(this.solveCurveX(a,r))}};var me=ot;function ot(a,r){this.x=a,this.y=r}ot.prototype={clone:function(){return new ot(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,r){return this.clone()._rotateAround(a,r)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var r=a.x-this.x,l=a.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,r){return Math.atan2(this.x*r-this.y*a,this.x*a+this.y*r)},_matMult:function(a){var r=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=r,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var r=Math.cos(a),l=Math.sin(a),h=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=h,this},_rotateAround:function(a,r){var l=Math.cos(a),h=Math.sin(a),p=r.y+h*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-h*(this.y-r.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ot.convert=function(a){return a instanceof ot?a:Array.isArray(a)?new ot(a[0],a[1]):a};const lt=Math.PI/180,_t=180/Math.PI;function rt(a){return a*lt}function Ge(a){return a*_t}const Ut=[[0,0],[1,0],[1,1],[0,1]];function Vt(a){if(a<=0)return 0;if(a>=1)return 1;const r=a*a,l=r*a;return 4*(a<.5?l:3*(a-r)+l-.75)}function Ot(a,r,l,h){const p=new oe(a,r,l,h);return function(_){return p.solve(_)}}const mt=Ot(.25,.1,.25,1);function xt(a,r,l){return Math.min(l,Math.max(r,a))}function ei(a,r,l){return(l=xt((l-a)/(r-a),0,1))*l*(3-2*l)}function ti(a,r,l){const h=l-r,p=((a-r)%h+h)%h+r;return p===r?l:p}function wi(a,r,l){if(!a.length)return l(null,[]);let h=a.length;const p=new Array(a.length);let _=null;a.forEach((x,T)=>{r(x,(A,I)=>{A&&(_=A),p[T]=I,--h==0&&l(_,p)})})}function On(a){const r=[];for(const l in a)r.push(a[l]);return r}function yi(a,...r){for(const l of r)for(const h in l)a[h]=l[h];return a}let tn=1;function Ln(){return tn++}function Xn(){return function a(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Bn(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function $r(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Dr(a,r){a.forEach(l=>{r[l]&&(r[l]=r[l].bind(r))})}function gr(a,r){return a.indexOf(r,a.length-r.length)!==-1}function Wr(a,r,l){const h={};for(const p in a)h[p]=r.call(this,a[p],p,a);return h}function Or(a,r,l){const h={};for(const p in a)r.call(l||this,a[p],p,a)&&(h[p]=a[p]);return h}function _r(a){return Array.isArray(a)?a.map(_r):typeof a=="object"&&a?Wr(a,_r):a}const Te={};function Se(a){Te[a]||(typeof console<"u"&&console.warn(a),Te[a]=!0)}function Ke(a,r,l){return(l.y-a.y)*(r.x-a.x)>(r.y-a.y)*(l.x-a.x)}function tt(a){let r=0;for(let l,h,p=0,_=a.length,x=_-1;p<_;x=p++)l=a[p],h=a[x],r+=(h.x-l.x)*(l.y+h.y);return r}function pt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function yt(a){const r={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,p,_)=>{const x=p||_;return r[h]=!x||x.toLowerCase(),""}),r["max-age"]){const l=parseInt(r["max-age"],10);isNaN(l)?delete r["max-age"]:r["max-age"]=l}return r}let kt=null;function At(a){if(kt==null){const r=a.navigator?a.navigator.userAgent:null;kt=!!a.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return kt}function It(a){try{const r=v[a];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}}function vt(a,r){return[a[4*r],a[4*r+1],a[4*r+2],a[4*r+3]]}const Qt="mapbox-tiles";let Pt,Ht,ii=500,pi=50;function ki(){try{return v.caches}catch{}}function xi(){ki()&&!Pt&&(Pt=v.caches.open(Qt))}function Cn(a){const r=a.indexOf("?");if(r<0)return a;const l=function(p){const _=p.indexOf("?");return _>0?p.slice(_+1).split("&"):[]}(a),h=l.filter(p=>{const _=p.split("=");return _[0]==="language"||_[0]==="worldview"});return h.length?`${a.slice(0,r)}?${h.join("&")}`:a.slice(0,r)}let vn=1/0;const qn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(qn);class cn extends Error{constructor(r,l,h){l===401&&Zo(h)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=l,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const is=pt()?()=>self.worker&&self.worker.referrer:()=>(v.location.protocol==="blob:"?v.parent:v).location.href,ns=function(a,r){if(!(/^file:/.test(l=a.url)||/^file:/.test(is())&&!/^\w+:/.test(l))){if(v.fetch&&v.Request&&v.AbortController&&v.Request.prototype.hasOwnProperty("signal"))return function(h,p){const _=new v.AbortController,x=new v.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:is(),referrerPolicy:h.referrerPolicy,signal:_.signal});let T=!1,A=!1;const I=(P=x.url).indexOf("sku=")>0&&Zo(P);var P;h.type==="json"&&x.headers.set("Accept","application/json");const D=(N,z,$)=>{if(A)return;if(N&&N.message!=="SecurityError"&&Se(N),z&&$)return O(z);const G=Date.now();v.fetch(x).then(se=>{if(se.ok){const pe=I?se.clone():null;return O(se,pe,G)}return p(new cn(se.statusText,se.status,h.url))}).catch(se=>{se.name!=="AbortError"&&p(new Error(`${se.message} ${h.url}`))})},O=(N,z,$)=>{(h.type==="arrayBuffer"?N.arrayBuffer():h.type==="json"?N.json():N.text()).then(G=>{A||(z&&$&&function(se,pe,ee){if(xi(),!Pt)return;const de={status:pe.status,statusText:pe.statusText,headers:new v.Headers};pe.headers.forEach((Ve,Ne)=>de.headers.set(Ne,Ve));const ye=yt(pe.headers.get("Cache-Control")||"");if(ye["no-store"])return;ye["max-age"]&&de.headers.set("Expires",new Date(ee+1e3*ye["max-age"]).toUTCString());const ge=de.headers.get("Expires");ge&&(new Date(ge).getTime()-ee<42e4||function(Ve,Ne){if(Ht===void 0)try{new Response(new ReadableStream),Ht=!0}catch{Ht=!1}Ht?Ne(Ve.body):Ve.blob().then(Ne)}(pe,Ve=>{const Ne=new v.Response(Ve,de);xi(),Pt&&Pt.then(Ye=>Ye.put(Cn(se.url),Ne)).catch(Ye=>Se(Ye.message))}))}(x,z,$),T=!0,p(null,G,N.headers.get("Cache-Control"),N.headers.get("Expires")))}).catch(G=>{A||p(new Error(G.message))})};return I?function(N,z){if(xi(),!Pt)return z(null);const $=Cn(N.url);Pt.then(G=>{G.match($).then(se=>{const pe=function(ee){if(!ee)return!1;const de=new Date(ee.headers.get("Expires")||0),ye=yt(ee.headers.get("Cache-Control")||"");return de>Date.now()&&!ye["no-cache"]}(se);G.delete($),pe&&G.put($,se.clone()),z(null,se,pe)}).catch(z)}).catch(z)}(x,D):D(null,null),{cancel:()=>{A=!0,T||_.abort()}}}(a,r);if(pt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r,void 0,!0)}var l;return function(h,p){const _=new v.XMLHttpRequest;_.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(_.responseType="arraybuffer");for(const x in h.headers)_.setRequestHeader(x,h.headers[x]);return h.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=h.credentials==="include",_.onerror=()=>{p(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let x=_.response;if(h.type==="json")try{x=JSON.parse(_.response)}catch(T){return p(T)}p(null,x,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else p(new cn(_.statusText,_.status,h.url))},_.send(h.body),{cancel:()=>_.abort()}}(a,r)},bn=function(a,r){return ns(yi(a,{type:"arrayBuffer"}),r)};function ir(a){const r=v.document.createElement("a");return r.href=a,r.protocol===v.document.location.protocol&&r.host===v.document.location.host}const Os="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ia,qo;Ia=[],qo=0;const Cl=function(a,r){if(L.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),qo>=R.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:a,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Ia.push(_),_}qo++;let l=!1;const h=()=>{if(!l)for(l=!0,qo--;Ia.length&&qo<R.MAX_PARALLEL_IMAGE_REQUESTS;){const _=Ia.shift(),{requestParameters:x,callback:T,cancelled:A}=_;A||(_.cancel=Cl(x,T).cancel)}},p=bn(a,(_,x,T,A)=>{h(),_?r(_):x&&(v.createImageBitmap?function(I,P){const D=new v.Blob([new Uint8Array(I)],{type:"image/png"});v.createImageBitmap(D).then(O=>{P(null,O)}).catch(O=>{P(new Error(`Could not load image because of ${O.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(I,P)=>r(I,P,T,A)):function(I,P){const D=new v.Image,O=v.URL;D.onload=()=>{P(null,D),O.revokeObjectURL(D.src),D.onload=null,v.requestAnimationFrame(()=>{D.src=Os})},D.onerror=()=>P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const N=new v.Blob([new Uint8Array(I)],{type:"image/png"});D.src=I.byteLength?O.createObjectURL(N):Os}(x,(I,P)=>r(I,P,T,A)))});return{cancel:()=>{p.cancel(),h()}}},Go="NO_ACCESS_TOKEN";function rs(a){return a.indexOf("mapbox:")===0}function Zo(a){return R.API_URL_REGEX.test(a)}function Jc(a){return R.API_CDN_URL_REGEX.test(a)}function Qc(a){return R.API_STYLE_REGEX.test(a)&&!Ca(a)}function Ca(a){return R.API_SPRITE_REGEX.test(a)}const Yo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Lr(a){const r=a.match(Yo);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function oo(a){const r=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${r}`}function eu(a){if(!a)return null;const r=a.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(decodeURIComponent(v.atob(r[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ko{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const l=eu(R.ACCESS_TOKEN);let h="";return h=l&&l.u?v.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(p,_)=>String.fromCharCode(+("0x"+_)))):R.ACCESS_TOKEN||"",r?`mapbox.eventData.${r}:${h}`:`mapbox.eventData:${h}`}fetchEventData(){const r=It("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{const p=v.localStorage.getItem(l);p&&(this.eventData=JSON.parse(p));const _=v.localStorage.getItem(h);_&&(this.anonId=_)}catch{Se("Unable to read from LocalStorage")}}saveEventData(){const r=It("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(r)try{v.localStorage.setItem(h,this.anonId),Object.keys(this.eventData).length>=1&&v.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{Se("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,l,h,p){if(!R.EVENTS_URL)return;const _=Lr(R.EVENTS_URL);_.params.push(`access_token=${p||R.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(r).toISOString()},T=l?yi(x,l):x,A={url:oo(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([T])};this.pendingRequest=function(I,P){return ns(yi(I,{method:"POST"}),P)}(A,I=>{this.pendingRequest=null,h(I),this.saveEventData(),this.processRequests(p)})}queueRequest(r,l){this.queue.push(r),this.processRequests(l)}}const ne=new class extends Ko{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,r){R.EVENTS_URL&&R.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>rs(l)||Zo(l))&&this.queueRequest(Date.now(),r)}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=eu(R.ACCESS_TOKEN),l=r?r.u:R.ACCESS_TOKEN;let h=l!==this.eventData.tokenU;$r(this.anonId)||(this.anonId=Xn(),h=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),x=new Date(p),T=(p-this.eventData.lastSuccess)/864e5;h=h||T>=1||T<-1||_.getDate()!==x.getDate()}else h=!0;h?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:ue,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=p,this.eventData.tokenU=l)},a):this.processRequests()}},V=ne.postTurnstileEvent.bind(ne),W=new class extends Ko{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,r,l,h){this.skuToken=r,this.errorCb=h,R.EVENTS_URL&&(l||R.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Go)))}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),$r(this.anonId)||(this.anonId=Xn()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:ue,skuToken:this.skuToken,userId:this.anonId},h=>{h?this.errorCb(h):r&&(this.success[r]=!0)},a))}},te=W.postMapLoadEvent.bind(W),fe=new class extends Ko{constructor(){super("gljs.performance")}postPerformanceEvent(a,r){R.EVENTS_URL&&(a||R.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},a)}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:l}=this.queue.shift(),h=function(p){const _=v.performance.getEntriesByType("resource"),x=v.performance.getEntriesByType("mark"),T=function(O){const N={};if(O){for(const z in O)if(z!=="other")for(const $ of O[z]){const G=`${z}ResolveRangeMin`,se=`${z}ResolveRangeMax`,pe=`${z}RequestCount`,ee=`${z}RequestCachedCount`;N[G]=Math.min(N[G]||1/0,$.startTime),N[se]=Math.max(N[se]||-1/0,$.responseEnd);const de=ye=>{N[ye]===void 0&&(N[ye]=0),++N[ye]};$.transferSize!==void 0&&$.transferSize===0&&de(ee),de(pe)}}return N}(function(O,N){const z={};if(O)for(const $ of O){const G=N($);z[G]===void 0&&(z[G]=[]),z[G].push($)}return z}(_,Ct)),A=v.devicePixelRatio,I=v.navigator.connection||v.navigator.mozConnection||v.navigator.webkitConnection,P={counters:[],metadata:[],attributes:[]},D=(O,N,z)=>{z!=null&&O.push({name:N,value:z.toString()})};for(const O in T)D(P.counters,O,T[O]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(D(P.counters,"interactionRangeMin",p.interactionRange[0]),D(P.counters,"interactionRangeMax",p.interactionRange[1])),x)for(const O of Object.keys(Fe)){const N=Fe[O],z=x.find($=>$.name===N);z&&D(P.counters,N,z.startTime)}return D(P.counters,"visibilityHidden",p.visibilityHidden),D(P.attributes,"style",function(O){if(O)for(const N of O){const z=N.name.split("?")[0];if(Qc(z)){const $=z.split("/").slice(-2);if($.length===2)return`mapbox://styles/${$[0]}/${$[1]}`}}}(_)),D(P.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),D(P.attributes,"fogEnabled",p.fogEnabled?"true":"false"),D(P.attributes,"projection",p.projection),D(P.attributes,"zoom",p.zoom),D(P.metadata,"devicePixelRatio",A),D(P.metadata,"connectionEffectiveType",I?I.effectiveType:void 0),D(P.metadata,"navigatorUserAgent",v.navigator.userAgent),D(P.metadata,"screenWidth",v.screen.width),D(P.metadata,"screenHeight",v.screen.height),D(P.metadata,"windowWidth",v.innerWidth),D(P.metadata,"windowHeight",v.innerHeight),D(P.metadata,"mapWidth",p.width/A),D(P.metadata,"mapHeight",p.height/A),D(P.metadata,"webglRenderer",p.renderer),D(P.metadata,"webglVendor",p.vendor),D(P.metadata,"sdkVersion",w),D(P.metadata,"sdkIdentifier","mapbox-gl-js"),P}(l);for(const p of h.metadata);for(const p of h.counters);for(const p of h.attributes);this.postEvent(r,h,()=>{},a)}},we=fe.postPerformanceEvent.bind(fe),Oe=new class extends Ko{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,r,l,h){if(!R.API_URL||!R.SESSION_PATH)return;const p=Lr(R.API_URL+R.SESSION_PATH);p.params.push(`sku=${r||""}`),p.params.push(`access_token=${h||R.ACCESS_TOKEN||""}`);const _={url:oo(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(x,T){return ns(yi(x,{method:"GET"}),T)}(_,x=>{this.pendingRequest=null,l(x),this.saveEventData(),this.processRequests(h)})}getSessionAPI(a,r,l,h){this.skuToken=r,this.errorCb=h,R.SESSION_PATH&&R.API_URL&&(l||R.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Go)))}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||this.getSession(l,this.skuToken,h=>{h?this.errorCb(h):r&&(this.success[r]=!0)},a)}},ke=Oe.getSessionAPI.bind(Oe),Ae=new Set,Fe={create:"create",load:"load",fullLoad:"fullLoad"},nt={mark(a){v.performance.mark(a)},measure(a,r,l){v.performance.measure(a,r,l)}};function Ct(a){const r=a.name.split("?")[0];return Jc(r)&&r.includes("mapbox-gl.js")?"javascript":Jc(r)&&r.includes("mapbox-gl.css")?"css":function(l){return R.API_FONTS_REGEX.test(l)}(r)?"fontRange":Ca(r)?"sprite":Qc(r)?"style":function(l){return R.API_TILEJSON_REGEX.test(l)}(r)?"tilejson":"other"}const ht=v.performance;function Xt(a){const r=a?a.url.toString():void 0;return ht.getEntriesByName(r)}let $t,jt,Kt,oi;const Ii={now:()=>Kt!==void 0?Kt:v.performance.now(),setNow(a){Kt=a},restoreNow(){Kt=void 0},frame(a){const r=v.requestAnimationFrame(a);return{cancel:()=>v.cancelAnimationFrame(r)}},getImageData(a,r=0){const{width:l,height:h}=a;oi||(oi=v.document.createElement("canvas"));const p=oi.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(l>oi.width||h>oi.height)&&(oi.width=l,oi.height=h),p.clearRect(-r,-r,l+2*r,h+2*r),p.drawImage(a,0,0,l,h),p.getImageData(-r,-r,l+2*r,h+2*r)},resolveURL:a=>($t||($t=v.document.createElement("a")),$t.href=a,$t.href),get devicePixelRatio(){return v.devicePixelRatio},get prefersReducedMotion(){return!!v.matchMedia&&(jt==null&&(jt=v.matchMedia("(prefers-reduced-motion: reduce)")),jt.matches)}};function Gt(a,r,l){l[a]&&l[a].indexOf(r)!==-1||(l[a]=l[a]||[],l[a].push(r))}function Fi(a,r,l){if(l&&l[a]){const h=l[a].indexOf(r);h!==-1&&l[a].splice(h,1)}}class Ni{constructor(r,l={}){yi(this,l),this.type=r}}class ao extends Ni{constructor(r,l={}){super("error",yi({error:r},l))}}class Ls{on(r,l){return this._listeners=this._listeners||{},Gt(r,l,this._listeners),this}off(r,l){return Fi(r,l,this._listeners),Fi(r,l,this._oneTimeListeners),this}once(r,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Gt(r,l,this._oneTimeListeners),this):new Promise(h=>this.once(r,h))}fire(r,l){typeof r=="string"&&(r=new Ni(r,l||{}));const h=r.type;if(this.listens(h)){r.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const T of p)T.call(this,r);const _=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const T of _)Fi(h,T,this._oneTimeListeners),T.call(this,r);const x=this._eventedParent;x&&(yi(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(r))}else r instanceof ao&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,l){return this._eventedParent=r,this._eventedParentData=l,this}}var Ze=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Bs(a,...r){for(const l of r)for(const h in l)a[h]=l[h];return a}function wn(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function lo(a){if(Array.isArray(a))return a.map(lo);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const r={};for(const l in a)r[l]=lo(a[l]);return r}return wn(a)}class Rp extends Error{constructor(r,l){super(l),this.message=l,this.key=r}}var xs=Rp;class Ma{constructor(r,l=[]){this.parent=r,this.bindings={};for(const[h,p]of l)this.bindings[h]=p}concat(r){return new Ma(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}var Pp=Ma;const Ra={kind:"null"},bt={kind:"number"},mi={kind:"string"},ui={kind:"boolean"},vs={kind:"color"},Jo={kind:"object"},li={kind:"value"},Ml={kind:"collator"},Pa={kind:"formatted"},ka={kind:"resolvedImage"};function hr(a,r){return{kind:"array",itemType:a,N:r}}function $i(a){if(a.kind==="array"){const r=$i(a.itemType);return typeof a.N=="number"?`array<${r}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${r}>`}return a.kind}const kp=[Ra,bt,mi,ui,vs,Pa,Jo,hr(li),ka];function yr(a,r){if(r.kind==="error")return null;if(a.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!yr(a.itemType,r.itemType))&&(typeof a.N!="number"||a.N===r.N))return null}else{if(a.kind===r.kind)return null;if(a.kind==="value"){for(const l of kp)if(!yr(l,r))return null}}return`Expected ${$i(a)} but found ${$i(r)} instead.`}function Zh(a,r){return r.some(l=>l.kind===a.kind)}function Qo(a,r){return r.some(l=>l==="null"?a===null:l==="array"?Array.isArray(a):l==="object"?a&&!Array.isArray(a)&&typeof a=="object":l===typeof a)}var Yh,tu={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Rl(a){return(a=Math.round(a))<0?0:a>255?255:a}function ea(a){return Rl(a[a.length-1]==="%"?parseFloat(a)/100*255:parseInt(a))}function Da(a){return(r=a[a.length-1]==="%"?parseFloat(a)/100:parseFloat(a))<0?0:r>1?1:r;var r}function Kh(a,r,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?a+(r-a)*l*6:2*l<1?r:3*l<2?a+(r-a)*(2/3-l)*6:a}try{Yh={}.parseCSSColor=function(a){var r,l=a.replace(/ /g,"").toLowerCase();if(l in tu)return tu[l].slice();if(l[0]==="#")return l.length===4?(r=parseInt(l.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:l.length===7&&(r=parseInt(l.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var h=l.indexOf("("),p=l.indexOf(")");if(h!==-1&&p+1===l.length){var _=l.substr(0,h),x=l.substr(h+1,p-(h+1)).split(","),T=1;switch(_){case"rgba":if(x.length!==4)return null;T=Da(x.pop());case"rgb":return x.length!==3?null:[ea(x[0]),ea(x[1]),ea(x[2]),T];case"hsla":if(x.length!==4)return null;T=Da(x.pop());case"hsl":if(x.length!==3)return null;var A=(parseFloat(x[0])%360+360)%360/360,I=Da(x[1]),P=Da(x[2]),D=P<=.5?P*(I+1):P+I-P*I,O=2*P-D;return[Rl(255*Kh(O,D,A+1/3)),Rl(255*Kh(O,D,A)),Rl(255*Kh(O,D,A-1/3)),T];default:return null}}return null}}catch{}class xr{constructor(r,l,h,p=1){this.r=r,this.g=l,this.b=h,this.a=p}static parse(r){if(!r)return;if(r instanceof xr)return r;if(typeof r!="string")return;const l=Yh(r);return l?new xr(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[r,l,h,p]=this.toArray();return`rgba(${Math.round(r)},${Math.round(l)},${Math.round(h)},${p})`}toArray(){const{r,g:l,b:h,a:p}=this;return p===0?[0,0,0,0]:[255*r/p,255*l/p,255*h/p,p]}toArray01(){const{r,g:l,b:h,a:p}=this;return p===0?[0,0,0,0]:[r/p,l/p,h/p,p]}toArray01PremultipliedAlpha(){const{r,g:l,b:h,a:p}=this;return[r,l,h,p]}}xr.black=new xr(0,0,0,1),xr.white=new xr(1,1,1,1),xr.transparent=new xr(0,0,0,0),xr.red=new xr(1,0,0,1),xr.blue=new xr(0,0,1,1);var mn=xr;class iu{constructor(r,l,h){this.sensitivity=r?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,l){return this.collator.compare(r,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Pl{constructor(r,l,h,p,_){this.text=r.normalize?r.normalize():r,this.image=l,this.scale=h,this.fontStack=p,this.textColor=_}}class vr{constructor(r){this.sections=r}static fromString(r){return new vr([new Pl(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof vr?r:vr.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const l of this.sections){if(l.image){r.push(["image",l.image.name]);continue}r.push(l.text);const h={};l.fontStack&&(h["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(h["font-scale"]=l.scale),l.textColor&&(h["text-color"]=["rgba"].concat(l.textColor.toArray())),r.push(h)}return r}}class fr{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new fr({name:r,available:!1}):null}serialize(){return["image",this.name]}}function Dp(a,r,l,h){return typeof a=="number"&&a>=0&&a<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof l=="number"&&l>=0&&l<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[a,r,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[a,r,l,h]:[a,r,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function nu(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof mn||a instanceof iu||a instanceof vr||a instanceof fr)return!0;if(Array.isArray(a)){for(const r of a)if(!nu(r))return!1;return!0}if(typeof a=="object"){for(const r in a)if(!nu(a[r]))return!1;return!0}return!1}function Mn(a){if(a===null)return Ra;if(typeof a=="string")return mi;if(typeof a=="boolean")return ui;if(typeof a=="number")return bt;if(a instanceof mn)return vs;if(a instanceof iu)return Ml;if(a instanceof vr)return Pa;if(a instanceof fr)return ka;if(Array.isArray(a)){const r=a.length;let l;for(const h of a){const p=Mn(h);if(l){if(l===p)continue;l=li;break}l=p}return hr(l||li,r)}return Jo}function kl(a){const r=typeof a;return a===null?"":r==="string"||r==="number"||r==="boolean"?String(a):a instanceof mn||a instanceof vr||a instanceof fr?a.toString():JSON.stringify(a)}class Jh{constructor(r,l){this.type=r,this.value=l}static parse(r,l){if(r.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!nu(r[1]))return l.error("invalid value");const h=r[1];let p=Mn(h);const _=l.expectedType;return p.kind!=="array"||p.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(p=_),new Jh(p,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof mn?["rgba"].concat(this.value.toArray()):this.value instanceof vr?this.value.serialize():this.value}}var Dl=Jh,Gn=class{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}};const ru={string:mi,number:bt,boolean:ui,object:Jo};class Oa{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");let h,p=1;const _=r[0];if(_==="array"){let T,A;if(r.length>2){const I=r[1];if(typeof I!="string"||!(I in ru)||I==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);T=ru[I],p++}else T=li;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return l.error('The length argument to "array" must be a positive integer literal',2);A=r[2],p++}h=hr(T,A)}else h=ru[_];const x=[];for(;p<r.length;p++){const T=l.parse(r[p],p,li);if(!T)return null;x.push(T)}return new Oa(h,x)}evaluate(r){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(r);if(!yr(this.type,Mn(h)))return h;if(l===this.args.length-1)throw new Gn(`Expected value to be of type ${$i(this.type)}, but found ${$i(Mn(h))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,l=[r.kind];if(r.kind==="array"){const h=r.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){l.push(h.kind);const p=r.N;(typeof p=="number"||this.args.length>1)&&l.push(p)}}return l.concat(this.args.map(h=>h.serialize()))}}var Fs=Oa;class Ol{constructor(r){this.type=Pa,this.sections=r}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const h=r[1];if(!Array.isArray(h)&&typeof h=="object")return l.error("First argument must be an image or text section.");const p=[];let _=!1;for(let x=1;x<=r.length-1;++x){const T=r[x];if(_&&typeof T=="object"&&!Array.isArray(T)){_=!1;let A=null;if(T["font-scale"]&&(A=l.parse(T["font-scale"],1,bt),!A))return null;let I=null;if(T["text-font"]&&(I=l.parse(T["text-font"],1,hr(mi)),!I))return null;let P=null;if(T["text-color"]&&(P=l.parse(T["text-color"],1,vs),!P))return null;const D=p[p.length-1];D.scale=A,D.font=I,D.textColor=P}else{const A=l.parse(r[x],1,li);if(!A)return null;const I=A.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,p.push({content:A,scale:null,font:null,textColor:null})}}return new Ol(p)}evaluate(r){return new vr(this.sections.map(l=>{const h=l.content.evaluate(r);return Mn(h)===ka?new Pl("",h,null,null,null):new Pl(kl(h),null,l.scale?l.scale.evaluate(r):null,l.font?l.font.evaluate(r).join(","):null,l.textColor?l.textColor.evaluate(r):null)}))}eachChild(r){for(const l of this.sections)r(l.content),l.scale&&r(l.scale),l.font&&r(l.font),l.textColor&&r(l.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const l of this.sections){r.push(l.content.serialize());const h={};l.scale&&(h["font-scale"]=l.scale.serialize()),l.font&&(h["text-font"]=l.font.serialize()),l.textColor&&(h["text-color"]=l.textColor.serialize()),r.push(h)}return r}}class su{constructor(r){this.type=ka,this.input=r}static parse(r,l){if(r.length!==2)return l.error("Expected two arguments.");const h=l.parse(r[1],1,mi);return h?new su(h):l.error("No image name provided.")}evaluate(r){const l=this.input.evaluate(r),h=fr.fromString(l);return h&&r.availableImages&&(h.available=r.availableImages.indexOf(l)>-1),h}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const jy={"to-boolean":ui,"to-color":vs,"to-number":bt,"to-string":mi};class Qh{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const h=r[0];if((h==="to-boolean"||h==="to-string")&&r.length!==2)return l.error("Expected one argument.");const p=jy[h],_=[];for(let x=1;x<r.length;x++){const T=l.parse(r[x],x,li);if(!T)return null;_.push(T)}return new Qh(p,_)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let l,h;for(const p of this.args){if(l=p.evaluate(r),h=null,l instanceof mn)return l;if(typeof l=="string"){const _=r.parseColor(l);if(_)return _}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Dp(l[0],l[1],l[2],l[3]),!h))return new mn(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Gn(h||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(const h of this.args){if(l=h.evaluate(r),l===null)return 0;const p=Number(l);if(!isNaN(p))return p}throw new Gn(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?vr.fromString(kl(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?fr.fromString(kl(this.args[0].evaluate(r))):kl(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ol([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new su(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(l=>{r.push(l.serialize())}),r}}var La=Qh;const Op=["Unknown","Point","LineString","Polygon"];var Ll=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Op[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*r-a[0])+this.featureDistanceData.bearing[1]*(h*r-a[1])}return 0}parseColor(a){let r=this._parseColorCache[a];return r||(r=this._parseColorCache[a]=mn.parse(a)),r}};class Ba{constructor(r,l,h,p){this.name=r,this.type=l,this._evaluate=h,this.args=p}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,l){const h=r[0],p=Ba.definitions[h];if(!p)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(p)?p[0]:p.type,x=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,T=x.filter(([I])=>!Array.isArray(I)||I.length===r.length-1);let A=null;for(const[I,P]of T){A=new of(l.registry,l.path,null,l.scope);const D=[];let O=!1;for(let N=1;N<r.length;N++){const z=r[N],$=Array.isArray(I)?I[N-1]:I.type,G=A.parse(z,1+D.length,$);if(!G){O=!0;break}D.push(G)}if(!O)if(Array.isArray(I)&&I.length!==D.length)A.error(`Expected ${I.length} arguments, but found ${D.length} instead.`);else{for(let N=0;N<D.length;N++){const z=Array.isArray(I)?I[N]:I.type,$=D[N];A.concat(N+1).checkSubtype(z,$.type)}if(A.errors.length===0)return new Ba(h,_,P,D)}}if(T.length===1)l.errors.push(...A.errors);else{const I=(T.length?T:x).map(([D])=>{return O=D,Array.isArray(O)?`(${O.map($i).join(", ")})`:`(${$i(O.type)}...)`;var O}).join(" | "),P=[];for(let D=1;D<r.length;D++){const O=l.parse(r[D],1+P.length);if(!O)return null;P.push($i(O.type))}l.error(`Expected arguments of type ${I}, but found (${P.join(", ")}) instead.`)}return null}static register(r,l){Ba.definitions=l;for(const h in l)r[h]=Ba}}var co=Ba;class ou{constructor(r,l,h){this.type=Ml,this.locale=h,this.caseSensitive=r,this.diacriticSensitive=l}static parse(r,l){if(r.length!==2)return l.error("Expected one argument.");const h=r[1];if(typeof h!="object"||Array.isArray(h))return l.error("Collator options argument must be an object.");const p=l.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,ui);if(!p)return null;const _=l.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,ui);if(!_)return null;let x=null;return h.locale&&(x=l.parse(h.locale,1,mi),!x)?null:new ou(p,_,x)}evaluate(r){return new iu(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const uo=8192;function Hr(a,r){a[0]=Math.min(a[0],r[0]),a[1]=Math.min(a[1],r[1]),a[2]=Math.max(a[2],r[0]),a[3]=Math.max(a[3],r[1])}function Bl(a,r){return!(a[0]<=r[0]||a[2]>=r[2]||a[1]<=r[1]||a[3]>=r[3])}function Lp(a,r){const l=(180+a[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,p=Math.pow(2,r.z);return[Math.round(l*p*uo),Math.round(h*p*uo)]}function Bp(a,r,l){const h=a[0]-r[0],p=a[1]-r[1],_=a[0]-l[0],x=a[1]-l[1];return h*x-_*p==0&&h*_<=0&&p*x<=0}function au(a,r){let l=!1;for(let x=0,T=r.length;x<T;x++){const A=r[x];for(let I=0,P=A.length;I<P-1;I++){if(Bp(a,A[I],A[I+1]))return!1;(p=A[I])[1]>(h=a)[1]!=(_=A[I+1])[1]>h[1]&&h[0]<(_[0]-p[0])*(h[1]-p[1])/(_[1]-p[1])+p[0]&&(l=!l)}}var h,p,_;return l}function Fp(a,r){for(let l=0;l<r.length;l++)if(au(a,r[l]))return!0;return!1}function ef(a,r,l,h){const p=h[0]-l[0],_=h[1]-l[1],x=(a[0]-l[0])*_-p*(a[1]-l[1]),T=(r[0]-l[0])*_-p*(r[1]-l[1]);return x>0&&T<0||x<0&&T>0}function tf(a,r,l){for(const I of l)for(let P=0;P<I.length-1;++P)if((T=[(x=I[P+1])[0]-(_=I[P])[0],x[1]-_[1]])[0]*(A=[(p=r)[0]-(h=a)[0],p[1]-h[1]])[1]-T[1]*A[0]!=0&&ef(h,p,_,x)&&ef(_,x,h,p))return!0;var h,p,_,x,T,A;return!1}function Fa(a,r){for(let l=0;l<a.length;++l)if(!au(a[l],r))return!1;for(let l=0;l<a.length-1;++l)if(tf(a[l],a[l+1],r))return!1;return!0}function Np(a,r){for(let l=0;l<r.length;l++)if(Fa(a,r[l]))return!0;return!1}function lu(a,r,l){const h=[];for(let p=0;p<a.length;p++){const _=[];for(let x=0;x<a[p].length;x++){const T=Lp(a[p][x],l);Hr(r,T),_.push(T)}h.push(_)}return h}function cu(a,r,l){const h=[];for(let p=0;p<a.length;p++){const _=lu(a[p],r,l);h.push(_)}return h}function nf(a,r,l,h){if(a[0]<l[0]||a[0]>l[2]){const p=.5*h;let _=a[0]-l[0]>p?-h:l[0]-a[0]>p?h:0;_===0&&(_=a[0]-l[2]>p?-h:l[2]-a[0]>p?h:0),a[0]+=_}Hr(r,a)}function ta(a,r,l,h){const p=Math.pow(2,h.z)*uo,_=[h.x*uo,h.y*uo],x=[];if(!a)return x;for(const T of a)for(const A of T){const I=[A.x+_[0],A.y+_[1]];nf(I,r,l,p),x.push(I)}return x}function Ci(a,r,l,h){const p=Math.pow(2,h.z)*uo,_=[h.x*uo,h.y*uo],x=[];if(!a)return x;for(const A of a){const I=[];for(const P of A){const D=[P.x+_[0],P.y+_[1]];Hr(r,D),I.push(D)}x.push(I)}if(r[2]-r[0]<=p/2){(T=r)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const A of x)for(const I of A)nf(I,r,l,p)}var T;return x}class Fl{constructor(r,l){this.type=ui,this.geojson=r,this.geometries=l}static parse(r,l){if(r.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(nu(r[1])){const h=r[1];if(h.type==="FeatureCollection")for(let p=0;p<h.features.length;++p){const _=h.features[p].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Fl(h,h.features[p].geometry)}else if(h.type==="Feature"){const p=h.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Fl(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Fl(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(l,h){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(!x)return!1;if(h.type==="Polygon"){const T=lu(h.coordinates,_,x),A=ta(l.geometry(),p,_,x);if(!Bl(p,_))return!1;for(const I of A)if(!au(I,T))return!1}if(h.type==="MultiPolygon"){const T=cu(h.coordinates,_,x),A=ta(l.geometry(),p,_,x);if(!Bl(p,_))return!1;for(const I of A)if(!Fp(I,T))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(l,h){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(!x)return!1;if(h.type==="Polygon"){const T=lu(h.coordinates,_,x),A=Ci(l.geometry(),p,_,x);if(!Bl(p,_))return!1;for(const I of A)if(!Fa(I,T))return!1}if(h.type==="MultiPolygon"){const T=cu(h.coordinates,_,x),A=Ci(l.geometry(),p,_,x);if(!Bl(p,_))return!1;for(const I of A)if(!Np(I,T))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var rf=Fl;function Nl(a){if(a instanceof co&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof rf)return!1;let r=!0;return a.eachChild(l=>{r&&!Nl(l)&&(r=!1)}),r}function zl(a){if(a instanceof co&&a.name==="feature-state")return!1;let r=!0;return a.eachChild(l=>{r&&!zl(l)&&(r=!1)}),r}function uu(a,r){if(a instanceof co&&r.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(h=>{l&&!uu(h,r)&&(l=!1)}),l}class hu{constructor(r,l){this.type=l.type,this.name=r,this.boundExpression=l}static parse(r,l){if(r.length!==2||typeof r[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const h=r[1];return l.scope.has(h)?new hu(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var sf=hu;class fu{constructor(r,l=[],h,p=new Pp,_=[]){this.registry=r,this.path=l,this.key=l.map(x=>`[${x}]`).join(""),this.scope=p,this.errors=_,this.expectedType=h}parse(r,l,h,p,_={}){return l?this.concat(l,h,p)._parse(r,_):this._parse(r,_)}_parse(r,l){function h(p,_,x){return x==="assert"?new Fs(_,[p]):x==="coerce"?new La(_,[p]):p}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=r[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[p];if(_){let x=_.parse(r,this);if(!x)return null;if(this.expectedType){const T=this.expectedType,A=x.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||A.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string"){if(this.checkSubtype(T,A))return null}else x=h(x,T,l.typeAnnotation||"coerce");else x=h(x,T,l.typeAnnotation||"assert")}if(!(x instanceof Dl)&&x.type.kind!=="resolvedImage"&&ho(x)){const T=new Ll;try{x=new Dl(x.type,x.evaluate(T))}catch(A){return this.error(A.message),null}}return x}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,l,h){const p=typeof r=="number"?this.path.concat(r):this.path,_=h?this.scope.concat(h):this.scope;return new fu(this.registry,p,l||null,_,this.errors)}error(r,...l){const h=`${this.key}${l.map(p=>`[${p}]`).join("")}`;this.errors.push(new xs(h,r))}checkSubtype(r,l){const h=yr(r,l);return h&&this.error(h),h}}var of=fu;function ho(a){if(a instanceof sf)return ho(a.boundExpression);if(a instanceof co&&a.name==="error"||a instanceof ou||a instanceof rf)return!1;const r=a instanceof La||a instanceof Fs;let l=!0;return a.eachChild(h=>{l=r?l&&ho(h):l&&h instanceof Dl}),!!l&&Nl(a)&&uu(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ia(a,r){const l=a.length-1;let h,p,_=0,x=l,T=0;for(;_<=x;)if(T=Math.floor((_+x)/2),h=a[T],p=a[T+1],h<=r){if(T===l||r<p)return T;_=T+1}else{if(!(h>r))throw new Gn("Input is not a number.");x=T-1}return 0}class du{constructor(r,l,h){this.type=r,this.input=l,this.labels=[],this.outputs=[];for(const[p,_]of h)this.labels.push(p),this.outputs.push(_)}static parse(r,l){if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(r[1],1,bt);if(!h)return null;const p=[];let _=null;l.expectedType&&l.expectedType.kind!=="value"&&(_=l.expectedType);for(let x=1;x<r.length;x+=2){const T=x===1?-1/0:r[x],A=r[x+1],I=x,P=x+1;if(typeof T!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(p.length&&p[p.length-1][0]>=T)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const D=l.parse(A,P,_);if(!D)return null;_=_||D.type,p.push([T,D])}return new du(_,h,p)}evaluate(r){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(r);const p=this.input.evaluate(r);if(p<=l[0])return h[0].evaluate(r);const _=l.length;return p>=l[_-1]?h[_-1].evaluate(r):h[ia(l,p)].evaluate(r)}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&r.push(this.labels[l]),r.push(this.outputs[l].serialize());return r}}var af=du;function vi(a,r,l){return a*(1-l)+r*l}var Ul=Object.freeze({__proto__:null,number:vi,color:function(a,r,l){return new mn(vi(a.r,r.r,l),vi(a.g,r.g,l),vi(a.b,r.b,l),vi(a.a,r.a,l))},array:function(a,r,l){return a.map((h,p)=>vi(h,r[p],l))}});const zp=.95047,Up=1.08883,lf=4/29,cf=6/29,uf=3*cf*cf,Vp=Math.PI/180,$y=180/Math.PI;function pu(a){return a>.008856451679035631?Math.pow(a,1/3):a/uf+lf}function hf(a){return a>cf?a*a*a:uf*(a-lf)}function mu(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function gu(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function jp(a){const r=gu(a.r),l=gu(a.g),h=gu(a.b),p=pu((.4124564*r+.3575761*l+.1804375*h)/zp),_=pu((.2126729*r+.7151522*l+.072175*h)/1);return{l:116*_-16,a:500*(p-_),b:200*(_-pu((.0193339*r+.119192*l+.9503041*h)/Up)),alpha:a.a}}function $p(a){let r=(a.l+16)/116,l=isNaN(a.a)?r:r+a.a/500,h=isNaN(a.b)?r:r-a.b/200;return r=1*hf(r),l=zp*hf(l),h=Up*hf(h),new mn(mu(3.2404542*l-1.5371385*r-.4985314*h),mu(-.969266*l+1.8760108*r+.041556*h),mu(.0556434*l-.2040259*r+1.0572252*h),a.alpha)}function Wy(a,r,l){const h=r-a;return a+l*(h>180||h<-180?h-360*Math.round(h/360):h)}const Vl={forward:jp,reverse:$p,interpolate:function(a,r,l){return{l:vi(a.l,r.l,l),a:vi(a.a,r.a,l),b:vi(a.b,r.b,l),alpha:vi(a.alpha,r.alpha,l)}}},jl={forward:function(a){const{l:r,a:l,b:h}=jp(a),p=Math.atan2(h,l)*$y;return{h:p<0?p+360:p,c:Math.sqrt(l*l+h*h),l:r,alpha:a.a}},reverse:function(a){const r=a.h*Vp,l=a.c;return $p({l:a.l,a:Math.cos(r)*l,b:Math.sin(r)*l,alpha:a.alpha})},interpolate:function(a,r,l){return{h:Wy(a.h,r.h,l),c:vi(a.c,r.c,l),l:vi(a.l,r.l,l),alpha:vi(a.alpha,r.alpha,l)}}};var Wp=Object.freeze({__proto__:null,lab:Vl,hcl:jl});class $l{constructor(r,l,h,p,_){this.type=r,this.operator=l,this.interpolation=h,this.input=p,this.labels=[],this.outputs=[];for(const[x,T]of _)this.labels.push(x),this.outputs.push(T)}static interpolationFactor(r,l,h,p){let _=0;if(r.name==="exponential")_=ff(l,r.base,h,p);else if(r.name==="linear")_=ff(l,1,h,p);else if(r.name==="cubic-bezier"){const x=r.controlPoints;_=new oe(x[0],x[1],x[2],x[3]).solve(ff(l,1,h,p))}return _}static parse(r,l){let[h,p,_,...x]=r;if(!Array.isArray(p)||p.length===0)return l.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const I=p[1];if(typeof I!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:I}}else{if(p[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const I=p.slice(1);if(I.length!==4||I.some(P=>typeof P!="number"||P<0||P>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:I}}}if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(_=l.parse(_,2,bt),!_)return null;const T=[];let A=null;h==="interpolate-hcl"||h==="interpolate-lab"?A=vs:l.expectedType&&l.expectedType.kind!=="value"&&(A=l.expectedType);for(let I=0;I<x.length;I+=2){const P=x[I],D=x[I+1],O=I+3,N=I+4;if(typeof P!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(T.length&&T[T.length-1][0]>=P)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const z=l.parse(D,N,A);if(!z)return null;A=A||z.type,T.push([P,z])}return A.kind==="number"||A.kind==="color"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new $l(A,h,p,_,T):l.error(`Type ${$i(A)} is not interpolatable.`)}evaluate(r){const l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(r);const p=this.input.evaluate(r);if(p<=l[0])return h[0].evaluate(r);const _=l.length;if(p>=l[_-1])return h[_-1].evaluate(r);const x=ia(l,p),T=$l.interpolationFactor(this.interpolation,p,l[x],l[x+1]),A=h[x].evaluate(r),I=h[x+1].evaluate(r);return this.operator==="interpolate"?Ul[this.type.kind.toLowerCase()](A,I,T):this.operator==="interpolate-hcl"?jl.reverse(jl.interpolate(jl.forward(A),jl.forward(I),T)):Vl.reverse(Vl.interpolate(Vl.forward(A),Vl.forward(I),T))}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,r,this.input.serialize()];for(let h=0;h<this.labels.length;h++)l.push(this.labels[h],this.outputs[h].serialize());return l}}function ff(a,r,l,h){const p=h-l,_=a-l;return p===0?0:r===1?_/p:(Math.pow(r,_)-1)/(Math.pow(r,p)-1)}var bs=$l;class df{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expectected at least one argument.");let h=null;const p=l.expectedType;p&&p.kind!=="value"&&(h=p);const _=[];for(const T of r.slice(1)){const A=l.parse(T,1+_.length,h,void 0,{typeAnnotation:"omit"});if(!A)return null;h=h||A.type,_.push(A)}const x=p&&_.some(T=>yr(p,T.type));return new df(x?li:h,_)}evaluate(r){let l,h=null,p=0;for(const _ of this.args){if(p++,h=_.evaluate(r),h&&h instanceof fr&&!h.available&&(l||(l=h),h=null,p===this.args.length))return l;if(h!==null)break}return h}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(l=>{r.push(l.serialize())}),r}}var Hp=df;class _u{constructor(r,l){this.type=l.type,this.bindings=[].concat(r),this.result=l}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const l of this.bindings)r(l[1]);r(this.result)}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const h=[];for(let _=1;_<r.length-1;_+=2){const x=r[_];if(typeof x!="string")return l.error(`Expected string, but found ${typeof x} instead.`,_);if(/[^a-zA-Z0-9_]/.test(x))return l.error("Variable names must contain only alphanumeric characters or '_'.",_);const T=l.parse(r[_+1],_+1);if(!T)return null;h.push([x,T])}const p=l.parse(r[r.length-1],r.length-1,l.expectedType,h);return p?new _u(h,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[l,h]of this.bindings)r.push(l,h.serialize());return r.push(this.result.serialize()),r}}var pf=_u;class yu{constructor(r,l,h){this.type=r,this.index=l,this.input=h}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,bt),p=l.parse(r[2],2,hr(l.expectedType||li));return h&&p?new yu(p.type.itemType,h,p):null}evaluate(r){const l=this.index.evaluate(r),h=this.input.evaluate(r);if(l<0)throw new Gn(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new Gn(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new Gn(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Hy=yu;class mf{constructor(r,l){this.type=ui,this.needle=r,this.haystack=l}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,li),p=l.parse(r[2],2,li);return h&&p?Zh(h.type,[ui,mi,bt,Ra,li])?new mf(h,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${$i(h.type)} instead`):null}evaluate(r){const l=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(h==null)return!1;if(!Qo(l,["boolean","string","number","null"]))throw new Gn(`Expected first argument to be of type boolean, string, number or null, but found ${$i(Mn(l))} instead.`);if(!Qo(h,["string","array"]))throw new Gn(`Expected second argument to be of type array or string, but found ${$i(Mn(h))} instead.`);return h.indexOf(l)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Xp=mf;class Wl{constructor(r,l,h){this.type=bt,this.needle=r,this.haystack=l,this.fromIndex=h}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,li),p=l.parse(r[2],2,li);if(!h||!p)return null;if(!Zh(h.type,[ui,mi,bt,Ra,li]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${$i(h.type)} instead`);if(r.length===4){const _=l.parse(r[3],3,bt);return _?new Wl(h,p,_):null}return new Wl(h,p)}evaluate(r){const l=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!Qo(l,["boolean","string","number","null"]))throw new Gn(`Expected first argument to be of type boolean, string, number or null, but found ${$i(Mn(l))} instead.`);if(!Qo(h,["string","array"]))throw new Gn(`Expected second argument to be of type array or string, but found ${$i(Mn(h))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(r);return h.indexOf(l,p)}return h.indexOf(l)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var qp=Wl;class gf{constructor(r,l,h,p,_,x){this.inputType=r,this.type=l,this.input=h,this.cases=p,this.outputs=_,this.otherwise=x}static parse(r,l){if(r.length<5)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return l.error("Expected an even number of arguments.");let h,p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);const _={},x=[];for(let I=2;I<r.length-1;I+=2){let P=r[I];const D=r[I+1];Array.isArray(P)||(P=[P]);const O=l.concat(I);if(P.length===0)return O.error("Expected at least one branch label.");for(const z of P){if(typeof z!="number"&&typeof z!="string")return O.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return O.error("Numeric branch labels must be integer values.");if(h){if(O.checkSubtype(h,Mn(z)))return null}else h=Mn(z);if(_[String(z)]!==void 0)return O.error("Branch labels must be unique.");_[String(z)]=x.length}const N=l.parse(D,I,p);if(!N)return null;p=p||N.type,x.push(N)}const T=l.parse(r[1],1,li);if(!T)return null;const A=l.parse(r[r.length-1],r.length-1,p);return A?T.type.kind!=="value"&&l.concat(1).checkSubtype(h,T.type)?null:new gf(h,p,T,_,x,A):null}evaluate(r){const l=this.input.evaluate(r);return(Mn(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),h=[],p={};for(const x of l){const T=p[this.cases[x]];T===void 0?(p[this.cases[x]]=h.length,h.push([this.cases[x],[x]])):h[T][1].push(x)}const _=x=>this.inputType.kind==="number"?Number(x):x;for(const[x,T]of h)r.push(T.length===1?_(T[0]):T.map(_)),r.push(this.outputs[x].serialize());return r.push(this.otherwise.serialize()),r}}var Xy=gf;class _f{constructor(r,l,h){this.type=r,this.branches=l,this.otherwise=h}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&l.expectedType.kind!=="value"&&(h=l.expectedType);const p=[];for(let x=1;x<r.length-1;x+=2){const T=l.parse(r[x],x,ui);if(!T)return null;const A=l.parse(r[x+1],x+1,h);if(!A)return null;p.push([T,A]),h=h||A.type}const _=l.parse(r[r.length-1],r.length-1,h);return _?new _f(h,p,_):null}evaluate(r){for(const[l,h]of this.branches)if(l.evaluate(r))return h.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[l,h]of this.branches)r(l),r(h);r(this.otherwise)}outputDefined(){return this.branches.every(([r,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(l=>{r.push(l.serialize())}),r}}var qy=_f;class na{constructor(r,l,h,p){this.type=r,this.input=l,this.beginIndex=h,this.endIndex=p}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=l.parse(r[1],1,li),p=l.parse(r[2],2,bt);if(!h||!p)return null;if(!Zh(h.type,[hr(li),mi,li]))return l.error(`Expected first argument to be of type array or string, but found ${$i(h.type)} instead`);if(r.length===4){const _=l.parse(r[3],3,bt);return _?new na(h.type,h,p,_):null}return new na(h.type,h,p)}evaluate(r){const l=this.input.evaluate(r),h=this.beginIndex.evaluate(r);if(!Qo(l,["string","array"]))throw new Gn(`Expected first argument to be of type array or string, but found ${$i(Mn(l))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(r);return l.slice(h,p)}return l.slice(h)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Gp=na;function yf(a,r){return a==="=="||a==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Zp(a,r,l,h){return h.compare(r,l)===0}function Na(a,r,l){const h=a!=="=="&&a!=="!=";return class yM{constructor(_,x,T){this.type=ui,this.lhs=_,this.rhs=x,this.collator=T,this.hasUntypedArgument=_.type.kind==="value"||x.type.kind==="value"}static parse(_,x){if(_.length!==3&&_.length!==4)return x.error("Expected two or three arguments.");const T=_[0];let A=x.parse(_[1],1,li);if(!A)return null;if(!yf(T,A.type))return x.concat(1).error(`"${T}" comparisons are not supported for type '${$i(A.type)}'.`);let I=x.parse(_[2],2,li);if(!I)return null;if(!yf(T,I.type))return x.concat(2).error(`"${T}" comparisons are not supported for type '${$i(I.type)}'.`);if(A.type.kind!==I.type.kind&&A.type.kind!=="value"&&I.type.kind!=="value")return x.error(`Cannot compare types '${$i(A.type)}' and '${$i(I.type)}'.`);h&&(A.type.kind==="value"&&I.type.kind!=="value"?A=new Fs(I.type,[A]):A.type.kind!=="value"&&I.type.kind==="value"&&(I=new Fs(A.type,[I])));let P=null;if(_.length===4){if(A.type.kind!=="string"&&I.type.kind!=="string"&&A.type.kind!=="value"&&I.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(P=x.parse(_[3],3,Ml),!P)return null}return new yM(A,I,P)}evaluate(_){const x=this.lhs.evaluate(_),T=this.rhs.evaluate(_);if(h&&this.hasUntypedArgument){const A=Mn(x),I=Mn(T);if(A.kind!==I.kind||A.kind!=="string"&&A.kind!=="number")throw new Gn(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${A.kind}, ${I.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const A=Mn(x),I=Mn(T);if(A.kind!=="string"||I.kind!=="string")return r(_,x,T)}return this.collator?l(_,x,T,this.collator.evaluate(_)):r(_,x,T)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[a];return this.eachChild(x=>{_.push(x.serialize())}),_}}}const Gy=Na("==",function(a,r,l){return r===l},Zp),Yp=Na("!=",function(a,r,l){return r!==l},function(a,r,l,h){return!Zp(0,r,l,h)}),Kp=Na("<",function(a,r,l){return r<l},function(a,r,l,h){return h.compare(r,l)<0}),Jp=Na(">",function(a,r,l){return r>l},function(a,r,l,h){return h.compare(r,l)>0}),xf=Na("<=",function(a,r,l){return r<=l},function(a,r,l,h){return h.compare(r,l)<=0}),Zy=Na(">=",function(a,r,l){return r>=l},function(a,r,l,h){return h.compare(r,l)>=0});class vf{constructor(r,l,h,p,_,x){this.type=mi,this.number=r,this.locale=l,this.currency=h,this.unit=p,this.minFractionDigits=_,this.maxFractionDigits=x}static parse(r,l){if(r.length!==3)return l.error("Expected two arguments.");const h=l.parse(r[1],1,bt);if(!h)return null;const p=r[2];if(typeof p!="object"||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let _=null;if(p.locale&&(_=l.parse(p.locale,1,mi),!_))return null;let x=null;if(p.currency&&(x=l.parse(p.currency,1,mi),!x))return null;let T=null;if(p.unit&&(T=l.parse(p.unit,1,mi),!T))return null;let A=null;if(p["min-fraction-digits"]&&(A=l.parse(p["min-fraction-digits"],1,bt),!A))return null;let I=null;return p["max-fraction-digits"]&&(I=l.parse(p["max-fraction-digits"],1,bt),!I)?null:new vf(h,_,x,T,A,I)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class bf{constructor(r){this.type=bt,this.input=r}static parse(r,l){if(r.length!==2)return l.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=l.parse(r[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${$i(h.type)} instead.`):new bf(h):null}evaluate(r){const l=this.input.evaluate(r);if(typeof l=="string"||Array.isArray(l))return l.length;throw new Gn(`Expected value to be of type string or array, but found ${$i(Mn(l))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(l=>{r.push(l.serialize())}),r}}const Qp={"==":Gy,"!=":Yp,">":Jp,"<":Kp,">=":Zy,"<=":xf,array:Fs,at:Hy,boolean:Fs,case:qy,coalesce:Hp,collator:ou,format:Ol,image:su,in:Xp,"index-of":qp,interpolate:bs,"interpolate-hcl":bs,"interpolate-lab":bs,length:bf,let:pf,literal:Dl,match:Xy,number:Fs,"number-format":vf,object:Fs,slice:Gp,step:af,string:Fs,"to-boolean":La,"to-color":La,"to-number":La,"to-string":La,var:sf,within:rf};function em(a,[r,l,h,p]){r=r.evaluate(a),l=l.evaluate(a),h=h.evaluate(a);const _=p?p.evaluate(a):1,x=Dp(r,l,h,_);if(x)throw new Gn(x);return new mn(r/255*_,l/255*_,h/255*_,_)}function tm(a,r){return a in r}function wf(a,r){const l=r[a];return l===void 0?null:l}function fo(a){return{type:a}}co.register(Qp,{error:[{kind:"error"},[mi],(a,[r])=>{throw new Gn(r.evaluate(a))}],typeof:[mi,[li],(a,[r])=>$i(Mn(r.evaluate(a)))],"to-rgba":[hr(bt,4),[vs],(a,[r])=>r.evaluate(a).toArray()],rgb:[vs,[bt,bt,bt],em],rgba:[vs,[bt,bt,bt,bt],em],has:{type:ui,overloads:[[[mi],(a,[r])=>tm(r.evaluate(a),a.properties())],[[mi,Jo],(a,[r,l])=>tm(r.evaluate(a),l.evaluate(a))]]},get:{type:li,overloads:[[[mi],(a,[r])=>wf(r.evaluate(a),a.properties())],[[mi,Jo],(a,[r,l])=>wf(r.evaluate(a),l.evaluate(a))]]},"feature-state":[li,[mi],(a,[r])=>wf(r.evaluate(a),a.featureState||{})],properties:[Jo,[],a=>a.properties()],"geometry-type":[mi,[],a=>a.geometryType()],id:[li,[],a=>a.id()],zoom:[bt,[],a=>a.globals.zoom],pitch:[bt,[],a=>a.globals.pitch||0],"distance-from-center":[bt,[],a=>a.distanceFromCenter()],"heatmap-density":[bt,[],a=>a.globals.heatmapDensity||0],"line-progress":[bt,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[bt,[],a=>a.globals.skyRadialProgress||0],accumulated:[li,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[bt,fo(bt),(a,r)=>{let l=0;for(const h of r)l+=h.evaluate(a);return l}],"*":[bt,fo(bt),(a,r)=>{let l=1;for(const h of r)l*=h.evaluate(a);return l}],"-":{type:bt,overloads:[[[bt,bt],(a,[r,l])=>r.evaluate(a)-l.evaluate(a)],[[bt],(a,[r])=>-r.evaluate(a)]]},"/":[bt,[bt,bt],(a,[r,l])=>r.evaluate(a)/l.evaluate(a)],"%":[bt,[bt,bt],(a,[r,l])=>r.evaluate(a)%l.evaluate(a)],ln2:[bt,[],()=>Math.LN2],pi:[bt,[],()=>Math.PI],e:[bt,[],()=>Math.E],"^":[bt,[bt,bt],(a,[r,l])=>Math.pow(r.evaluate(a),l.evaluate(a))],sqrt:[bt,[bt],(a,[r])=>Math.sqrt(r.evaluate(a))],log10:[bt,[bt],(a,[r])=>Math.log(r.evaluate(a))/Math.LN10],ln:[bt,[bt],(a,[r])=>Math.log(r.evaluate(a))],log2:[bt,[bt],(a,[r])=>Math.log(r.evaluate(a))/Math.LN2],sin:[bt,[bt],(a,[r])=>Math.sin(r.evaluate(a))],cos:[bt,[bt],(a,[r])=>Math.cos(r.evaluate(a))],tan:[bt,[bt],(a,[r])=>Math.tan(r.evaluate(a))],asin:[bt,[bt],(a,[r])=>Math.asin(r.evaluate(a))],acos:[bt,[bt],(a,[r])=>Math.acos(r.evaluate(a))],atan:[bt,[bt],(a,[r])=>Math.atan(r.evaluate(a))],min:[bt,fo(bt),(a,r)=>Math.min(...r.map(l=>l.evaluate(a)))],max:[bt,fo(bt),(a,r)=>Math.max(...r.map(l=>l.evaluate(a)))],abs:[bt,[bt],(a,[r])=>Math.abs(r.evaluate(a))],round:[bt,[bt],(a,[r])=>{const l=r.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[bt,[bt],(a,[r])=>Math.floor(r.evaluate(a))],ceil:[bt,[bt],(a,[r])=>Math.ceil(r.evaluate(a))],"filter-==":[ui,[mi,li],(a,[r,l])=>a.properties()[r.value]===l.value],"filter-id-==":[ui,[li],(a,[r])=>a.id()===r.value],"filter-type-==":[ui,[mi],(a,[r])=>a.geometryType()===r.value],"filter-<":[ui,[mi,li],(a,[r,l])=>{const h=a.properties()[r.value],p=l.value;return typeof h==typeof p&&h<p}],"filter-id-<":[ui,[li],(a,[r])=>{const l=a.id(),h=r.value;return typeof l==typeof h&&l<h}],"filter->":[ui,[mi,li],(a,[r,l])=>{const h=a.properties()[r.value],p=l.value;return typeof h==typeof p&&h>p}],"filter-id->":[ui,[li],(a,[r])=>{const l=a.id(),h=r.value;return typeof l==typeof h&&l>h}],"filter-<=":[ui,[mi,li],(a,[r,l])=>{const h=a.properties()[r.value],p=l.value;return typeof h==typeof p&&h<=p}],"filter-id-<=":[ui,[li],(a,[r])=>{const l=a.id(),h=r.value;return typeof l==typeof h&&l<=h}],"filter->=":[ui,[mi,li],(a,[r,l])=>{const h=a.properties()[r.value],p=l.value;return typeof h==typeof p&&h>=p}],"filter-id->=":[ui,[li],(a,[r])=>{const l=a.id(),h=r.value;return typeof l==typeof h&&l>=h}],"filter-has":[ui,[li],(a,[r])=>r.value in a.properties()],"filter-has-id":[ui,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[ui,[hr(mi)],(a,[r])=>r.value.indexOf(a.geometryType())>=0],"filter-id-in":[ui,[hr(li)],(a,[r])=>r.value.indexOf(a.id())>=0],"filter-in-small":[ui,[mi,hr(li)],(a,[r,l])=>l.value.indexOf(a.properties()[r.value])>=0],"filter-in-large":[ui,[mi,hr(li)],(a,[r,l])=>function(h,p,_,x){for(;_<=x;){const T=_+x>>1;if(p[T]===h)return!0;p[T]>h?x=T-1:_=T+1}return!1}(a.properties()[r.value],l.value,0,l.value.length-1)],all:{type:ui,overloads:[[[ui,ui],(a,[r,l])=>r.evaluate(a)&&l.evaluate(a)],[fo(ui),(a,r)=>{for(const l of r)if(!l.evaluate(a))return!1;return!0}]]},any:{type:ui,overloads:[[[ui,ui],(a,[r,l])=>r.evaluate(a)||l.evaluate(a)],[fo(ui),(a,r)=>{for(const l of r)if(l.evaluate(a))return!0;return!1}]]},"!":[ui,[ui],(a,[r])=>!r.evaluate(a)],"is-supported-script":[ui,[mi],(a,[r])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(r.evaluate(a))}],upcase:[mi,[mi],(a,[r])=>r.evaluate(a).toUpperCase()],downcase:[mi,[mi],(a,[r])=>r.evaluate(a).toLowerCase()],concat:[mi,fo(li),(a,r)=>r.map(l=>kl(l.evaluate(a))).join("")],"resolved-locale":[mi,[Ml],(a,[r])=>r.evaluate(a).resolvedLocale()]});var za=Qp;function Hl(a){return{result:"success",value:a}}function Ua(a){return{result:"error",value:a}}function Va(a){return a["property-type"]==="data-driven"}function Ns(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function xu(a){return!!a.expression&&a.expression.interpolated}function _i(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function vu(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Yy(a){return a}function Tf(a,r){const l=r.type==="color",h=a.stops&&typeof a.stops[0][0]=="object",p=h||!(h||a.property!==void 0),_=a.type||(xu(r)?"exponential":"interval");if(l&&((a=Bs({},a)).stops&&(a.stops=a.stops.map(I=>[I[0],mn.parse(I[1])])),a.default=mn.parse(a.default?a.default:r.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!Wp[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let x,T,A;if(_==="exponential")x=bu;else if(_==="interval")x=im;else if(_==="categorical"){x=Ef,T=Object.create(null);for(const I of a.stops)T[I[0]]=I[1];A=typeof a.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);x=nm}if(h){const I={},P=[];for(let N=0;N<a.stops.length;N++){const z=a.stops[N],$=z[0].zoom;I[$]===void 0&&(I[$]={zoom:$,type:a.type,property:a.property,default:a.default,stops:[]},P.push($)),I[$].stops.push([z[0].value,z[1]])}const D=[];for(const N of P)D.push([I[N].zoom,Tf(I[N],r)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:bs.interpolationFactor.bind(void 0,O),zoomStops:D.map(N=>N[0]),evaluate:({zoom:N},z)=>bu({stops:D,base:a.base},r,N).evaluate(N,z)}}if(p){const I=_==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:bs.interpolationFactor.bind(void 0,I),zoomStops:a.stops.map(P=>P[0]),evaluate:({zoom:P})=>x(a,r,P,T,A)}}return{kind:"source",evaluate(I,P){const D=P&&P.properties?P.properties[a.property]:void 0;return D===void 0?Xl(a.default,r.default):x(a,r,D,T,A)}}}function Xl(a,r,l){return a!==void 0?a:r!==void 0?r:l!==void 0?l:void 0}function Ef(a,r,l,h,p){return Xl(typeof l===p?h[l]:void 0,a.default,r.default)}function im(a,r,l){if(_i(l)!=="number")return Xl(a.default,r.default);const h=a.stops.length;if(h===1||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[h-1][0])return a.stops[h-1][1];const p=ia(a.stops.map(_=>_[0]),l);return a.stops[p][1]}function bu(a,r,l){const h=a.base!==void 0?a.base:1;if(_i(l)!=="number")return Xl(a.default,r.default);const p=a.stops.length;if(p===1||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[p-1][0])return a.stops[p-1][1];const _=ia(a.stops.map(P=>P[0]),l),x=function(P,D,O,N){const z=N-O,$=P-O;return z===0?0:D===1?$/z:(Math.pow(D,$)-1)/(Math.pow(D,z)-1)}(l,h,a.stops[_][0],a.stops[_+1][0]),T=a.stops[_][1],A=a.stops[_+1][1];let I=Ul[r.type]||Yy;if(a.colorSpace&&a.colorSpace!=="rgb"){const P=Wp[a.colorSpace];I=(D,O)=>P.reverse(P.interpolate(P.forward(D),P.forward(O),x))}return typeof T.evaluate=="function"?{evaluate(...P){const D=T.evaluate.apply(void 0,P),O=A.evaluate.apply(void 0,P);if(D!==void 0&&O!==void 0)return I(D,O,x)}}:I(T,A,x)}function nm(a,r,l){return r.type==="color"?l=mn.parse(l):r.type==="formatted"?l=vr.fromString(l.toString()):r.type==="resolvedImage"?l=fr.fromString(l.toString()):_i(l)===r.type||r.type==="enum"&&r.values[l]||(l=void 0),Xl(l,a.default,r.default)}class wu{constructor(r,l){this.expression=r,this._warningHistory={},this._evaluator=new Ll,this._defaultValue=l?function(h){return h.type==="color"&&(vu(h.default)||Array.isArray(h.default))?new mn(0,0,0,0):h.type==="color"?mn.parse(h.default)||null:h.default===void 0?null:h.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(r,l,h,p,_,x,T,A){return this._evaluator.globals=r,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=p||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=A||null,this.expression.evaluate(this._evaluator)}evaluate(r,l,h,p,_,x,T,A){this._evaluator.globals=r,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=A||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new Gn(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function ja(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in za}function $a(a,r){const l=new of(za,[],r?function(p){const _={color:vs,string:mi,number:bt,enum:mi,boolean:ui,formatted:Pa,resolvedImage:ka};return p.type==="array"?hr(_[p.value]||li,p.length):_[p.type]}(r):void 0),h=l.parse(a,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Hl(new wu(h,r)):Ua(l.errors)}class Tu{constructor(r,l){this.kind=r,this._styleExpression=l,this.isStateDependent=r!=="constant"&&!zl(l.expression)}evaluateWithoutErrorHandling(r,l,h,p,_,x){return this._styleExpression.evaluateWithoutErrorHandling(r,l,h,p,_,x)}evaluate(r,l,h,p,_,x){return this._styleExpression.evaluate(r,l,h,p,_,x)}}class ra{constructor(r,l,h,p){this.kind=r,this.zoomStops=h,this._styleExpression=l,this.isStateDependent=r!=="camera"&&!zl(l.expression),this.interpolationType=p}evaluateWithoutErrorHandling(r,l,h,p,_,x){return this._styleExpression.evaluateWithoutErrorHandling(r,l,h,p,_,x)}evaluate(r,l,h,p,_,x){return this._styleExpression.evaluate(r,l,h,p,_,x)}interpolationFactor(r,l,h){return this.interpolationType?bs.interpolationFactor(this.interpolationType,r,l,h):0}}function sa(a,r){if((a=$a(a,r)).result==="error")return a;const l=a.value.expression,h=Nl(l);if(!h&&!Va(r))return Ua([new xs("","data expressions not supported")]);const p=uu(l,["zoom","pitch","distance-from-center"]);if(!p&&!Ns(r))return Ua([new xs("","zoom expressions not supported")]);const _=Gl(l);return _||p?_ instanceof xs?Ua([_]):_ instanceof bs&&!xu(r)?Ua([new xs("",'"interpolate" expressions cannot be used with this property')]):Hl(_?new ra(h?"camera":"composite",a.value,_.labels,_ instanceof bs?_.interpolation:void 0):new Tu(h?"constant":"source",a.value)):Ua([new xs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ql{constructor(r,l){this._parameters=r,this._specification=l,Bs(this,Tf(this._parameters,this._specification))}static deserialize(r){return new ql(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Gl(a){let r=null;if(a instanceof pf)r=Gl(a.result);else if(a instanceof Hp){for(const l of a.args)if(r=Gl(l),r)break}else(a instanceof af||a instanceof bs)&&a.input instanceof co&&a.input.name==="zoom"&&(r=a);return r instanceof xs||a.eachChild(l=>{const h=Gl(l);h instanceof xs?r=h:!r&&h?r=new xs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&h&&r!==h&&(r=new xs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}class Mt{constructor(r,l,h,p){this.message=(r?`${r}: `:"")+h,p&&(this.identifier=p),l!=null&&l.__line__&&(this.line=l.__line__)}}function Xr(a){const r=a.key,l=a.value,h=a.valueSpec||{},p=a.objectElementValidators||{},_=a.style,x=a.styleSpec;let T=[];const A=_i(l);if(A!=="object")return[new Mt(r,l,`object expected, ${A} found`)];for(const I in l){const P=I.split(".")[0],D=h[P]||h["*"];let O;p[P]?O=p[P]:h[P]?O=nr:p["*"]?O=p["*"]:h["*"]&&(O=nr),O?T=T.concat(O({key:(r&&`${r}.`)+I,value:l[I],valueSpec:D,style:_,styleSpec:x,object:l,objectKey:I},l)):T.push(new Mt(r,l[I],`unknown property "${I}"`))}for(const I in h)p[I]||h[I].required&&h[I].default===void 0&&l[I]===void 0&&T.push(new Mt(r,l,`missing required property "${I}"`));return T}function rm(a){const r=a.value,l=a.valueSpec,h=a.style,p=a.styleSpec,_=a.key,x=a.arrayElementValidator||nr;if(_i(r)!=="array")return[new Mt(_,r,`array expected, ${_i(r)} found`)];if(l.length&&r.length!==l.length)return[new Mt(_,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new Mt(_,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let T={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};p.$version<7&&(T.function=l.function),_i(l.value)==="object"&&(T=l.value);let A=[];for(let I=0;I<r.length;I++)A=A.concat(x({array:r,arrayIndex:I,value:r[I],valueSpec:T,style:h,styleSpec:p,key:`${_}[${I}]`}));return A}function Af(a){const r=a.key,l=a.value,h=a.valueSpec;let p=_i(l);if(p==="number"&&l!=l&&(p="NaN"),p!=="number")return[new Mt(r,l,`number expected, ${p} found`)];if("minimum"in h){let _=h.minimum;if(_i(h.minimum)==="array"&&(_=h.minimum[a.arrayIndex]),l<_)return[new Mt(r,l,`${l} is less than the minimum value ${_}`)]}if("maximum"in h){let _=h.maximum;if(_i(h.maximum)==="array"&&(_=h.maximum[a.arrayIndex]),l>_)return[new Mt(r,l,`${l} is greater than the maximum value ${_}`)]}return[]}function Zl(a){const r=a.valueSpec,l=wn(a.value.type);let h,p,_,x={};const T=l!=="categorical"&&a.value.property===void 0,A=!T,I=_i(a.value.stops)==="array"&&_i(a.value.stops[0])==="array"&&_i(a.value.stops[0][0])==="object",P=Xr({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(N){if(l==="identity")return[new Mt(N.key,N.value,'identity function may not have a "stops" property')];let z=[];const $=N.value;return z=z.concat(rm({key:N.key,value:$,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:D})),_i($)==="array"&&$.length===0&&z.push(new Mt(N.key,$,"array must have at least one stop")),z},default:function(N){return nr({key:N.key,value:N.value,valueSpec:r,style:N.style,styleSpec:N.styleSpec})}}});return l==="identity"&&T&&P.push(new Mt(a.key,a.value,'missing required property "property"')),l==="identity"||a.value.stops||P.push(new Mt(a.key,a.value,'missing required property "stops"')),l==="exponential"&&a.valueSpec.expression&&!xu(a.valueSpec)&&P.push(new Mt(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(A&&!Va(a.valueSpec)?P.push(new Mt(a.key,a.value,"property functions not supported")):T&&!Ns(a.valueSpec)&&P.push(new Mt(a.key,a.value,"zoom functions not supported"))),l!=="categorical"&&!I||a.value.property!==void 0||P.push(new Mt(a.key,a.value,'"property" property is required')),P;function D(N){let z=[];const $=N.value,G=N.key;if(_i($)!=="array")return[new Mt(G,$,`array expected, ${_i($)} found`)];if($.length!==2)return[new Mt(G,$,`array length 2 expected, length ${$.length} found`)];if(I){if(_i($[0])!=="object")return[new Mt(G,$,`object expected, ${_i($[0])} found`)];if($[0].zoom===void 0)return[new Mt(G,$,"object stop key must have zoom")];if($[0].value===void 0)return[new Mt(G,$,"object stop key must have value")];const se=wn($[0].zoom);if(typeof se!="number")return[new Mt(G,$[0].zoom,"stop zoom values must be numbers")];if(_&&_>se)return[new Mt(G,$[0].zoom,"stop zoom values must appear in ascending order")];se!==_&&(_=se,p=void 0,x={}),z=z.concat(Xr({key:`${G}[0]`,value:$[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:Af,value:O}}))}else z=z.concat(O({key:`${G}[0]`,value:$[0],style:N.style,styleSpec:N.styleSpec},$));return ja(lo($[1]))?z.concat([new Mt(`${G}[1]`,$[1],"expressions are not allowed in function stops.")]):z.concat(nr({key:`${G}[1]`,value:$[1],valueSpec:r,style:N.style,styleSpec:N.styleSpec}))}function O(N,z){const $=_i(N.value),G=wn(N.value),se=N.value!==null?N.value:z;if(h){if($!==h)return[new Mt(N.key,se,`${$} stop domain type must match previous stop domain type ${h}`)]}else h=$;if($!=="number"&&$!=="string"&&$!=="boolean"&&typeof G!="number"&&typeof G!="string"&&typeof G!="boolean")return[new Mt(N.key,se,"stop domain value must be a number, string, or boolean")];if($!=="number"&&l!=="categorical"){let pe=`number expected, ${$} found`;return Va(r)&&l===void 0&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Mt(N.key,se,pe)]}return l!=="categorical"||$!=="number"||typeof G=="number"&&isFinite(G)&&Math.floor(G)===G?l!=="categorical"&&$==="number"&&typeof G=="number"&&typeof p=="number"&&p!==void 0&&G<p?[new Mt(N.key,se,"stop domain values must appear in ascending order")]:(p=G,l==="categorical"&&G in x?[new Mt(N.key,se,"stop domain values must be unique")]:(x[G]=!0,[])):[new Mt(N.key,se,`integer expected, found ${String(G)}`)]}}function Wa(a){const r=(a.expressionContext==="property"?sa:$a)(lo(a.value),a.valueSpec);if(r.result==="error")return r.value.map(h=>new Mt(`${a.key}${h.key}`,a.value,h.message));const l=r.value.expression||r.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!l.outputDefined())return[new Mt(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!zl(l))return[new Mt(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter")return sm(l,a);if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!uu(l,["zoom","feature-state"]))return[new Mt(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Nl(l))return[new Mt(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function sm(a,r){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const p of r.valueSpec.expression.parameters)l.delete(p);if(l.size===0)return[];const h=[];return a instanceof co&&l.has(a.name)?[new Mt(r.key,r.value,`["${a.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(a.eachChild(p=>{h.push(...sm(p,r))}),h)}function Eu(a){const r=a.key,l=a.value,h=a.valueSpec,p=[];return Array.isArray(h.values)?h.values.indexOf(wn(l))===-1&&p.push(new Mt(r,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(h.values).indexOf(wn(l))===-1&&p.push(new Mt(r,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),p}function Sf(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const r of a.slice(1))if(!Sf(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function Au(a,r="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Sf(a)||(a=Iu(a));const l=a;let h=!0;try{h=function(I){if(!Un(I))return I;let P=lo(I);return Kl(P),P=Yl(P),P}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(l,null,2)}
        `)}const p=Ze[`filter_${r}`],_=$a(h,p);let x=null;if(_.result==="error")throw new Error(_.value.map(I=>`${I.key}: ${I.message}`).join(", "));x=(I,P,D)=>_.value.evaluate(I,P,{},D);let T=null,A=null;if(h!==l){const I=$a(l,p);if(I.result==="error")throw new Error(I.value.map(P=>`${P.key}: ${P.message}`).join(", "));T=(P,D,O,N,z)=>I.value.evaluate(P,D,{},O,void 0,void 0,N,z),A=!Nl(I.value.expression)}return{filter:x,dynamicFilter:T||void 0,needGeometry:om(h),needFeature:!!A}}function Yl(a){if(!Array.isArray(a))return a;const r=function(l){if(Su.has(l[0])){for(let h=1;h<l.length;h++)if(Un(l[h]))return!0}return l}(a);return r===!0?r:r.map(l=>Yl(l))}function Kl(a){let r=!1;const l=[];if(a[0]==="case"){for(let h=1;h<a.length-1;h+=2)r=r||Un(a[h]),l.push(a[h+1]);l.push(a[a.length-1])}else if(a[0]==="match"){r=r||Un(a[1]);for(let h=2;h<a.length-1;h+=2)l.push(a[h+1]);l.push(a[a.length-1])}else if(a[0]==="step"){r=r||Un(a[1]);for(let h=1;h<a.length-1;h+=2)l.push(a[h+1])}r&&(a.length=0,a.push("any",...l));for(let h=1;h<a.length;h++)Kl(a[h])}function Un(a){if(!Array.isArray(a))return!1;if((r=a[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let l=1;l<a.length;l++)if(Un(a[l]))return!0;return!1}const Su=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ky(a,r){return a<r?-1:a>r?1:0}function om(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(let r=1;r<a.length;r++)if(om(a[r]))return!0;return!1}function Iu(a){if(!a)return!0;const r=a[0];return a.length<=1?r!=="any":r==="=="?If(a[1],a[2],"=="):r==="!="?Ha(If(a[1],a[2],"==")):r==="<"||r===">"||r==="<="||r===">="?If(a[1],a[2],r):r==="any"?(l=a.slice(1),["any"].concat(l.map(Iu))):r==="all"?["all"].concat(a.slice(1).map(Iu)):r==="none"?["all"].concat(a.slice(1).map(Iu).map(Ha)):r==="in"?Cu(a[1],a.slice(2)):r==="!in"?Ha(Cu(a[1],a.slice(2))):r==="has"?am(a[1]):r==="!has"?Ha(am(a[1])):r!=="within"||a;var l}function If(a,r,l){switch(a){case"$type":return[`filter-type-${l}`,r];case"$id":return[`filter-id-${l}`,r];default:return[`filter-${l}`,a,r]}}function Cu(a,r){if(r.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(l=>typeof l!=typeof r[0])?["filter-in-large",a,["literal",r.sort(Ky)]]:["filter-in-small",a,["literal",r]]}}function am(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Ha(a){return["!",a]}function Cf(a){return Sf(lo(a.value))?Wa(Bs({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):lm(a)}function lm(a){const r=a.value,l=a.key;if(_i(r)!=="array")return[new Mt(l,r,`array expected, ${_i(r)} found`)];const h=a.styleSpec;let p,_=[];if(r.length<1)return[new Mt(l,r,"filter array must have at least 1 element")];switch(_=_.concat(Eu({key:`${l}[0]`,value:r[0],valueSpec:h.filter_operator,style:a.style,styleSpec:a.styleSpec})),wn(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&wn(r[1])==="$type"&&_.push(new Mt(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&_.push(new Mt(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(p=_i(r[1]),p!=="string"&&_.push(new Mt(`${l}[1]`,r[1],`string expected, ${p} found`)));for(let x=2;x<r.length;x++)p=_i(r[x]),wn(r[1])==="$type"?_=_.concat(Eu({key:`${l}[${x}]`,value:r[x],valueSpec:h.geometry_type,style:a.style,styleSpec:a.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&_.push(new Mt(`${l}[${x}]`,r[x],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let x=1;x<r.length;x++)_=_.concat(lm({key:`${l}[${x}]`,value:r[x],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":p=_i(r[1]),r.length!==2?_.push(new Mt(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):p!=="string"&&_.push(new Mt(`${l}[1]`,r[1],`string expected, ${p} found`));break;case"within":p=_i(r[1]),r.length!==2?_.push(new Mt(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):p!=="object"&&_.push(new Mt(`${l}[1]`,r[1],`object expected, ${p} found`))}return _}function Mu(a,r){const l=a.key,h=a.style,p=a.styleSpec,_=a.value,x=a.objectKey,T=p[`${r}_${a.layerType}`];if(!T)return[];const A=x.match(/^(.*)-transition$/);if(r==="paint"&&A&&T[A[1]]&&T[A[1]].transition)return nr({key:l,value:_,valueSpec:p.transition,style:h,styleSpec:p});const I=a.valueSpec||T[x];if(!I)return[new Mt(l,_,`unknown property "${x}"`)];let P;if(_i(_)==="string"&&Va(I)&&!I.tokens&&(P=/^{([^}]+)}$/.exec(_))){const O=`\`{ "type": "identity", "property": ${P?JSON.stringify(P[1]):'"_"'} }\``;return[new Mt(l,_,`"${x}" does not support interpolation syntax
Use an identity property function instead: ${O}.`)]}const D=[];return a.layerType==="symbol"&&(x==="text-field"&&h&&!h.glyphs&&D.push(new Mt(l,_,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&vu(lo(_))&&wn(_.type)==="identity"&&D.push(new Mt(l,_,'"text-font" does not support identity functions'))),D.concat(nr({key:a.key,value:_,valueSpec:I,style:h,styleSpec:p,expressionContext:"property",propertyType:r,propertyKey:x}))}function cm(a){return Mu(a,"paint")}function Mf(a){return Mu(a,"layout")}function Rf(a){let r=[];const l=a.value,h=a.key,p=a.style,_=a.styleSpec;l.type||l.ref||r.push(new Mt(h,l,'either "type" or "ref" is required'));let x=wn(l.type);const T=wn(l.ref);if(l.id){const A=wn(l.id);for(let I=0;I<a.arrayIndex;I++){const P=p.layers[I];wn(P.id)===A&&r.push(new Mt(h,l.id,`duplicate layer id "${l.id}", previously used at line ${P.id.__line__}`))}}if("ref"in l){let A;["type","source","source-layer","filter","layout"].forEach(I=>{I in l&&r.push(new Mt(h,l[I],`"${I}" is prohibited for ref layers`))}),p.layers.forEach(I=>{wn(I.id)===T&&(A=I)}),A?A.ref?r.push(new Mt(h,l.ref,"ref cannot reference another ref layer")):x=wn(A.type):typeof T=="string"&&r.push(new Mt(h,l.ref,`ref layer "${T}" not found`))}else if(x!=="background"&&x!=="sky")if(l.source){const A=p.sources&&p.sources[l.source],I=A&&wn(A.type);A?I==="vector"&&x==="raster"?r.push(new Mt(h,l.source,`layer "${l.id}" requires a raster source`)):I==="raster"&&x!=="raster"?r.push(new Mt(h,l.source,`layer "${l.id}" requires a vector source`)):I!=="vector"||l["source-layer"]?I==="raster-dem"&&x!=="hillshade"?r.push(new Mt(h,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||I==="geojson"&&A.lineMetrics||r.push(new Mt(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Mt(h,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new Mt(h,l.source,`source "${l.source}" not found`))}else r.push(new Mt(h,l,'missing required property "source"'));return r=r.concat(Xr({key:h,value:l,valueSpec:_.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>nr({key:`${h}.type`,value:l.type,valueSpec:_.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:A=>Cf(Bs({layerType:x},A)),layout:A=>Xr({layer:l,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":I=>Mf(Bs({layerType:x},I))}}),paint:A=>Xr({layer:l,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":I=>cm(Bs({layerType:x},I))}})}})),r}function Xa(a){const r=a.value,l=a.key,h=_i(r);return h!=="string"?[new Mt(l,r,`string expected, ${h} found`)]:[]}const Ru={promoteId:function({key:a,value:r}){if(_i(r)==="string")return Xa({key:a,value:r});{const l=[];for(const h in r)l.push(...Xa({key:`${a}.${h}`,value:r[h]}));return l}}};function Jl(a){const r=a.value,l=a.key,h=a.styleSpec,p=a.style;if(!r.type)return[new Mt(l,r,'"type" is required')];const _=wn(r.type);let x;switch(_){case"vector":case"raster":case"raster-dem":return x=Xr({key:l,value:r,valueSpec:h[`source_${_.replace("-","_")}`],style:a.style,styleSpec:h,objectElementValidators:Ru}),x;case"geojson":if(x=Xr({key:l,value:r,valueSpec:h.source_geojson,style:p,styleSpec:h,objectElementValidators:Ru}),r.cluster)for(const T in r.clusterProperties){const[A,I]=r.clusterProperties[T],P=typeof A=="string"?[A,["accumulated"],["get",T]]:A;x.push(...Wa({key:`${l}.${T}.map`,value:I,expressionContext:"cluster-map"})),x.push(...Wa({key:`${l}.${T}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return x;case"video":return Xr({key:l,value:r,valueSpec:h.source_video,style:p,styleSpec:h});case"image":return Xr({key:l,value:r,valueSpec:h.source_image,style:p,styleSpec:h});case"canvas":return[new Mt(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Eu({key:`${l}.type`,value:r.type,valueSpec:{values:um(h)}})}}function um(a){return a.source.reduce((r,l)=>{const h=a[l];return h.type.type==="enum"&&(r=r.concat(Object.keys(h.type.values))),r},[])}function hm(a){const r=a.value,l=a.styleSpec,h=l.light,p=a.style;let _=[];const x=_i(r);if(r===void 0)return _;if(x!=="object")return _=_.concat([new Mt("light",r,`object expected, ${x} found`)]),_;for(const T in r){const A=T.match(/^(.*)-transition$/);_=_.concat(A&&h[A[1]]&&h[A[1]].transition?nr({key:T,value:r[T],valueSpec:l.transition,style:p,styleSpec:l}):h[T]?nr({key:T,value:r[T],valueSpec:h[T],style:p,styleSpec:l}):[new Mt(T,r[T],`unknown property "${T}"`)])}return _}function Pf(a){const r=a.value,l=a.key,h=a.style,p=a.styleSpec,_=p.terrain;let x=[];const T=_i(r);if(r===void 0)return x;if(T!=="object")return x=x.concat([new Mt("terrain",r,`object expected, ${T} found`)]),x;for(const A in r){const I=A.match(/^(.*)-transition$/);x=x.concat(I&&_[I[1]]&&_[I[1]].transition?nr({key:A,value:r[A],valueSpec:p.transition,style:h,styleSpec:p}):_[A]?nr({key:A,value:r[A],valueSpec:_[A],style:h,styleSpec:p}):[new Mt(A,r[A],`unknown property "${A}"`)])}if(r.source){const A=h.sources&&h.sources[r.source],I=A&&wn(A.type);A?I!=="raster-dem"&&x.push(new Mt(l,r.source,`terrain cannot be used with a source of type ${String(I)}, it only be used with a "raster-dem" source type`)):x.push(new Mt(l,r.source,`source "${r.source}" not found`))}else x.push(new Mt(l,r,'terrain is missing required property "source"'));return x}function fm(a){const r=a.value,l=a.style,h=a.styleSpec,p=h.fog;let _=[];const x=_i(r);if(r===void 0)return _;if(x!=="object")return _=_.concat([new Mt("fog",r,`object expected, ${x} found`)]),_;for(const T in r){const A=T.match(/^(.*)-transition$/);_=_.concat(A&&p[A[1]]&&p[A[1]].transition?nr({key:T,value:r[T],valueSpec:h.transition,style:l,styleSpec:h}):p[T]?nr({key:T,value:r[T],valueSpec:p[T],style:l,styleSpec:h}):[new Mt(T,r[T],`unknown property "${T}"`)])}return _}const Pu={"*":()=>[],array:rm,boolean:function(a){const r=a.value,l=a.key,h=_i(r);return h!=="boolean"?[new Mt(l,r,`boolean expected, ${h} found`)]:[]},number:Af,color:function(a){const r=a.key,l=a.value,h=_i(l);return h!=="string"?[new Mt(r,l,`color expected, ${h} found`)]:Yh(l)===null?[new Mt(r,l,`color expected, "${l}" found`)]:[]},enum:Eu,filter:Cf,function:Zl,layer:Rf,object:Xr,source:Jl,light:hm,terrain:Pf,fog:fm,string:Xa,formatted:function(a){return Xa(a).length===0?[]:Wa(a)},resolvedImage:function(a){return Xa(a).length===0?[]:Wa(a)},projection:function(a){const r=a.value,l=a.styleSpec,h=l.projection,p=a.style;let _=[];const x=_i(r);if(x==="object")for(const T in r)_=_.concat(nr({key:T,value:r[T],valueSpec:h[T],style:p,styleSpec:l}));else x!=="string"&&(_=_.concat([new Mt("projection",r,`object or string expected, ${x} found`)]));return _}};function nr(a){const r=a.value,l=a.valueSpec,h=a.styleSpec;return l.expression&&vu(wn(r))?Zl(a):l.expression&&ja(lo(r))?Wa(a):l.type&&Pu[l.type]?Pu[l.type](a):Xr(Bs({},a,{valueSpec:l.type?h[l.type]:l}))}function Jy(a){const r=a.value,l=a.key,h=Xa(a);return h.length||(r.indexOf("{fontstack}")===-1&&h.push(new Mt(l,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&h.push(new Mt(l,r,'"glyphs" url must include a "{range}" token'))),h}function dm(a,r=Ze){return zs(nr({key:"",value:a,valueSpec:r.$root,styleSpec:r,style:a,objectElementValidators:{glyphs:Jy,"*":()=>[]}}))}const Qy=a=>zs(cm(a)),pm=a=>zs(Mf(a));function zs(a){return a.slice().sort((r,l)=>r.line&&l.line?r.line-l.line:0)}function mm(a,r){let l=!1;if(r&&r.length)for(const h of r)a.fire(new ao(new Error(h.message))),l=!0;return l}var qa=ws;function ws(a,r,l){var h=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var p=new Int32Array(this.arrayBuffer);a=p[0],this.d=(r=p[1])+2*(l=p[2]);for(var _=0;_<this.d*this.d;_++){var x=p[3+_],T=p[3+_+1];h.push(x===T?null:p.subarray(x,T))}var A=p[3+h.length+1];this.keys=p.subarray(p[3+h.length],A),this.bboxes=p.subarray(A),this.insert=this._insertReadonly}else{this.d=r+2*l;for(var I=0;I<this.d*this.d;I++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=a,this.padding=l,this.scale=r/a,this.uid=0;var P=l/r*a;this.min=-P,this.max=a+P}ws.prototype.insert=function(a,r,l,h,p){this._forEachCell(r,l,h,p,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(p)},ws.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ws.prototype._insertCell=function(a,r,l,h,p,_){this.cells[p].push(_)},ws.prototype.query=function(a,r,l,h,p){var _=this.min,x=this.max;if(a<=_&&r<=_&&x<=l&&x<=h&&!p)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(a,r,l,h,this._queryCell,T,{},p),T},ws.prototype._queryCell=function(a,r,l,h,p,_,x,T){var A=this.cells[p];if(A!==null)for(var I=this.keys,P=this.bboxes,D=0;D<A.length;D++){var O=A[D];if(x[O]===void 0){var N=4*O;(T?T(P[N+0],P[N+1],P[N+2],P[N+3]):a<=P[N+2]&&r<=P[N+3]&&l>=P[N+0]&&h>=P[N+1])?(x[O]=!0,_.push(I[O])):x[O]=!1}}},ws.prototype._forEachCell=function(a,r,l,h,p,_,x,T){for(var A=this._convertToCellCoord(a),I=this._convertToCellCoord(r),P=this._convertToCellCoord(l),D=this._convertToCellCoord(h),O=A;O<=P;O++)for(var N=I;N<=D;N++){var z=this.d*N+O;if((!T||T(this._convertFromCellCoord(O),this._convertFromCellCoord(N),this._convertFromCellCoord(O+1),this._convertFromCellCoord(N+1)))&&p.call(this,a,r,l,h,z,_,x,T))return}},ws.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},ws.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},ws.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,r=3+this.cells.length+1+1,l=0,h=0;h<this.cells.length;h++)l+=this.cells[h].length;var p=new Int32Array(r+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var _=r,x=0;x<a.length;x++){var T=a[x];p[3+x]=_,p.set(T,_),_+=T.length}return p[3+a.length]=_,p.set(this.keys,_),p[3+a.length+1]=_+=this.keys.length,p.set(this.bboxes,_),_+=this.bboxes.length,p.buffer};const ku={};function Dt(a,r,l={}){Object.defineProperty(a,"_classRegistryKey",{value:r,writeable:!1}),ku[r]={klass:a,omit:l.omit||[]}}Dt(Object,"Object"),qa.serialize=function(a,r){const l=a.toArrayBuffer();return r&&r.push(l),{buffer:l}},qa.deserialize=function(a){return new qa(a.buffer)},Object.defineProperty(qa,"name",{value:"Grid"}),Dt(qa,"Grid"),Dt(mn,"Color"),Dt(Error,"Error"),Dt(cn,"AJAXError"),Dt(fr,"ResolvedImage"),Dt(ql,"StylePropertyFunction"),Dt(wu,"StyleExpression",{omit:["_evaluator"]}),Dt(ra,"ZoomDependentExpression"),Dt(Tu,"ZoomConstantExpression"),Dt(co,"CompoundExpression",{omit:["_evaluate"]});for(const a in za)ku[za[a]._classRegistryKey]||Dt(za[a],`Expression${a}`);function gm(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Ql(a){return v.ImageBitmap&&a instanceof v.ImageBitmap}function ec(a,r){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(gm(a)||Ql(a))return r&&r.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return r&&r.push(l.buffer),l}if(a instanceof v.ImageData)return r&&r.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const h of a)l.push(ec(h,r));return l}if(typeof a=="object"){const l=a.constructor,h=l._classRegistryKey;if(!h)throw new Error(`can't serialize object of unregistered class ${h}`);const p=l.serialize?l.serialize(a,r):{};if(!l.serialize){for(const _ in a)a.hasOwnProperty(_)&&(ku[h].omit.indexOf(_)>=0||(p[_]=ec(a[_],r)));a instanceof Error&&(p.message=a.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(p.$name=h),p}throw new Error("can't serialize object of type "+typeof a)}function tc(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||gm(a)||Ql(a)||ArrayBuffer.isView(a)||a instanceof v.ImageData)return a;if(Array.isArray(a))return a.map(tc);if(typeof a=="object"){const r=a.$name||"Object",{klass:l}=ku[r];if(!l)throw new Error(`can't deserialize unregistered class ${r}`);if(l.deserialize)return l.deserialize(a);const h=Object.create(l.prototype);for(const p of Object.keys(a))p!=="$name"&&(h[p]=tc(a[p]));return h}throw new Error("can't deserialize object of type "+typeof a)}const ic=a=>a>=1536&&a<=1791,_m=a=>a>=1872&&a<=1919,kf=a=>a>=2208&&a<=2303,ym=a=>a>=11904&&a<=12031,Df=a=>a>=12032&&a<=12255,Of=a=>a>=12272&&a<=12287,nc=a=>a>=12288&&a<=12351,Du=a=>a>=12352&&a<=12447,Ga=a=>a>=12448&&a<=12543,Ou=a=>a>=12544&&a<=12591,xm=a=>a>=12704&&a<=12735,vm=a=>a>=12736&&a<=12783,Lf=a=>a>=12784&&a<=12799,bm=a=>a>=12800&&a<=13055,wm=a=>a>=13056&&a<=13311,Tm=a=>a>=13312&&a<=19903,Bf=a=>a>=19968&&a<=40959,Em=a=>a>=40960&&a<=42127,Am=a=>a>=42128&&a<=42191,Sm=a=>a>=44032&&a<=55215,Im=a=>a>=63744&&a<=64255,Lu=a=>a>=64336&&a<=65023,rc=a=>a>=65040&&a<=65055,g=a=>a>=65072&&a<=65103,c=a=>a>=65104&&a<=65135,d=a=>a>=65136&&a<=65279,y=a=>a>=65280&&a<=65519;function b(a){for(const r of a)if(M(r.charCodeAt(0)))return!0;return!1}function E(a){for(const r of a)if(!C(r.charCodeAt(0)))return!1;return!0}function C(a){return!(ic(a)||_m(a)||kf(a)||Lu(a)||d(a))}function M(a){return!(a!==746&&a!==747&&(a<4352||!(xm(a)||Ou(a)||g(a)&&!(a>=65097&&a<=65103)||Im(a)||wm(a)||ym(a)||vm(a)||!(!nc(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Tm(a)||Bf(a)||bm(a)||(r=>r>=12592&&r<=12687)(a)||(r=>r>=43360&&r<=43391)(a)||(r=>r>=55216&&r<=55295)(a)||(r=>r>=4352&&r<=4607)(a)||Sm(a)||Du(a)||Of(a)||(r=>r>=12688&&r<=12703)(a)||Df(a)||Lf(a)||Ga(a)&&a!==12540||!(!y(a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!c(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(r=>r>=5120&&r<=5759)(a)||(r=>r>=6320&&r<=6399)(a)||rc(a)||(r=>r>=19904&&r<=19967)(a)||Em(a)||Am(a))))}function k(a){return!(M(a)||function(r){return!!((l=>l>=128&&l<=255)(r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||(l=>l>=8192&&l<=8303)(r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||(l=>l>=8448&&l<=8527)(r)||(l=>l>=8528&&l<=8591)(r)||(l=>l>=8960&&l<=9215)(r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||(l=>l>=9216&&l<=9279)(r)&&r!==9251||(l=>l>=9280&&l<=9311)(r)||(l=>l>=9312&&l<=9471)(r)||(l=>l>=9632&&l<=9727)(r)||(l=>l>=9728&&l<=9983)(r)&&!(r>=9754&&r<=9759)||(l=>l>=11008&&l<=11263)(r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||nc(r)||Ga(r)||(l=>l>=57344&&l<=63743)(r)||g(r)||c(r)||y(r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(a))}function F(a){return a>=1424&&a<=2303||Lu(a)||d(a)}function B(a,r){return!(!r&&F(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(l=>l>=6016&&l<=6143)(a))}function U(a){for(const r of a)if(F(r.charCodeAt(0)))return!0;return!1}const X="deferred",Y="loading",K="loaded";let J=null,Q="unavailable",H=null;const le=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Q="error"),J&&J(a)};function ae(){ce.fire(new Ni("pluginStateChange",{pluginStatus:Q,pluginURL:H}))}const ce=new Ls,ve=function(){return Q},_e=function(){if(Q!==X||!H)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Q=Y,ae(),H&&bn({url:H},a=>{a?le(a):(Q=K,ae())})},Ee={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Q===K||Ee.applyArabicShaping!=null,isLoading:()=>Q===Y,setState(a){Q=a.pluginStatus,H=a.pluginURL},isParsed:()=>Ee.applyArabicShaping!=null&&Ee.processBidirectionalText!=null&&Ee.processStyledBidirectionalText!=null,getPluginURL:()=>H};class Re{constructor(r,l){this.zoom=r,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(r){return function(l,h){for(const p of l)if(!B(p.charCodeAt(0),h))return!1;return!0}(r,Ee.isLoaded())}}class ze{constructor(r,l){this.property=r,this.value=l,this.expression=function(h,p){if(vu(h))return new ql(h,p);if(ja(h)){const _=sa(h,p);if(_.result==="error")throw new Error(_.value.map(x=>`${x.key}: ${x.message}`).join(", "));return _.value}{let _=h;return typeof h=="string"&&p.type==="color"&&(_=mn.parse(h)),{kind:"constant",evaluate:()=>_}}}(l===void 0?r.specification.default:l,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,l,h){return this.property.possiblyEvaluate(this,r,l,h)}}class je{constructor(r){this.property=r,this.value=new ze(r,void 0)}transitioned(r,l){return new Le(this.property,this.value,l,yi({},r.transition,this.transition),r.now)}untransitioned(){return new Le(this.property,this.value,null,{},0)}}class gt{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return _r(this._values[r].value.value)}setValue(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new je(this._values[r].property)),this._values[r].value=new ze(this._values[r].property,l===null?void 0:_r(l))}getTransition(r){return _r(this._values[r].transition)}setTransition(r,l){this._values.hasOwnProperty(r)||(this._values[r]=new je(this._values[r].property)),this._values[r].transition=_r(l)||void 0}serialize(){const r={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(r[l]=h);const p=this.getTransition(l);p!==void 0&&(r[`${l}-transition`]=p)}return r}transitioned(r,l){const h=new Qe(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].transitioned(r,l._values[p]);return h}untransitioned(){const r=new Qe(this._properties);for(const l of Object.keys(this._values))r._values[l]=this._values[l].untransitioned();return r}}class Le{constructor(r,l,h,p,_){const x=p.delay||0,T=p.duration||0;_=_||0,this.property=r,this.value=l,this.begin=_+x,this.end=this.begin+T,r.specification.transition&&(p.delay||p.duration)&&(this.prior=h)}possiblyEvaluate(r,l,h){const p=r.now||0,_=this.value.possiblyEvaluate(r,l,h),x=this.prior;if(x){if(p>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(p<this.begin)return x.possiblyEvaluate(r,l,h);{const T=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(r,l,h),_,Vt(T))}}return _}}class Qe{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,l,h){const p=new Ue(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(r,l,h);return p}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class qe{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return _r(this._values[r].value)}setValue(r,l){this._values[r]=new ze(this._values[r].property,l===null?void 0:_r(l))}serialize(){const r={};for(const l of Object.keys(this._values)){const h=this.getValue(l);h!==void 0&&(r[l]=h)}return r}possiblyEvaluate(r,l,h){const p=new Ue(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(r,l,h);return p}}class st{constructor(r,l,h){this.property=r,this.value=l,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,l,h,p){return this.property.evaluate(this.value,this.parameters,r,l,h,p)}}class Ue{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Ce{constructor(r){this.specification=r}possiblyEvaluate(r,l){return r.expression.evaluate(l)}interpolate(r,l,h){const p=Ul[this.specification.type];return p?p(r,l,h):r}}class $e{constructor(r,l){this.specification=r,this.overrides=l}possiblyEvaluate(r,l,h,p){return new st(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(l,null,{},h,p)}:r.expression,l)}interpolate(r,l,h){if(r.value.kind!=="constant"||l.value.kind!=="constant")return r;if(r.value.value===void 0||l.value.value===void 0)return new st(this,{kind:"constant",value:void 0},r.parameters);const p=Ul[this.specification.type];return p?new st(this,{kind:"constant",value:p(r.value.value,l.value.value,h)},r.parameters):r}evaluate(r,l,h,p,_,x){return r.kind==="constant"?r.value:r.evaluate(l,h,p,_,x)}}class it{constructor(r){this.specification=r}possiblyEvaluate(r,l,h,p){return!!r.expression.evaluate(l,null,{},h,p)}interpolate(){return!1}}class ct{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new Re(0,{});for(const h in r){const p=r[h];p.specification.overridable&&this.overridableProperties.push(h);const _=this.defaultPropertyValues[h]=new ze(p,void 0),x=this.defaultTransitionablePropertyValues[h]=new je(p);this.defaultTransitioningPropertyValues[h]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=_.possiblyEvaluate(l)}}}function Nt(a,r){return 256*(a=xt(Math.floor(a),0,255))+xt(Math.floor(r),0,255)}Dt($e,"DataDrivenProperty"),Dt(Ce,"DataConstantProperty"),Dt(it,"ColorRampProperty");const si={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Lt{constructor(r,l){this._structArray=r,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Rt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,l){return r._trim(),l&&(r.isTransferred=!0,l.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const l=Object.create(this.prototype);return l.arrayBuffer=r.arrayBuffer,l.length=r.length,l.capacity=r.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function zt(a,r=1){let l=0,h=0;return{members:a.map(p=>{const _=si[p.type].BYTES_PER_ELEMENT,x=l=hi(l,Math.max(r,_)),T=p.components||1;return h=Math.max(h,_),l+=_*T,{name:p.name,type:p.type,components:T,offset:x}}),size:hi(l,Math.max(h,r)),alignment:r}}function hi(a,r){return Math.ceil(a/r)*r}class Wt extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const p=2*r;return this.int16[p+0]=l,this.int16[p+1]=h,r}}Wt.prototype.bytesPerElement=4,Dt(Wt,"StructArrayLayout2i4");class Mi extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,h)}emplace(r,l,h,p){const _=3*r;return this.int16[_+0]=l,this.int16[_+1]=h,this.int16[_+2]=p,r}}Mi.prototype.bytesPerElement=6,Dt(Mi,"StructArrayLayout3i6");class Ri extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,h,p)}emplace(r,l,h,p,_){const x=4*r;return this.int16[x+0]=l,this.int16[x+1]=h,this.int16[x+2]=p,this.int16[x+3]=_,r}}Ri.prototype.bytesPerElement=8,Dt(Ri,"StructArrayLayout4i8");class Wi extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,_,x,T){const A=this.length;return this.resize(A+1),this.emplace(A,r,l,h,p,_,x,T)}emplace(r,l,h,p,_,x,T,A){const I=6*r,P=12*r,D=3*r;return this.int16[I+0]=l,this.int16[I+1]=h,this.uint8[P+4]=p,this.uint8[P+5]=_,this.uint8[P+6]=x,this.uint8[P+7]=T,this.float32[D+2]=A,r}}Wi.prototype.bytesPerElement=12,Dt(Wi,"StructArrayLayout2i4ub1f12");class Vi extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,h,p)}emplace(r,l,h,p,_){const x=4*r;return this.float32[x+0]=l,this.float32[x+1]=h,this.float32[x+2]=p,this.float32[x+3]=_,r}}Vi.prototype.bytesPerElement=16,Dt(Vi,"StructArrayLayout4f16");class Tn extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p,_)}emplace(r,l,h,p,_,x){const T=6*r,A=3*r;return this.uint16[T+0]=l,this.uint16[T+1]=h,this.uint16[T+2]=p,this.uint16[T+3]=_,this.float32[A+2]=x,r}}Tn.prototype.bytesPerElement=12,Dt(Tn,"StructArrayLayout4ui1f12");class br extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,h,p)}emplace(r,l,h,p,_){const x=4*r;return this.uint16[x+0]=l,this.uint16[x+1]=h,this.uint16[x+2]=p,this.uint16[x+3]=_,r}}br.prototype.bytesPerElement=8,Dt(br,"StructArrayLayout4ui8");class ss extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,r,l,h,p,_,x)}emplace(r,l,h,p,_,x,T){const A=6*r;return this.int16[A+0]=l,this.int16[A+1]=h,this.int16[A+2]=p,this.int16[A+3]=_,this.int16[A+4]=x,this.int16[A+5]=T,r}}ss.prototype.bytesPerElement=12,Dt(ss,"StructArrayLayout6i12");class Us extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,_,x,T,A,I,P,D,O){const N=this.length;return this.resize(N+1),this.emplace(N,r,l,h,p,_,x,T,A,I,P,D,O)}emplace(r,l,h,p,_,x,T,A,I,P,D,O,N){const z=12*r;return this.int16[z+0]=l,this.int16[z+1]=h,this.int16[z+2]=p,this.int16[z+3]=_,this.uint16[z+4]=x,this.uint16[z+5]=T,this.uint16[z+6]=A,this.uint16[z+7]=I,this.int16[z+8]=P,this.int16[z+9]=D,this.int16[z+10]=O,this.int16[z+11]=N,r}}Us.prototype.bytesPerElement=24,Dt(Us,"StructArrayLayout4i4ui4i24");class nn extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,r,l,h,p,_,x)}emplace(r,l,h,p,_,x,T){const A=10*r,I=5*r;return this.int16[A+0]=l,this.int16[A+1]=h,this.int16[A+2]=p,this.float32[I+2]=_,this.float32[I+3]=x,this.float32[I+4]=T,r}}nn.prototype.bytesPerElement=20,Dt(nn,"StructArrayLayout3i3f20");class ji extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint32[1*r+0]=l,r}}ji.prototype.bytesPerElement=4,Dt(ji,"StructArrayLayout1ul4");class Ai extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,_,x,T,A,I,P,D,O,N){const z=this.length;return this.resize(z+1),this.emplace(z,r,l,h,p,_,x,T,A,I,P,D,O,N)}emplace(r,l,h,p,_,x,T,A,I,P,D,O,N,z){const $=20*r,G=10*r;return this.int16[$+0]=l,this.int16[$+1]=h,this.int16[$+2]=p,this.int16[$+3]=_,this.int16[$+4]=x,this.float32[G+3]=T,this.float32[G+4]=A,this.float32[G+5]=I,this.float32[G+6]=P,this.int16[$+14]=D,this.uint32[G+8]=O,this.uint16[$+18]=N,this.uint16[$+19]=z,r}}Ai.prototype.bytesPerElement=40,Dt(Ai,"StructArrayLayout5i4f1i1ul2ui40");class fn extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,_,x,T){const A=this.length;return this.resize(A+1),this.emplace(A,r,l,h,p,_,x,T)}emplace(r,l,h,p,_,x,T,A){const I=8*r;return this.int16[I+0]=l,this.int16[I+1]=h,this.int16[I+2]=p,this.int16[I+4]=_,this.int16[I+5]=x,this.int16[I+6]=T,this.int16[I+7]=A,r}}fn.prototype.bytesPerElement=16,Dt(fn,"StructArrayLayout3i2i2i16");class rr extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,h,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p,_)}emplace(r,l,h,p,_,x){const T=4*r,A=8*r;return this.float32[T+0]=l,this.float32[T+1]=h,this.float32[T+2]=p,this.int16[A+6]=_,this.int16[A+7]=x,r}}rr.prototype.bytesPerElement=16,Dt(rr,"StructArrayLayout2f1f2i16");class Zi extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,h,p)}emplace(r,l,h,p,_){const x=12*r,T=3*r;return this.uint8[x+0]=l,this.uint8[x+1]=h,this.float32[T+1]=p,this.float32[T+2]=_,r}}Zi.prototype.bytesPerElement=12,Dt(Zi,"StructArrayLayout2ub2f12");class sr extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,h)}emplace(r,l,h,p){const _=3*r;return this.float32[_+0]=l,this.float32[_+1]=h,this.float32[_+2]=p,r}}sr.prototype.bytesPerElement=12,Dt(sr,"StructArrayLayout3f12");class or extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,r,l,h)}emplace(r,l,h,p){const _=3*r;return this.uint16[_+0]=l,this.uint16[_+1]=h,this.uint16[_+2]=p,r}}or.prototype.bytesPerElement=6,Dt(or,"StructArrayLayout3ui6");class po extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,_,x,T,A,I,P,D,O,N,z,$,G,se,pe,ee,de,ye){const ge=this.length;return this.resize(ge+1),this.emplace(ge,r,l,h,p,_,x,T,A,I,P,D,O,N,z,$,G,se,pe,ee,de,ye)}emplace(r,l,h,p,_,x,T,A,I,P,D,O,N,z,$,G,se,pe,ee,de,ye,ge){const Ve=30*r,Ne=15*r,Ye=60*r;return this.int16[Ve+0]=l,this.int16[Ve+1]=h,this.int16[Ve+2]=p,this.float32[Ne+2]=_,this.float32[Ne+3]=x,this.uint16[Ve+8]=T,this.uint16[Ve+9]=A,this.uint32[Ne+5]=I,this.uint32[Ne+6]=P,this.uint32[Ne+7]=D,this.uint16[Ve+16]=O,this.uint16[Ve+17]=N,this.uint16[Ve+18]=z,this.float32[Ne+10]=$,this.float32[Ne+11]=G,this.uint8[Ye+48]=se,this.uint8[Ye+49]=pe,this.uint8[Ye+50]=ee,this.uint32[Ne+13]=de,this.int16[Ve+28]=ye,this.uint8[Ye+58]=ge,r}}po.prototype.bytesPerElement=60,Dt(po,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Za extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,_,x,T,A,I,P,D,O,N,z,$,G,se,pe,ee,de,ye,ge,Ve,Ne,Ye,ft,He,Je,et,at){const dt=this.length;return this.resize(dt+1),this.emplace(dt,r,l,h,p,_,x,T,A,I,P,D,O,N,z,$,G,se,pe,ee,de,ye,ge,Ve,Ne,Ye,ft,He,Je,et,at)}emplace(r,l,h,p,_,x,T,A,I,P,D,O,N,z,$,G,se,pe,ee,de,ye,ge,Ve,Ne,Ye,ft,He,Je,et,at,dt){const Xe=38*r,wt=19*r;return this.int16[Xe+0]=l,this.int16[Xe+1]=h,this.int16[Xe+2]=p,this.float32[wt+2]=_,this.float32[wt+3]=x,this.int16[Xe+8]=T,this.int16[Xe+9]=A,this.int16[Xe+10]=I,this.int16[Xe+11]=P,this.int16[Xe+12]=D,this.int16[Xe+13]=O,this.uint16[Xe+14]=N,this.uint16[Xe+15]=z,this.uint16[Xe+16]=$,this.uint16[Xe+17]=G,this.uint16[Xe+18]=se,this.uint16[Xe+19]=pe,this.uint16[Xe+20]=ee,this.uint16[Xe+21]=de,this.uint16[Xe+22]=ye,this.uint16[Xe+23]=ge,this.uint16[Xe+24]=Ve,this.uint16[Xe+25]=Ne,this.uint16[Xe+26]=Ye,this.uint16[Xe+27]=ft,this.uint16[Xe+28]=He,this.uint32[wt+15]=Je,this.float32[wt+16]=et,this.float32[wt+17]=at,this.float32[wt+18]=dt,r}}Za.prototype.bytesPerElement=76,Dt(Za,"StructArrayLayout3i2f6i15ui1ul3f76");class Br extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.float32[1*r+0]=l,r}}Br.prototype.bytesPerElement=4,Dt(Br,"StructArrayLayout1f4");class qr extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,h,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,h,p,_)}emplace(r,l,h,p,_,x){const T=5*r;return this.float32[T+0]=l,this.float32[T+1]=h,this.float32[T+2]=p,this.float32[T+3]=_,this.float32[T+4]=x,r}}qr.prototype.bytesPerElement=20,Dt(qr,"StructArrayLayout5f20");class Vs extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,r,l,h,p)}emplace(r,l,h,p,_){const x=6*r;return this.uint32[3*r+0]=l,this.uint16[x+2]=h,this.uint16[x+3]=p,this.uint16[x+4]=_,r}}Vs.prototype.bytesPerElement=12,Dt(Vs,"StructArrayLayout1ul3ui12");class mo extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const p=2*r;return this.uint16[p+0]=l,this.uint16[p+1]=h,r}}mo.prototype.bytesPerElement=4,Dt(mo,"StructArrayLayout2ui4");class go extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint16[1*r+0]=l,r}}go.prototype.bytesPerElement=2,Dt(go,"StructArrayLayout1ui2");class Ya extends Rt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,l)}emplace(r,l,h){const p=2*r;return this.float32[p+0]=l,this.float32[p+1]=h,r}}Ya.prototype.bytesPerElement=8,Dt(Ya,"StructArrayLayout2f8");class sw extends Lt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}sw.prototype.size=40;class e0 extends Ai{get(r){return new sw(this,r)}}Dt(e0,"CollisionBoxArray");class ow extends Lt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}ow.prototype.size=60;class aw extends po{get(r){return new ow(this,r)}}Dt(aw,"PlacedSymbolArray");class lw extends Lt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}lw.prototype.size=76;class cw extends Za{get(r){return new lw(this,r)}}Dt(cw,"SymbolInstanceArray");class uw extends Br{getoffsetX(r){return this.float32[1*r+0]}}Dt(uw,"GlyphOffsetArray");class hw extends Wt{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}Dt(hw,"SymbolLineVertexArray");class fw extends Lt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}fw.prototype.size=12;class dw extends Vs{get(r){return new fw(this,r)}}Dt(dw,"FeatureIndexArray");class pw extends mo{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}Dt(pw,"FillExtrusionCentroidArray");const lk=zt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ck=zt([{name:"a_dash",components:4,type:"Uint16"}]);var sc={},uk={get exports(){return sc},set exports(a){sc=a}},t0={};({get exports(){return t0},set exports(a){t0=a}}).exports=function(a,r){var l,h,p,_,x,T,A,I;for(h=a.length-(l=3&a.length),p=r,x=3432918353,T=461845907,I=0;I<h;)A=255&a.charCodeAt(I)|(255&a.charCodeAt(++I))<<8|(255&a.charCodeAt(++I))<<16|(255&a.charCodeAt(++I))<<24,++I,p=27492+(65535&(_=5*(65535&(p=(p^=A=(65535&(A=(A=(65535&A)*x+(((A>>>16)*x&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(A=0,l){case 3:A^=(255&a.charCodeAt(I+2))<<16;case 2:A^=(255&a.charCodeAt(I+1))<<8;case 1:p^=A=(65535&(A=(A=(65535&(A^=255&a.charCodeAt(I)))*x+(((A>>>16)*x&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295}return p^=a.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var i0={};({get exports(){return i0},set exports(a){i0=a}}).exports=function(a,r){for(var l,h=a.length,p=r^h,_=0;h>=4;)l=1540483477*(65535&(l=255&a.charCodeAt(_)|(255&a.charCodeAt(++_))<<8|(255&a.charCodeAt(++_))<<16|(255&a.charCodeAt(++_))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:p^=(255&a.charCodeAt(_+2))<<16;case 2:p^=(255&a.charCodeAt(_+1))<<8;case 1:p=1540483477*(65535&(p^=255&a.charCodeAt(_)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var mw=t0,hk=i0;uk.exports=mw,sc.murmur3=mw,sc.murmur2=hk;class Cm{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,l,h,p){this.ids.push(gw(r)),this.positions.push(l,h,p)}getPositions(r){const l=gw(r);let h=0,p=this.ids.length-1;for(;h<p;){const x=h+p>>1;this.ids[x]>=l?p=x:h=x+1}const _=[];for(;this.ids[h]===l;)_.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return _}static serialize(r,l){const h=new Float64Array(r.ids),p=new Uint32Array(r.positions);return n0(h,p,0,h.length-1),l&&l.push(h.buffer,p.buffer),{ids:h,positions:p}}static deserialize(r){const l=new Cm;return l.ids=r.ids,l.positions=r.positions,l.indexed=!0,l}}function gw(a){const r=+a;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:sc(String(a))}function n0(a,r,l,h){for(;l<h;){const p=a[l+h>>1];let _=l-1,x=h+1;for(;;){do _++;while(a[_]<p);do x--;while(a[x]>p);if(_>=x)break;Mm(a,_,x),Mm(r,3*_,3*x),Mm(r,3*_+1,3*x+1),Mm(r,3*_+2,3*x+2)}x-l<h-x?(n0(a,r,l,x),l=x+1):(n0(a,r,x+1,h),h=x)}}function Mm(a,r,l){const h=a[r];a[r]=a[l],a[l]=h}Dt(Cm,"FeaturePositionMap");class oa{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,l),this.initialized=!0),!!this.location}}class Rm extends oa{constructor(r){super(r),this.current=0}set(r,l,h){this.fetchUniformLocation(r,l)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class _w extends oa{constructor(r){super(r),this.current=[0,0,0,0]}set(r,l,h){this.fetchUniformLocation(r,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class yw extends oa{constructor(r){super(r),this.current=mn.transparent}set(r,l,h){this.fetchUniformLocation(r,l)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const fk=new Float32Array(16),dk=new Float32Array(9),pk=new Float32Array(4);function r0(a){return[Nt(255*a.r,255*a.g),Nt(255*a.b,255*a.a)]}class Ff{constructor(r,l,h){this.value=r,this.uniformNames=l.map(p=>`u_${p}`),this.type=h}setUniform(r,l,h,p,_){l.set(r,_,p.constantOr(this.value))}getBinding(r,l){return this.type==="color"?new yw(r):new Rm(r)}}class Bu{constructor(r,l){this.uniformNames=l.map(h=>`u_${h}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,l,h,p,_){const x=_==="u_pattern"||_==="u_dash"?this.pattern:_==="u_pixel_ratio"?this.pixelRatio:null;x&&l.set(r,_,x)}getBinding(r,l){return l==="u_pattern"||l==="u_dash"?new _w(r):new Rm(r)}}class aa{constructor(r,l,h,p){this.expression=r,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(_=>({name:`a_${_}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(r,l,h,p,_,x){const T=this.paintVertexArray.length,A=this.expression.evaluate(new Re(0),l,{},_,p,x);this.paintVertexArray.resize(r),this._setPaintValue(T,r,A)}updatePaintArray(r,l,h,p,_){const x=this.expression.evaluate({zoom:0},h,p,void 0,_);this._setPaintValue(r,l,x)}_setPaintValue(r,l,h){if(this.type==="color"){const p=r0(h);for(let _=r;_<l;_++)this.paintVertexArray.emplace(_,p[0],p[1])}else{for(let p=r;p<l;p++)this.paintVertexArray.emplace(p,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class js{constructor(r,l,h,p,_,x){this.expression=r,this.uniformNames=l.map(T=>`u_${T}_t`),this.type=h,this.useIntegerZoom=p,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=l.map(T=>({name:`a_${T}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(r,l,h,p,_,x){const T=this.expression.evaluate(new Re(this.zoom),l,{},_,p,x),A=this.expression.evaluate(new Re(this.zoom+1),l,{},_,p,x),I=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(I,r,T,A)}updatePaintArray(r,l,h,p,_){const x=this.expression.evaluate({zoom:this.zoom},h,p,void 0,_),T=this.expression.evaluate({zoom:this.zoom+1},h,p,void 0,_);this._setPaintValue(r,l,x,T)}_setPaintValue(r,l,h,p){if(this.type==="color"){const _=r0(h),x=r0(p);for(let T=r;T<l;T++)this.paintVertexArray.emplace(T,_[0],_[1],x[0],x[1])}else{for(let _=r;_<l;_++)this.paintVertexArray.emplace(_,h,p);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,l,h,p,_){const x=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,T=xt(this.expression.interpolationFactor(x,this.zoom,this.zoom+1),0,1);l.set(r,_,T)}getBinding(r,l){return new Rm(r)}}class Ka{constructor(r,l,h,p,_){this.expression=r,this.layerId=_,this.paintVertexAttributes=(h==="array"?ck:lk).members;for(let x=0;x<l.length;++x);this.paintVertexArray=new p}populatePaintArray(r,l,h){const p=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(p,r,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(r,l,h,p,_,x){this._setPaintValues(r,l,h.patterns&&h.patterns[this.layerId],x)}_setPaintValues(r,l,h,p){if(!p||!h)return;const _=p[h];if(!_)return;const{tl:x,br:T,pixelRatio:A}=_;for(let I=r;I<l;I++)this.paintVertexArray.emplace(I,x[0],x[1],T[0],T[1],A)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ja{constructor(r,l,h=()=>!0){this.binders={},this._buffers=[];const p=[];for(const _ in r.paint._values){if(!h(_))continue;const x=r.paint.get(_);if(!(x instanceof st&&Va(x.property.specification)))continue;const T=gk(_,r.type),A=x.value,I=x.property.specification.type,P=!!x.property.useIntegerZoom,D=_==="line-dasharray"||_.endsWith("pattern"),O=_==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant";if(A.kind!=="constant"||O)if(A.kind==="source"||O||D){const N=xw(_,I,"source");this.binders[_]=D?new Ka(A,T,I,N,r.id):new aa(A,T,I,N),p.push(`/a_${_}`)}else{const N=xw(_,I,"composite");this.binders[_]=new js(A,T,I,P,l,N),p.push(`/z_${_}`)}else this.binders[_]=D?new Bu(A.value,T):new Ff(A.value,T,I),p.push(`/u_${_}`)}this.cacheKey=p.sort().join("")}getMaxValue(r){const l=this.binders[r];return l instanceof aa||l instanceof js?l.maxValue:0}populatePaintArrays(r,l,h,p,_,x){for(const T in this.binders){const A=this.binders[T];(A instanceof aa||A instanceof js||A instanceof Ka)&&A.populatePaintArray(r,l,h,p,_,x)}}setConstantPatternPositions(r){for(const l in this.binders){const h=this.binders[l];h instanceof Bu&&h.setConstantPatternPositions(r)}}updatePaintArrays(r,l,h,p,_,x){let T=!1;for(const A in r){const I=l.getPositions(A);for(const P of I){const D=h.feature(P.index);for(const O in this.binders){const N=this.binders[O];if((N instanceof aa||N instanceof js||N instanceof Ka)&&N.expression.isStateDependent===!0){const z=p.paint.get(O);N.expression=z.value,N.updatePaintArray(P.start,P.end,D,r[A],_,x),T=!0}}}}return T}defines(){const r=[];for(const l in this.binders){const h=this.binders[l];(h instanceof Ff||h instanceof Bu)&&r.push(...h.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return r}getBinderAttributes(){const r=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof aa||h instanceof js||h instanceof Ka)for(let p=0;p<h.paintVertexAttributes.length;p++)r.push(h.paintVertexAttributes[p].name)}return r}getBinderUniforms(){const r=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Ff||h instanceof Bu||h instanceof js)for(const p of h.uniformNames)r.push(p)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const l=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof Ff||p instanceof Bu||p instanceof js)for(const _ of p.uniformNames)l.push({name:_,property:h,binding:p.getBinding(r,_)})}return l}setUniforms(r,l,h,p,_){for(const{name:x,property:T,binding:A}of h)this.binders[T].setUniform(r,A,_,p.get(T),x)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const l=this.binders[r];(l instanceof aa||l instanceof js||l instanceof Ka)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(r){for(const l in this.binders){const h=this.binders[l];(h instanceof aa||h instanceof js||h instanceof Ka)&&h.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const l=this.binders[r];(l instanceof aa||l instanceof js||l instanceof Ka)&&l.destroy()}}}class oc{constructor(r,l,h=()=>!0){this.programConfigurations={};for(const p of r)this.programConfigurations[p.id]=new Ja(p,l,h);this.needsUpload=!1,this._featureMap=new Cm,this._bufferOffset=0}populatePaintArrays(r,l,h,p,_,x,T){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(r,l,p,_,x,T);l.id!==void 0&&this._featureMap.add(l.id,h,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,l,h,p,_){for(const x of h)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(r,this._featureMap,l,x,p,_)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const mk={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function gk(a,r){return mk[a]||[a.replace(`${r}-`,"").replace(/-/g,"_")]}const _k={"line-pattern":{source:Tn,composite:Tn},"fill-pattern":{source:Tn,composite:Tn},"fill-extrusion-pattern":{source:Tn,composite:Tn},"line-dasharray":{source:br,composite:br}},yk={color:{source:Ya,composite:Vi},number:{source:Br,composite:Ya}};function xw(a,r,l){const h=_k[a];return h&&h[l]||yk[r][l]}Dt(Ff,"ConstantBinder"),Dt(Bu,"PatternConstantBinder"),Dt(aa,"SourceExpressionBinder"),Dt(Ka,"PatternCompositeBinder"),Dt(js,"CompositeExpressionBinder"),Dt(Ja,"ProgramConfiguration",{omit:["_buffers"]}),Dt(oc,"ProgramConfigurationSet");const Pm="-transition";class $s extends Ls{constructor(r,l){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&r.type!=="sky"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),l.layout&&(this._unevaluatedLayout=new qe(l.layout)),l.paint)){this._transitionablePaint=new gt(l.paint);for(const h in r.paint)this.setPaintProperty(h,r.paint[h],{validate:!1});for(const h in r.layout)this.setLayoutProperty(h,r.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ue(l.paint)}}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,l,h={}){l!=null&&this._validate(pm,`layers.${this.id}.layout.${r}`,r,l,h)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,l):this.visibility=l)}getPaintProperty(r){return gr(r,Pm)?this._transitionablePaint.getTransition(r.slice(0,-Pm.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,l,h={}){if(l!=null&&this._validate(Qy,`layers.${this.id}.paint.${r}`,r,l,h))return!1;if(gr(r,Pm))return this._transitionablePaint.setTransition(r.slice(0,-Pm.length),l||void 0),!1;{const p=this._transitionablePaint._values[r],_=p.value.isDataDriven(),x=p.value;this._transitionablePaint.setValue(r,l),this._handleSpecialPaintPropertyUpdate(r);const T=this._transitionablePaint._values[r].value,A=T.isDataDriven(),I=gr(r,"pattern")||r==="line-dasharray";return A||_||I||this._handleOverridablePaintPropertyUpdate(r,x,T)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,l,h){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,l)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Or(r,(l,h)=>!(l===void 0||h==="layout"&&!Object.keys(l).length||h==="paint"&&!Object.keys(l).length))}_validate(r,l,h,p,_={}){return(!_||_.validate!==!1)&&mm(this,r.call(dm,{key:l,layerType:this.type,objectKey:h,value:p,styleSpec:Ze,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const l=this.paint.get(r);if(l instanceof st&&Va(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Au(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const xk=zt([{name:"a_pos",components:2,type:"Int16"}],4),vk=zt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class En{constructor(r=[]){this.segments=r}prepareSegment(r,l,h,p){let _=this.segments[this.segments.length-1];return r>En.MAX_VERTEX_ARRAY_LENGTH&&Se(`Max vertices per segment is ${En.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!_||_.vertexLength+r>En.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==p)&&(_={vertexOffset:l.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},p!==void 0&&(_.sortKey=p),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const r of this.segments)for(const l in r.vaos)r.vaos[l].destroy()}static simpleSegment(r,l,h,p){return new En([{vertexOffset:r,primitiveOffset:l,vertexLength:h,primitiveLength:p,vaos:{},sortKey:0}])}}En.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Dt(En,"SegmentVector");var Jt=8192;class Qa{constructor(r,l){r&&(l?this.setSouthWest(r).setNorthEast(l):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Ti?new Ti(r.lng,r.lat):Ti.convert(r),this}setSouthWest(r){return this._sw=r instanceof Ti?new Ti(r.lng,r.lat):Ti.convert(r),this}extend(r){const l=this._sw,h=this._ne;let p,_;if(r instanceof Ti)p=r,_=r;else{if(!(r instanceof Qa))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(Qa.convert(r)):this.extend(Ti.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(Ti.convert(r)):this;if(p=r._sw,_=r._ne,!p||!_)return this}return l||h?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),h.lng=Math.max(_.lng,h.lng),h.lat=Math.max(_.lat,h.lat)):(this._sw=new Ti(p.lng,p.lat),this._ne=new Ti(_.lng,_.lat)),this}getCenter(){return new Ti((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ti(this.getWest(),this.getNorth())}getSouthEast(){return new Ti(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:l,lat:h}=Ti.convert(r);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}static convert(r){return!r||r instanceof Qa?r:new Qa(r)}}var km=1e-6,Gr=typeof Float32Array<"u"?Float32Array:Array;function vw(){var a=new Gr(9);return Gr!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function bw(a,r,l){var h=r[0],p=r[1],_=r[2],x=r[3],T=r[4],A=r[5],I=r[6],P=r[7],D=r[8],O=l[0],N=l[1],z=l[2],$=l[3],G=l[4],se=l[5],pe=l[6],ee=l[7],de=l[8];return a[0]=O*h+N*x+z*I,a[1]=O*p+N*T+z*P,a[2]=O*_+N*A+z*D,a[3]=$*h+G*x+se*I,a[4]=$*p+G*T+se*P,a[5]=$*_+G*A+se*D,a[6]=pe*h+ee*x+de*I,a[7]=pe*p+ee*T+de*P,a[8]=pe*_+ee*A+de*D,a}function Ws(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function s0(a,r){var l=r[0],h=r[1],p=r[2],_=r[3],x=r[4],T=r[5],A=r[6],I=r[7],P=r[8],D=r[9],O=r[10],N=r[11],z=r[12],$=r[13],G=r[14],se=r[15],pe=l*T-h*x,ee=l*A-p*x,de=l*I-_*x,ye=h*A-p*T,ge=h*I-_*T,Ve=p*I-_*A,Ne=P*$-D*z,Ye=P*G-O*z,ft=P*se-N*z,He=D*G-O*$,Je=D*se-N*$,et=O*se-N*G,at=pe*et-ee*Je+de*He+ye*ft-ge*Ye+Ve*Ne;return at?(a[0]=(T*et-A*Je+I*He)*(at=1/at),a[1]=(p*Je-h*et-_*He)*at,a[2]=($*Ve-G*ge+se*ye)*at,a[3]=(O*ge-D*Ve-N*ye)*at,a[4]=(A*ft-x*et-I*Ye)*at,a[5]=(l*et-p*ft+_*Ye)*at,a[6]=(G*de-z*Ve-se*ee)*at,a[7]=(P*Ve-O*de+N*ee)*at,a[8]=(x*Je-T*ft+I*Ne)*at,a[9]=(h*ft-l*Je-_*Ne)*at,a[10]=(z*ge-$*de+se*pe)*at,a[11]=(D*de-P*ge-N*pe)*at,a[12]=(T*Ye-x*He-A*Ne)*at,a[13]=(l*He-h*Ye+p*Ne)*at,a[14]=($*ee-z*ye-G*pe)*at,a[15]=(P*ye-D*ee+O*pe)*at,a):null}function ac(a,r,l){var h=r[0],p=r[1],_=r[2],x=r[3],T=r[4],A=r[5],I=r[6],P=r[7],D=r[8],O=r[9],N=r[10],z=r[11],$=r[12],G=r[13],se=r[14],pe=r[15],ee=l[0],de=l[1],ye=l[2],ge=l[3];return a[0]=ee*h+de*T+ye*D+ge*$,a[1]=ee*p+de*A+ye*O+ge*G,a[2]=ee*_+de*I+ye*N+ge*se,a[3]=ee*x+de*P+ye*z+ge*pe,a[4]=(ee=l[4])*h+(de=l[5])*T+(ye=l[6])*D+(ge=l[7])*$,a[5]=ee*p+de*A+ye*O+ge*G,a[6]=ee*_+de*I+ye*N+ge*se,a[7]=ee*x+de*P+ye*z+ge*pe,a[8]=(ee=l[8])*h+(de=l[9])*T+(ye=l[10])*D+(ge=l[11])*$,a[9]=ee*p+de*A+ye*O+ge*G,a[10]=ee*_+de*I+ye*N+ge*se,a[11]=ee*x+de*P+ye*z+ge*pe,a[12]=(ee=l[12])*h+(de=l[13])*T+(ye=l[14])*D+(ge=l[15])*$,a[13]=ee*p+de*A+ye*O+ge*G,a[14]=ee*_+de*I+ye*N+ge*se,a[15]=ee*x+de*P+ye*z+ge*pe,a}function Nf(a,r,l){var h,p,_,x,T,A,I,P,D,O,N,z,$=l[0],G=l[1],se=l[2];return r===a?(a[12]=r[0]*$+r[4]*G+r[8]*se+r[12],a[13]=r[1]*$+r[5]*G+r[9]*se+r[13],a[14]=r[2]*$+r[6]*G+r[10]*se+r[14],a[15]=r[3]*$+r[7]*G+r[11]*se+r[15]):(p=r[1],_=r[2],x=r[3],T=r[4],A=r[5],I=r[6],P=r[7],D=r[8],O=r[9],N=r[10],z=r[11],a[0]=h=r[0],a[1]=p,a[2]=_,a[3]=x,a[4]=T,a[5]=A,a[6]=I,a[7]=P,a[8]=D,a[9]=O,a[10]=N,a[11]=z,a[12]=h*$+T*G+D*se+r[12],a[13]=p*$+A*G+O*se+r[13],a[14]=_*$+I*G+N*se+r[14],a[15]=x*$+P*G+z*se+r[15]),a}function lc(a,r,l){var h=l[0],p=l[1],_=l[2];return a[0]=r[0]*h,a[1]=r[1]*h,a[2]=r[2]*h,a[3]=r[3]*h,a[4]=r[4]*p,a[5]=r[5]*p,a[6]=r[6]*p,a[7]=r[7]*p,a[8]=r[8]*_,a[9]=r[9]*_,a[10]=r[10]*_,a[11]=r[11]*_,a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a}function o0(a,r,l){var h=Math.sin(l),p=Math.cos(l),_=r[4],x=r[5],T=r[6],A=r[7],I=r[8],P=r[9],D=r[10],O=r[11];return r!==a&&(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[4]=_*p+I*h,a[5]=x*p+P*h,a[6]=T*p+D*h,a[7]=A*p+O*h,a[8]=I*p-_*h,a[9]=P*p-x*h,a[10]=D*p-T*h,a[11]=O*p-A*h,a}function Dm(a,r,l){var h=Math.sin(l),p=Math.cos(l),_=r[0],x=r[1],T=r[2],A=r[3],I=r[8],P=r[9],D=r[10],O=r[11];return r!==a&&(a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=_*p-I*h,a[1]=x*p-P*h,a[2]=T*p-D*h,a[3]=A*p-O*h,a[8]=_*h+I*p,a[9]=x*h+P*p,a[10]=T*h+D*p,a[11]=A*h+O*p,a}function ww(a,r){return a[0]=r[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=r[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Tw(a,r,l){var h,p,_,x=l[0],T=l[1],A=l[2],I=Math.hypot(x,T,A);return I<km?null:(x*=I=1/I,T*=I,A*=I,h=Math.sin(r),p=Math.cos(r),a[0]=x*x*(_=1-p)+p,a[1]=T*x*_+A*h,a[2]=A*x*_-T*h,a[3]=0,a[4]=x*T*_-A*h,a[5]=T*T*_+p,a[6]=A*T*_+x*h,a[7]=0,a[8]=x*A*_+T*h,a[9]=T*A*_-x*h,a[10]=A*A*_+p,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}Math.hypot||(Math.hypot=function(){for(var a=0,r=arguments.length;r--;)a+=arguments[r]*arguments[r];return Math.sqrt(a)});var bk=ac;function a0(){var a=new Gr(3);return Gr!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Ew(a){var r=new Gr(3);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r}function zf(a){return Math.hypot(a[0],a[1],a[2])}function Fu(a,r,l){var h=new Gr(3);return h[0]=a,h[1]=r,h[2]=l,h}function la(a,r,l){return a[0]=r[0]+l[0],a[1]=r[1]+l[1],a[2]=r[2]+l[2],a}function l0(a,r,l){return a[0]=r[0]-l[0],a[1]=r[1]-l[1],a[2]=r[2]-l[2],a}function Aw(a,r,l){return a[0]=r[0]*l[0],a[1]=r[1]*l[1],a[2]=r[2]*l[2],a}function Uf(a,r,l){return a[0]=Math.min(r[0],l[0]),a[1]=Math.min(r[1],l[1]),a[2]=Math.min(r[2],l[2]),a}function Vf(a,r,l){return a[0]=Math.max(r[0],l[0]),a[1]=Math.max(r[1],l[1]),a[2]=Math.max(r[2],l[2]),a}function os(a,r,l){return a[0]=r[0]*l,a[1]=r[1]*l,a[2]=r[2]*l,a}function jf(a,r,l,h){return a[0]=r[0]+l[0]*h,a[1]=r[1]+l[1]*h,a[2]=r[2]+l[2]*h,a}function wr(a,r){var l=r[0],h=r[1],p=r[2],_=l*l+h*h+p*p;return _>0&&(_=1/Math.sqrt(_)),a[0]=r[0]*_,a[1]=r[1]*_,a[2]=r[2]*_,a}function Ts(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]}function c0(a,r,l){var h=r[0],p=r[1],_=r[2],x=l[0],T=l[1],A=l[2];return a[0]=p*A-_*T,a[1]=_*x-h*A,a[2]=h*T-p*x,a}function gn(a,r,l){var h=r[0],p=r[1],_=r[2],x=l[3]*h+l[7]*p+l[11]*_+l[15];return a[0]=(l[0]*h+l[4]*p+l[8]*_+l[12])/(x=x||1),a[1]=(l[1]*h+l[5]*p+l[9]*_+l[13])/x,a[2]=(l[2]*h+l[6]*p+l[10]*_+l[14])/x,a}function Sw(a,r,l){var h=l[0],p=l[1],_=l[2],x=r[0],T=r[1],A=r[2],I=p*A-_*T,P=_*x-h*A,D=h*T-p*x,O=p*D-_*P,N=_*I-h*D,z=h*P-p*I,$=2*l[3];return P*=$,D*=$,N*=2,z*=2,a[0]=x+(I*=$)+(O*=2),a[1]=T+P+N,a[2]=A+D+z,a}var $f,Hs=l0,wk=Aw,Tk=zf;function Iw(a,r,l){return a[0]=r[0]*l,a[1]=r[1]*l,a[2]=r[2]*l,a[3]=r[3]*l,a}function Cw(a,r){var l=r[0],h=r[1],p=r[2],_=r[3],x=l*l+h*h+p*p+_*_;return x>0&&(x=1/Math.sqrt(x)),a[0]=l*x,a[1]=h*x,a[2]=p*x,a[3]=_*x,a}function cc(a,r,l){var h=r[0],p=r[1],_=r[2],x=r[3];return a[0]=l[0]*h+l[4]*p+l[8]*_+l[12]*x,a[1]=l[1]*h+l[5]*p+l[9]*_+l[13]*x,a[2]=l[2]*h+l[6]*p+l[10]*_+l[14]*x,a[3]=l[3]*h+l[7]*p+l[11]*_+l[15]*x,a}function Mw(){var a=new Gr(4);return Gr!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Rw(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Pw(a,r,l){l*=.5;var h=r[0],p=r[1],_=r[2],x=r[3],T=Math.sin(l),A=Math.cos(l);return a[0]=h*A+x*T,a[1]=p*A+_*T,a[2]=_*A-p*T,a[3]=x*A-h*T,a}function kw(a,r,l){l*=.5;var h=r[0],p=r[1],_=r[2],x=r[3],T=Math.sin(l),A=Math.cos(l);return a[0]=h*A-_*T,a[1]=p*A+x*T,a[2]=_*A+h*T,a[3]=x*A-p*T,a}a0(),$f=new Gr(4),Gr!=Float32Array&&($f[0]=0,$f[1]=0,$f[2]=0,$f[3]=0);var Ek=Cw;a0(),Fu(1,0,0),Fu(0,1,0),Mw(),Mw(),vw();const Ak=zt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Dw}=Ak,Ow=zt([{name:"a_pos_3",components:3,type:"Int16"}]);var Wf=zt([{name:"a_pos",type:"Int16",components:2}]);class u0{constructor(r,l){this.pos=r,this.dir=l}intersectsPlane(r,l,h){const p=Ts(l,this.dir);if(Math.abs(p)<1e-6)return!1;const _=((r[0]-this.pos[0])*l[0]+(r[1]-this.pos[1])*l[1]+(r[2]-this.pos[2])*l[2])/p;return h[0]=this.pos[0]+this.dir[0]*_,h[1]=this.pos[1]+this.dir[1]*_,h[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(r,l,h){if(function(N,z){var $=N[0],G=N[1],se=N[2],pe=z[0],ee=z[1],de=z[2];return Math.abs($-pe)<=km*Math.max(1,Math.abs($),Math.abs(pe))&&Math.abs(G-ee)<=km*Math.max(1,Math.abs(G),Math.abs(ee))&&Math.abs(se-de)<=km*Math.max(1,Math.abs(se),Math.abs(de))}(this.pos,r)||l===0)return h[0]=h[1]=h[2]=0,!1;const[p,_,x]=this.dir,T=this.pos[0]-r[0],A=this.pos[1]-r[1],I=this.pos[2]-r[2],P=p*p+_*_+x*x,D=2*(T*p+A*_+I*x),O=D*D-4*P*(T*T+A*A+I*I-l*l);if(O<0){const N=Math.max(-D/2,0),z=T+p*N,$=A+_*N,G=I+x*N,se=Math.hypot(z,$,G);return h[0]=z*l/se,h[1]=$*l/se,h[2]=G*l/se,!1}{const N=(-D-Math.sqrt(O))/(2*P);if(N<0){const z=Math.hypot(T,A,I);return h[0]=T*l/z,h[1]=A*l/z,h[2]=I*l/z,!1}return h[0]=T+p*N,h[1]=A+_*N,h[2]=I+x*N,!0}}}class h0{constructor(r,l,h,p,_){this.TL=r,this.TR=l,this.BR=h,this.BL=p,this.horizon=_}static fromInvProjectionMatrix(r,l,h){const p=[-1,1,1],_=[1,1,1],x=[1,-1,1],T=[-1,-1,1],A=gn(p,p,r),I=gn(_,_,r),P=gn(x,x,r),D=gn(T,T,r);return new h0(A,I,P,D,l/h)}}class f0{constructor(r,l){this.points=r,this.planes=l}static fromInvProjectionMatrix(r,l,h,p){const _=Math.pow(2,h),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const I=cc([],A,r),P=1/I[3]/l*_;return function(D,O,N){return D[0]=O[0]*N[0],D[1]=O[1]*N[1],D[2]=O[2]*N[2],D[3]=O[3]*N[3],D}(I,I,[P,P,p?1/I[3]:P,P])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const I=wr([],c0([],Hs([],x[A[0]],x[A[1]]),Hs([],x[A[2]],x[A[1]]))),P=-Ts(I,x[A[1]]);return I.concat(P)});return new f0(x,T)}}class Tr{static fromPoints(r){const l=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const p of r)Uf(l,l,p),Vf(h,h,p);return new Tr(l,h)}static applyTransform(r,l){const h=r.getCorners();for(let p=0;p<h.length;++p)gn(h[p],h[p],l);return Tr.fromPoints(h)}constructor(r,l){this.min=r,this.max=l,this.center=os([],la([],this.min,this.max),.5)}quadrant(r){const l=[r%2==0,r<2],h=Ew(this.min),p=Ew(this.max);for(let _=0;_<l.length;_++)h[_]=l[_]?this.min[_]:this.center[_],p[_]=l[_]?this.center[_]:this.max[_];return p[2]=this.max[2],new Tr(h,p)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,l=this.max;return[[r[0],r[1],r[2]],[l[0],r[1],r[2]],[l[0],l[1],r[2]],[r[0],l[1],r[2]],[r[0],r[1],l[2]],[l[0],r[1],l[2]],[l[0],l[1],l[2]],[r[0],l[1],l[2]]]}intersects(r){const l=this.getCorners();let h=!0;for(let p=0;p<r.planes.length;p++){const _=r.planes[p];let x=0;for(let T=0;T<l.length;T++)x+=Ts(_,l[T])+_[3]>=0;if(x===0)return 0;x!==l.length&&(h=!1)}if(h)return 2;for(let p=0;p<3;p++){let _=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let T=0;T<r.points.length;T++){const A=r.points[T][p]-this.min[p];_=Math.min(_,A),x=Math.max(x,A)}if(x<0||_>this.max[p]-this.min[p])return 0}return 1}}const _o=Jt/Math.PI/2,uc=64,Hf=[uc,32,16],Es=-_o,As=_o,Sk=[new Tr([Es,Es,Es],[As,As,As]),new Tr([Es,Es,Es],[0,0,As]),new Tr([0,Es,Es],[As,0,As]),new Tr([Es,0,Es],[0,As,As]),new Tr([0,0,Es],[As,As,As])];function Om(a){return a*_o/Gf}function Lw(a,r,l,h=!0){const p=os([],a._camera.position,a.worldSize),_=[r,l,1,1];cc(_,_,a.pixelMatrixInverse),Iw(_,_,1/_[3]);const x=wr([],Hs([],_,p)),T=a.globeMatrix,A=[T[12],T[13],T[14]],I=Hs([],A,p),P=zf(I),D=wr([],I),O=a.worldSize/(2*Math.PI),N=Ts(D,x),z=Math.asin(O/P);if(z<Math.acos(N)){if(!h)return null;const ft=[],He=[];os(ft,x,P/N),wr(He,Hs(He,ft,I)),wr(x,la(x,I,os(x,He,Math.tan(z)*P)))}const $=[];new u0(p,x).closestPointOnSphere(A,O,$);const G=wr([],vt(T,0)),se=wr([],vt(T,1)),pe=wr([],vt(T,2)),ee=Ts(G,$),de=Ts(se,$),ye=Ts(pe,$),ge=Ge(Math.asin(-de/O));let Ve=Ge(Math.atan2(ee,ye));Ve=a.center.lng+function(ft,He){const Je=(He-ft+180)%360-180;return Je<-180?Je+360:Je}(a.center.lng,Ve);const Ne=xo(Ve),Ye=xt(vo(ge),0,1);return new Vu(Ne,Ye)}class Ik{constructor(r,l,h){this.a=Hs([],r,h),this.b=Hs([],l,h),this.center=h;const p=wr([],this.a),_=wr([],this.b);this.angle=Math.acos(Ts(p,_))}}function d0(a,r){if(a.angle===0)return null;let l;return l=a.a[r]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[r]/a.a[r]/Math.sin(a.angle)-1/Math.tan(a.angle)),l<0||l>1?null:function(h,p,_,x){const T=Math.sin(_);return h*(Math.sin((1-x)*_)/T)+p*(Math.sin(x*_)/T)}(a.a[r],a.b[r],a.angle,xt(l,0,1))+a.center[r]}function yo(a){if(a.z<=1)return Sk[a.z+2*a.y+a.x];const r=p0(Lm(a));return Tr.fromPoints(r)}function hc(a,r,l){return os(a,a,1-l),jf(a,a,r,l)}function Bw(a,r){const l=Uu(r.zoom);if(l===0)return yo(a);const h=Lm(a),p=p0(h),_=xo(h.getWest())*r.worldSize,x=xo(h.getEast())*r.worldSize,T=vo(h.getNorth())*r.worldSize,A=vo(h.getSouth())*r.worldSize,I=[_,T,0],P=[x,T,0],D=[_,A,0],O=[x,A,0],N=s0([],r.globeMatrix);return gn(I,I,N),gn(P,P,N),gn(D,D,N),gn(O,O,N),p[0]=hc(p[0],D,l),p[1]=hc(p[1],O,l),p[2]=hc(p[2],P,l),p[3]=hc(p[3],I,l),Tr.fromPoints(p)}function Fw(a,r,l){for(const h of a)gn(h,h,r),os(h,h,l)}function Ck(a,r,l){const h=r/a.worldSize,p=a.globeMatrix;if(l.z<=1){const Ne=yo(l).getCorners();return Fw(Ne,p,h),Tr.fromPoints(Ne)}const _=Lm(l),x=p0(_);Fw(x,p,h);const T=Number.MAX_VALUE,A=[-T,-T,-T],I=[T,T,T];if(_.contains(a.center)){for(const ft of x)Uf(I,I,ft),Vf(A,A,ft);A[2]=0;const Ne=a.point,Ye=[Ne.x*h,Ne.y*h,0];return Uf(I,I,Ye),Vf(A,A,Ye),new Tr(I,A)}const P=[p[12]*h,p[13]*h,p[14]*h],D=_.getCenter(),O=xt(a.center.lat,-85.051129,qs),N=xt(D.lat,-85.051129,qs),z=xo(a.center.lng),$=vo(O);let G=z-xo(D.lng);const se=$-vo(N);G>.5?G-=1:G<-.5&&(G+=1);let pe=0;Math.abs(G)>Math.abs(se)?pe=G>=0?1:3:(pe=se>=0?0:2,jf(P,P,[p[4]*h,p[5]*h,p[6]*h],-Math.sin(rt(se>=0?_.getSouth():_.getNorth()))*_o));const ee=x[pe],de=x[(pe+1)%4],ye=new Ik(ee,de,P),ge=[d0(ye,0)||ee[0],d0(ye,1)||ee[1],d0(ye,2)||ee[2]],Ve=Uu(a.zoom);if(Ve>0){const Ne=function({x:ft,y:He,z:Je},et,at,dt,Xe){const wt=1/(1<<Je);let qt=ft*wt,St=qt+wt,Ft=He*wt,Tt=Ft+wt,Zt=0;const fi=(qt+St)/2-dt;return fi>.5?Zt=-1:fi<-.5&&(Zt=1),qt=((qt+Zt)*et-(dt*=et))*at+dt,St=((St+Zt)*et-dt)*at+dt,Ft=(Ft*et-(Xe*=et))*at+Xe,Tt=(Tt*et-Xe)*at+Xe,[[qt,Tt,0],[St,Tt,0],[St,Ft,0],[qt,Ft,0]]}(l,r,a._pixelsPerMercatorPixel,z,$);for(let ft=0;ft<x.length;ft++)hc(x[ft],Ne[ft],Ve);const Ye=la([],Ne[pe],Ne[(pe+1)%4]);os(Ye,Ye,.5),hc(ge,Ye,Ve)}for(const Ne of x)Uf(I,I,Ne),Vf(A,A,Ne);return I[2]=Math.min(ee[2],de[2]),Uf(I,I,ge),Vf(A,A,ge),new Tr(I,A)}function Lm({x:a,y:r,z:l}){const h=1/(1<<l),p=new Ti(as(a*h),ar((r+1)*h)),_=new Ti(as((a+1)*h),ar(r*h));return new Qa(p,_)}function p0(a){const r=rt(a.getNorth()),l=rt(a.getSouth()),h=Math.cos(r),p=Math.cos(l),_=Math.sin(r),x=Math.sin(l),T=a.getWest(),A=a.getEast();return[Nu(p,x,T),Nu(p,x,A),Nu(h,_,A),Nu(h,_,T)]}function Nu(a,r,l,h=_o){return l=rt(l),[a*Math.sin(l)*h,-r*h,a*Math.cos(l)*h]}function zu(a,r,l){return Nu(Math.cos(rt(a)),Math.sin(rt(a)),r,l)}function Xf(a,r,l,h){const p=1<<l.z,_=(a/Jt+l.x)/p;return zu(ar((r/Jt+l.y)/p),as(_),h)}function Bm({min:a,max:r}){return 16383/Math.max(r[0]-a[0],r[1]-a[1],r[2]-a[2])}const Nw=new Float64Array(16);function qf(a){const r=Bm(a),l=ww(Nw,[r,r,r]);return Nf(l,l,((h=[])[0]=-(p=a.min)[0],h[1]=-p[1],h[2]=-p[2],h));var h,p}function m0(a){const r=(h=a.min,(l=Nw)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=h[0],l[13]=h[1],l[14]=h[2],l[15]=1,l);var l,h;const p=1/Bm(a);return lc(r,r,[p,p,p])}function zw(a,r,l,h,p){const _=function(A){const I=Jt/(2*Math.PI);return A/(2*Math.PI)/I}(l),x=[a,r,-l/(2*Math.PI)],T=Ws(new Float64Array(16));return Nf(T,T,x),lc(T,T,[_,_,_]),o0(T,T,rt(-p)),Dm(T,T,rt(-h)),T}function Uu(a){return ei(5,6,a)}function Uw(a,r){const l=zu(r.lat,r.lng),h=function(z){const $=zu(z._center.lat,z._center.lng);let G=c0([],Fu(0,1,0),$);const se=Tw([],-z.angle,$);G=gn(G,G,se),Tw(se,-z._pitch,G);const pe=wr([],$);return os(pe,pe,Om(z.cameraToCenterDistance/z.pixelsPerMeter)),gn(pe,pe,se),la([],$,pe)}(a);return x=(p=l0([],h,l))[0],T=p[1],A=p[2],I=(_=l)[0],P=_[1],D=_[2],N=(O=Math.sqrt(x*x+T*T+A*A)*Math.sqrt(I*I+P*P+D*D))&&Ts(p,_)/O,Math.acos(Math.min(Math.max(N,-1),1));var p,_,x,T,A,I,P,D,O,N}function g0(a,r){return Uw(a,r)>Math.PI/2*1.01}const Vw=rt(85),Mk=Math.cos(Vw),Rk=Math.sin(Vw),Gf=63710088e-1,jw=2*Math.PI*Gf;class Ti{constructor(r,l){if(isNaN(r)||isNaN(l))throw new Error(`Invalid LngLat object: (${r}, ${l})`);if(this.lng=+r,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ti(ti(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const l=Math.PI/180,h=this.lat*l,p=r.lat*l,_=Math.sin(h)*Math.sin(p)+Math.cos(h)*Math.cos(p)*Math.cos((r.lng-this.lng)*l);return Gf*Math.acos(Math.min(_,1))}toBounds(r=0){const l=360*r/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new Qa(new Ti(this.lng-h,this.lat-l),new Ti(this.lng+h,this.lat+l))}toEcef(r){const l=Om(r);return zu(this.lat,this.lng,_o+l)}static convert(r){if(r instanceof Ti)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Ti(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Ti(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function _0(a){return jw*Math.cos(a*Math.PI/180)}function xo(a){return(180+a)/360}function vo(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Xs(a,r){return a/_0(r)}function as(a){return 360*a-180}function ar(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function $w(a,r){return a*_0(ar(r))}const qs=85.051129;function Ww(a){return 1/Math.cos(a*Math.PI/180)}class Vu{constructor(r,l,h=0){this.x=+r,this.y=+l,this.z=+h}static fromLngLat(r,l=0){const h=Ti.convert(r);return new Vu(xo(h.lng),vo(h.lat),Xs(l,h.lat))}toLngLat(){return new Ti(as(this.x),ar(this.y))}toAltitude(){return $w(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/jw*Ww(ar(this.y))}}function y0(a,r,l,h,p,_,x,T,A){const I=(r+h)/2,P=(l+p)/2,D=new me(I,P);T(D),function(O,N,z,$,G,se){const pe=z-G,ee=$-se;return Math.abs(($-N)*pe-(z-O)*ee)/Math.hypot(pe,ee)}(D.x,D.y,_.x,_.y,x.x,x.y)>=A?(y0(a,r,l,I,P,_,D,T,A),y0(a,I,P,h,p,D,x,T,A)):a.push(x)}function Hw(a,r,l){let h=a[0],p=h.x,_=h.y;r(h);const x=[h];for(let T=1;T<a.length;T++){const A=a[T],{x:I,y:P}=A;r(A),y0(x,p,_,I,P,h,A,r,l),p=I,_=P,h=A}return x}function x0(a,r,l,h){if(h(r,l)){const p=r.add(l)._mult(.5);x0(a,r,p,h),x0(a,p,l,h)}else a.push(l)}function Pk(a,r){let l=a[0];const h=[l];for(let p=1;p<a.length;p++){const _=a[p];x0(h,l,_,r),l=_}return h}const v0=Math.pow(2,14)-1,Xw=-v0-1;function kk(a,r){const l=Math.round(a.x*r),h=Math.round(a.y*r);return a.x=xt(l,Xw,v0),a.y=xt(h,Xw,v0),(l<a.x||l>a.x+1||h<a.y||h>a.y+1)&&Se("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function ca(a,r,l){const h=a.loadGeometry(),p=a.extent,_=Jt/p;if(r&&l&&l.projection.isReprojectedInTileSpace){const x=1<<r.z,{scale:T,x:A,y:I,projection:P}=l,D=O=>{const N=as((r.x+O.x/p)/x),z=ar((r.y+O.y/p)/x),$=P.project(N,z);O.x=($.x*T-A)*p,O.y=($.y*T-I)*p};for(let O=0;O<h.length;O++)if(a.type!==1)h[O]=Hw(h[O],D,1);else{const N=[];for(const z of h[O])z.x<0||z.x>=p||z.y<0||z.y>=p||(D(z),N.push(z));h[O]=N}}for(const x of h)for(const T of x)kk(T,_);return h}function fc(a,r){return{type:a.type,id:a.id,properties:a.properties,geometry:r?ca(a):[]}}function Fm(a,r,l,h,p){a.emplaceBack(2*r+(h+1)/2,2*l+(p+1)/2)}function Nm(a,r,l){a.emplaceBack(r.x,r.y,r.z,l[0]*16384,l[1]*16384,l[2]*16384)}class b0{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new Wt,this.indexArray=new or,this.segments=new En,this.programConfigurations=new oc(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,h,p){const _=this.layers[0],x=[];let T=null;_.type==="circle"&&(T=_.layout.get("circle-sort-key"));for(const{feature:I,id:P,index:D,sourceLayerIndex:O}of r){const N=this.layers[0]._featureFilter.needGeometry,z=fc(I,N);if(!this.layers[0]._featureFilter.filter(new Re(this.zoom),z,h))continue;const $=T?T.evaluate(z,{},h):void 0,G={id:P,properties:I.properties,type:I.type,sourceLayerIndex:O,index:D,geometry:N?z.geometry:ca(I,h,p),patterns:{},sortKey:$};x.push(G)}T&&x.sort((I,P)=>I.sortKey-P.sortKey);let A=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new ss,A=p.projection);for(const I of x){const{geometry:P,index:D,sourceLayerIndex:O}=I,N=r[D].feature;this.addFeature(I,P,D,l.availableImages,h,A),l.featureIndex.insert(N,P,D,O,this.index)}}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,xk.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,vk.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,l,h,p,_,x){for(const T of l)for(const A of T){const I=A.x,P=A.y;if(I<0||I>=Jt||P<0||P>=Jt)continue;if(x){const N=x.projectTilePoint(I,P,_),z=x.upVector(_,I,P),$=this.globeExtVertexArray;Nm($,N,z),Nm($,N,z),Nm($,N,z),Nm($,N,z)}const D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),O=D.vertexLength;Fm(this.layoutVertexArray,I,P,-1,-1),Fm(this.layoutVertexArray,I,P,1,-1),Fm(this.layoutVertexArray,I,P,1,1),Fm(this.layoutVertexArray,I,P,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+2,O+3),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{},p,_)}}function qw(a,r){for(let l=0;l<a.length;l++)if(dc(r,a[l]))return!0;for(let l=0;l<r.length;l++)if(dc(a,r[l]))return!0;return!!w0(a,r)}function Dk(a,r,l){return!!dc(a,r)||!!T0(r,a,l)}function Gw(a,r){if(a.length===1)return Yw(r,a[0]);for(let l=0;l<r.length;l++){const h=r[l];for(let p=0;p<h.length;p++)if(dc(a,h[p]))return!0}for(let l=0;l<a.length;l++)if(Yw(r,a[l]))return!0;for(let l=0;l<r.length;l++)if(w0(a,r[l]))return!0;return!1}function Ok(a,r,l){if(a.length>1){if(w0(a,r))return!0;for(let h=0;h<r.length;h++)if(T0(r[h],a,l))return!0}for(let h=0;h<a.length;h++)if(T0(a[h],r,l))return!0;return!1}function w0(a,r){if(a.length===0||r.length===0)return!1;for(let l=0;l<a.length-1;l++){const h=a[l],p=a[l+1];for(let _=0;_<r.length-1;_++)if(Lk(h,p,r[_],r[_+1]))return!0}return!1}function Lk(a,r,l,h){return Ke(a,l,h)!==Ke(r,l,h)&&Ke(a,r,l)!==Ke(a,r,h)}function T0(a,r,l){const h=l*l;if(r.length===1)return a.distSqr(r[0])<h;for(let p=1;p<r.length;p++)if(Zw(a,r[p-1],r[p])<h)return!0;return!1}function Zw(a,r,l){const h=r.distSqr(l);if(h===0)return a.distSqr(r);const p=((a.x-r.x)*(l.x-r.x)+(a.y-r.y)*(l.y-r.y))/h;return a.distSqr(p<0?r:p>1?l:l.sub(r)._mult(p)._add(r))}function Yw(a,r){let l,h,p,_=!1;for(let x=0;x<a.length;x++){l=a[x];for(let T=0,A=l.length-1;T<l.length;A=T++)h=l[T],p=l[A],h.y>r.y!=p.y>r.y&&r.x<(p.x-h.x)*(r.y-h.y)/(p.y-h.y)+h.x&&(_=!_)}return _}function dc(a,r){let l=!1;for(let h=0,p=a.length-1;h<a.length;p=h++){const _=a[h],x=a[p];_.y>r.y!=x.y>r.y&&r.x<(x.x-_.x)*(r.y-_.y)/(x.y-_.y)+_.x&&(l=!l)}return l}function Kw(a,r,l,h,p){for(const x of a)if(r<=x.x&&l<=x.y&&h>=x.x&&p>=x.y)return!0;const _=[new me(r,l),new me(r,p),new me(h,p),new me(h,l)];if(a.length>2){for(const x of _)if(dc(a,x))return!0}for(let x=0;x<a.length-1;x++)if(Bk(a[x],a[x+1],_))return!0;return!1}function Bk(a,r,l){const h=l[0],p=l[2];if(a.x<h.x&&r.x<h.x||a.x>p.x&&r.x>p.x||a.y<h.y&&r.y<h.y||a.y>p.y&&r.y>p.y)return!1;const _=Ke(a,r,l[0]);return _!==Ke(a,r,l[1])||_!==Ke(a,r,l[2])||_!==Ke(a,r,l[3])}function ju(a,r,l){const h=r.paint.get(a).value;return h.kind==="constant"?h.value:l.programConfigurations.get(r.id).getMaxValue(a)}function zm(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Jw(a,r,l,h,p){if(!r[0]&&!r[1])return a;const _=me.convert(r)._mult(p);l==="viewport"&&_._rotate(-h);const x=[];for(let T=0;T<a.length;T++)x.push(a[T].sub(_));return x}function Qw(a,r,l,h){const p=me.convert(a)._mult(h);return r==="viewport"&&p._rotate(-l),p}Dt(b0,"CircleBucket",{omit:["layers"]});const Fk=new ct({"circle-sort-key":new $e(Ze.layout_circle["circle-sort-key"])});var Nk={paint:new ct({"circle-radius":new $e(Ze.paint_circle["circle-radius"]),"circle-color":new $e(Ze.paint_circle["circle-color"]),"circle-blur":new $e(Ze.paint_circle["circle-blur"]),"circle-opacity":new $e(Ze.paint_circle["circle-opacity"]),"circle-translate":new Ce(Ze.paint_circle["circle-translate"]),"circle-translate-anchor":new Ce(Ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ce(Ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ce(Ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $e(Ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $e(Ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $e(Ze.paint_circle["circle-stroke-opacity"])}),layout:Fk};function eT(a,r,l,h,p,_,x,T,A){if(_&&a.queryGeometry.isAboveHorizon)return!1;_&&(A*=a.pixelToTileUnitsFactor);const I=a.tileID.canonical,P=l.projection.upVectorScale(I,l.center.lat,l.worldSize).metersToTile;for(const D of r)for(const O of D){const N=O.add(T),z=p&&l.elevation?l.elevation.exaggeration()*p.getElevationAt(N.x,N.y,!0):0,$=l.projection.projectTilePoint(N.x,N.y,I);if(z>0){const ee=l.projection.upVector(I,N.x,N.y);$.x+=ee[0]*P*z,$.y+=ee[1]*P*z,$.z+=ee[2]*P*z}const G=_?N:zk($.x,$.y,$.z,h),se=_?a.tilespaceRays.map(ee=>Vk(ee,z)):a.queryGeometry.screenGeometry,pe=cc([],[$.x,$.y,$.z,1],h);if(!x&&_?A*=pe[3]/l.cameraToCenterDistance:x&&!_&&(A*=l.cameraToCenterDistance/pe[3]),_){const ee=ar((O.y/Jt+I.y)/(1<<I.z));A/=l.projection.pixelsPerMeter(ee,1)/Xs(1,ee)}if(Dk(se,G,A))return!0}return!1}function zk(a,r,l,h){const p=cc([],[a,r,l,1],h);return new me(p[0]/p[3],p[1]/p[3])}const tT=Fu(0,0,0),Uk=Fu(0,0,1);function Vk(a,r){const l=a0();return tT[2]=r,a.intersectsPlane(tT,Uk,l),new me(l[0],l[1])}class iT extends b0{}function nT(a,{width:r,height:l},h,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==r*l*h)throw new RangeError("mismatched image size")}else p=new Uint8Array(r*l*h);return a.width=r,a.height=l,a.data=p,a}function rT(a,r,l){const{width:h,height:p}=r;h===a.width&&p===a.height||(E0(a,r,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,h),height:Math.min(a.height,p)},l),a.width=h,a.height=p,a.data=r.data)}function E0(a,r,l,h,p,_){if(p.width===0||p.height===0)return r;if(p.width>a.width||p.height>a.height||l.x>a.width-p.width||l.y>a.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>r.width||p.height>r.height||h.x>r.width-p.width||h.y>r.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const x=a.data,T=r.data;for(let A=0;A<p.height;A++){const I=((l.y+A)*a.width+l.x)*_,P=((h.y+A)*r.width+h.x)*_;for(let D=0;D<p.width*_;D++)T[P+D]=x[I+D]}return r}Dt(iT,"HeatmapBucket",{omit:["layers"]});class ua{constructor(r,l){nT(this,r,1,l)}resize(r){rT(this,new ua(r),1)}clone(){return new ua({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,h,p,_){E0(r,l,h,p,_,1)}}class Zr{constructor(r,l){nT(this,r,4,l)}resize(r){rT(this,new Zr(r),4)}replace(r,l){l?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Zr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,h,p,_){E0(r,l,h,p,_,4)}}Dt(ua,"AlphaImage"),Dt(Zr,"RGBAImage");var jk={paint:new ct({"heatmap-radius":new $e(Ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $e(Ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ce(Ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new it(Ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ce(Ze.paint_heatmap["heatmap-opacity"])})};function A0(a){const r={},l=a.resolution||256,h=a.clips?a.clips.length:1,p=a.image||new Zr({width:l,height:h}),_=(x,T,A)=>{r[a.evaluationKey]=A;const I=a.expression.evaluate(r);p.data[x+T+0]=Math.floor(255*I.r/I.a),p.data[x+T+1]=Math.floor(255*I.g/I.a),p.data[x+T+2]=Math.floor(255*I.b/I.a),p.data[x+T+3]=Math.floor(255*I.a)};if(a.clips)for(let x=0,T=0;x<h;++x,T+=4*l)for(let A=0,I=0;A<l;A++,I+=4){const P=A/(l-1),{start:D,end:O}=a.clips[x];_(T,I,D*(1-P)+O*P)}else for(let x=0,T=0;x<l;x++,T+=4)_(0,T,x/(l-1));return p}var $k={paint:new ct({"hillshade-illumination-direction":new Ce(Ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ce(Ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ce(Ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ce(Ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ce(Ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ce(Ze.paint_hillshade["hillshade-accent-color"])})};const Wk=zt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Hk}=Wk;var $u={};function Um(a,r,l){l=l||2;var h,p,_,x,T,A,I,P=r&&r.length,D=P?r[0]*l:a.length,O=sT(a,0,D,l,!0),N=[];if(!O||O.next===O.prev)return N;if(P&&(O=function($,G,se,pe){var ee,de,ye,ge=[];for(ee=0,de=G.length;ee<de;ee++)(ye=sT($,G[ee]*pe,ee<de-1?G[ee+1]*pe:$.length,pe,!1))===ye.next&&(ye.steiner=!0),ge.push(Qk(ye));for(ge.sort(Yk),ee=0;ee<ge.length;ee++)se=Kk(ge[ee],se);return se}(a,r,O,l)),a.length>80*l){h=_=a[0],p=x=a[1];for(var z=l;z<D;z+=l)(T=a[z])<h&&(h=T),(A=a[z+1])<p&&(p=A),T>_&&(_=T),A>x&&(x=A);I=(I=Math.max(_-h,x-p))!==0?32767/I:0}return Zf(O,N,l,h,p,I,0),N}function sT(a,r,l,h,p){var _,x;if(p===C0(a,r,l,h)>0)for(_=r;_<l;_+=h)x=lT(_,a[_],a[_+1],x);else for(_=l-h;_>=r;_-=h)x=lT(_,a[_],a[_+1],x);return x&&Vm(x,x.next)&&(Kf(x),x=x.next),x}function pc(a,r){if(!a)return a;r||(r=a);var l,h=a;do if(l=!1,h.steiner||!Vm(h,h.next)&&An(h.prev,h,h.next)!==0)h=h.next;else{if(Kf(h),(h=r=h.prev)===h.next)break;l=!0}while(l||h!==r);return r}function Zf(a,r,l,h,p,_,x){if(a){!x&&_&&function(P,D,O,N){var z=P;do z.z===0&&(z.z=S0(z.x,z.y,D,O,N)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==P);z.prevZ.nextZ=null,z.prevZ=null,function($){var G,se,pe,ee,de,ye,ge,Ve,Ne=1;do{for(se=$,$=null,de=null,ye=0;se;){for(ye++,pe=se,ge=0,G=0;G<Ne&&(ge++,pe=pe.nextZ);G++);for(Ve=Ne;ge>0||Ve>0&&pe;)ge!==0&&(Ve===0||!pe||se.z<=pe.z)?(ee=se,se=se.nextZ,ge--):(ee=pe,pe=pe.nextZ,Ve--),de?de.nextZ=ee:$=ee,ee.prevZ=de,de=ee;se=pe}de.nextZ=null,Ne*=2}while(ye>1)}(z)}(a,h,p,_);for(var T,A,I=a;a.prev!==a.next;)if(T=a.prev,A=a.next,_?qk(a,h,p,_):Xk(a))r.push(T.i/l|0),r.push(a.i/l|0),r.push(A.i/l|0),Kf(a),a=A.next,I=A.next;else if((a=A)===I){x?x===1?Zf(a=Gk(pc(a),r,l),r,l,h,p,_,2):x===2&&Zk(a,r,l,h,p,_):Zf(pc(a),r,l,h,p,_,1);break}}}function Xk(a){var r=a.prev,l=a,h=a.next;if(An(r,l,h)>=0)return!1;for(var p=r.x,_=l.x,x=h.x,T=r.y,A=l.y,I=h.y,P=p<_?p<x?p:x:_<x?_:x,D=T<A?T<I?T:I:A<I?A:I,O=p>_?p>x?p:x:_>x?_:x,N=T>A?T>I?T:I:A>I?A:I,z=h.next;z!==r;){if(z.x>=P&&z.x<=O&&z.y>=D&&z.y<=N&&Wu(p,T,_,A,x,I,z.x,z.y)&&An(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function qk(a,r,l,h){var p=a.prev,_=a,x=a.next;if(An(p,_,x)>=0)return!1;for(var T=p.x,A=_.x,I=x.x,P=p.y,D=_.y,O=x.y,N=T<A?T<I?T:I:A<I?A:I,z=P<D?P<O?P:O:D<O?D:O,$=T>A?T>I?T:I:A>I?A:I,G=P>D?P>O?P:O:D>O?D:O,se=S0(N,z,r,l,h),pe=S0($,G,r,l,h),ee=a.prevZ,de=a.nextZ;ee&&ee.z>=se&&de&&de.z<=pe;){if(ee.x>=N&&ee.x<=$&&ee.y>=z&&ee.y<=G&&ee!==p&&ee!==x&&Wu(T,P,A,D,I,O,ee.x,ee.y)&&An(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,de.x>=N&&de.x<=$&&de.y>=z&&de.y<=G&&de!==p&&de!==x&&Wu(T,P,A,D,I,O,de.x,de.y)&&An(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;ee&&ee.z>=se;){if(ee.x>=N&&ee.x<=$&&ee.y>=z&&ee.y<=G&&ee!==p&&ee!==x&&Wu(T,P,A,D,I,O,ee.x,ee.y)&&An(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;de&&de.z<=pe;){if(de.x>=N&&de.x<=$&&de.y>=z&&de.y<=G&&de!==p&&de!==x&&Wu(T,P,A,D,I,O,de.x,de.y)&&An(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function Gk(a,r,l){var h=a;do{var p=h.prev,_=h.next.next;!Vm(p,_)&&oT(p,h,h.next,_)&&Yf(p,_)&&Yf(_,p)&&(r.push(p.i/l|0),r.push(h.i/l|0),r.push(_.i/l|0),Kf(h),Kf(h.next),h=a=_),h=h.next}while(h!==a);return pc(h)}function Zk(a,r,l,h,p,_){var x=a;do{for(var T=x.next.next;T!==x.prev;){if(x.i!==T.i&&eD(x,T)){var A=aT(x,T);return x=pc(x,x.next),A=pc(A,A.next),Zf(x,r,l,h,p,_,0),void Zf(A,r,l,h,p,_,0)}T=T.next}x=x.next}while(x!==a)}function Yk(a,r){return a.x-r.x}function Kk(a,r){var l=function(p,_){var x,T=_,A=p.x,I=p.y,P=-1/0;do{if(I<=T.y&&I>=T.next.y&&T.next.y!==T.y){var D=T.x+(I-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(D<=A&&D>P&&(P=D,x=T.x<T.next.x?T:T.next,D===A))return x}T=T.next}while(T!==_);if(!x)return null;var O,N=x,z=x.x,$=x.y,G=1/0;T=x;do A>=T.x&&T.x>=z&&A!==T.x&&Wu(I<$?A:P,I,z,$,I<$?P:A,I,T.x,T.y)&&(O=Math.abs(I-T.y)/(A-T.x),Yf(T,p)&&(O<G||O===G&&(T.x>x.x||T.x===x.x&&Jk(x,T)))&&(x=T,G=O)),T=T.next;while(T!==N);return x}(a,r);if(!l)return r;var h=aT(l,a);return pc(h,h.next),pc(l,l.next)}function Jk(a,r){return An(a.prev,a,r.prev)<0&&An(r.next,a,a.next)<0}function S0(a,r,l,h,p){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-l)*p|0)|a<<8))|a<<4))|a<<2))|a<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-h)*p|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Qk(a){var r=a,l=a;do(r.x<l.x||r.x===l.x&&r.y<l.y)&&(l=r),r=r.next;while(r!==a);return l}function Wu(a,r,l,h,p,_,x,T){return(p-x)*(r-T)>=(a-x)*(_-T)&&(a-x)*(h-T)>=(l-x)*(r-T)&&(l-x)*(_-T)>=(p-x)*(h-T)}function eD(a,r){return a.next.i!==r.i&&a.prev.i!==r.i&&!function(l,h){var p=l;do{if(p.i!==l.i&&p.next.i!==l.i&&p.i!==h.i&&p.next.i!==h.i&&oT(p,p.next,l,h))return!0;p=p.next}while(p!==l);return!1}(a,r)&&(Yf(a,r)&&Yf(r,a)&&function(l,h){var p=l,_=!1,x=(l.x+h.x)/2,T=(l.y+h.y)/2;do p.y>T!=p.next.y>T&&p.next.y!==p.y&&x<(p.next.x-p.x)*(T-p.y)/(p.next.y-p.y)+p.x&&(_=!_),p=p.next;while(p!==l);return _}(a,r)&&(An(a.prev,a,r.prev)||An(a,r.prev,r))||Vm(a,r)&&An(a.prev,a,a.next)>0&&An(r.prev,r,r.next)>0)}function An(a,r,l){return(r.y-a.y)*(l.x-r.x)-(r.x-a.x)*(l.y-r.y)}function Vm(a,r){return a.x===r.x&&a.y===r.y}function oT(a,r,l,h){var p=$m(An(a,r,l)),_=$m(An(a,r,h)),x=$m(An(l,h,a)),T=$m(An(l,h,r));return p!==_&&x!==T||!(p!==0||!jm(a,l,r))||!(_!==0||!jm(a,h,r))||!(x!==0||!jm(l,a,h))||!(T!==0||!jm(l,r,h))}function jm(a,r,l){return r.x<=Math.max(a.x,l.x)&&r.x>=Math.min(a.x,l.x)&&r.y<=Math.max(a.y,l.y)&&r.y>=Math.min(a.y,l.y)}function $m(a){return a>0?1:a<0?-1:0}function Yf(a,r){return An(a.prev,a,a.next)<0?An(a,r,a.next)>=0&&An(a,a.prev,r)>=0:An(a,r,a.prev)<0||An(a,a.next,r)<0}function aT(a,r){var l=new I0(a.i,a.x,a.y),h=new I0(r.i,r.x,r.y),p=a.next,_=r.prev;return a.next=r,r.prev=a,l.next=p,p.prev=l,h.next=l,l.prev=h,_.next=h,h.prev=_,h}function lT(a,r,l,h){var p=new I0(a,r,l);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function Kf(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function I0(a,r,l){this.i=a,this.x=r,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C0(a,r,l,h){for(var p=0,_=r,x=l-h;_<l;_+=h)p+=(a[x]-a[_])*(a[_+1]+a[x+1]),x=_;return p}function tD(a,r,l,h,p){cT(a,r,l,h||a.length-1,p||iD)}function cT(a,r,l,h,p){for(;h>l;){if(h-l>600){var _=h-l+1,x=r-l+1,T=Math.log(_),A=.5*Math.exp(2*T/3),I=.5*Math.sqrt(T*A*(_-A)/_)*(x-_/2<0?-1:1);cT(a,r,Math.max(l,Math.floor(r-x*A/_+I)),Math.min(h,Math.floor(r+(_-x)*A/_+I)),p)}var P=a[r],D=l,O=h;for(Jf(a,l,r),p(a[h],P)>0&&Jf(a,l,h);D<O;){for(Jf(a,D,O),D++,O--;p(a[D],P)<0;)D++;for(;p(a[O],P)>0;)O--}p(a[l],P)===0?Jf(a,l,O):Jf(a,++O,h),O<=r&&(l=O+1),r<=O&&(h=O-1)}}function Jf(a,r,l){var h=a[r];a[r]=a[l],a[l]=h}function iD(a,r){return a<r?-1:a>r?1:0}function M0(a,r){const l=a.length;if(l<=1)return[a];const h=[];let p,_;for(let x=0;x<l;x++){const T=tt(a[x]);T!==0&&(a[x].area=Math.abs(T),_===void 0&&(_=T<0),_===T<0?(p&&h.push(p),p=[a[x]]):p.push(a[x]))}if(p&&h.push(p),r>1)for(let x=0;x<h.length;x++)h[x].length<=r||(tD(h[x],r,1,h[x].length-1,nD),h[x]=h[x].slice(0,r));return h}function nD(a,r){return r.area-a.area}function R0(a,r,l){const h=l.patternDependencies;let p=!1;for(const _ of r){const x=_.paint.get(`${a}-pattern`);x.isConstant()||(p=!0);const T=x.constantOr(null);T&&(p=!0,h[T]=!0)}return p}function P0(a,r,l,h,p){const _=p.patternDependencies;for(const x of r){const T=x.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let A=T.evaluate({zoom:h},l,{},p.availableImages);A=A&&A.name?A.name:A,_[A]=!0,l.patterns[x.id]=A}}return l}({get exports(){return $u},set exports(a){$u=a}}).exports=Um,$u.default=Um,Um.deviation=function(a,r,l,h){var p=r&&r.length,_=Math.abs(C0(a,0,p?r[0]*l:a.length,l));if(p)for(var x=0,T=r.length;x<T;x++)_-=Math.abs(C0(a,r[x]*l,x<T-1?r[x+1]*l:a.length,l));var A=0;for(x=0;x<h.length;x+=3){var I=h[x]*l,P=h[x+1]*l,D=h[x+2]*l;A+=Math.abs((a[I]-a[D])*(a[P+1]-a[I+1])-(a[I]-a[P])*(a[D+1]-a[I+1]))}return _===0&&A===0?0:Math.abs((A-_)/_)},Um.flatten=function(a){for(var r=a[0][0].length,l={vertices:[],holes:[],dimensions:r},h=0,p=0;p<a.length;p++){for(var _=0;_<a[p].length;_++)for(var x=0;x<r;x++)l.vertices.push(a[p][_][x]);p>0&&l.holes.push(h+=a[p-1].length)}return l};class Wm{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Wt,this.indexArray=new or,this.indexArray2=new mo,this.programConfigurations=new oc(r.layers,r.zoom),this.segments=new En,this.segments2=new En,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=r.projection}populate(r,l,h,p){this.hasPattern=R0("fill",this.layers,l);const _=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:T,id:A,index:I,sourceLayerIndex:P}of r){const D=this.layers[0]._featureFilter.needGeometry,O=fc(T,D);if(!this.layers[0]._featureFilter.filter(new Re(this.zoom),O,h))continue;const N=_?_.evaluate(O,{},h,l.availableImages):void 0,z={id:A,properties:T.properties,type:T.type,sourceLayerIndex:P,index:I,geometry:D?O.geometry:ca(T,h,p),patterns:{},sortKey:N};x.push(z)}_&&x.sort((T,A)=>T.sortKey-A.sortKey);for(const T of x){const{geometry:A,index:I,sourceLayerIndex:P}=T;if(this.hasPattern){const D=P0("fill",this.layers,T,this.zoom,l);this.patternFeatures.push(D)}else this.addFeature(T,A,I,h,{},l.availableImages);l.featureIndex.insert(r[I].feature,A,I,P,this.index)}}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}addFeatures(r,l,h,p,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,l,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Hk),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,l,h,p,_,x=[]){for(const T of M0(l,500)){let A=0;for(const z of T)A+=z.length;const I=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray),P=I.vertexLength,D=[],O=[];for(const z of T){if(z.length===0)continue;z!==T[0]&&O.push(D.length/2);const $=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),G=$.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack(G+z.length-1,G),D.push(z[0].x),D.push(z[0].y);for(let se=1;se<z.length;se++)this.layoutVertexArray.emplaceBack(z[se].x,z[se].y),this.indexArray2.emplaceBack(G+se-1,G+se),D.push(z[se].x),D.push(z[se].y);$.vertexLength+=z.length,$.primitiveLength+=z.length}const N=$u(D,O);for(let z=0;z<N.length;z+=3)this.indexArray.emplaceBack(P+N[z],P+N[z+1],P+N[z+2]);I.vertexLength+=A,I.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,_,x,p)}}Dt(Wm,"FillBucket",{omit:["layers","patternFeatures"]});const rD=new ct({"fill-sort-key":new $e(Ze.layout_fill["fill-sort-key"])});var sD={paint:new ct({"fill-antialias":new Ce(Ze.paint_fill["fill-antialias"]),"fill-opacity":new $e(Ze.paint_fill["fill-opacity"]),"fill-color":new $e(Ze.paint_fill["fill-color"]),"fill-outline-color":new $e(Ze.paint_fill["fill-outline-color"]),"fill-translate":new Ce(Ze.paint_fill["fill-translate"]),"fill-translate-anchor":new Ce(Ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new $e(Ze.paint_fill["fill-pattern"])}),layout:rD};const oD=zt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),aD=zt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),lD=zt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:cD}=oD;var Hm={},uD=me,uT=Hu;function Hu(a,r,l,h,p){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=h,this._values=p,a.readFields(hD,this,r)}function hD(a,r,l){a==1?r.id=l.readVarint():a==2?function(h,p){for(var _=h.readVarint()+h.pos;h.pos<_;){var x=p._keys[h.readVarint()],T=p._values[h.readVarint()];p.properties[x]=T}}(l,r):a==3?r.type=l.readVarint():a==4&&(r._geometry=l.pos)}function fD(a){for(var r,l,h=0,p=0,_=a.length,x=_-1;p<_;x=p++)h+=((l=a[x]).x-(r=a[p]).x)*(r.y+l.y);return h}Hu.types=["Unknown","Point","LineString","Polygon"],Hu.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var r,l=a.readVarint()+a.pos,h=1,p=0,_=0,x=0,T=[];a.pos<l;){if(p<=0){var A=a.readVarint();h=7&A,p=A>>3}if(p--,h===1||h===2)_+=a.readSVarint(),x+=a.readSVarint(),h===1&&(r&&T.push(r),r=[]),r.push(new uD(_,x));else{if(h!==7)throw new Error("unknown command "+h);r&&r.push(r[0].clone())}}return r&&T.push(r),T},Hu.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var r=a.readVarint()+a.pos,l=1,h=0,p=0,_=0,x=1/0,T=-1/0,A=1/0,I=-1/0;a.pos<r;){if(h<=0){var P=a.readVarint();l=7&P,h=P>>3}if(h--,l===1||l===2)(p+=a.readSVarint())<x&&(x=p),p>T&&(T=p),(_+=a.readSVarint())<A&&(A=_),_>I&&(I=_);else if(l!==7)throw new Error("unknown command "+l)}return[x,A,T,I]},Hu.prototype.toGeoJSON=function(a,r,l){var h,p,_=this.extent*Math.pow(2,l),x=this.extent*a,T=this.extent*r,A=this.loadGeometry(),I=Hu.types[this.type];function P(N){for(var z=0;z<N.length;z++){var $=N[z];N[z]=[360*($.x+x)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+T)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var D=[];for(h=0;h<A.length;h++)D[h]=A[h][0];P(A=D);break;case 2:for(h=0;h<A.length;h++)P(A[h]);break;case 3:for(A=function(N){var z=N.length;if(z<=1)return[N];for(var $,G,se=[],pe=0;pe<z;pe++){var ee=fD(N[pe]);ee!==0&&(G===void 0&&(G=ee<0),G===ee<0?($&&se.push($),$=[N[pe]]):$.push(N[pe]))}return $&&se.push($),se}(A),h=0;h<A.length;h++)for(p=0;p<A[h].length;p++)P(A[h][p])}A.length===1?A=A[0]:I="Multi"+I;var O={type:"Feature",geometry:{type:I,coordinates:A},properties:this.properties};return"id"in this&&(O.id=this.id),O};var dD=uT,hT=fT;function fT(a,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(pD,this,r),this.length=this._features.length}function pD(a,r,l){a===15?r.version=l.readVarint():a===1?r.name=l.readString():a===5?r.extent=l.readVarint():a===2?r._features.push(l.pos):a===3?r._keys.push(l.readString()):a===4&&r._values.push(function(h){for(var p=null,_=h.readVarint()+h.pos;h.pos<_;){var x=h.readVarint()>>3;p=x===1?h.readString():x===2?h.readFloat():x===3?h.readDouble():x===4?h.readVarint64():x===5?h.readVarint():x===6?h.readSVarint():x===7?h.readBoolean():null}return p}(l))}fT.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var r=this._pbf.readVarint()+this._pbf.pos;return new dD(this._pbf,r,this.extent,this._keys,this._values)};var mD=hT;function gD(a,r,l){if(a===3){var h=new mD(l,l.readVarint()+l.pos);h.length&&(r[h.name]=h)}}var k0=Hm.VectorTile=function(a,r){this.layers=a.readFields(gD,{},r)},Xm=Hm.VectorTileFeature=uT;function qm(a,r,l,h){const p=[],_=h===0?(x,T,A,I,P,D)=>{x.push(new me(D,A+(D-T)/(I-T)*(P-A)))}:(x,T,A,I,P,D)=>{x.push(new me(T+(D-A)/(P-A)*(I-T),D))};for(const x of a){const T=[];for(const A of x){if(A.length<=2)continue;const I=[];for(let O=0;O<A.length-1;O++){const N=A[O].x,z=A[O].y,$=A[O+1].x,G=A[O+1].y,se=h===0?N:z,pe=h===0?$:G;se<r?pe>r&&_(I,N,z,$,G,r):se>l?pe<l&&_(I,N,z,$,G,l):I.push(A[O]),pe<r&&se>=r&&_(I,N,z,$,G,r),pe>l&&se<=l&&_(I,N,z,$,G,l)}let P=A[A.length-1];const D=h===0?P.x:P.y;D>=r&&D<=l&&I.push(P),I.length&&(P=I[I.length-1],I[0].x===P.x&&I[0].y===P.y||I.push(I[0]),T.push(I))}T.length&&p.push(T)}return p}Hm.VectorTileLayer=hT;const _D=Xm.types,yD=Math.pow(2,13);function Qf(a,r,l,h,p,_,x,T){a.emplaceBack((r<<1)+x,(l<<1)+_,(Math.floor(h*yD)<<1)+p,Math.round(T))}function ed(a,r,l){a.emplaceBack(r.x,r.y,r.z,l[0]*16384,l[1]*16384,l[2]*16384)}class dT{constructor(){this.acc=new me(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new me(r.x,r.y),this.max=new me(r.x,r.y))}append(r,l){this.currentPolyCount.edges++,this.acc._add(r);const h=this.min,p=this.max;r.x<h.x?h.x=r.x:r.x>p.x&&(p.x=r.x),r.y<h.y?h.y=r.y:r.y>p.y&&(p.y=r.y),((r.x===0||r.x===Jt)&&r.x===l.x)!=((r.y===0||r.y===Jt)&&r.y===l.y)&&this.processBorderOverlap(r,l),l.x<0!=r.x<0&&this.addBorderIntersection(0,vi(l.y,r.y,(0-l.x)/(r.x-l.x))),l.x>Jt!=r.x>Jt&&this.addBorderIntersection(1,vi(l.y,r.y,(Jt-l.x)/(r.x-l.x))),l.y<0!=r.y<0&&this.addBorderIntersection(2,vi(l.x,r.x,(0-l.y)/(r.y-l.y))),l.y>Jt!=r.y>Jt&&this.addBorderIntersection(3,vi(l.x,r.x,(Jt-l.y)/(r.y-l.y)))}addBorderIntersection(r,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[r];l<h[0]&&(h[0]=l),l>h[1]&&(h[1]=l)}processBorderOverlap(r,l){if(r.x===l.x){if(r.y===l.y)return;const h=r.x===0?0:1;this.addBorderIntersection(h,l.y),this.addBorderIntersection(h,r.y)}else{const h=r.y===0?2:3;this.addBorderIntersection(h,l.x),this.addBorderIntersection(h,r.x)}}centroid(){const r=this.polyCount.reduce((l,h)=>l+h.edges,0);return r!==0?this.acc.div(r)._round():new me(0,0)}span(){return new me(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,l)=>r+ +(l[0]!==Number.MAX_VALUE),0)}}class td{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.layoutVertexArray=new Ri,this.centroidVertexArray=new pw,this.indexArray=new or,this.programConfigurations=new oc(r.layers,r.zoom),this.segments=new En,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=r.enableTerrain}populate(r,l,h,p){this.features=[],this.hasPattern=R0("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(_){const x=Math.exp(Math.PI*(1-_.y/(1<<_.z)*2));return 80150034*x/(x*x+1)/Jt/(1<<_.z)}(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:_,id:x,index:T,sourceLayerIndex:A}of r){const I=this.layers[0]._featureFilter.needGeometry,P=fc(_,I);if(!this.layers[0]._featureFilter.filter(new Re(this.zoom),P,h))continue;const D={id:x,sourceLayerIndex:A,index:T,geometry:I?P.geometry:ca(_,h,p),properties:_.properties,type:_.type,patterns:{}},O=this.layoutVertexArray.length;this.hasPattern?this.features.push(P0("fill-extrusion",this.layers,D,this.zoom,l)):this.addFeature(D,D.geometry,T,h,{},l.availableImages,p),l.featureIndex.insert(_,D.geometry,T,A,this.index,O)}this.sortBorders()}addFeatures(r,l,h,p,_){for(const x of this.features){const{geometry:T}=x;this.addFeature(x,T,x.index,l,h,p,_)}this.sortBorders()}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,cD),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,lD.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,aD.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,h,p,_,x,T){const A=[new me(0,0),new me(Jt,Jt)],I=T.projection,P=I.name==="globe",D=this.enableTerrain&&!P?new dT:null,O=_D[r.type]==="Polygon";P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ss);const N=M0(l,500);for(let se=N.length-1;se>=0;se--){const pe=N[se];(pe.length===0||(z=pe[0]).every(ee=>ee.x<=0)||z.every(ee=>ee.x>=Jt)||z.every(ee=>ee.y<=0)||z.every(ee=>ee.y>=Jt))&&N.splice(se,1)}var z;let $;if(P)$=vT(N,A,p);else{$=[];for(const se of N)$.push({polygon:se,bounds:A})}const G=O?this.edgeRadius:0;for(const{polygon:se,bounds:pe}of $){let ee=0,de=0;for(const ge of se)O&&!ge[0].equals(ge[ge.length-1])&&ge.push(ge[0]),de+=O?ge.length-1:ge.length;const ye=this.segments.prepareSegment((O?5:4)*de,this.layoutVertexArray,this.indexArray);if(O){const ge=[],Ve=[];ee=ye.vertexLength;for(const Ye of se){let ft,He;Ye.length&&Ye!==se[0]&&Ve.push(ge.length/2),ft=Ye[1].sub(Ye[0])._perp()._unit();for(let Je=1;Je<Ye.length;Je++){const et=Ye[Je],at=Ye[Je===Ye.length-1?1:Je+1];let{x:dt,y:Xe}=et;if(G){He=at.sub(et)._perp()._unit();const wt=ft.add(He)._unit(),qt=G*Math.min(4,1/(ft.x*wt.x+ft.y*wt.y));dt+=qt*wt.x,Xe+=qt*wt.y,ft=He}Qf(this.layoutVertexArray,dt,Xe,0,0,1,1,0),ye.vertexLength++,ge.push(et.x,et.y),P&&ed(this.layoutVertexExtArray,I.projectTilePoint(dt,Xe,p),I.upVector(p,dt,Xe))}}const Ne=$u(ge,Ve);for(let Ye=0;Ye<Ne.length;Ye+=3)this.indexArray.emplaceBack(ee+Ne[Ye],ee+Ne[Ye+2],ee+Ne[Ye+1]),ye.primitiveLength++}for(const ge of se){D&&ge.length&&D.startRing(ge[0]);let Ve,Ne,Ye,ft=ge.length>4&&_T(ge[ge.length-2],ge[0],ge[1]),He=G?xD(ge[ge.length-2],ge[0],ge[1],G):0;Ne=ge[1].sub(ge[0])._perp()._unit();let Je=!0;for(let et=1,at=0;et<ge.length;et++){let dt=ge[et-1],Xe=ge[et];const wt=ge[et===ge.length-1?1:et+1];if(D&&O&&D.currentPolyCount.top++,gT(Xe,dt,pe)){G&&(Ne=wt.sub(Xe)._perp()._unit(),Je=!Je);continue}D&&D.append(Xe,dt);const qt=Xe.sub(dt)._perp(),St=qt.x/(Math.abs(qt.x)+Math.abs(qt.y)),Ft=qt.y>0?1:0,Tt=dt.dist(Xe);if(at+Tt>32768&&(at=0),G){Ye=wt.sub(Xe)._perp()._unit();let ai=mT(dt,Xe,wt,pT(Ne,Ye),G);isNaN(ai)&&(ai=0);const Yt=Xe.sub(dt)._unit();dt=dt.add(Yt.mult(He))._round(),Xe=Xe.add(Yt.mult(-ai))._round(),He=ai,Ne=Ye}const Zt=ye.vertexLength,fi=ge.length>4&&_T(dt,Xe,wt);let ci=yT(at,ft,Je);if(Qf(this.layoutVertexArray,dt.x,dt.y,St,Ft,0,0,ci),Qf(this.layoutVertexArray,dt.x,dt.y,St,Ft,0,1,ci),at+=Tt,ci=yT(at,fi,!Je),ft=fi,Qf(this.layoutVertexArray,Xe.x,Xe.y,St,Ft,0,0,ci),Qf(this.layoutVertexArray,Xe.x,Xe.y,St,Ft,0,1,ci),ye.vertexLength+=4,this.indexArray.emplaceBack(Zt+0,Zt+1,Zt+2),this.indexArray.emplaceBack(Zt+1,Zt+3,Zt+2),ye.primitiveLength+=2,G){const ai=ee+(et===1?ge.length-2:et-2),Yt=et===1?ee:ai+1;if(this.indexArray.emplaceBack(Zt+1,ai,Zt+3),this.indexArray.emplaceBack(ai,Yt,Zt+3),ye.primitiveLength+=2,Ve===void 0&&(Ve=Zt),!gT(wt,ge[et],pe)){const Di=et===ge.length-1?Ve:ye.vertexLength;this.indexArray.emplaceBack(Zt+2,Zt+3,Di),this.indexArray.emplaceBack(Zt+3,Di+1,Di),this.indexArray.emplaceBack(Zt+3,Yt,Di+1),ye.primitiveLength+=3}Je=!Je}if(P){const ai=this.layoutVertexExtArray,Yt=I.projectTilePoint(dt.x,dt.y,p),Di=I.projectTilePoint(Xe.x,Xe.y,p),ni=I.upVector(p,dt.x,dt.y),di=I.upVector(p,Xe.x,Xe.y);ed(ai,Yt,ni),ed(ai,Yt,ni),ed(ai,Di,di),ed(ai,Di,di)}}O&&(ee+=ge.length-1)}}if(D&&D.polyCount.length>0){if(D.borders){D.vertexArrayOffset=this.centroidVertexArray.length;const se=D.borders,pe=this.featuresOnBorder.push(D)-1;for(let ee=0;ee<4;ee++)se[ee][0]!==Number.MAX_VALUE&&this.borders[ee].push(pe)}this.encodeCentroid(D.borders?void 0:D.centroid(),D)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,_,x,p)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((l,h)=>this.featuresOnBorder[l].borders[r][0]-this.featuresOnBorder[h].borders[r][0])}encodeCentroid(r,l,h=!0){let p,_;if(r)if(r.y!==0){const T=l.span()._mult(this.tileToMeter);p=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(T.x/10)),_=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(T.y/10))}else p=Math.ceil(7*(r.x+450)),_=0;else p=0,_=+h;let x=h?this.centroidVertexArray.length:l.vertexArrayOffset;for(const T of l.polyCount){h&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*T.edges+T.top);for(let A=0;A<T.top;A++)this.centroidVertexArray.emplace(x++,p,_);for(let A=0;A<2*T.edges;A++)this.centroidVertexArray.emplace(x++,0,_),this.centroidVertexArray.emplace(x++,p,_)}}}function pT(a,r){const l=a.add(r)._unit();return a.x*l.x+a.y*l.y}function xD(a,r,l,h){const p=r.sub(a)._perp()._unit(),_=l.sub(r)._perp()._unit();return mT(a,r,l,pT(p,_),h)}function mT(a,r,l,h,p){const _=Math.sqrt(1-h*h);return Math.min(a.dist(r)/3,r.dist(l)/3,p*_/h)}function gT(a,r,l){return a.x<l[0].x&&r.x<l[0].x||a.x>l[1].x&&r.x>l[1].x||a.y<l[0].y&&r.y<l[0].y||a.y>l[1].y&&r.y>l[1].y}function _T(a,r,l){if(a.x<0||a.x>=Jt||r.x<0||r.x>=Jt||l.x<0||l.x>=Jt)return!1;const h=l.sub(r),p=h.perp(),_=a.sub(r);return(h.x*_.x+h.y*_.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(_.x*_.x+_.y*_.y))>-.866&&p.x*_.x+p.y*_.y<0}function yT(a,r,l){const h=r?2|a:-3&a;return l?1|h:-2&h}function xT(){const a=Math.PI/32,r=Math.tan(a),l=Gf;return l*Math.sqrt(1+2*r*r)-l}function vT(a,r,l){const h=1<<l.z,p=as(l.x/h),_=as((l.x+1)/h),x=ar(l.y/h),T=ar((l.y+1)/h);return function(A,I,P,D,O=0,N){const z=[];if(!A.length||!P||!D)return z;const $=(ge,Ve)=>{for(const Ne of ge)z.push({polygon:Ne,bounds:Ve})},G=Math.ceil(Math.log2(P)),se=Math.ceil(Math.log2(D)),pe=G-se,ee=[];for(let ge=0;ge<Math.abs(pe);ge++)ee.push(pe>0?0:1);for(let ge=0;ge<Math.min(G,se);ge++)ee.push(0),ee.push(1);let de=A;if(de=qm(de,I[0].y-O,I[1].y+O,1),de=qm(de,I[0].x-O,I[1].x+O,0),!de.length)return z;const ye=[];for(ee.length?ye.push({polygons:de,bounds:I,depth:0}):$(de,I);ye.length;){const ge=ye.pop(),Ve=ge.depth,Ne=ee[Ve],Ye=ge.bounds[0],ft=ge.bounds[1],He=Ne===0?Ye.x:Ye.y,Je=Ne===0?ft.x:ft.y,et=N?N(Ne,He,Je):.5*(He+Je),at=qm(ge.polygons,He-O,et+O,Ne),dt=qm(ge.polygons,et-O,Je+O,Ne);if(at.length){const Xe=[Ye,new me(Ne===0?et:ft.x,Ne===1?et:ft.y)];ee.length>Ve+1?ye.push({polygons:at,bounds:Xe,depth:Ve+1}):$(at,Xe)}if(dt.length){const Xe=[new me(Ne===0?et:Ye.x,Ne===1?et:Ye.y),ft];ee.length>Ve+1?ye.push({polygons:dt,bounds:Xe,depth:Ve+1}):$(dt,Xe)}}return z}(a,r,Math.ceil((_-p)/11.25),Math.ceil((x-T)/11.25),1,(A,I,P)=>{if(A===0)return .5*(I+P);{const D=ar((l.y+I/Jt)/h);return(vo(.5*(ar((l.y+P/Jt)/h)+D))*h-l.y)*Jt}})}Dt(td,"FillExtrusionBucket",{omit:["layers","features"]}),Dt(dT,"PartMetadata");const vD=new ct({"fill-extrusion-edge-radius":new Ce(Ze["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var bD={paint:new ct({"fill-extrusion-opacity":new Ce(Ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $e(Ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ce(Ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ce(Ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $e(Ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new $e(Ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $e(Ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ce(Ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ce(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ce(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:vD};function bT(a,r,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[a*h-2*Math.PI*6378137/2,r*h-2*Math.PI*6378137/2]}class Gm{constructor(r,l,h){this.z=r,this.x=l,this.y=h,this.key=id(0,r,r,l,h)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,l){const h=function(_,x,T){var A=bT(256*_,256*(x=Math.pow(2,T)-x-1),T),I=bT(256*(_+1),256*(x+1),T);return A[0]+","+A[1]+","+I[0]+","+I[1]}(this.x,this.y,this.z),p=function(_,x,T){let A,I="";for(let P=_;P>0;P--)A=1<<P-1,I+=(x&A?1:0)+(T&A?2:0);return I}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class wT{constructor(r,l){this.wrap=r,this.canonical=l,this.key=id(r,l.z,l.z,l.x,l.y)}}class Er{constructor(r,l,h,p,_){this.overscaledZ=r,this.wrap=l,this.canonical=new Gm(h,+p,+_),this.key=l===0&&r===h?this.canonical.key:id(l,r,h,p,_)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const l=this.canonical.z-r;return r>this.canonical.z?new Er(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Er(r,this.wrap,r,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(r,l=!0){if(this.overscaledZ===r&&l)return this.key;if(r>this.canonical.z)return id(this.wrap*+l,r,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-r;return id(this.wrap*+l,r,r,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const l=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>l&&r.canonical.y===this.canonical.y>>l}children(r){if(this.overscaledZ>=r)return[new Er(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,p=2*this.canonical.y;return[new Er(l,this.wrap,l,h,p),new Er(l,this.wrap,l,h+1,p),new Er(l,this.wrap,l,h,p+1),new Er(l,this.wrap,l,h+1,p+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Er(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Er(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new wT(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function id(a,r,l,h,p){const _=1<<Math.min(l,22);let x=_*(p%_)+h%_;return a&&l<22&&(x+=_*_*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*x+l)+(r-l)}Dt(Gm,"CanonicalTileID"),Dt(Er,"OverscaledTileID",{omit:["projMatrix"]});class Xu extends me{constructor(r,l,h){super(r,l),this.z=h}}function nd(a,r){return a.x*r.x+a.y*r.y}function TT(a,r){if(a.length===1){let l=0;const h=r[l++];let p;for(;!p||h.equals(p);)if(p=r[l++],!p)return 1/0;for(;l<r.length;l++){const _=r[l],x=a[0],T=p.sub(h),A=_.sub(h),I=x.sub(h),P=nd(T,T),D=nd(T,A),O=nd(A,A),N=nd(I,T),z=nd(I,A),$=P*O-D*D,G=(O*N-D*z)/$,se=(P*z-D*N)/$,pe=h.z*(1-G-se)+p.z*G+_.z*se;if(isFinite(pe))return pe}return 1/0}{let l=1/0;for(const h of r)l=Math.min(l,h.z);return l}}function ET(a,r,l,h,p,_,x,T){const A=x*p.getElevationAt(a,r,!0,!0),I=_[0]!==0,P=I?_[1]===0?x*(_[0]/7-450):x*function(D,O,N){const z=Math.floor(O[0]/8),$=Math.floor(O[1]/8),G=10*(O[0]-8*z),se=10*(O[1]-8*$),pe=D.getElevationAt(z,$,!0,!0),ee=D.getMeterToDEM(N),de=Math.floor(.5*(G*ee-1)),ye=Math.floor(.5*(se*ee-1)),ge=D.tileCoordToPixel(z,$),Ve=2*de+1,Ne=2*ye+1,Ye=function(dt,Xe,wt,qt,St){return[dt.getElevationAtPixel(Xe,wt,!0),dt.getElevationAtPixel(Xe+St,wt,!0),dt.getElevationAtPixel(Xe,wt+St,!0),dt.getElevationAtPixel(Xe+qt,wt+St,!0)]}(D,ge.x-de,ge.y-ye,Ve,Ne),ft=Math.abs(Ye[0]-Ye[1]),He=Math.abs(Ye[2]-Ye[3]),Je=Math.abs(Ye[0]-Ye[2])+Math.abs(Ye[1]-Ye[3]),et=Math.min(.25,.5*ee*(ft+He)/Ve),at=Math.min(.25,.5*ee*Je/Ne);return pe+Math.max(et*G,at*se)}(p,_,T):A;return{base:A+(l===0)?-1:l,top:I?Math.max(P+h,A+l+2):A+h}}const wD=zt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:TD}=wD,ED=zt([{name:"a_packed",components:4,type:"Float32"}]),{members:AD}=ED,SD=Xm.types,ID=Math.cos(Math.PI/180*37.5);class Zm{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Wi,this.layoutVertexArray2=new Vi,this.indexArray=new or,this.programConfigurations=new oc(r.layers,r.zoom),this.segments=new En,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,h,p){this.hasPattern=R0("line",this.layers,l);const _=this.layers[0].layout.get("line-sort-key"),x=[];for(const{feature:P,id:D,index:O,sourceLayerIndex:N}of r){const z=this.layers[0]._featureFilter.needGeometry,$=fc(P,z);if(!this.layers[0]._featureFilter.filter(new Re(this.zoom),$,h))continue;const G=_?_.evaluate($,{},h):void 0,se={id:D,properties:P.properties,type:P.type,sourceLayerIndex:N,index:O,geometry:z?$.geometry:ca(P,h,p),patterns:{},sortKey:G};x.push(se)}_&&x.sort((P,D)=>P.sortKey-D.sortKey);const{lineAtlas:T,featureIndex:A}=l,I=this.addConstantDashes(T);for(const P of x){const{geometry:D,index:O,sourceLayerIndex:N}=P;if(I&&this.addFeatureDashes(P,T),this.hasPattern){const z=P0("line",this.layers,P,this.zoom,l);this.patternFeatures.push(z)}else this.addFeature(P,D,O,h,T.positions,l.availableImages);A.insert(r[O].feature,D,O,N,this.index)}}addConstantDashes(r){let l=!1;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if(p.kind!=="constant"||_.kind!=="constant")l=!0;else{const x=_.value,T=p.value;if(!T)continue;r.addDash(T,x)}}return l}addFeatureDashes(r,l){const h=this.zoom;for(const p of this.layers){const _=p.paint.get("line-dasharray").value,x=p.layout.get("line-cap").value;if(_.kind==="constant"&&x.kind==="constant")continue;let T,A;if(_.kind==="constant"){if(T=_.value,!T)continue}else T=_.evaluate({zoom:h},r);A=x.kind==="constant"?x.value:x.evaluate({zoom:h},r),l.addDash(T,A),r.patterns[p.id]=l.getKey(T,A)}}update(r,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,h,p)}addFeatures(r,l,h,p,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,l,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,AD)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,TD),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,l,h,p,_,x){const T=this.layers[0].layout,A=T.get("line-join").evaluate(r,{}),I=T.get("line-cap").evaluate(r,{}),P=T.get("line-miter-limit"),D=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const O of l)this.addLine(O,r,A,I,P,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,_,x,p)}addLine(r,l,h,p,_,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<r.length-1;se++)this.totalDistance+=r[se].dist(r[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=SD[l.type]==="Polygon";let A=r.length;for(;A>=2&&r[A-1].equals(r[A-2]);)A--;let I=0;for(;I<A-1&&r[I].equals(r[I+1]);)I++;if(A<(T?3:2))return;h==="bevel"&&(_=1.05);const P=this.overscaling<=16?122880/(512*this.overscaling):0,D=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let O,N,z,$,G;this.e1=this.e2=-1,T&&(O=r[A-2],G=r[I].sub(O)._unit()._perp());for(let se=I;se<A;se++){if(z=se===A-1?T?r[I+1]:void 0:r[se+1],z&&r[se].equals(z))continue;G&&($=G),O&&(N=O),O=r[se],G=z?z.sub(O)._unit()._perp():$,$=$||G;let pe=$.add(G);pe.x===0&&pe.y===0||pe._unit();const ee=$.x*G.x+$.y*G.y,de=pe.x*G.x+pe.y*G.y,ye=de!==0?1/de:1/0,ge=2*Math.sqrt(2-2*de),Ve=de<ID&&N&&z,Ne=$.x*G.y-$.y*G.x>0;if(Ve&&se>I){const He=O.dist(N);if(He>2*P){const Je=O.sub(O.sub(N)._mult(P/He)._round());this.updateDistance(N,Je),this.addCurrentVertex(Je,$,0,0,D),N=Je}}const Ye=N&&z;let ft=Ye?h:T?"butt":p;if(Ye&&ft==="round"&&(ye<x?ft="miter":ye<=2&&(ft="fakeround")),ft==="miter"&&ye>_&&(ft="bevel"),ft==="bevel"&&(ye>2&&(ft="flipbevel"),ye<_&&(ft="miter")),N&&this.updateDistance(N,O),ft==="miter")pe._mult(ye),this.addCurrentVertex(O,pe,0,0,D);else if(ft==="flipbevel"){if(ye>100)pe=G.mult(-1);else{const He=ye*$.add(G).mag()/$.sub(G).mag();pe._perp()._mult(He*(Ne?-1:1))}this.addCurrentVertex(O,pe,0,0,D),this.addCurrentVertex(O,pe.mult(-1),0,0,D)}else if(ft==="bevel"||ft==="fakeround"){const He=-Math.sqrt(ye*ye-1),Je=Ne?He:0,et=Ne?0:He;if(N&&this.addCurrentVertex(O,$,Je,et,D),ft==="fakeround"){const at=Math.round(180*ge/Math.PI/20);for(let dt=1;dt<at;dt++){let Xe=dt/at;if(Xe!==.5){const qt=Xe-.5;Xe+=Xe*qt*(Xe-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*qt*qt+(.848013+ee*(.215638*ee-1.06021)))}const wt=G.sub($)._mult(Xe)._add($)._unit()._mult(Ne?-1:1);this.addHalfVertex(O,wt.x,wt.y,!1,Ne,0,D)}}z&&this.addCurrentVertex(O,G,-Je,-et,D)}else if(ft==="butt")this.addCurrentVertex(O,pe,0,0,D);else if(ft==="square"){const He=N?1:-1;N||this.addCurrentVertex(O,pe,He,He,D),this.addCurrentVertex(O,pe,0,0,D),N&&this.addCurrentVertex(O,pe,He,He,D)}else ft==="round"&&(N&&(this.addCurrentVertex(O,$,0,0,D),this.addCurrentVertex(O,$,1,1,D,!0)),z&&(this.addCurrentVertex(O,G,-1,-1,D,!0),this.addCurrentVertex(O,G,0,0,D)));if(Ve&&se<A-1){const He=O.dist(z);if(He>2*P){const Je=O.add(z.sub(O)._mult(P/He)._round());this.updateDistance(O,Je),this.addCurrentVertex(Je,G,0,0,D),O=Je}}}}addCurrentVertex(r,l,h,p,_,x=!1){const T=l.y*p-l.x,A=-l.y-l.x*p;this.addHalfVertex(r,l.x+l.y*h,l.y-l.x*h,x,!1,h,_),this.addHalfVertex(r,T,A,x,!0,-p,_)}addHalfVertex({x:r,y:l},h,p,_,x,T,A){this.layoutVertexArray.emplaceBack((r<<1)+(_?1:0),(l<<1)+(x?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(T===0?0:T<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const I=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),A.primitiveLength++),x?this.e2=I:this.e1=I}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,l){this.distance+=r.dist(l),this.updateScaledDistance()}}Dt(Zm,"LineBucket",{omit:["layers","patternFeatures"]});const CD=new ct({"line-cap":new $e(Ze.layout_line["line-cap"]),"line-join":new $e(Ze.layout_line["line-join"]),"line-miter-limit":new Ce(Ze.layout_line["line-miter-limit"]),"line-round-limit":new Ce(Ze.layout_line["line-round-limit"]),"line-sort-key":new $e(Ze.layout_line["line-sort-key"])});var AT={paint:new ct({"line-opacity":new $e(Ze.paint_line["line-opacity"]),"line-color":new $e(Ze.paint_line["line-color"]),"line-translate":new Ce(Ze.paint_line["line-translate"]),"line-translate-anchor":new Ce(Ze.paint_line["line-translate-anchor"]),"line-width":new $e(Ze.paint_line["line-width"]),"line-gap-width":new $e(Ze.paint_line["line-gap-width"]),"line-offset":new $e(Ze.paint_line["line-offset"]),"line-blur":new $e(Ze.paint_line["line-blur"]),"line-dasharray":new $e(Ze.paint_line["line-dasharray"]),"line-pattern":new $e(Ze.paint_line["line-pattern"]),"line-gradient":new it(Ze.paint_line["line-gradient"]),"line-trim-offset":new Ce(Ze.paint_line["line-trim-offset"])}),layout:CD};const ST=new class extends $e{possiblyEvaluate(a,r){return r=new Re(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(a,r)}evaluate(a,r,l,h){return r=yi({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(a,r,l,h)}}(AT.paint.properties["line-width"].specification);function IT(a,r){return r>0?r+2*a:a}ST.useIntegerZoom=!0;const MD=zt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),RD=zt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),PD=zt([{name:"a_projected_pos",components:4,type:"Float32"}],4);zt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const kD=zt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),DD=zt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);zt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const CT=zt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),OD=zt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);zt([{name:"triangle",components:3,type:"Uint16"}]),zt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),zt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),zt([{type:"Float32",name:"offsetX"}]),zt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var lr=24;const bo=128;function D0(a,r){const{expression:l}=r;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Re(a+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:p}=l;let _=0;for(;_<h.length&&h[_]<=a;)_++;_=Math.max(0,_-1);let x=_;for(;x<h.length&&h[x]<a+1;)x++;x=Math.min(h.length-1,x);const T=h[_],A=h[x];return l.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:A,interpolationType:p}:{kind:"camera",minZoom:T,maxZoom:A,minSize:l.evaluate(new Re(T)),maxSize:l.evaluate(new Re(A)),interpolationType:p}}}function Ym(a,{uSize:r,uSizeT:l},{lowerSize:h,upperSize:p}){return a.kind==="source"?h/bo:a.kind==="composite"?vi(h/bo,p/bo,l):r}function qu(a,r){let l=0,h=0;if(a.kind==="constant")h=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:p,minZoom:_,maxZoom:x}=a,T=p?xt(bs.interpolationFactor(p,r,_,x),0,1):0;a.kind==="camera"?h=vi(a.minSize,a.maxSize,T):l=T}return{uSizeT:l,uSize:h}}var LD=Object.freeze({__proto__:null,getSizeData:D0,evaluateSizeForFeature:Ym,evaluateSizeForZoom:qu,SIZE_PACK_FACTOR:bo});function BD(a,r,l){return a.sections.forEach(h=>{h.text=function(p,_,x){const T=_.layout.get("text-transform").evaluate(x,{});return T==="uppercase"?p=p.toLocaleUpperCase():T==="lowercase"&&(p=p.toLocaleLowerCase()),Ee.applyArabicShaping&&(p=Ee.applyArabicShaping(p)),p}(h.text,r,l)}),a}const rd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function FD(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}function ND(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}var sd=Hi,MT=function(a,r,l,h,p){var _,x,T=8*p-h-1,A=(1<<T)-1,I=A>>1,P=-7,D=p-1,O=-1,N=a[r+D];for(D+=O,_=N&(1<<-P)-1,N>>=-P,P+=T;P>0;_=256*_+a[r+D],D+=O,P-=8);for(x=_&(1<<-P)-1,_>>=-P,P+=h;P>0;x=256*x+a[r+D],D+=O,P-=8);if(_===0)_=1-I;else{if(_===A)return x?NaN:1/0*(N?-1:1);x+=Math.pow(2,h),_-=I}return(N?-1:1)*x*Math.pow(2,_-h)},RT=function(a,r,l,h,p,_){var x,T,A,I=8*_-p-1,P=(1<<I)-1,D=P>>1,O=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,N=0,z=1,$=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(T=isNaN(r)?1:0,x=P):(x=Math.floor(Math.log(r)/Math.LN2),r*(A=Math.pow(2,-x))<1&&(x--,A*=2),(r+=x+D>=1?O/A:O*Math.pow(2,1-D))*A>=2&&(x++,A/=2),x+D>=P?(T=0,x=P):x+D>=1?(T=(r*A-1)*Math.pow(2,p),x+=D):(T=r*Math.pow(2,D-1)*Math.pow(2,p),x=0));p>=8;a[l+N]=255&T,N+=z,T/=256,p-=8);for(x=x<<p|T,I+=p;I>0;a[l+N]=255&x,N+=z,x/=256,I-=8);a[l+N-z]|=128*$};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Hi(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Hi.Varint=0,Hi.Fixed64=1,Hi.Bytes=2,Hi.Fixed32=5;var O0=4294967296,PT=1/O0,kT=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ha(a){return a.type===Hi.Bytes?a.readVarint()+a.pos:a.pos+1}function Gu(a,r,l){return l?4294967296*r+(a>>>0):4294967296*(r>>>0)+(a>>>0)}function DT(a,r,l){var h=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));l.realloc(h);for(var p=l.pos-1;p>=a;p--)l.buf[p+h]=l.buf[p]}function zD(a,r){for(var l=0;l<a.length;l++)r.writeVarint(a[l])}function UD(a,r){for(var l=0;l<a.length;l++)r.writeSVarint(a[l])}function VD(a,r){for(var l=0;l<a.length;l++)r.writeFloat(a[l])}function jD(a,r){for(var l=0;l<a.length;l++)r.writeDouble(a[l])}function $D(a,r){for(var l=0;l<a.length;l++)r.writeBoolean(a[l])}function WD(a,r){for(var l=0;l<a.length;l++)r.writeFixed32(a[l])}function HD(a,r){for(var l=0;l<a.length;l++)r.writeSFixed32(a[l])}function XD(a,r){for(var l=0;l<a.length;l++)r.writeFixed64(a[l])}function qD(a,r){for(var l=0;l<a.length;l++)r.writeSFixed64(a[l])}function Km(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+16777216*a[r+3]}function Zu(a,r,l){a[l]=r,a[l+1]=r>>>8,a[l+2]=r>>>16,a[l+3]=r>>>24}function OT(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+(a[r+3]<<24)}function GD(a,r,l){r.glyphs=[],a===1&&l.readMessage(ZD,r)}function ZD(a,r,l){if(a===3){const{id:h,bitmap:p,width:_,height:x,left:T,top:A,advance:I}=l.readMessage(YD,{});r.glyphs.push({id:h,bitmap:new ua({width:_+6,height:x+6},p),metrics:{width:_,height:x,left:T,top:A,advance:I}})}else a===4?r.ascender=l.readSVarint():a===5&&(r.descender=l.readSVarint())}function YD(a,r,l){a===1?r.id=l.readVarint():a===2?r.bitmap=l.readBytes():a===3?r.width=l.readVarint():a===4?r.height=l.readVarint():a===5?r.left=l.readSVarint():a===6?r.top=l.readSVarint():a===7&&(r.advance=l.readVarint())}function L0(a){let r=0,l=0;for(const x of a)r+=x.w*x.h,l=Math.max(l,x.w);a.sort((x,T)=>T.h-x.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),l),h:1/0}];let p=0,_=0;for(const x of a)for(let T=h.length-1;T>=0;T--){const A=h[T];if(!(x.w>A.w||x.h>A.h)){if(x.x=A.x,x.y=A.y,_=Math.max(_,x.y+x.h),p=Math.max(p,x.x+x.w),x.w===A.w&&x.h===A.h){const I=h.pop();T<h.length&&(h[T]=I)}else x.h===A.h?(A.x+=x.w,A.w-=x.w):x.w===A.w?(A.y+=x.h,A.h-=x.h):(h.push({x:A.x+x.w,y:A.y,w:A.w-x.w,h:x.h}),A.y+=x.h,A.h-=x.h);break}}return{w:p,h:_,fill:r/(p*_)||0}}Hi.prototype={destroy:function(){this.buf=null},readFields:function(a,r,l){for(l=l||this.length;this.pos<l;){var h=this.readVarint(),p=h>>3,_=this.pos;this.type=7&h,a(p,r,this),this.pos===_&&this.skip(h)}return r},readMessage:function(a,r){return this.readFields(a,r,this.readVarint()+this.pos)},readFixed32:function(){var a=Km(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=OT(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Km(this.buf,this.pos)+Km(this.buf,this.pos+4)*O0;return this.pos+=8,a},readSFixed64:function(){var a=Km(this.buf,this.pos)+OT(this.buf,this.pos+4)*O0;return this.pos+=8,a},readFloat:function(){var a=MT(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=MT(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var r,l,h=this.buf;return r=127&(l=h[this.pos++]),l<128?r:(r|=(127&(l=h[this.pos++]))<<7,l<128?r:(r|=(127&(l=h[this.pos++]))<<14,l<128?r:(r|=(127&(l=h[this.pos++]))<<21,l<128?r:function(p,_,x){var T,A,I=x.buf;if(T=(112&(A=I[x.pos++]))>>4,A<128||(T|=(127&(A=I[x.pos++]))<<3,A<128)||(T|=(127&(A=I[x.pos++]))<<10,A<128)||(T|=(127&(A=I[x.pos++]))<<17,A<128)||(T|=(127&(A=I[x.pos++]))<<24,A<128)||(T|=(1&(A=I[x.pos++]))<<31,A<128))return Gu(p,T,_);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(l=h[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,r=this.pos;return this.pos=a,a-r>=12&&kT?function(l,h,p){return kT.decode(l.subarray(h,p))}(this.buf,r,a):function(l,h,p){for(var _="",x=h;x<p;){var T,A,I,P=l[x],D=null,O=P>239?4:P>223?3:P>191?2:1;if(x+O>p)break;O===1?P<128&&(D=P):O===2?(192&(T=l[x+1]))==128&&(D=(31&P)<<6|63&T)<=127&&(D=null):O===3?(A=l[x+2],(192&(T=l[x+1]))==128&&(192&A)==128&&((D=(15&P)<<12|(63&T)<<6|63&A)<=2047||D>=55296&&D<=57343)&&(D=null)):O===4&&(A=l[x+2],I=l[x+3],(192&(T=l[x+1]))==128&&(192&A)==128&&(192&I)==128&&((D=(15&P)<<18|(63&T)<<12|(63&A)<<6|63&I)<=65535||D>=1114112)&&(D=null)),D===null?(D=65533,O=1):D>65535&&(D-=65536,_+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),_+=String.fromCharCode(D),x+=O}return _}(this.buf,r,a)},readBytes:function(){var a=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,a);return this.pos=a,r},readPackedVarint:function(a,r){if(this.type!==Hi.Bytes)return a.push(this.readVarint(r));var l=ha(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(r));return a},readPackedSVarint:function(a){if(this.type!==Hi.Bytes)return a.push(this.readSVarint());var r=ha(this);for(a=a||[];this.pos<r;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Hi.Bytes)return a.push(this.readBoolean());var r=ha(this);for(a=a||[];this.pos<r;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Hi.Bytes)return a.push(this.readFloat());var r=ha(this);for(a=a||[];this.pos<r;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Hi.Bytes)return a.push(this.readDouble());var r=ha(this);for(a=a||[];this.pos<r;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Hi.Bytes)return a.push(this.readFixed32());var r=ha(this);for(a=a||[];this.pos<r;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Hi.Bytes)return a.push(this.readSFixed32());var r=ha(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Hi.Bytes)return a.push(this.readFixed64());var r=ha(this);for(a=a||[];this.pos<r;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Hi.Bytes)return a.push(this.readSFixed64());var r=ha(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed64());return a},skip:function(a){var r=7&a;if(r===Hi.Varint)for(;this.buf[this.pos++]>127;);else if(r===Hi.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Hi.Fixed32)this.pos+=4;else{if(r!==Hi.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(a,r){this.writeVarint(a<<3|r)},realloc:function(a){for(var r=this.length||16;r<this.pos+a;)r*=2;if(r!==this.length){var l=new Uint8Array(r);l.set(this.buf),this.buf=l,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Zu(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Zu(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Zu(this.buf,-1&a,this.pos),Zu(this.buf,Math.floor(a*PT),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Zu(this.buf,-1&a,this.pos),Zu(this.buf,Math.floor(a*PT),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(r,l){var h,p;if(r>=0?(h=r%4294967296|0,p=r/4294967296|0):(p=~(-r/4294967296),4294967295^(h=~(-r%4294967296))?h=h+1|0:(h=0,p=p+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(_,x,T){T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,T.buf[T.pos]=127&(_>>>=7)}(h,0,l),function(_,x){var T=(7&_)<<4;x.buf[x.pos++]|=T|((_>>>=3)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_)))))}(p,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var r=this.pos;this.pos=function(h,p,_){for(var x,T,A=0;A<p.length;A++){if((x=p.charCodeAt(A))>55295&&x<57344){if(!T){x>56319||A+1===p.length?(h[_++]=239,h[_++]=191,h[_++]=189):T=x;continue}if(x<56320){h[_++]=239,h[_++]=191,h[_++]=189,T=x;continue}x=T-55296<<10|x-56320|65536,T=null}else T&&(h[_++]=239,h[_++]=191,h[_++]=189,T=null);x<128?h[_++]=x:(x<2048?h[_++]=x>>6|192:(x<65536?h[_++]=x>>12|224:(h[_++]=x>>18|240,h[_++]=x>>12&63|128),h[_++]=x>>6&63|128),h[_++]=63&x|128)}return _}(this.buf,a,this.pos);var l=this.pos-r;l>=128&&DT(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),RT(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),RT(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var r=a.length;this.writeVarint(r),this.realloc(r);for(var l=0;l<r;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,r){this.pos++;var l=this.pos;a(r,this);var h=this.pos-l;h>=128&&DT(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeMessage:function(a,r,l){this.writeTag(a,Hi.Bytes),this.writeRawMessage(r,l)},writePackedVarint:function(a,r){r.length&&this.writeMessage(a,zD,r)},writePackedSVarint:function(a,r){r.length&&this.writeMessage(a,UD,r)},writePackedBoolean:function(a,r){r.length&&this.writeMessage(a,$D,r)},writePackedFloat:function(a,r){r.length&&this.writeMessage(a,VD,r)},writePackedDouble:function(a,r){r.length&&this.writeMessage(a,jD,r)},writePackedFixed32:function(a,r){r.length&&this.writeMessage(a,WD,r)},writePackedSFixed32:function(a,r){r.length&&this.writeMessage(a,HD,r)},writePackedFixed64:function(a,r){r.length&&this.writeMessage(a,XD,r)},writePackedSFixed64:function(a,r){r.length&&this.writeMessage(a,qD,r)},writeBytesField:function(a,r){this.writeTag(a,Hi.Bytes),this.writeBytes(r)},writeFixed32Field:function(a,r){this.writeTag(a,Hi.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(a,r){this.writeTag(a,Hi.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(a,r){this.writeTag(a,Hi.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(a,r){this.writeTag(a,Hi.Fixed64),this.writeSFixed64(r)},writeVarintField:function(a,r){this.writeTag(a,Hi.Varint),this.writeVarint(r)},writeSVarintField:function(a,r){this.writeTag(a,Hi.Varint),this.writeSVarint(r)},writeStringField:function(a,r){this.writeTag(a,Hi.Bytes),this.writeString(r)},writeFloatField:function(a,r){this.writeTag(a,Hi.Fixed32),this.writeFloat(r)},writeDoubleField:function(a,r){this.writeTag(a,Hi.Fixed64),this.writeDouble(r)},writeBooleanField:function(a,r){this.writeVarintField(a,!!r)}};class B0{constructor(r,{pixelRatio:l,version:h,stretchX:p,stretchY:_,content:x}){this.paddedRect=r,this.pixelRatio=l,this.stretchX=p,this.stretchY=_,this.content=x,this.version=h}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class LT{constructor(r,l){const h={},p={};this.haveRenderCallbacks=[];const _=[];this.addImages(r,h,_),this.addImages(l,p,_);const{w:x,h:T}=L0(_),A=new Zr({width:x||1,height:T||1});for(const I in r){const P=r[I],D=h[I].paddedRect;Zr.copy(P.data,A,{x:0,y:0},{x:D.x+1,y:D.y+1},P.data)}for(const I in l){const P=l[I],D=p[I].paddedRect,O=D.x+1,N=D.y+1,z=P.data.width,$=P.data.height;Zr.copy(P.data,A,{x:0,y:0},{x:O,y:N},P.data),Zr.copy(P.data,A,{x:0,y:$-1},{x:O,y:N-1},{width:z,height:1}),Zr.copy(P.data,A,{x:0,y:0},{x:O,y:N+$},{width:z,height:1}),Zr.copy(P.data,A,{x:z-1,y:0},{x:O-1,y:N},{width:1,height:$}),Zr.copy(P.data,A,{x:0,y:0},{x:O+z,y:N},{width:1,height:$})}this.image=A,this.iconPositions=h,this.patternPositions=p}addImages(r,l,h){for(const p in r){const _=r[p],x={x:0,y:0,w:_.data.width+2,h:_.data.height+2};h.push(x),l[p]=new B0(x,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(r,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>r.hasImage(h)),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in r.updatedImages)this.patchUpdatedImage(this.iconPositions[h],r.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],r.getImage(h),l)}patchUpdatedImage(r,l,h){if(!r||!l||r.version===l.version)return;r.version=l.version;const[p,_]=r.tl;h.update(l.data,void 0,{x:p,y:_})}}Dt(B0,"ImagePosition"),Dt(LT,"ImageAtlas");const ls={horizontal:1,vertical:2,horizontalOnly:3};class od{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,l){const h=new od;return h.scale=r||1,h.fontStack=l,h}static forImage(r){const l=new od;return l.imageName=r,l}}class Yu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,l){const h=new Yu;for(let p=0;p<r.sections.length;p++){const _=r.sections[p];_.image?h.addImageSection(_):h.addTextSection(_,l)}return h}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(l,h){let p="";for(let _=0;_<l.length;_++){const x=l.charCodeAt(_+1)||null,T=l.charCodeAt(_-1)||null;p+=!h&&(x&&k(x)&&!rd[l[_+1]]||T&&k(T)&&!rd[l[_-1]])||!rd[l[_]]?l[_]:rd[l[_]]}return p}(this.text,r)}trim(){let r=0;for(let h=0;h<this.text.length&&Jm[this.text.charCodeAt(h)];h++)r++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=r&&Jm[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(r,l),this.sectionIndex=this.sectionIndex.slice(r,l)}substring(r,l){const h=new Yu;return h.text=this.text.substring(r,l),h.sectionIndex=this.sectionIndex.slice(r,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,l)=>Math.max(r,this.sections[l].scale),0)}addTextSection(r,l){this.text+=r.text,this.sections.push(od.forText(r.scale,r.fontStack||l));const h=this.sections.length-1;for(let p=0;p<r.text.length;++p)this.sectionIndex.push(h)}addImageSection(r){const l=r.image?r.image.name:"";if(l.length===0)return void Se("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(od.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Se("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function F0(a,r,l,h,p,_,x,T,A,I,P,D,O,N,z){const $=Yu.fromFeature(a,p);D===ls.vertical&&$.verticalizePunctuation(O);let G=[];const se=function(ge,Ve,Ne,Ye,ft,He){if(!ge)return[];const Je=[],et=function(wt,qt,St,Ft,Tt,Zt){let fi=0;for(let ci=0;ci<wt.length();ci++){const ai=wt.getSection(ci);fi+=BT(wt.getCharCode(ci),ai,Ft,Tt,qt,Zt)}return fi/Math.max(1,Math.ceil(fi/St))}(ge,Ve,Ne,Ye,ft,He),at=ge.text.indexOf("")>=0;let dt=0;for(let wt=0;wt<ge.length();wt++){const qt=ge.getSection(wt),St=ge.getCharCode(wt);if(Jm[St]||(dt+=BT(St,qt,Ye,ft,Ve,He)),wt<ge.length()-1){const Ft=!((Xe=St)<11904||!(xm(Xe)||Ou(Xe)||g(Xe)||Im(Xe)||wm(Xe)||ym(Xe)||vm(Xe)||nc(Xe)||Tm(Xe)||Bf(Xe)||bm(Xe)||y(Xe)||Du(Xe)||Of(Xe)||Df(Xe)||Lf(Xe)||Ga(Xe)||rc(Xe)||Am(Xe)||Em(Xe)));(KD[St]||Ft||qt.imageName)&&Je.push(NT(wt+1,dt,et,Je,JD(St,ge.getCharCode(wt+1),Ft&&at),!1))}}var Xe;return zT(NT(ge.length(),dt,et,Je,0,!0))}($,I,_,r,h,N),{processBidirectionalText:pe,processStyledBidirectionalText:ee}=Ee;if(pe&&$.sections.length===1){const ge=pe($.toString(),se);for(const Ve of ge){const Ne=new Yu;Ne.text=Ve,Ne.sections=$.sections;for(let Ye=0;Ye<Ve.length;Ye++)Ne.sectionIndex.push(0);G.push(Ne)}}else if(ee){const ge=ee($.text,$.sectionIndex,se);for(const Ve of ge){const Ne=new Yu;Ne.text=Ve[0],Ne.sectionIndex=Ve[1],Ne.sections=$.sections,G.push(Ne)}}else G=function(ge,Ve){const Ne=[],Ye=ge.text;let ft=0;for(const He of Ve)Ne.push(ge.substring(ft,He)),ft=He;return ft<Ye.length&&Ne.push(ge.substring(ft,Ye.length)),Ne}($,se);const de=[],ye={positionedLines:de,text:$.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ge,Ve,Ne,Ye,ft,He,Je,et,at,dt,Xe,wt){let qt=0,St=0,Ft=0;const Tt=et==="right"?1:et==="left"?0:.5;let Zt=!1;for(const ni of ft){const di=ni.getSections();for(const zi of di){if(zi.imageName)continue;const Yi=Ve[zi.fontStack];if(Yi&&(Zt=Yi.ascender!==void 0&&Yi.descender!==void 0,!Zt))break}if(!Zt)break}let fi=0;for(const ni of ft){ni.trim();const di=ni.getMaxScale(),zi=(di-1)*lr,Yi={positionedGlyphs:[],lineOffset:0};ge.positionedLines[fi]=Yi;const Xi=Yi.positionedGlyphs;let Ki=0;if(!ni.length()){St+=He,++fi;continue}let rn=0,dn=0;for(let Oi=0;Oi<ni.length();Oi++){const Rn=ni.getSection(Oi),Sn=ni.getSectionIndex(Oi),Si=ni.getCharCode(Oi);let an=Rn.scale,Fn=null,Ui=null,_n=null,dr=lr,Yn=0;const Kn=!(at===ls.horizontal||!Xe&&!M(Si)||Xe&&(Jm[Si]||(ci=Si,ic(ci)||_m(ci)||kf(ci)||Lu(ci)||d(ci))));if(Rn.imageName){const Ar=Ye[Rn.imageName];if(!Ar)continue;_n=Rn.imageName,ge.iconsInText=ge.iconsInText||!0,Ui=Ar.paddedRect;const Jn=Ar.displaySize;an=an*lr/wt,Fn={width:Jn[0],height:Jn[1],left:1,top:-3,advance:Kn?Jn[1]:Jn[0],localGlyph:!1},Yn=Zt?-Fn.height*an:di*lr-17-Jn[1]*an,dr=Fn.advance;const da=(Kn?Jn[0]:Jn[1])*an-lr*di;da>0&&da>Ki&&(Ki=da)}else{const Ar=Ne[Rn.fontStack];if(!Ar)continue;Ar[Si]&&(Ui=Ar[Si]);const Jn=Ve[Rn.fontStack];if(!Jn)continue;const da=Jn.glyphs[Si];if(!da)continue;if(Fn=da.metrics,dr=Si!==8203?lr:0,Zt){const th=Jn.ascender!==void 0?Math.abs(Jn.ascender):0,dd=Jn.descender!==void 0?Math.abs(Jn.descender):0,pd=(th+dd)*an;rn<pd&&(rn=pd,dn=(th-dd)/2*an),Yn=-th*an}else Yn=(di-an)*lr-17}Kn?(ge.verticalizable=!0,Xi.push({glyph:Si,imageName:_n,x:qt,y:St+Yn,vertical:Kn,scale:an,localGlyph:Fn.localGlyph,fontStack:Rn.fontStack,sectionIndex:Sn,metrics:Fn,rect:Ui}),qt+=dr*an+dt):(Xi.push({glyph:Si,imageName:_n,x:qt,y:St+Yn,vertical:Kn,scale:an,localGlyph:Fn.localGlyph,fontStack:Rn.fontStack,sectionIndex:Sn,metrics:Fn,rect:Ui}),qt+=Fn.advance*an+dt)}Xi.length!==0&&(Ft=Math.max(qt-dt,Ft),Zt?UT(Xi,Tt,Ki,dn,He*di/2):UT(Xi,Tt,Ki,0,He/2)),qt=0;const Zn=He*di+Ki;Yi.lineOffset=Math.max(Ki,zi),St+=Zn,++fi}var ci;const ai=St,{horizontalAlign:Yt,verticalAlign:Di}=N0(Je);(function(ni,di,zi,Yi,Xi,Ki){const rn=(di-zi)*Xi,dn=-Ki*Yi;for(const Zn of ni)for(const Oi of Zn.positionedGlyphs)Oi.x+=rn,Oi.y+=dn})(ge.positionedLines,Tt,Yt,Di,Ft,ai),ge.top+=-Di*ai,ge.bottom=ge.top+ai,ge.left+=-Yt*Ft,ge.right=ge.left+Ft,ge.hasBaseline=Zt}(ye,r,l,h,G,x,T,A,D,I,O,z),!function(ge){for(const Ve of ge)if(Ve.positionedGlyphs.length!==0)return!1;return!0}(de)&&ye}const Jm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},KD={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function BT(a,r,l,h,p,_){if(r.imageName){const x=h[r.imageName];return x?x.displaySize[0]*r.scale*lr/_+p:0}{const x=l[r.fontStack],T=x&&x.glyphs[a];return T?T.metrics.advance*r.scale+p:0}}function FT(a,r,l,h){const p=Math.pow(a-r,2);return h?a<r?p/2:2*p:p+Math.abs(l)*l}function JD(a,r,l){let h=0;return a===10&&(h-=1e4),l&&(h+=150),a!==40&&a!==65288||(h+=50),r!==41&&r!==65289||(h+=50),h}function NT(a,r,l,h,p,_){let x=null,T=FT(r,l,p,_);for(const A of h){const I=FT(r-A.x,l,p,_)+A.badness;I<=T&&(x=A,T=I)}return{index:a,x:r,priorBreak:x,badness:T}}function zT(a){return a?zT(a.priorBreak).concat(a.index):[]}function N0(a){let r=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:r,verticalAlign:l}}function UT(a,r,l,h,p){if(!(r||l||h||p))return;const _=a.length-1,x=a[_],T=(x.x+x.metrics.advance*x.scale)*r;for(let A=0;A<=_;A++)a[A].x-=T,a[A].y+=l+h+p}function QD(a,r,l){const{horizontalAlign:h,verticalAlign:p}=N0(l),_=r[0]-a.displaySize[0]*h,x=r[1]-a.displaySize[1]*p;return{image:a,top:x,bottom:x+a.displaySize[1],left:_,right:_+a.displaySize[0]}}function VT(a,r,l,h,p,_){const x=a.image;let T;if(x.content){const G=x.content,se=x.pixelRatio||1;T=[G[0]/se,G[1]/se,x.displaySize[0]-G[2]/se,x.displaySize[1]-G[3]/se]}const A=r.left*_,I=r.right*_;let P,D,O,N;l==="width"||l==="both"?(N=p[0]+A-h[3],D=p[0]+I+h[1]):(N=p[0]+(A+I-x.displaySize[0])/2,D=N+x.displaySize[0]);const z=r.top*_,$=r.bottom*_;return l==="height"||l==="both"?(P=p[1]+z-h[0],O=p[1]+$+h[2]):(P=p[1]+(z+$-x.displaySize[1])/2,O=P+x.displaySize[1]),{image:x,top:P,right:D,bottom:O,left:N,collisionPadding:T}}class fa extends me{constructor(r,l,h,p,_){super(r,l),this.angle=p,this.z=h,_!==void 0&&(this.segment=_)}clone(){return new fa(this.x,this.y,this.z,this.angle,this.segment)}}function jT(a,r,l,h,p){if(r.segment===void 0)return!0;let _=r,x=r.segment+1,T=0;for(;T>-l/2;){if(x--,x<0)return!1;T-=a[x].dist(_),_=a[x]}T+=a[x].dist(a[x+1]),x++;const A=[];let I=0;for(;T<l/2;){const P=a[x],D=a[x+1];if(!D)return!1;let O=a[x-1].angleTo(P)-P.angleTo(D);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:T,angleDelta:O}),I+=O;T-A[0].distance>h;)I-=A.shift().angleDelta;if(I>p)return!1;x++,T+=P.dist(D)}return!0}function $T(a){let r=0;for(let l=0;l<a.length-1;l++)r+=a[l].dist(a[l+1]);return r}function WT(a,r,l){return a?.6*r*l:0}function HT(a,r){return Math.max(a?a.right-a.left:0,r?r.right-r.left:0)}function eO(a,r,l,h,p,_){const x=WT(l,p,_),T=HT(l,h)*_;let A=0;const I=$T(a)/2;for(let P=0;P<a.length-1;P++){const D=a[P],O=a[P+1],N=D.dist(O);if(A+N>I){const z=(I-A)/N,$=vi(D.x,O.x,z),G=vi(D.y,O.y,z),se=new fa($,G,0,O.angleTo(D),P);return!x||jT(a,se,T,x,r)?se:void 0}A+=N}}function tO(a,r,l,h,p,_,x,T,A){const I=WT(h,_,x),P=HT(h,p),D=P*x,O=a[0].x===0||a[0].x===A||a[0].y===0||a[0].y===A;return r-D<r/4&&(r=D+r/4),XT(a,O?r/2*T%r:(P/2+2*_)*x*T%r,r,I,l,D,O,!1,A)}function XT(a,r,l,h,p,_,x,T,A){const I=_/2,P=$T(a);let D=0,O=r-l,N=[];for(let z=0;z<a.length-1;z++){const $=a[z],G=a[z+1],se=$.dist(G),pe=G.angleTo($);for(;O+l<D+se;){O+=l;const ee=(O-D)/se,de=vi($.x,G.x,ee),ye=vi($.y,G.y,ee);if(de>=0&&de<A&&ye>=0&&ye<A&&O-I>=0&&O+I<=P){const ge=new fa(de,ye,0,pe,z);ge._round(),h&&!jT(a,ge,_,h,p)||N.push(ge)}}D+=se}return T||N.length||x||(N=XT(a,D/2,l,h,p,_,x,!0,A)),N}function qT(a,r,l,h,p){const _=[];for(let x=0;x<a.length;x++){const T=a[x];let A;for(let I=0;I<T.length-1;I++){let P=T[I],D=T[I+1];P.x<r&&D.x<r||(P.x<r?P=new me(r,P.y+(r-P.x)/(D.x-P.x)*(D.y-P.y))._round():D.x<r&&(D=new me(r,P.y+(r-P.x)/(D.x-P.x)*(D.y-P.y))._round()),P.y<l&&D.y<l||(P.y<l?P=new me(P.x+(l-P.y)/(D.y-P.y)*(D.x-P.x),l)._round():D.y<l&&(D=new me(P.x+(l-P.y)/(D.y-P.y)*(D.x-P.x),l)._round()),P.x>=h&&D.x>=h||(P.x>=h?P=new me(h,P.y+(h-P.x)/(D.x-P.x)*(D.y-P.y))._round():D.x>=h&&(D=new me(h,P.y+(h-P.x)/(D.x-P.x)*(D.y-P.y))._round()),P.y>=p&&D.y>=p||(P.y>=p?P=new me(P.x+(p-P.y)/(D.y-P.y)*(D.x-P.x),p)._round():D.y>=p&&(D=new me(P.x+(p-P.y)/(D.y-P.y)*(D.x-P.x),p)._round()),A&&P.equals(A[A.length-1])||(A=[P],_.push(A)),A.push(D)))))}}return _}Dt(fa,"Anchor");const Qm=1e20;function GT(a,r,l,h,p,_,x,T,A){for(let I=r;I<r+h;I++)ZT(a,l*_+I,_,p,x,T,A);for(let I=l;I<l+p;I++)ZT(a,I*_+r,1,h,x,T,A)}function ZT(a,r,l,h,p,_,x){_[0]=0,x[0]=-1e20,x[1]=Qm,p[0]=a[r];for(let T=1,A=0,I=0;T<h;T++){p[T]=a[r+T*l];const P=T*T;do{const D=_[A];I=(p[T]-p[D]+P-D*D)/(T-D)/2}while(I<=x[A]&&--A>-1);A++,_[A]=T,x[A]=I,x[A+1]=Qm}for(let T=0,A=0;T<h;T++){for(;x[A+1]<T;)A++;const I=_[A],P=T-I;a[r+T*l]=p[I]+P*P}}const z0={none:0,ideographs:1,all:2};class Ku{constructor(r,l,h){this.requestManager=r,this.localGlyphMode=l,this.localFontFamily=h,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,l){const h=[];for(const p in r)for(const _ of r[p])h.push({stack:p,id:_});wi(h,({stack:p,id:_},x)=>{let T=this.entries[p];T||(T=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=T.glyphs[_];if(A!==void 0)return void x(null,{stack:p,id:_,glyph:A});if(A=this._tinySDF(T,p,_),A)return T.glyphs[_]=A,void x(null,{stack:p,id:_,glyph:A});const I=Math.floor(_/256);if(256*I>65535)return void x(new Error("glyphs > 65535 not supported"));if(T.ranges[I])return void x(null,{stack:p,id:_,glyph:A});let P=T.requests[I];P||(P=T.requests[I]=[],Ku.loadGlyphRange(p,I,this.url,this.requestManager,(D,O)=>{if(O){T.ascender=O.ascender,T.descender=O.descender;for(const N in O.glyphs)this._doesCharSupportLocalGlyph(+N)||(T.glyphs[+N]=O.glyphs[+N]);T.ranges[I]=!0}for(const N of P)N(D,O);delete T.requests[I]})),P.push((D,O)=>{D?x(D):O&&x(null,{stack:p,id:_,glyph:O.glyphs[_]||null})})},(p,_)=>{if(p)l(p);else if(_){const x={};for(const{stack:T,id:A,glyph:I}of _)x[T]===void 0&&(x[T]={}),x[T].glyphs===void 0&&(x[T].glyphs={}),x[T].glyphs[A]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},x[T].ascender=this.entries[T].ascender,x[T].descender=this.entries[T].descender;l(null,x)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==z0.none&&(this.localGlyphMode===z0.all?!!this.localFontFamily:!!this.localFontFamily&&(Bf(r)||Sm(r)||Du(r)||Ga(r)||nc(r)))}_tinySDF(r,l,h){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(h))return;let _=r.tinySDF;if(!_){let $="400";/bold/i.test(l)?$="900":/medium/i.test(l)?$="500":/light/i.test(l)&&($="200"),_=r.tinySDF=new Ku.TinySDF({fontFamily:p,fontWeight:$,fontSize:48,buffer:6,radius:16}),_.fontWeight=$}if(this.localGlyphs[_.fontWeight][h])return this.localGlyphs[_.fontWeight][h];const x=String.fromCharCode(h),{data:T,width:A,height:I,glyphWidth:P,glyphHeight:D,glyphLeft:O,glyphTop:N,glyphAdvance:z}=_.draw(x);return this.localGlyphs[_.fontWeight][h]={id:h,bitmap:new ua({width:A,height:I},T),metrics:{width:P/2,height:D/2,left:O/2,top:N/2-27,advance:z/2,localGlyph:!0}}}}function YT(a,r,l,h){const p=[],_=a.image,x=_.pixelRatio,T=_.paddedRect.w-2,A=_.paddedRect.h-2,I=a.right-a.left,P=a.bottom-a.top,D=_.stretchX||[[0,T]],O=_.stretchY||[[0,A]],N=(He,Je)=>He+Je[1]-Je[0],z=D.reduce(N,0),$=O.reduce(N,0),G=T-z,se=A-$;let pe=0,ee=z,de=0,ye=$,ge=0,Ve=G,Ne=0,Ye=se;if(_.content&&h){const He=_.content;pe=eg(D,0,He[0]),de=eg(O,0,He[1]),ee=eg(D,He[0],He[2]),ye=eg(O,He[1],He[3]),ge=He[0]-pe,Ne=He[1]-de,Ve=He[2]-He[0]-ee,Ye=He[3]-He[1]-ye}const ft=(He,Je,et,at)=>{const dt=tg(He.stretch-pe,ee,I,a.left),Xe=ig(He.fixed-ge,Ve,He.stretch,z),wt=tg(Je.stretch-de,ye,P,a.top),qt=ig(Je.fixed-Ne,Ye,Je.stretch,$),St=tg(et.stretch-pe,ee,I,a.left),Ft=ig(et.fixed-ge,Ve,et.stretch,z),Tt=tg(at.stretch-de,ye,P,a.top),Zt=ig(at.fixed-Ne,Ye,at.stretch,$),fi=new me(dt,wt),ci=new me(St,wt),ai=new me(St,Tt),Yt=new me(dt,Tt),Di=new me(Xe/x,qt/x),ni=new me(Ft/x,Zt/x),di=r*Math.PI/180;if(di){const Xi=Math.sin(di),Ki=Math.cos(di),rn=[Ki,-Xi,Xi,Ki];fi._matMult(rn),ci._matMult(rn),Yt._matMult(rn),ai._matMult(rn)}const zi=He.stretch+He.fixed,Yi=Je.stretch+Je.fixed;return{tl:fi,tr:ci,bl:Yt,br:ai,tex:{x:_.paddedRect.x+1+zi,y:_.paddedRect.y+1+Yi,w:et.stretch+et.fixed-zi,h:at.stretch+at.fixed-Yi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Di,pixelOffsetBR:ni,minFontScaleX:Ve/x/I,minFontScaleY:Ye/x/P,isSDF:l}};if(h&&(_.stretchX||_.stretchY)){const He=KT(D,G,z),Je=KT(O,se,$);for(let et=0;et<He.length-1;et++){const at=He[et],dt=He[et+1];for(let Xe=0;Xe<Je.length-1;Xe++)p.push(ft(at,Je[Xe],dt,Je[Xe+1]))}}else p.push(ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:A+1}));return p}function eg(a,r,l){let h=0;for(const p of a)h+=Math.max(r,Math.min(l,p[1]))-Math.max(r,Math.min(l,p[0]));return h}function KT(a,r,l){const h=[{fixed:-1,stretch:0}];for(const[p,_]of a){const x=h[h.length-1];h.push({fixed:p-x.stretch,stretch:x.stretch}),h.push({fixed:p-x.stretch,stretch:x.stretch+(_-p)})}return h.push({fixed:r+1,stretch:l}),h}function tg(a,r,l,h){return a/r*l+h}function ig(a,r,l,h){return a-r*l/h}function iO(a,r,l,h){const p=r+a.positionedLines[h].lineOffset;return h===0?l+p/2:l+(p+(r+a.positionedLines[h-1].lineOffset))/2}Ku.loadGlyphRange=function(a,r,l,h,p){const _=256*r,x=_+255,T=h.transformRequest(h.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${_}-${x}`),qn.Glyphs);bn(T,(A,I)=>{if(A)p(A);else if(I){const P={},D=function(O){return new sd(O).readFields(GD,{})}(I);for(const O of D.glyphs)P[O.id]=O;p(null,{glyphs:P,ascender:D.ascender,descender:D.descender})}})},Ku.TinySDF=class{constructor({fontSize:a=24,buffer:r=3,radius:l=8,cutoff:h=.25,fontFamily:p="sans-serif",fontWeight:_="normal",fontStyle:x="normal"}={}){this.buffer=r,this.cutoff=h,this.radius=l;const T=this.size=a+4*r,A=this._createCanvas(T),I=this.ctx=A.getContext("2d",{willReadFrequently:!0});I.font=`${x} ${_} ${a}px ${p}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(a){const r=document.createElement("canvas");return r.width=r.height=a,r}draw(a){const{width:r,actualBoundingBoxAscent:l,actualBoundingBoxDescent:h,actualBoundingBoxLeft:p,actualBoundingBoxRight:_}=this.ctx.measureText(a),x=Math.ceil(l),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-p))),A=Math.min(this.size-this.buffer,x+Math.ceil(h)),I=T+2*this.buffer,P=A+2*this.buffer,D=Math.max(I*P,0),O=new Uint8ClampedArray(D),N={data:O,width:I,height:P,glyphWidth:T,glyphHeight:A,glyphTop:x,glyphLeft:0,glyphAdvance:r};if(T===0||A===0)return N;const{ctx:z,buffer:$,gridInner:G,gridOuter:se}=this;z.clearRect($,$,T,A),z.fillText(a,$,$+x);const pe=z.getImageData($,$,T,A);se.fill(Qm,0,D),G.fill(0,0,D);for(let ee=0;ee<A;ee++)for(let de=0;de<T;de++){const ye=pe.data[4*(ee*T+de)+3]/255;if(ye===0)continue;const ge=(ee+$)*I+de+$;if(ye===1)se[ge]=0,G[ge]=Qm;else{const Ve=.5-ye;se[ge]=Ve>0?Ve*Ve:0,G[ge]=Ve<0?Ve*Ve:0}}GT(se,0,0,I,P,I,this.f,this.v,this.z),GT(G,$,$,T,A,I,this.f,this.v,this.z);for(let ee=0;ee<D;ee++){const de=Math.sqrt(se[ee])-Math.sqrt(G[ee]);O[ee]=Math.round(255-255*(de/this.radius+this.cutoff))}return N}};class nO{constructor(r=[],l=rO){if(this.data=r,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:l,compare:h}=this,p=l[r];for(;r>0;){const _=r-1>>1,x=l[_];if(h(p,x)>=0)break;l[r]=x,r=_}l[r]=p}_down(r){const{data:l,compare:h}=this,p=this.length>>1,_=l[r];for(;r<p;){let x=1+(r<<1),T=l[x];const A=x+1;if(A<this.length&&h(l[A],T)<0&&(x=A,T=l[A]),h(T,_)>=0)break;l[r]=T,r=x}l[r]=_}}function rO(a,r){return a<r?-1:a>r?1:0}function sO(a,r=1,l=!1){let h=1/0,p=1/0,_=-1/0,x=-1/0;const T=a[0];for(let N=0;N<T.length;N++){const z=T[N];(!N||z.x<h)&&(h=z.x),(!N||z.y<p)&&(p=z.y),(!N||z.x>_)&&(_=z.x),(!N||z.y>x)&&(x=z.y)}const A=Math.min(_-h,x-p);let I=A/2;const P=new nO([],oO);if(A===0)return new me(h,p);for(let N=h;N<_;N+=A)for(let z=p;z<x;z+=A)P.push(new Ju(N+I,z+I,I,a));let D=function(N){let z=0,$=0,G=0;const se=N[0];for(let pe=0,ee=se.length,de=ee-1;pe<ee;de=pe++){const ye=se[pe],ge=se[de],Ve=ye.x*ge.y-ge.x*ye.y;$+=(ye.x+ge.x)*Ve,G+=(ye.y+ge.y)*Ve,z+=3*Ve}return new Ju($/z,G/z,0,N)}(a),O=P.length;for(;P.length;){const N=P.pop();(N.d>D.d||!D.d)&&(D=N,l&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,O)),N.max-D.d<=r||(I=N.h/2,P.push(new Ju(N.p.x-I,N.p.y-I,I,a)),P.push(new Ju(N.p.x+I,N.p.y-I,I,a)),P.push(new Ju(N.p.x-I,N.p.y+I,I,a)),P.push(new Ju(N.p.x+I,N.p.y+I,I,a)),O+=4)}return l&&(console.log(`num probes: ${O}`),console.log(`best distance: ${D.d}`)),D.p}function oO(a,r){return r.max-a.max}class Ju{constructor(r,l,h,p){this.p=new me(r,l),this.h=h,this.d=function(_,x){let T=!1,A=1/0;for(let I=0;I<x.length;I++){const P=x[I];for(let D=0,O=P.length,N=O-1;D<O;N=D++){const z=P[D],$=P[N];z.y>_.y!=$.y>_.y&&_.x<($.x-z.x)*(_.y-z.y)/($.y-z.y)+z.x&&(T=!T),A=Math.min(A,Zw(_,z,$))}}return(T?1:-1)*Math.sqrt(A)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const U0=Number.POSITIVE_INFINITY,aO=Math.sqrt(2);function JT(a,[r,l]){let h=0,p=0;if(l===U0){r<0&&(r=0);const _=r/aO;switch(a){case"top-right":case"top-left":p=_-7;break;case"bottom-right":case"bottom-left":p=7-_;break;case"bottom":p=7-r;break;case"top":p=r-7}switch(a){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=r;break;case"right":h=-r}}else{switch(r=Math.abs(r),l=Math.abs(l),a){case"top-right":case"top-left":case"top":p=l-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-l}switch(a){case"top-right":case"bottom-right":case"right":h=-r;break;case"top-left":case"bottom-left":case"left":h=r}}return[h,p]}function lO(a,r,l,h,p,_,x,T,A,I){a.createArrays(),a.tilePixelRatio=Jt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const P=a.layers[0].layout,D=a.layers[0]._unevaluatedLayout._values,O={};if(a.textSizeData.kind==="composite"){const{minZoom:$,maxZoom:G}=a.textSizeData;O.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Re($),T),D["text-size"].possiblyEvaluate(new Re(G),T)]}if(a.iconSizeData.kind==="composite"){const{minZoom:$,maxZoom:G}=a.iconSizeData;O.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Re($),T),D["icon-size"].possiblyEvaluate(new Re(G),T)]}O.layoutTextSize=D["text-size"].possiblyEvaluate(new Re(A+1),T),O.layoutIconSize=D["icon-size"].possiblyEvaluate(new Re(A+1),T),O.textMaxSize=D["text-size"].possiblyEvaluate(new Re(18),T);const N=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",z=P.get("text-size");for(const $ of a.features){const G=P.get("text-font").evaluate($,{},T).join(","),se=z.evaluate($,{},T),pe=O.layoutTextSize.evaluate($,{},T),ee=(O.layoutIconSize.evaluate($,{},T),{horizontal:{},vertical:void 0}),de=$.text;let ye,ge=[0,0];if(de){const Ye=de.toString(),ft=P.get("text-letter-spacing").evaluate($,{},T)*lr,He=P.get("text-line-height").evaluate($,{},T)*lr,Je=E(Ye)?ft:0,et=P.get("text-anchor").evaluate($,{},T),at=P.get("text-variable-anchor");if(!at){const St=P.get("text-radial-offset").evaluate($,{},T);ge=St?JT(et,[St*lr,U0]):P.get("text-offset").evaluate($,{},T).map(Ft=>Ft*lr)}let dt=N?"center":P.get("text-justify").evaluate($,{},T);const Xe=P.get("symbol-placement")==="point",wt=Xe?P.get("text-max-width").evaluate($,{},T)*lr:1/0,qt=St=>{a.allowVerticalPlacement&&b(Ye)&&(ee.vertical=F0(de,r,l,p,G,wt,He,et,St,Je,ge,ls.vertical,!0,pe,se))};if(!N&&at){const St=dt==="auto"?at.map(Tt=>V0(Tt)):[dt];let Ft=!1;for(let Tt=0;Tt<St.length;Tt++){const Zt=St[Tt];if(!ee.horizontal[Zt])if(Ft)ee.horizontal[Zt]=ee.horizontal[0];else{const fi=F0(de,r,l,p,G,wt,He,"center",Zt,Je,ge,ls.horizontal,!1,pe,se);fi&&(ee.horizontal[Zt]=fi,Ft=fi.positionedLines.length===1)}}qt("left")}else{if(dt==="auto"&&(dt=V0(et)),Xe||P.get("text-writing-mode").indexOf("horizontal")>=0||!b(Ye)){const St=F0(de,r,l,p,G,wt,He,et,dt,Je,ge,ls.horizontal,!1,pe,se);St&&(ee.horizontal[dt]=St)}qt(Xe?"left":dt)}}let Ve=!1;if($.icon&&$.icon.name){const Ye=h[$.icon.name];Ye&&(ye=QD(p[$.icon.name],P.get("icon-offset").evaluate($,{},T),P.get("icon-anchor").evaluate($,{},T)),Ve=Ye.sdf,a.sdfIcons===void 0?a.sdfIcons=Ye.sdf:a.sdfIcons!==Ye.sdf&&Se("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ye.pixelRatio!==a.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}const Ne=eE(ee.horizontal)||ee.vertical;a.iconsInText||(a.iconsInText=!!Ne&&Ne.iconsInText),(Ne||ye)&&cO(a,$,ee,ye,h,O,pe,0,ge,Ve,x,T,I)}_&&a.generateCollisionDebugBuffers(A,a.collisionBoxArray)}function V0(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function cO(a,r,l,h,p,_,x,T,A,I,P,D,O){let N=_.textMaxSize.evaluate(r,{},D);N===void 0&&(N=x);const z=a.layers[0].layout,$=z.get("icon-offset").evaluate(r,{},D),G=eE(l.horizontal)||l.vertical,se=O.name==="globe",pe=x/24,ee=a.tilePixelRatio*N/24,de=(Je=a.overscaling,a.zoom>18&&Je>2&&(Je>>=1),Math.max(Jt/(512*Je),1)*z.get("symbol-spacing")),ye=z.get("text-padding")*a.tilePixelRatio,ge=z.get("icon-padding")*a.tilePixelRatio,Ve=rt(z.get("text-max-angle")),Ne=z.get("text-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ye=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",ft=z.get("symbol-placement"),He=de/2;var Je;const et=z.get("icon-text-fit");let at;h&&et!=="none"&&(a.allowVerticalPlacement&&l.vertical&&(at=VT(h,l.vertical,et,z.get("icon-text-fit-padding"),$,pe)),G&&(h=VT(h,G,et,z.get("icon-text-fit-padding"),$,pe)));const dt=(Xe,wt,qt)=>{if(wt.x<0||wt.x>=Jt||wt.y<0||wt.y>=Jt)return;let St=null;if(se){const{x:Ft,y:Tt,z:Zt}=O.projectTilePoint(wt.x,wt.y,qt);St={anchor:new fa(Ft,Tt,Zt,0,void 0),up:O.upVector(qt,wt.x,wt.y)}}(function(Ft,Tt,Zt,fi,ci,ai,Yt,Di,ni,di,zi,Yi,Xi,Ki,rn,dn,Zn,Oi,Rn,Sn,Si,an,Fn,Ui,_n){const dr=Ft.addToLineVertexArray(Tt,fi);let Yn,Kn,Ar,Jn,da,th,dd,pd=0,ME=0,RE=0,PE=0,Q0=-1,ex=-1;const Ao={};let kE=sc("");const _c=Zt?Zt.anchor:Tt;let tx=0,ix=0;if(ni._unevaluatedLayout.getValue("text-radial-offset")===void 0?[tx,ix]=ni.layout.get("text-offset").evaluate(Si,{},_n).map(Yr=>Yr*lr):(tx=ni.layout.get("text-radial-offset").evaluate(Si,{},_n)*lr,ix=U0),Ft.allowVerticalPlacement&&ci.vertical){const Yr=ci.vertical;if(rn)th=j0(Yr),Di&&(dd=j0(Di));else{const Kr=ni.layout.get("text-rotate").evaluate(Si,{},_n)+90;Ar=ng(di,_c,Tt,zi,Yi,Xi,Yr,Ki,Kr,dn),Di&&(Jn=ng(di,_c,Tt,zi,Yi,Xi,Di,Oi,Kr))}}if(ai){const Yr=ni.layout.get("icon-rotate").evaluate(Si,{},_n),Kr=ni.layout.get("icon-text-fit")!=="none",md=YT(ai,Yr,Fn,Kr),rx=Di?YT(Di,Yr,Fn,Kr):void 0;Kn=ng(di,_c,Tt,zi,Yi,Xi,ai,Oi,Yr),pd=4*md.length;const DE=Ft.iconSizeData;let yc=null;DE.kind==="source"?(yc=[bo*ni.layout.get("icon-size").evaluate(Si,{},_n)],yc[0]>el&&Se(`${Ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):DE.kind==="composite"&&(yc=[bo*an.compositeIconSizes[0].evaluate(Si,{},_n),bo*an.compositeIconSizes[1].evaluate(Si,{},_n)],(yc[0]>el||yc[1]>el)&&Se(`${Ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ft.addSymbols(Ft.icon,md,yc,Sn,Rn,Si,!1,Zt,Tt,dr.lineStartIndex,dr.lineLength,-1,Ui,_n),Q0=Ft.icon.placedSymbolArray.length-1,rx&&(ME=4*rx.length,Ft.addSymbols(Ft.icon,rx,yc,Sn,Rn,Si,ls.vertical,Zt,Tt,dr.lineStartIndex,dr.lineLength,-1,Ui,_n),ex=Ft.icon.placedSymbolArray.length-1)}for(const Yr in ci.horizontal){const Kr=ci.horizontal[Yr];Yn||(kE=sc(Kr.text),rn?da=j0(Kr):Yn=ng(di,_c,Tt,zi,Yi,Xi,Kr,Ki,ni.layout.get("text-rotate").evaluate(Si,{},_n),dn));const md=Kr.positionedLines.length===1;if(RE+=QT(Ft,Zt,Tt,Kr,Yt,ni,rn,Si,dn,dr,ci.vertical?ls.horizontal:ls.horizontalOnly,md?Object.keys(ci.horizontal):[Yr],Ao,Q0,an,Ui,_n),md)break}ci.vertical&&(PE+=QT(Ft,Zt,Tt,ci.vertical,Yt,ni,rn,Si,dn,dr,ls.vertical,["vertical"],Ao,ex,an,Ui,_n));let ol=-1;const nx=(Yr,Kr)=>Yr?Math.max(Yr,Kr):Kr;ol=nx(da,ol),ol=nx(th,ol),ol=nx(dd,ol);const FO=ol>-1?1:0;Ft.glyphOffsetArray.length>=il.MAX_GLYPHS&&Se("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Si.sortKey!==void 0&&Ft.addToSortKeyRanges(Ft.symbolInstances.length,Si.sortKey),Ft.symbolInstances.emplaceBack(_c.x,_c.y,_c.z,Tt.x,Tt.y,Ao.right>=0?Ao.right:-1,Ao.center>=0?Ao.center:-1,Ao.left>=0?Ao.left:-1,Ao.vertical>=0?Ao.vertical:-1,Q0,ex,kE,Yn!==void 0?Yn:Ft.collisionBoxArray.length,Yn!==void 0?Yn+1:Ft.collisionBoxArray.length,Ar!==void 0?Ar:Ft.collisionBoxArray.length,Ar!==void 0?Ar+1:Ft.collisionBoxArray.length,Kn!==void 0?Kn:Ft.collisionBoxArray.length,Kn!==void 0?Kn+1:Ft.collisionBoxArray.length,Jn||Ft.collisionBoxArray.length,Jn?Jn+1:Ft.collisionBoxArray.length,zi,RE,PE,pd,ME,FO,0,tx,ix,ol)})(a,wt,St,Xe,l,h,p,at,a.layers[0],a.collisionBoxArray,r.index,r.sourceLayerIndex,a.index,ye,Ne,A,0,ge,Ye,$,r,_,I,P,D)};if(ft==="line")for(const Xe of qT(r.geometry,0,0,Jt,Jt)){const wt=tO(Xe,de,Ve,l.vertical||G,h,24,ee,a.overscaling,Jt);for(const qt of wt){const St=G;St&&uO(a,St.text,He,qt)||dt(Xe,qt,D)}}else if(ft==="line-center"){for(const Xe of r.geometry)if(Xe.length>1){const wt=eO(Xe,Ve,l.vertical||G,h,24,ee);wt&&dt(Xe,wt,D)}}else if(r.type==="Polygon")for(const Xe of M0(r.geometry,0)){const wt=sO(Xe,16);dt(Xe[0],new fa(wt.x,wt.y,0,0,void 0),D)}else if(r.type==="LineString")for(const Xe of r.geometry)dt(Xe,new fa(Xe[0].x,Xe[0].y,0,0,void 0),D);else if(r.type==="Point")for(const Xe of r.geometry)for(const wt of Xe)dt([wt],new fa(wt.x,wt.y,0,0,void 0),D)}const el=32640;function QT(a,r,l,h,p,_,x,T,A,I,P,D,O,N,z,$,G){const se=function(de,ye,ge,Ve,Ne,Ye,ft,He){const Je=[];if(ye.positionedLines.length===0)return Je;const et=Ve.layout.get("text-rotate").evaluate(Ye,{})*Math.PI/180,at=function(St){const Ft=St[0],Tt=St[1],Zt=Ft*Tt;return Zt>0?[Ft,-Tt]:Zt<0?[-Ft,Tt]:Ft===0?[Tt,Ft]:[Tt,-Ft]}(ge);let dt=Math.abs(ye.top-ye.bottom);for(const St of ye.positionedLines)dt-=St.lineOffset;const Xe=ye.positionedLines.length,wt=dt/Xe;let qt=ye.top-ge[1];for(let St=0;St<Xe;++St){const Ft=ye.positionedLines[St];qt=iO(ye,wt,qt,St);for(const Tt of Ft.positionedGlyphs){if(!Tt.rect)continue;const Zt=Tt.rect||{};let fi=4,ci=!0,ai=1,Yt=0;if(Tt.imageName){const Ui=ft[Tt.imageName];if(!Ui)continue;if(Ui.sdf){Se("SDF images are not supported in formatted text and will be ignored.");continue}ci=!1,ai=Ui.pixelRatio,fi=1/ai}const Di=(Ne||He)&&Tt.vertical,ni=Tt.metrics.advance*Tt.scale/2,di=Tt.metrics,zi=Tt.rect;if(zi===null)continue;He&&ye.verticalizable&&(Yt=Tt.imageName?ni-Tt.metrics.width*Tt.scale/2:0);const Yi=Ne?[Tt.x+ni,Tt.y]:[0,0];let Xi=[0,0],Ki=[0,0],rn=!1;Ne||(Di?(Ki=[Tt.x+ni+at[0],Tt.y+at[1]-Yt],rn=!0):Xi=[Tt.x+ni+ge[0],Tt.y+ge[1]-Yt]);const dn=zi.w*Tt.scale/(ai*(Tt.localGlyph?2:1)),Zn=zi.h*Tt.scale/(ai*(Tt.localGlyph?2:1));let Oi,Rn,Sn,Si;if(Di){const Ui=Tt.y-qt,_n=new me(-ni,ni-Ui),dr=-Math.PI/2,Yn=new me(...Ki);Oi=new me(-ni+Xi[0],Xi[1]),Oi._rotateAround(dr,_n)._add(Yn),Oi.x+=-Ui+ni,Oi.y-=(di.left-fi)*Tt.scale;const Kn=Tt.imageName?di.advance*Tt.scale:lr*Tt.scale,Ar=String.fromCharCode(Tt.glyph);FD(Ar)?Oi.x+=(1-fi)*Tt.scale:ND(Ar)?Oi.x+=Kn-di.height*Tt.scale+(-fi-1)*Tt.scale:Oi.x+=Tt.imageName||di.width+2*fi===zi.w&&di.height+2*fi===zi.h?(Kn-Zn)/2:(Kn-(di.height+2*fi)*Tt.scale)/2,Rn=new me(Oi.x,Oi.y-dn),Sn=new me(Oi.x+Zn,Oi.y),Si=new me(Oi.x+Zn,Oi.y-dn)}else{const Ui=(di.left-fi)*Tt.scale-ni+Xi[0],_n=(-di.top-fi)*Tt.scale+Xi[1],dr=Ui+dn,Yn=_n+Zn;Oi=new me(Ui,_n),Rn=new me(dr,_n),Sn=new me(Ui,Yn),Si=new me(dr,Yn)}if(et){let Ui;Ui=Ne?new me(0,0):rn?new me(at[0],at[1]):new me(ge[0],ge[1]),Oi._rotateAround(et,Ui),Rn._rotateAround(et,Ui),Sn._rotateAround(et,Ui),Si._rotateAround(et,Ui)}const an=new me(0,0),Fn=new me(0,0);Je.push({tl:Oi,tr:Rn,bl:Sn,br:Si,tex:Zt,writingMode:ye.writingMode,glyphOffset:Yi,sectionIndex:Tt.sectionIndex,isSDF:ci,pixelOffsetTL:an,pixelOffsetBR:Fn,minFontScaleX:0,minFontScaleY:0})}}return Je}(0,h,A,_,x,T,p,a.allowVerticalPlacement),pe=a.textSizeData;let ee=null;pe.kind==="source"?(ee=[bo*_.layout.get("text-size").evaluate(T,{},G)],ee[0]>el&&Se(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):pe.kind==="composite"&&(ee=[bo*z.compositeTextSizes[0].evaluate(T,{},G),bo*z.compositeTextSizes[1].evaluate(T,{},G)],(ee[0]>el||ee[1]>el)&&Se(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,se,ee,A,x,T,P,r,l,I.lineStartIndex,I.lineLength,N,$,G);for(const de of D)O[de]=a.text.placedSymbolArray.length-1;return 4*se.length}function eE(a){for(const r in a)return a[r];return null}function ng(a,r,l,h,p,_,x,T,A,I){let P=x.top,D=x.bottom,O=x.left,N=x.right;const z=x.collisionPadding;if(z&&(O-=z[0],P-=z[1],N+=z[2],D+=z[3]),A){const $=new me(O,P),G=new me(N,P),se=new me(O,D),pe=new me(N,D),ee=rt(A);let de=new me(0,0);I&&(de=new me(I[0],I[1])),$._rotateAround(ee,de),G._rotateAround(ee,de),se._rotateAround(ee,de),pe._rotateAround(ee,de),O=Math.min($.x,G.x,se.x,pe.x),N=Math.max($.x,G.x,se.x,pe.x),P=Math.min($.y,G.y,se.y,pe.y),D=Math.max($.y,G.y,se.y,pe.y)}return a.emplaceBack(r.x,r.y,r.z,l.x,l.y,O,P,N,D,T,h,p,_),a.length-1}function j0(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const r=a.bottom-a.top;return r>0?Math.max(10,r):null}function uO(a,r,l,h){const p=a.compareText;if(r in p){const _=p[r];for(let x=_.length-1;x>=0;x--)if(h.dist(_[x])<l)return!0}else p[r]=[];return p[r].push(h),!1}function tE(a,r){const l=a.fovAboveCenter,h=a.elevation?a.elevation.getMinElevationBelowMSL()*r:0,p=(a._camera.position[2]*a.worldSize-h)/Math.cos(a._pitch),_=Math.sin(l)*p/Math.sin(Math.max(Math.PI/2-a._pitch-l,.01)),x=Math.sin(a._pitch)*_+p;return Math.min(1.01*x,p*(1/a._horizonShift))}function mc(a,r){if(!r.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:r};const l=Math.pow(2,-a.z),h=a.x*l,p=(a.x+1)*l,_=a.y*l,x=(a.y+1)*l,T=as(h),A=as(p),I=ar(_),P=ar(x),D=r.project(T,I),O=r.project(A,I),N=r.project(A,P),z=r.project(T,P);let $=Math.min(D.x,O.x,N.x,z.x),G=Math.min(D.y,O.y,N.y,z.y),se=Math.max(D.x,O.x,N.x,z.x),pe=Math.max(D.y,O.y,N.y,z.y);const ee=l/16;function de(ge,Ve,Ne,Ye,ft,He){const Je=(Ne+ft)/2,et=(Ye+He)/2,at=r.project(as(Je),ar(et)),dt=Math.max(0,$-at.x,G-at.y,at.x-se,at.y-pe);$=Math.min($,at.x),se=Math.max(se,at.x),G=Math.min(G,at.y),pe=Math.max(pe,at.y),dt>ee&&(de(ge,at,Ne,Ye,Je,et),de(at,Ve,Je,et,ft,He))}de(D,O,h,_,p,_),de(O,N,p,_,p,x),de(N,z,p,x,h,x),de(z,D,h,x,h,_),$-=ee,G-=ee,se+=ee,pe+=ee;const ye=1/Math.max(se-$,pe-G);return{scale:ye,x:$*ye,y:G*ye,x2:se*ye,y2:pe*ye,projection:r}}const hO=Ws(new Float32Array(16));class tl{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,l){return{x:0,y:0,z:0}}unproject(r,l){return new Ti(0,0)}projectTilePoint(r,l,h){return{x:r,y:l,z:0}}locationPoint(r,l,h=!0){return r._coordinatePoint(r.locationCoordinate(l),h)}pixelsPerMeter(r,l){return Xs(1,r)*l}pixelSpaceConversion(r,l,h){return 1}farthestPixelDistance(r){return tE(r,r.pixelsPerMeter)}pointCoordinate(r,l,h,p){const _=r.horizonLineFromTop(!1),x=new me(l,Math.max(_,h));return r.rayIntersectionCoordinate(r.pointRayIntersection(x,p))}pointCoordinate3D(r,l,h){const p=new me(l,h);if(r.elevation)return r.elevation.pointCoordinate(p);{const _=this.pointCoordinate(r,p.x,p.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(r,l){if(r.elevation)return!this.pointCoordinate3D(r,l.x,l.y);const h=r.horizonLineFromTop();return l.y<h}createInversionMatrix(r,l){return hO}createTileMatrix(r,l,h){let p,_,x;const T=h.canonical,A=Ws(new Float64Array(16));if(this.isReprojectedInTileSpace){const I=mc(T,this);p=1,_=I.x+h.wrap*I.scale,x=I.y,lc(A,A,[p/I.scale,p/I.scale,r.pixelsPerMeter/l])}else p=l/r.zoomScale(T.z),_=(T.x+Math.pow(2,T.z)*h.wrap)*p,x=T.y*p;return Nf(A,A,[_,x,0]),lc(A,A,[p/Jt,p/Jt,1]),A}upVector(r,l,h){return[0,0,1]}upVectorScale(r,l,h){return{metersToTile:1}}}class fO extends tl{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[l,h]=this.parallels=r.parallels||[29.5,45.5],p=Math.sin(rt(l));this.n=(p+Math.sin(rt(h)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(r,l){const{n:h,c:p,r0:_}=this,x=rt(r-this.center[0]),T=rt(l),A=Math.sqrt(p-2*h*Math.sin(T))/h;return{x:A*Math.sin(x*h),y:A*Math.cos(x*h)-_,z:0}}unproject(r,l){const{n:h,c:p,r0:_}=this,x=_+l;let T=Math.atan2(r,Math.abs(x))*Math.sign(x);x*h<0&&(T-=Math.PI*Math.sign(r)*Math.sign(x));const A=rt(this.center[0])*h;T=ti(T,-Math.PI-A,Math.PI-A);const I=xt(Ge(T/h)+this.center[0],-180,180),P=Math.asin(xt((p-(r*r+x*x)*h*h)/(2*h),-1,1)),D=xt(Ge(P),-85.051129,qs);return new Ti(I,D)}}const ad=1.340264,ld=-.081106,cd=893e-6,ud=.003796,rg=Math.sqrt(3)/2;class dO extends tl{project(r,l){l=l/180*Math.PI,r=r/180*Math.PI;const h=Math.asin(rg*Math.sin(l)),p=h*h,_=p*p*p;return{x:.5*(r*Math.cos(h)/(rg*(ad+3*ld*p+_*(7*cd+9*ud*p)))/Math.PI+.5),y:1-.5*(h*(ad+ld*p+_*(cd+ud*p))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,p=h*h,_=p*p*p;for(let P,D,O,N=0;N<12&&(D=h*(ad+ld*p+_*(cd+ud*p))-l,O=ad+3*ld*p+_*(7*cd+9*ud*p),P=D/O,h=xt(h-P,-Math.PI/3,Math.PI/3),p=h*h,_=p*p*p,!(Math.abs(P)<1e-12));++N);const x=rg*r*(ad+3*ld*p+_*(7*cd+9*ud*p))/Math.cos(h),T=Math.asin(Math.sin(h)/rg),A=xt(180*x/Math.PI,-180,180),I=xt(180*T/Math.PI,-85.051129,qs);return new Ti(A,I)}}class pO extends tl{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){return{x:.5+r/360,y:.5-l/360,z:0}}unproject(r,l){const h=360*(r-.5),p=xt(360*(.5-l),-85.051129,qs);return new Ti(h,p)}}const Qu=Math.PI/2;function sg(a){return Math.tan((Qu+a)/2)}class mO extends tl{constructor(r){super(r),this.center=r.center||[0,30];const[l,h]=this.parallels=r.parallels||[30,30];let p=rt(l),_=rt(h);this.southernCenter=p+_<0,this.southernCenter&&(p=-p,_=-_);const x=Math.cos(p),T=sg(p);this.n=p===_?Math.sin(p):Math.log(x/Math.cos(_))/Math.log(sg(_)/T),this.f=x*Math.pow(sg(p),this.n)/this.n}project(r,l){l=rt(l),this.southernCenter&&(l=-l),r=rt(r-this.center[0]);const h=1e-6,{n:p,f:_}=this;_>0?l<-Qu+h&&(l=-Qu+h):l>Qu-h&&(l=Qu-h);const x=_/Math.pow(sg(l),p);let T=x*Math.sin(p*r),A=_-x*Math.cos(p*r);return T=.5*(T/Math.PI+.5),A=.5*(A/Math.PI+.5),{x:T,y:this.southernCenter?A:1-A,z:0}}unproject(r,l){r=(2*r-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:h,f:p}=this,_=p-l,x=Math.sign(_),T=Math.sign(h)*Math.sqrt(r*r+_*_);let A=Math.atan2(r,Math.abs(_))*x;_*h<0&&(A-=Math.PI*Math.sign(r)*x);const I=xt(Ge(A/h)+this.center[0],-180,180),P=xt(Ge(2*Math.atan(Math.pow(p/T,1/h))-Qu),-85.051129,qs);return new Ti(I,this.southernCenter?-P:P)}}class iE extends tl{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,l){return{x:xo(r),y:vo(l),z:0}}unproject(r,l){const h=as(r),p=ar(l);return new Ti(h,p)}}const nE=rt(qs);class gO extends tl{project(r,l){const h=(l=rt(l))*l,p=h*h;return{x:.5*((r=rt(r))*(.8707-.131979*h+p*(p*(.003971*h-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+h*(.015085+p*(.028874*h-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(r,l){r=(2*r-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,p=25,_=0,x=h*h;do{x=h*h;const I=x*x;_=(h*(1.007226+x*(.015085+I*(.028874*x-.044475-.005916*I)))-l)/(1.007226+x*(.045255+I*(.259866*x-.311325-.005916*11*I))),h=xt(h-_,-nE,nE)}while(Math.abs(_)>1e-6&&--p>0);x=h*h;const T=xt(Ge(r/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),A=Ge(h);return new Ti(T,A)}}const rE=rt(qs);class _O extends tl{project(r,l){l=rt(l),r=rt(r);const h=Math.cos(l),p=2/Math.PI,_=Math.acos(h*Math.cos(r/2)),x=Math.sin(_)/_,T=.5*(r*p+2*h*Math.sin(r/2)/x)||0,A=.5*(l+Math.sin(l)/x)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(A/Math.PI+1),z:0}}unproject(r,l){let h=r=(2*r-.5)*Math.PI,p=l=(2*(1-l)-1)*Math.PI,_=25;const x=1e-6;let T=0,A=0;do{const I=Math.cos(p),P=Math.sin(p),D=2*P*I,O=P*P,N=I*I,z=Math.cos(h/2),$=Math.sin(h/2),G=2*z*$,se=$*$,pe=1-N*z*z,ee=pe?1/pe:0,de=pe?Math.acos(I*z)*Math.sqrt(1/pe):0,ye=.5*(2*de*I*$+2*h/Math.PI)-r,ge=.5*(de*P+p)-l,Ve=.5*ee*(N*se+de*I*z*O)+1/Math.PI,Ne=ee*(G*D/4-de*P*$),Ye=.125*ee*(D*$-de*P*N*G),ft=.5*ee*(O*z+de*se*I)+.5,He=Ne*Ye-ft*Ve;T=(ge*Ne-ye*ft)/He,A=(ye*Ye-ge*Ve)/He,h=xt(h-T,-Math.PI,Math.PI),p=xt(p-A,-rE,rE)}while((Math.abs(T)>x||Math.abs(A)>x)&&--_>0);return new Ti(Ge(h),Ge(p))}}class sE extends tl{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(rt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,l){const{scale:h,cosPhi:p}=this;return{x:rt(r)*p*h+.5,y:-Math.sin(rt(l))/p*h+.5,z:0}}unproject(r,l){const{scale:h,cosPhi:p}=this,_=-(l-.5)/h,x=xt(Ge((r-.5)/h)/p,-180,180),T=Math.asin(xt(_*p,-1,1)),A=xt(Ge(T),-85.051129,qs);return new Ti(x,A)}}class yO extends iE{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,l,h){const p=Xf(r,l,h);return gn(p,p,qf(yo(h))),{x:p[0],y:p[1],z:p[2]}}locationPoint(r,l){const h=zu(l.lat,l.lng),p=wr([],h),_=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(l),r._centerAltitude):r._centerAltitude;jf(h,h,p,Xs(1,0)*Jt*_);const x=Ws(new Float64Array(16));return ac(x,r.pixelMatrix,r.globeMatrix),gn(h,h,x),new me(h[0],h[1])}pixelsPerMeter(r,l){return Xs(1,0)*l}pixelSpaceConversion(r,l,h){const p=Xs(1,r)*l,_=vi(Xs(1,45)*l,p,h);return this.pixelsPerMeter(r,l)/_}createTileMatrix(r,l,h){const p=m0(yo(h.canonical));return ac(new Float64Array(16),r.globeMatrix,p)}createInversionMatrix(r,l){const{center:h}=r,p=qf(yo(l));return Dm(p,p,rt(h.lng)),o0(p,p,rt(h.lat)),lc(p,p,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(r,l,h,p){return Lw(r,l,h,!0)||new Vu(0,0)}pointCoordinate3D(r,l,h){const p=this.pointCoordinate(r,l,h,0);return[p.x,p.y,p.z]}isPointAboveHorizon(r,l){return!Lw(r,l.x,l.y,!1)}farthestPixelDistance(r){const l=function(p,_){const x=p.cameraToCenterDistance,T=p._centerAltitude*_,A=p._camera,I=p._camera.forward(),P=la([],os([],I,-x),[0,0,T]),D=p.worldSize/(2*Math.PI),O=[0,0,-D],N=p.width/p.height,z=Math.tan(p.fovAboveCenter),$=os([],A.up(),z),G=os([],A.right(),z*N),se=wr([],la([],la([],I,$),G)),pe=[];let ee;if(new u0(P,se).closestPointOnSphere(O,D,pe)){const de=la([],pe,O),ye=Hs([],de,P);ee=Math.cos(p.fovAboveCenter)*zf(ye)}else{const de=Hs([],P,O),ye=Hs([],O,P);wr(ye,ye);const ge=zf(de)-D;ee=Math.sqrt(ge*(ge+2*D));const Ve=Math.acos(ee/(D+ge))-Math.acos(Ts(I,ye));ee*=Math.cos(Ve)}return 1.01*ee}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),h=Uu(r.zoom);if(h>0){const p=tE(r,Xs(1,r.center.lat)*r.worldSize),_=r.worldSize/(2*Math.PI),x=Math.max(r.width,r.height)/r.worldSize*Math.PI;return vi(l,p+_*(1-Math.cos(x)),Math.pow(h,10))}return l}upVector(r,l,h){return Xf(l,h,r,1)}upVectorScale(r){return{metersToTile:Om(Bm(yo(r)))}}}function oE(a){const r=a.parallels,l=!!r&&Math.abs(r[0]+r[1])<.01;switch(a.name){case"mercator":return new iE(a);case"equirectangular":return new pO(a);case"naturalEarth":return new gO(a);case"equalEarth":return new dO(a);case"winkelTripel":return new _O(a);case"albers":return l?new sE(a):new fO(a);case"lambertConformalConic":return l?new sE(a):new mO(a);case"globe":return new yO(a)}throw new Error(`Invalid projection name: ${a.name}`)}const xO=Xm.types,vO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function og(a,r,l,h,p,_,x,T,A,I,P,D,O){const N=T?Math.min(el,Math.round(T[0])):0,z=T?Math.min(el,Math.round(T[1])):0;a.emplaceBack(r,l,Math.round(32*h),Math.round(32*p),_,x,(N<<1)+(A?1:0),z,16*I,16*P,256*D,256*O)}function ag(a,r,l,h,p,_,x){a.emplaceBack(r,l,h,p,_,x)}function lg(a,r,l,h,p){a.emplaceBack(r,l,h,p),a.emplaceBack(r,l,h,p),a.emplaceBack(r,l,h,p),a.emplaceBack(r,l,h,p)}function bO(a){for(const r of a.sections)if(U(r.text))return!0;return!1}class $0{constructor(r){this.layoutVertexArray=new Us,this.indexArray=new or,this.programConfigurations=r,this.segments=new En,this.dynamicLayoutVertexArray=new Vi,this.opacityVertexArray=new ji,this.placedSymbolArray=new aw,this.globeExtVertexArray=new nn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,l,h,p){this.isEmpty()||(h&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,MD.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,PD.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,vO,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,RD.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||p)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Dt($0,"SymbolBuffers");class W0{constructor(r,l,h){this.layoutVertexArray=new r,this.layoutAttributes=l,this.indexArray=new h,this.segments=new En,this.collisionVertexArray=new Zi,this.collisionVertexArrayExt=new sr}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,kD.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,DD.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Dt(W0,"CollisionBuffers");class il{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(x=>x.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ws([]),this.placementViewportMatrix=Ws([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=D0(this.zoom,l["text-size"]),this.iconSizeData=D0(this.zoom,l["icon-size"]);const h=this.layers[0].layout,p=h.get("symbol-sort-key"),_=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(x=>ls[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new $0(new oc(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new $0(new oc(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new uw,this.lineVertexArray=new hw,this.symbolInstances=new cw}calculateGlyphDependencies(r,l,h,p,_){for(let x=0;x<r.length;x++)if(l[r.charCodeAt(x)]=!0,p&&_){const T=rd[r.charAt(x)];T&&(l[T.charCodeAt(0)]=!0)}}populate(r,l,h,p){const _=this.layers[0],x=_.layout,T=this.projection.name==="globe",A=x.get("text-font"),I=x.get("text-field"),P=x.get("icon-image"),D=(I.value.kind!=="constant"||I.value.value instanceof vr&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),O=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,N=x.get("symbol-sort-key");if(this.features=[],!D&&!O)return;const z=l.iconDependencies,$=l.glyphDependencies,G=l.availableImages,se=new Re(this.zoom);for(const{feature:pe,id:ee,index:de,sourceLayerIndex:ye}of r){const ge=_._featureFilter.needGeometry,Ve=fc(pe,ge);if(!_._featureFilter.filter(se,Ve,h))continue;if(ge||(Ve.geometry=ca(pe,h,p)),T&&pe.type!==1&&h.z<=5){const He=Ve.geometry,Je=.98078528056,et=(at,dt)=>Ts(Xf(at.x,at.y,h,1),Xf(dt.x,dt.y,h,1))<Je;for(let at=0;at<He.length;at++)He[at]=Pk(He[at],et)}let Ne,Ye;if(D){const He=_.getValueAndResolveTokens("text-field",Ve,h,G),Je=vr.factory(He);bO(Je)&&(this.hasRTLText=!0),(!this.hasRTLText||ve()==="unavailable"||this.hasRTLText&&Ee.isParsed())&&(Ne=BD(Je,_,Ve))}if(O){const He=_.getValueAndResolveTokens("icon-image",Ve,h,G);Ye=He instanceof fr?He:fr.fromString(He)}if(!Ne&&!Ye)continue;const ft=this.sortFeaturesByKey?N.evaluate(Ve,{},h):void 0;if(this.features.push({id:ee,text:Ne,icon:Ye,index:de,sourceLayerIndex:ye,geometry:Ve.geometry,properties:pe.properties,type:xO[pe.type],sortKey:ft}),Ye&&(z[Ye.name]=!0),Ne){const He=A.evaluate(Ve,{},h).join(","),Je=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ls.vertical)>=0;for(const et of Ne.sections)if(et.image)z[et.image.name]=!0;else{const at=b(Ne.toString()),dt=et.fontStack||He,Xe=$[dt]=$[dt]||{};this.calculateGlyphDependencies(et.text,Xe,Je,this.allowVerticalPlacement,at)}}}x.get("symbol-placement")==="line"&&(this.features=function(pe){const ee={},de={},ye=[];let ge=0;function Ve(He){ye.push(pe[He]),ge++}function Ne(He,Je,et){const at=de[He];return delete de[He],de[Je]=at,ye[at].geometry[0].pop(),ye[at].geometry[0]=ye[at].geometry[0].concat(et[0]),at}function Ye(He,Je,et){const at=ee[Je];return delete ee[Je],ee[He]=at,ye[at].geometry[0].shift(),ye[at].geometry[0]=et[0].concat(ye[at].geometry[0]),at}function ft(He,Je,et){const at=et?Je[0][Je[0].length-1]:Je[0][0];return`${He}:${at.x}:${at.y}`}for(let He=0;He<pe.length;He++){const Je=pe[He],et=Je.geometry,at=Je.text?Je.text.toString():null;if(!at){Ve(He);continue}const dt=ft(at,et),Xe=ft(at,et,!0);if(dt in de&&Xe in ee&&de[dt]!==ee[Xe]){const wt=Ye(dt,Xe,et),qt=Ne(dt,Xe,ye[wt].geometry);delete ee[dt],delete de[Xe],de[ft(at,ye[qt].geometry,!0)]=qt,ye[wt].geometry=null}else dt in de?Ne(dt,Xe,et):Xe in ee?Ye(dt,Xe,et):(Ve(He),ee[dt]=ge-1,de[Xe]=ge-1)}return ye.filter(He=>He.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,ee)=>pe.sortKey-ee.sortKey)}update(r,l,h,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,l,this.layers,h,p),this.icon.programConfigurations.updatePaintArrays(r,l,this.layers,h,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=oE(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,l){const h=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:p,y:_}of l)this.lineVertexArray.emplaceBack(p,_);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(r,l,h,p,_,x,T,A,I,P,D,O,N,z){const $=r.indexArray,G=r.layoutVertexArray,se=r.globeExtVertexArray,pe=r.segments.prepareSegment(4*l.length,G,$,this.canOverlap?x.sortKey:void 0),ee=this.glyphOffsetArray.length,de=pe.vertexLength,ye=this.allowVerticalPlacement&&T===ls.vertical?Math.PI/2:0,ge=x.text&&x.text.sections;for(let Ne=0;Ne<l.length;Ne++){const{tl:Ye,tr:ft,bl:He,br:Je,tex:et,pixelOffsetTL:at,pixelOffsetBR:dt,minFontScaleX:Xe,minFontScaleY:wt,glyphOffset:qt,isSDF:St,sectionIndex:Ft}=l[Ne],Tt=pe.vertexLength,Zt=qt[1];if(og(G,I.x,I.y,Ye.x,Zt+Ye.y,et.x,et.y,h,St,at.x,at.y,Xe,wt),og(G,I.x,I.y,ft.x,Zt+ft.y,et.x+et.w,et.y,h,St,dt.x,at.y,Xe,wt),og(G,I.x,I.y,He.x,Zt+He.y,et.x,et.y+et.h,h,St,at.x,dt.y,Xe,wt),og(G,I.x,I.y,Je.x,Zt+Je.y,et.x+et.w,et.y+et.h,h,St,dt.x,dt.y,Xe,wt),A){const{x:fi,y:ci,z:ai}=A.anchor,[Yt,Di,ni]=A.up;ag(se,fi,ci,ai,Yt,Di,ni),ag(se,fi,ci,ai,Yt,Di,ni),ag(se,fi,ci,ai,Yt,Di,ni),ag(se,fi,ci,ai,Yt,Di,ni),lg(r.dynamicLayoutVertexArray,fi,ci,ai,ye)}else lg(r.dynamicLayoutVertexArray,I.x,I.y,I.z,ye);$.emplaceBack(Tt,Tt+1,Tt+2),$.emplaceBack(Tt+1,Tt+2,Tt+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(qt[0]),Ne!==l.length-1&&Ft===l[Ne+1].sectionIndex||r.programConfigurations.populatePaintArrays(G.length,x,x.index,{},N,z,ge&&ge[Ft])}const Ve=A?A.anchor:I;r.placedSymbolArray.emplaceBack(Ve.x,Ve.y,Ve.z,I.x,I.y,ee,this.glyphOffsetArray.length-ee,de,P,D,I.segment,h?h[0]:0,h?h[1]:0,p[0],p[1],T,0,!1,0,O,0)}_commitLayoutVertex(r,l,h,p,_,x,T){r.emplaceBack(l,h,p,_,x,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(r,l,h,p,_,x,T){const A=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),I=A.vertexLength,P=T.tileAnchorX,D=T.tileAnchorY;for(let N=0;N<4;N++)h.collisionVertexArray.emplaceBack(0,0,0,0);h.collisionVertexArrayExt.emplaceBack(l,-r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(l,r.padding,-r.padding),h.collisionVertexArrayExt.emplaceBack(l,r.padding,r.padding),h.collisionVertexArrayExt.emplaceBack(l,-r.padding,r.padding),this._commitLayoutVertex(h.layoutVertexArray,p,_,x,P,D,new me(r.x1,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,_,x,P,D,new me(r.x2,r.y1)),this._commitLayoutVertex(h.layoutVertexArray,p,_,x,P,D,new me(r.x2,r.y2)),this._commitLayoutVertex(h.layoutVertexArray,p,_,x,P,D,new me(r.x1,r.y2)),A.vertexLength+=4;const O=h.indexArray;O.emplaceBack(I,I+1),O.emplaceBack(I+1,I+2),O.emplaceBack(I+2,I+3),O.emplaceBack(I+3,I),A.primitiveLength+=4}_addTextDebugCollisionBoxes(r,l,h,p,_,x){for(let T=p;T<_;T++){const A=h.get(T),I=this.getSymbolInstanceTextSize(r,x,l,T);this._addCollisionDebugVertices(A,I,this.textCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(r,l,h,p,_,x){for(let T=p;T<_;T++){const A=h.get(T),I=this.getSymbolInstanceIconSize(r,l,x.placedIconSymbolIndex);this._addCollisionDebugVertices(A,I,this.iconCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,x)}}generateCollisionDebugBuffers(r,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new W0(fn,CT.members,mo),this.iconCollisionBox=new W0(fn,CT.members,mo);const h=qu(this.iconSizeData,r),p=qu(this.textSizeData,r);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(p,r,l,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(p,r,l,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,r,l,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,r,l,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(r,l,h,p){const _=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:p),x=Ym(this.textSizeData,r,_)/lr;return this.tilePixelRatio*x}getSymbolInstanceIconSize(r,l,h){const p=this.icon.placedSymbolArray.get(h),_=Ym(this.iconSizeData,r,p);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(r,l,h){r.emplaceBack(l,-h,-h),r.emplaceBack(l,h,-h),r.emplaceBack(l,h,h),r.emplaceBack(l,-h,h)}_updateTextDebugCollisionBoxes(r,l,h,p,_,x){for(let T=p;T<_;T++){const A=h.get(T),I=this.getSymbolInstanceTextSize(r,x,l,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,I,A.padding)}}_updateIconDebugCollisionBoxes(r,l,h,p,_,x){for(let T=p;T<_;T++){const A=h.get(T),I=this.getSymbolInstanceIconSize(r,l,x);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,I,A.padding)}}updateCollisionDebugBuffers(r,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=qu(this.iconSizeData,r),p=qu(this.textSizeData,r);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(p,r,l,x.textBoxStartIndex,x.textBoxEndIndex,x),this._updateTextDebugCollisionBoxes(p,r,l,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._updateIconDebugCollisionBoxes(h,r,l,x.iconBoxStartIndex,x.iconBoxEndIndex,x.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(h,r,l,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,l,h,p,_,x,T,A,I){const P={};if(l<h){const{x1:D,y1:O,x2:N,y2:z,padding:$,projectedAnchorX:G,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ee,tileAnchorY:de,featureIndex:ye}=r.get(l);P.textBox={x1:D,y1:O,x2:N,y2:z,padding:$,projectedAnchorX:G,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ee,tileAnchorY:de},P.textFeatureIndex=ye}if(p<_){const{x1:D,y1:O,x2:N,y2:z,padding:$,projectedAnchorX:G,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ee,tileAnchorY:de,featureIndex:ye}=r.get(p);P.verticalTextBox={x1:D,y1:O,x2:N,y2:z,padding:$,projectedAnchorX:G,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ee,tileAnchorY:de},P.verticalTextFeatureIndex=ye}if(x<T){const{x1:D,y1:O,x2:N,y2:z,padding:$,projectedAnchorX:G,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ee,tileAnchorY:de,featureIndex:ye}=r.get(x);P.iconBox={x1:D,y1:O,x2:N,y2:z,padding:$,projectedAnchorX:G,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ee,tileAnchorY:de},P.iconFeatureIndex=ye}if(A<I){const{x1:D,y1:O,x2:N,y2:z,padding:$,projectedAnchorX:G,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ee,tileAnchorY:de,featureIndex:ye}=r.get(A);P.verticalIconBox={x1:D,y1:O,x2:N,y2:z,padding:$,projectedAnchorX:G,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:ee,tileAnchorY:de},P.verticalIconFeatureIndex=ye}return P}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,l){const h=r.placedSymbolArray.get(l),p=h.vertexStartIndex+4*h.numGlyphs;for(let _=h.vertexStartIndex;_<p;_+=4)r.indexArray.emplaceBack(_,_+1,_+2),r.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(r),h=Math.cos(r),p=[],_=[],x=[];for(let T=0;T<this.symbolInstances.length;++T){x.push(T);const A=this.symbolInstances.get(T);p.push(0|Math.round(l*A.tileAnchorX+h*A.tileAnchorY)),_.push(A.featureIndex)}return x.sort((T,A)=>p[T]-p[A]||_[A]-_[T]),x}addToSortKeyRanges(r,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:I}=h;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&_!==p&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&x!==_&&x!==p&&this.addIndicesForPlacedSymbol(this.text,x),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Dt(il,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),il.MAX_GLYPHS=65535,il.addDynamicAttributes=lg;const wO=new ct({"symbol-placement":new Ce(Ze.layout_symbol["symbol-placement"]),"symbol-spacing":new Ce(Ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ce(Ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $e(Ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ce(Ze.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ce(Ze.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ce(Ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ce(Ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ce(Ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new $e(Ze.layout_symbol["icon-size"]),"icon-text-fit":new Ce(Ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ce(Ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new $e(Ze.layout_symbol["icon-image"]),"icon-rotate":new $e(Ze.layout_symbol["icon-rotate"]),"icon-padding":new Ce(Ze.layout_symbol["icon-padding"]),"icon-keep-upright":new Ce(Ze.layout_symbol["icon-keep-upright"]),"icon-offset":new $e(Ze.layout_symbol["icon-offset"]),"icon-anchor":new $e(Ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ce(Ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ce(Ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ce(Ze.layout_symbol["text-rotation-alignment"]),"text-field":new $e(Ze.layout_symbol["text-field"]),"text-font":new $e(Ze.layout_symbol["text-font"]),"text-size":new $e(Ze.layout_symbol["text-size"]),"text-max-width":new $e(Ze.layout_symbol["text-max-width"]),"text-line-height":new $e(Ze.layout_symbol["text-line-height"]),"text-letter-spacing":new $e(Ze.layout_symbol["text-letter-spacing"]),"text-justify":new $e(Ze.layout_symbol["text-justify"]),"text-radial-offset":new $e(Ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ce(Ze.layout_symbol["text-variable-anchor"]),"text-anchor":new $e(Ze.layout_symbol["text-anchor"]),"text-max-angle":new Ce(Ze.layout_symbol["text-max-angle"]),"text-writing-mode":new Ce(Ze.layout_symbol["text-writing-mode"]),"text-rotate":new $e(Ze.layout_symbol["text-rotate"]),"text-padding":new Ce(Ze.layout_symbol["text-padding"]),"text-keep-upright":new Ce(Ze.layout_symbol["text-keep-upright"]),"text-transform":new $e(Ze.layout_symbol["text-transform"]),"text-offset":new $e(Ze.layout_symbol["text-offset"]),"text-allow-overlap":new Ce(Ze.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ce(Ze.layout_symbol["text-ignore-placement"]),"text-optional":new Ce(Ze.layout_symbol["text-optional"])});var H0={paint:new ct({"icon-opacity":new $e(Ze.paint_symbol["icon-opacity"]),"icon-color":new $e(Ze.paint_symbol["icon-color"]),"icon-halo-color":new $e(Ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new $e(Ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $e(Ze.paint_symbol["icon-halo-blur"]),"icon-translate":new Ce(Ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ce(Ze.paint_symbol["icon-translate-anchor"]),"text-opacity":new $e(Ze.paint_symbol["text-opacity"]),"text-color":new $e(Ze.paint_symbol["text-color"],{runtimeType:vs,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new $e(Ze.paint_symbol["text-halo-color"]),"text-halo-width":new $e(Ze.paint_symbol["text-halo-width"]),"text-halo-blur":new $e(Ze.paint_symbol["text-halo-blur"]),"text-translate":new Ce(Ze.paint_symbol["text-translate"]),"text-translate-anchor":new Ce(Ze.paint_symbol["text-translate-anchor"])}),layout:wO};class aE{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Ra,this.defaultValue=r}evaluate(r){if(r.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(r.formattedSection))return l.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Dt(aE,"FormatSectionOverride",{omit:["defaultValue"]});class cg extends $s{constructor(r){super(r,H0)}recalculate(r,l){super.recalculate(r,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const p=[];for(const _ of h)p.indexOf(_)<0&&p.push(_);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,l,h,p){const _=this.layout.get(r).evaluate(l,{},h,p),x=this._unevaluatedLayout._values[r];return x.isDataDriven()||ja(x.value)||!_?_:function(T,A){return A.replace(/{([^{}]+)}/g,(I,P)=>P in T?String(T[P]):"")}(l.properties,_)}createBucket(r){return new il(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of H0.paint.overridableProperties){if(!cg.hasPaintOverride(this.layout,r))continue;const l=this.paint.get(r),h=new aE(l),p=new wu(h,l.property.specification);let _=null;_=l.value.kind==="constant"||l.value.kind==="source"?new Tu("source",p):new ra("composite",p,l.value.zoomStops,l.value._interpolationType),this.paint._values[r]=new st(l.property,_,l.parameters)}}_handleOverridablePaintPropertyUpdate(r,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&cg.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,l){const h=r.get("text-field"),p=H0.paint.properties[l];let _=!1;const x=T=>{for(const A of T)if(p.overrides&&p.overrides.hasOverride(A))return void(_=!0)};if(h.value.kind==="constant"&&h.value.value instanceof vr)x(h.value.value.sections);else if(h.value.kind==="source"){const T=I=>{_||(I instanceof Dl&&Mn(I.value)===Pa?x(I.value.sections):I instanceof Ol?x(I.sections):I.eachChild(T))},A=h.value;A._styleExpression&&T(A._styleExpression.expression)}return _}getProgramConfiguration(r){return new Ja(this,r)}}var TO={paint:new ct({"background-color":new Ce(Ze.paint_background["background-color"]),"background-pattern":new Ce(Ze.paint_background["background-pattern"]),"background-opacity":new Ce(Ze.paint_background["background-opacity"])})},EO={paint:new ct({"raster-opacity":new Ce(Ze.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ce(Ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ce(Ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ce(Ze.paint_raster["raster-brightness-max"]),"raster-saturation":new Ce(Ze.paint_raster["raster-saturation"]),"raster-contrast":new Ce(Ze.paint_raster["raster-contrast"]),"raster-resampling":new Ce(Ze.paint_raster["raster-resampling"]),"raster-fade-duration":new Ce(Ze.paint_raster["raster-fade-duration"])})};class AO extends $s{constructor(r){super(r,{}),this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var SO={paint:new ct({"sky-type":new Ce(Ze.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ce(Ze.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ce(Ze.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ce(Ze.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ce(Ze.paint_sky["sky-gradient-radius"]),"sky-gradient":new it(Ze.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ce(Ze.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ce(Ze.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ce(Ze.paint_sky["sky-opacity"])})};function X0(a,r,l){const h=[0,0,1],p=Rw([]);return kw(p,p,l?-rt(a)+Math.PI:rt(a)),Pw(p,p,-rt(r)),Sw(h,h,p),wr(h,h)}const IO={circle:class extends $s{constructor(a){super(a,Nk)}createBucket(a){return new b0(a)}queryRadius(a){const r=a;return ju("circle-radius",this,r)+ju("circle-stroke-width",this,r)+zm(this.paint.get("circle-translate"))}queryIntersectsFeature(a,r,l,h,p,_,x,T){const A=Qw(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,a.pixelToTileUnitsFactor),I=this.paint.get("circle-radius").evaluate(r,l)+this.paint.get("circle-stroke-width").evaluate(r,l);return eT(a,h,_,x,T,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",A,I)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new Ja(this,a)}},heatmap:class extends $s{createBucket(a){return new iT(a)}constructor(a){super(a,jk),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=A0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return ju("heatmap-radius",this,a)}queryIntersectsFeature(a,r,l,h,p,_,x,T){const A=this.paint.get("heatmap-radius").evaluate(r,l);return eT(a,h,_,x,T,!0,!0,new me(0,0),A)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new Ja(this,a)}},hillshade:class extends $s{constructor(a){super(a,$k)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends $s{constructor(a){super(a,sD)}getProgramIds(){const a=this.paint.get("fill-pattern"),r=a&&a.constantOr(1),l=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new Ja(this,a)}recalculate(a,r){super.recalculate(a,r);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Wm(a)}queryRadius(){return zm(this.paint.get("fill-translate"))}queryIntersectsFeature(a,r,l,h,p,_){return!a.queryGeometry.isAboveHorizon&&Gw(Jw(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,a.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}},"fill-extrusion":class extends $s{constructor(a){super(a,bD)}createBucket(a){return new td(a)}queryRadius(){return zm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new Ja(this,a)}queryIntersectsFeature(a,r,l,h,p,_,x,T,A){const I=Qw(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,a.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(r,l),D=this.paint.get("fill-extrusion-base").evaluate(r,l),O=[0,0],N=T&&_.elevation,z=_.elevation?_.elevation.exaggeration():1,$=a.tile.getBucket(this);if(N&&$ instanceof td){const de=$.centroidVertexArray,ye=A+1;ye<de.length&&(O[0]=de.geta_centroid_pos0(ye),O[1]=de.geta_centroid_pos1(ye))}if(O[0]===0&&O[1]===1)return!1;_.projection.name==="globe"&&(h=vT([h],[new me(0,0),new me(Jt,Jt)],a.tileID.canonical).map(de=>de.polygon).flat());const G=N?T:null,[se,pe]=function(de,ye,ge,Ve,Ne,Ye,ft,He,Je,et,at){return de.projection.name==="globe"?function(dt,Xe,wt,qt,St,Ft,Tt,Zt,fi,ci,ai){const Yt=[],Di=[],ni=dt.projection.upVectorScale(ai,dt.center.lat,dt.worldSize).metersToTile,di=[0,0,0,1],zi=[0,0,0,1],Yi=(Ki,rn,dn,Zn)=>{Ki[0]=rn,Ki[1]=dn,Ki[2]=Zn,Ki[3]=1},Xi=xT();wt>0&&(wt+=Xi),qt+=Xi;for(const Ki of Xe){const rn=[],dn=[];for(const Zn of Ki){const Oi=Zn.x+St.x,Rn=Zn.y+St.y,Sn=dt.projection.projectTilePoint(Oi,Rn,ai),Si=dt.projection.upVector(ai,Zn.x,Zn.y);let an=wt,Fn=qt;if(Tt){const Ui=ET(Oi,Rn,wt,qt,Tt,Zt,fi,ci);an+=Ui.base,Fn+=Ui.top}wt!==0?Yi(di,Sn.x+Si[0]*ni*an,Sn.y+Si[1]*ni*an,Sn.z+Si[2]*ni*an):Yi(di,Sn.x,Sn.y,Sn.z),Yi(zi,Sn.x+Si[0]*ni*Fn,Sn.y+Si[1]*ni*Fn,Sn.z+Si[2]*ni*Fn),gn(di,di,Ft),gn(zi,zi,Ft),rn.push(new Xu(di[0],di[1],di[2])),dn.push(new Xu(zi[0],zi[1],zi[2]))}Yt.push(rn),Di.push(dn)}return[Yt,Di]}(de,ye,ge,Ve,Ne,Ye,ft,He,Je,et,at):ft?function(dt,Xe,wt,qt,St,Ft,Tt,Zt,fi){const ci=[],ai=[],Yt=[0,0,0,1];for(const Di of dt){const ni=[],di=[];for(const zi of Di){const Yi=zi.x+qt.x,Xi=zi.y+qt.y,Ki=ET(Yi,Xi,Xe,wt,Ft,Tt,Zt,fi);Yt[0]=Yi,Yt[1]=Xi,Yt[2]=Ki.base,Yt[3]=1,cc(Yt,Yt,St),Yt[3]=Math.max(Yt[3],1e-5);const rn=new Xu(Yt[0]/Yt[3],Yt[1]/Yt[3],Yt[2]/Yt[3]);Yt[0]=Yi,Yt[1]=Xi,Yt[2]=Ki.top,Yt[3]=1,cc(Yt,Yt,St),Yt[3]=Math.max(Yt[3],1e-5);const dn=new Xu(Yt[0]/Yt[3],Yt[1]/Yt[3],Yt[2]/Yt[3]);ni.push(rn),di.push(dn)}ci.push(ni),ai.push(di)}return[ci,ai]}(ye,ge,Ve,Ne,Ye,ft,He,Je,et):function(dt,Xe,wt,qt,St){const Ft=[],Tt=[],Zt=St[8]*Xe,fi=St[9]*Xe,ci=St[10]*Xe,ai=St[11]*Xe,Yt=St[8]*wt,Di=St[9]*wt,ni=St[10]*wt,di=St[11]*wt;for(const zi of dt){const Yi=[],Xi=[];for(const Ki of zi){const rn=Ki.x+qt.x,dn=Ki.y+qt.y,Zn=St[0]*rn+St[4]*dn+St[12],Oi=St[1]*rn+St[5]*dn+St[13],Rn=St[2]*rn+St[6]*dn+St[14],Sn=St[3]*rn+St[7]*dn+St[15],Si=Zn+Zt,an=Oi+fi,Fn=Rn+ci,Ui=Math.max(Sn+ai,1e-5),_n=Zn+Yt,dr=Oi+Di,Yn=Rn+ni,Kn=Math.max(Sn+di,1e-5);Yi.push(new Xu(Si/Ui,an/Ui,Fn/Ui)),Xi.push(new Xu(_n/Kn,dr/Kn,Yn/Kn))}Ft.push(Yi),Tt.push(Xi)}return[Ft,Tt]}(ye,ge,Ve,Ne,Ye)}(_,h,D,P,I,x,G,O,z,_.center.lat,a.tileID.canonical),ee=a.queryGeometry;return function(de,ye,ge){let Ve=1/0;Gw(ge,ye)&&(Ve=TT(ge,ye[0]));for(let Ne=0;Ne<ye.length;Ne++){const Ye=ye[Ne],ft=de[Ne];for(let He=0;He<Ye.length-1;He++){const Je=Ye[He],et=[Je,Ye[He+1],ft[He+1],ft[He],Je];qw(ge,et)&&(Ve=Math.min(Ve,TT(ge,et)))}}return Ve!==1/0&&Ve}(se,pe,ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends $s{constructor(a){super(a,AT),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof af,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,r){super.recalculate(a,r),this.paint._values["line-floorwidth"]=ST.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Zm(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new Ja(this,a)}queryRadius(a){const r=a,l=IT(ju("line-width",this,r),ju("line-gap-width",this,r)),h=ju("line-offset",this,r);return l/2+Math.abs(h)+zm(this.paint.get("line-translate"))}queryIntersectsFeature(a,r,l,h,p,_){if(a.queryGeometry.isAboveHorizon)return!1;const x=Jw(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,a.pixelToTileUnitsFactor),T=a.pixelToTileUnitsFactor/2*IT(this.paint.get("line-width").evaluate(r,l),this.paint.get("line-gap-width").evaluate(r,l)),A=this.paint.get("line-offset").evaluate(r,l);return A&&(h=function(I,P){const D=[],O=new me(0,0);for(let N=0;N<I.length;N++){const z=I[N],$=[];for(let G=0;G<z.length;G++){const se=z[G-1],pe=z[G],ee=z[G+1],de=G===0?O:pe.sub(se)._unit()._perp(),ye=G===z.length-1?O:ee.sub(pe)._unit()._perp(),ge=de._add(ye)._unit();ge._mult(1/(ge.x*ye.x+ge.y*ye.y)),$.push(ge._mult(P)._add(pe))}D.push($)}return D}(h,A*a.pixelToTileUnitsFactor)),function(I,P,D){for(let O=0;O<P.length;O++){const N=P[O];if(I.length>=3){for(let z=0;z<N.length;z++)if(dc(I,N[z]))return!0}if(Ok(I,N,D))return!0}return!1}(x,h,T)}isTileClipped(){return!0}},symbol:cg,background:class extends $s{constructor(a){super(a,TO)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends $s{constructor(a){super(a,EO)}getProgramIds(){return["raster"]}},sky:class extends $s{constructor(a){super(a,SO),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=A0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(a,r){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),p=!h,_=a.style.light,x=_.properties.get("position");return p&&_.properties.get("anchor")==="viewport"&&Se("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?X0(x.azimuthal,90-x.polar,r):X0(h[0],90-h[1],r)}const l=this.paint.get("sky-gradient-center");return X0(l[0],90-l[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}}};class hd{constructor(r,l,h,p){this.context=r,this.format=h,this.texture=r.gl.createTexture(),this.update(l,p)}update(r,l,h){const{width:p,height:_}=r,{context:x}=this,{gl:T}=x,{HTMLImageElement:A,HTMLCanvasElement:I,HTMLVideoElement:P,ImageData:D,ImageBitmap:O}=v;if(T.bindTexture(T.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!l||l.premultiply!==!1)),h||this.size&&this.size[0]===p&&this.size[1]===_){const{x:N,y:z}=h||{x:0,y:0};r instanceof A||r instanceof I||r instanceof P||r instanceof D||O&&r instanceof O?T.texSubImage2D(T.TEXTURE_2D,0,N,z,T.RGBA,T.UNSIGNED_BYTE,r):T.texSubImage2D(T.TEXTURE_2D,0,N,z,p,_,T.RGBA,T.UNSIGNED_BYTE,r.data)}else this.size=[p,_],r instanceof A||r instanceof I||r instanceof P||r instanceof D||O&&r instanceof O?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,r):T.texImage2D(T.TEXTURE_2D,0,this.format,p,_,0,this.format,T.UNSIGNED_BYTE,r.data);this.useMipmap=!!(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&T.generateMipmap(T.TEXTURE_2D)}bind(r,l){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),r!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?r===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:r),this.filter=r),l!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,l),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class CO{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class MO{constructor(){this.tasks={},this.taskQueue=[],Dr(["process"],this),this.invoker=new CO(this.process),this.nextId=0}add(r,l){const h=this.nextId++,p=function({type:_,isSymbolTile:x,zoom:T}){return T=T||0,_==="message"?0:_!=="maybePrepare"||x?_!=="parseTile"||x?_==="parseTile"&&x?300-T:_==="maybePrepare"&&x?400-T:500:200-T:100-T}(l);if(p===0){pt();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[h]={fn:r,metadata:l,priority:p,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){pt();try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const l=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let r=null,l=1/0;for(let p=0;p<this.taskQueue.length;p++){const _=this.tasks[this.taskQueue[p]];_.priority<l&&(l=_.priority,r=p)}if(r===null)return null;const h=this.taskQueue[r];return this.taskQueue.splice(r,1),h}remove(){this.invoker.remove()}}class lE{constructor(r){this._stringToNumber={},this._numberToString=[];for(let l=0;l<r.length;l++){const h=r[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const RO=["tile","layer","source","sourceLayer","state"];class cE{constructor(r,l,h,p,_){this.type="Feature",this._vectorTileFeature=r,this._z=l,this._x=h,this._y=p,this.properties=r.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(r.id=this.id);for(const l of RO)this[l]!==void 0&&(r[l]=this[l]);return r}}const Ss=32,wo=33,nl=new Uint16Array(8184);for(let a=0;a<2046;a++){let r=a+2,l=0,h=0,p=0,_=0,x=0,T=0;for(1&r?p=_=x=Ss:l=h=T=Ss;(r>>=1)>1;){const I=l+p>>1,P=h+_>>1;1&r?(p=l,_=h,l=x,h=T):(l=p,h=_,p=x,_=T),x=I,T=P}const A=4*a;nl[A+0]=l,nl[A+1]=h,nl[A+2]=p,nl[A+3]=_}const To=new Uint16Array(2178),rl=new Uint8Array(1089),ug=new Uint16Array(1089);function uE(a){return a===0?-.03125:a===32?.03125:0}var hE=zt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const fE={type:2,extent:Jt,loadGeometry:()=>[[new me(0,0),new me(8193,0),new me(8193,8193),new me(0,8193),new me(0,0)]]};class q0{constructor(r,l,h,p,_){this.tileID=r,this.uid=Ln(),this.uses=0,this.tileSize=l,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(r){const l=r+this.timeAdded;l<Ii.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=mc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,l,h){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(p,_){const x={};if(!_)return x;for(const T of p){const A=T.layerIds.map(I=>_.getLayer(I)).filter(Boolean);if(A.length!==0){T.layers=A,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(I=>A.filter(P=>P.id===I)[0]));for(const I of A)x[I.id]=T}}return x}(r.buckets,l.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof il){if(this.hasSymbolBuckets=!0,!h)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof il&&_.hasRTLText){this.hasRTLText=!0,Ee.isLoading()||Ee.isLoaded()||ve()!=="deferred"||_e();break}}this.queryPadding=0;for(const p in this.buckets){const _=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(p).queryRadius(_))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new e0}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(r)}const l=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new hd(r,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new hd(r,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new hd(r,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,l,h,p,_,x,T,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:T,transform:x,params:_,tileTransform:this.tileTransform},r,l,h):{}}querySourceFeatures(r,l){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const p=h.loadVTLayers(),_=l?l.sourceLayer:"",x=p._geojsonTileLayer||p[_];if(!x)return;const T=Au(l&&l.filter),{z:A,x:I,y:P}=this.tileID.canonical,D={z:A,x:I,y:P};for(let O=0;O<x.length;O++){const N=x.feature(O);if(T.needGeometry){const G=fc(N,!0);if(!T.filter(new Re(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!T.filter(new Re(this.tileID.overscaledZ),N))continue;const z=h.getId(N,_),$=new cE(N,A,I,P,z);$.tile=D,r.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const h=yt(r.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const h=Date.now();let p=!1;if(this.expirationTime>h)p=!1;else if(l)if(this.expirationTime<l)p=!0;else{const _=this.expirationTime-l;_?this.expirationTime=h+Math.max(_,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0||!l)return;const h=this.latestFeatureIndex.loadVTLayers(),p=l.style.listImages();for(const _ in this.buckets){if(!l.style.hasLayer(_))continue;const x=this.buckets[_],T=x.layers[0].sourceLayer||"_geojsonTileLayer",A=h[T],I=r[T];if(!A||!I||Object.keys(I).length===0)continue;if(x.update(I,A,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),x instanceof Zm||x instanceof Wm){const D=l.style._getSourceCache(x.layers[0].source);l._terrain&&l._terrain.enabled&&D&&x.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(D.id,this.tileID)}const P=l&&l.style&&l.style.getLayer(_);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ii.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=Ii.now()+r}setTexture(r,l){const h=l.context,p=h.gl;this.texture=this.texture||l.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new hd(h,r,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(r,l){const h={};for(const p of l)h[p]=!0;this.dependencies[r]=h}hasDependency(r,l){for(const h of r){const p=this.dependencies[h];if(p){for(const _ of l)if(p[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const h=ca(fE,this.tileID.canonical,this.tileTransform)[0],p=new Wt,_=new go;for(let x=0;x<h.length;x++){const{x:T,y:A}=h[x];p.emplaceBack(T,A),_.emplaceBack(x)}_.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(_),this._tileDebugBuffer=r.createVertexBuffer(p,Wf.members),this._tileDebugSegments=En.simpleSegment(0,0,p.length,_.length)}_makeTileBoundsBuffers(r,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const h=ca(fE,this.tileID.canonical,this.tileTransform)[0];let p,_;if(this.isRaster){const x=function(T,A){const I=mc(T,A),P=Math.pow(2,T.z);for(let G=0;G<wo;G++)for(let se=0;se<wo;se++){const pe=as((T.x+(se+uE(se))/Ss)/P),ee=ar((T.y+(G+uE(G))/Ss)/P),de=A.project(pe,ee),ye=G*wo+se;To[2*ye+0]=Math.round((de.x*I.scale-I.x)*Jt),To[2*ye+1]=Math.round((de.y*I.scale-I.y)*Jt)}rl.fill(0),ug.fill(0);for(let G=2045;G>=0;G--){const se=4*G,pe=nl[se+0],ee=nl[se+1],de=nl[se+2],ye=nl[se+3],ge=pe+de>>1,Ve=ee+ye>>1,Ne=ge+Ve-ee,Ye=Ve+pe-ge,ft=ee*wo+pe,He=ye*wo+de,Je=Ve*wo+ge,et=Math.hypot((To[2*ft+0]+To[2*He+0])/2-To[2*Je+0],(To[2*ft+1]+To[2*He+1])/2-To[2*Je+1])>=16;if(rl[Je]=rl[Je]||(et?1:0),G<1022){const at=(ee+Ye>>1)*wo+(pe+Ne>>1),dt=(ye+Ye>>1)*wo+(de+Ne>>1);rl[Je]=rl[Je]||rl[at]||rl[dt]}}const D=new Ri,O=new or;let N=0;function z(G,se){const pe=se*wo+G;return ug[pe]===0&&(D.emplaceBack(To[2*pe+0],To[2*pe+1],G*Jt/Ss,se*Jt/Ss),ug[pe]=++N),ug[pe]-1}function $(G,se,pe,ee,de,ye){const ge=G+pe>>1,Ve=se+ee>>1;if(Math.abs(G-de)+Math.abs(se-ye)>1&&rl[Ve*wo+ge])$(de,ye,G,se,ge,Ve),$(pe,ee,de,ye,ge,Ve);else{const Ne=z(G,se),Ye=z(pe,ee),ft=z(de,ye);O.emplaceBack(Ne,Ye,ft)}}return $(0,0,Ss,Ss,Ss,0),$(Ss,Ss,0,0,0,Ss),{vertices:D,indices:O}}(this.tileID.canonical,l);p=x.vertices,_=x.indices}else{p=new Ri,_=new or;for(const{x:T,y:A}of h)p.emplaceBack(T,A,0,0);const x=$u(p.int16,void 0,4);for(let T=0;T<x.length;T+=3)_.emplaceBack(x[T],x[T+1],x[T+2])}this._tileBoundsBuffer=r.createVertexBuffer(p,hE.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(_),this._tileBoundsSegments=En.simpleSegment(0,0,p.length,_.length)}_makeGlobeTileDebugBuffers(r,l){const h=l.projection;if(!h||h.name!=="globe"||l.freezeTileCoverage)return;const p=this.tileID.canonical,_=qf(Bw(p,l)),x=Uu(l.zoom);let T;x>0&&(T=s0(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,p,l,_,T,x),this._makeGlobeTileDebugTextBuffer(r,p,l,_,T,x)}_globePoint(r,l,h,p,_,x,T){let A=Xf(r,l,h);if(x){const I=1<<h.z,P=xo(p.center.lng),D=vo(p.center.lat),O=(h.x+.5)/I-P;let N=0;O>.5?N=-1:O<-.5&&(N=1);let z=(r/Jt+h.x)/I+N,$=(l/Jt+h.y)/I;z=(z-P)*p._pixelsPerMercatorPixel+P,$=($-D)*p._pixelsPerMercatorPixel+D;const G=[z*p.worldSize,$*p.worldSize,0];gn(G,G,x),A=hc(A,G,T)}return gn(A,A,_)}_makeGlobeTileDebugBorderBuffer(r,l,h,p,_,x){const T=new Wt,A=new go,I=new Mi,P=(O,N,z,$,G)=>{const se=(z-O)/(G-1),pe=($-N)/(G-1),ee=T.length;for(let de=0;de<G;de++){const ye=O+de*se,ge=N+de*pe;T.emplaceBack(ye,ge);const Ve=this._globePoint(ye,ge,l,h,p,_,x);I.emplaceBack(Ve[0],Ve[1],Ve[2]),A.emplaceBack(ee+de)}},D=Jt;P(0,0,D,0,16),P(D,0,D,D,16),P(D,D,0,D,16),P(0,D,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(A),this._tileDebugBuffer=r.createVertexBuffer(T,Wf.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(I,Ow.members),this._tileDebugSegments=En.simpleSegment(0,0,T.length,A.length)}_makeGlobeTileDebugTextBuffer(r,l,h,p,_,x){const T=new Wt,A=new or,I=new Mi,P=25;A.reserve(32),T.reserve(P),I.reserve(P);const D=(O,N)=>P*O+N;for(let O=0;O<P;O++){const N=2048*O;for(let z=0;z<P;z++){const $=2048*z;T.emplaceBack($,N);const G=this._globePoint($,N,l,h,p,_,x);I.emplaceBack(G[0],G[1],G[2])}}for(let O=0;O<4;O++)for(let N=0;N<4;N++){const z=D(O,N),$=D(O,N+1),G=D(O+1,N),se=D(O+1,N+1);A.emplaceBack(z,$,G),A.emplaceBack(G,$,se)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(A),this._tileDebugTextBuffer=r.createVertexBuffer(T,Wf.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(I,Ow.members),this._tileDebugTextSegments=En.simpleSegment(0,0,P,32)}}class PO{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,h){const p=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][p]=this.stateChanges[r][p]||{},yi(this.stateChanges[r][p],h),this.deletedStates[r]===null){this.deletedStates[r]={};for(const _ in this.state[r])_!==p&&(this.deletedStates[r][_]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][p]===null){this.deletedStates[r][p]={};for(const _ in this.state[r][p])h[_]||(this.deletedStates[r][p][_]=null)}else for(const _ in h)this.deletedStates[r]&&this.deletedStates[r][p]&&this.deletedStates[r][p][_]===null&&delete this.deletedStates[r][p][_]}removeFeatureState(r,l,h){if(this.deletedStates[r]===null)return;const p=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},h&&l!==void 0)this.deletedStates[r][p]!==null&&(this.deletedStates[r][p]=this.deletedStates[r][p]||{},this.deletedStates[r][p][h]=null);else if(l!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][p])for(h in this.deletedStates[r][p]={},this.stateChanges[r][p])this.deletedStates[r][p][h]=null;else this.deletedStates[r][p]=null;else this.deletedStates[r]=null}getState(r,l){const h=String(l),p=yi({},(this.state[r]||{})[h],(this.stateChanges[r]||{})[h]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const _=this.deletedStates[r][l];if(_===null)return{};for(const x in _)delete p[x]}return p}initializeTileState(r,l){r.setFeatureState(this.state,l)}coalesceChanges(r,l){const h={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const _={};for(const x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),yi(this.state[p][x],this.stateChanges[p][x]),_[x]=this.state[p][x];h[p]=_}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const _={};if(this.deletedStates[p]===null)for(const x in this.state[p])_[x]={},this.state[p][x]={};else for(const x in this.deletedStates[p]){if(this.deletedStates[p][x]===null)this.state[p][x]={};else if(this.state[p][x])for(const T of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][T];_[x]=this.state[p][x]}h[p]=h[p]||{},yi(h[p],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const p in r)r[p].setFeatureState(h,l)}}class dE{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,l){const h=this.toIdx(r,l);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(r,l){return this.leaves[this.toIdx(r,l)]}toIdx(r,l){return l*this.size+r}}function pE(a,r,l,h){let p=0,_=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(h[x])<1e-15){if(l[x]<a[x]||l[x]>r[x])return null}else{const T=1/h[x];let A=(a[x]-l[x])*T,I=(r[x]-l[x])*T;if(A>I){const P=A;A=I,I=P}if(A>p&&(p=A),I<_&&(_=I),p>_)return null}return p}function mE(a,r,l,h,p,_,x,T,A,I,P){const D=h-a,O=p-r,N=_-l,z=x-a,$=T-r,G=A-l,se=P[1]*G-P[2]*$,pe=P[2]*z-P[0]*G,ee=P[0]*$-P[1]*z,de=D*se+O*pe+N*ee;if(Math.abs(de)<1e-15)return null;const ye=1/de,ge=I[0]-a,Ve=I[1]-r,Ne=I[2]-l,Ye=(ge*se+Ve*pe+Ne*ee)*ye;if(Ye<0||Ye>1)return null;const ft=Ve*N-Ne*O,He=Ne*D-ge*N,Je=ge*O-Ve*D,et=(P[0]*ft+P[1]*He+P[2]*Je)*ye;return et<0||Ye+et>1?null:(z*ft+$*He+G*Je)*ye}function gE(a,r,l){return(a-r)/(l-r)}function _E(a,r,l,h,p,_,x,T,A){const I=1<<l,P=_-h,D=x-p,O=(a+1)/I*P+h,N=(r+0)/I*D+p,z=(r+1)/I*D+p;T[0]=(a+0)/I*P+h,T[1]=N,A[0]=O,A[1]=z}class yE{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(_){const x=Math.ceil(Math.log2(_.dim/8)),T=[];let A=Math.ceil(Math.pow(2,x));const I=1/A,P=(N,z,$,G,se)=>{const pe=G?1:0,ee=(N+1)*$-pe,de=z*$,ye=(z+1)*$-pe;se[0]=N*$,se[1]=de,se[2]=ee,se[3]=ye};let D=new dE(A);const O=[];for(let N=0;N<A*A;N++){P(N%A,Math.floor(N/A),I,!1,O);const z=sl(O[0],O[1],_),$=sl(O[2],O[1],_),G=sl(O[2],O[3],_),se=sl(O[0],O[3],_);D.minimums.push(Math.min(z,$,G,se)),D.maximums.push(Math.max(z,$,G,se)),D.leaves.push(1)}for(T.push(D),A/=2;A>=1;A/=2){const N=T[T.length-1];D=new dE(A);for(let z=0;z<A*A;z++){P(z%A,Math.floor(z/A),2,!0,O);const $=N.getElevation(O[0],O[1]),G=N.getElevation(O[2],O[1]),se=N.getElevation(O[2],O[3]),pe=N.getElevation(O[0],O[3]),ee=N.isLeaf(O[0],O[1]),de=N.isLeaf(O[2],O[1]),ye=N.isLeaf(O[2],O[3]),ge=N.isLeaf(O[0],O[3]),Ve=Math.min($.min,G.min,se.min,pe.min),Ne=Math.max($.max,G.max,se.max,pe.max),Ye=ee&&de&&ye&&ge;D.maximums.push(Ne),D.minimums.push(Ve),D.leaves.push(Ne-Ve<=5&&Ye?1:0)}T.push(D)}return T}(this.dem),h=l.length-1,p=l[h];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(l,0,0,h,0)}raycastRoot(r,l,h,p,_,x,T=1){return pE([r,l,-100],[h,p,this.maximums[0]*T],_,x)}raycast(r,l,h,p,_,x,T=1){if(!this.nodeCount)return null;const A=this.raycastRoot(r,l,h,p,_,x,T);if(A==null)return null;const I=[],P=[],D=[],O=[],N=[{idx:0,t:A,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:z,t:$,nodex:G,nodey:se,depth:pe}=N.pop();if(this.leaves[z]){_E(G,se,pe,r,l,h,p,D,O);const de=1<<pe,ye=(G+0)/de,ge=(G+1)/de,Ve=(se+0)/de,Ne=(se+1)/de,Ye=sl(ye,Ve,this.dem)*T,ft=sl(ge,Ve,this.dem)*T,He=sl(ge,Ne,this.dem)*T,Je=sl(ye,Ne,this.dem)*T,et=mE(D[0],D[1],Ye,O[0],D[1],ft,O[0],O[1],He,_,x),at=mE(O[0],O[1],He,D[0],O[1],Je,D[0],D[1],Ye,_,x),dt=Math.min(et!==null?et:Number.MAX_VALUE,at!==null?at:Number.MAX_VALUE);if(dt!==Number.MAX_VALUE)return dt;{const Xe=jf([],_,x,$);if(xE(Ye,ft,Je,He,gE(Xe[0],D[0],O[0]),gE(Xe[1],D[1],O[1]))>=Xe[2])return $}continue}let ee=0;for(let de=0;de<this._siblingOffset.length;de++){_E((G<<1)+this._siblingOffset[de][0],(se<<1)+this._siblingOffset[de][1],pe+1,r,l,h,p,D,O),D[2]=-100,O[2]=this.maximums[this.childOffsets[z]+de]*T;const ye=pE(D,O,_,x);if(ye!=null){const ge=ye;I[de]=ge;let Ve=!1;for(let Ne=0;Ne<ee&&!Ve;Ne++)ge>=I[P[Ne]]&&(P.splice(Ne,0,de),Ve=!0);Ve||(P[ee]=de),ee++}}for(let de=0;de<ee;de++){const ye=P[de];N.push({idx:this.childOffsets[z]+ye,t:I[ye],nodex:(G<<1)+this._siblingOffset[ye][0],nodey:(se<<1)+this._siblingOffset[ye][1],depth:pe+1})}}return null}_addNode(r,l,h){return this.minimums.push(r),this.maximums.push(l),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(r,l,h,p,_){if(r[p].isLeaf(l,h)===1)return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const x=p-1,T=r[x];let A=0,I=0;for(let P=0;P<this._siblingOffset.length;P++){const D=2*l+this._siblingOffset[P][0],O=2*h+this._siblingOffset[P][1],N=T.getElevation(D,O),z=T.isLeaf(D,O),$=this._addNode(N.min,N.max,z);z&&(A|=1<<P),I||(I=$)}for(let P=0;P<this._siblingOffset.length;P++)A&1<<P||this._construct(r,2*l+this._siblingOffset[P][0],2*h+this._siblingOffset[P][1],x,I+P)}}function xE(a,r,l,h,p,_){return vi(vi(a,l,_),vi(r,h,_),p)}function sl(a,r,l){const h=l.dim,p=xt(a*h-.5,0,h-1),_=xt(r*h-.5,0,h-1),x=Math.floor(p),T=Math.floor(_),A=Math.min(x+1,h-1),I=Math.min(T+1,h-1);return xE(l.get(x,T),l.get(A,T),l.get(x,I),l.get(A,I),p-x,_-T)}const vE={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function kO(a,r,l){return(256*a*256+256*r+l)/10-1e4}function DO(a,r,l){return 256*a+r+l/256-32768}class hg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,l,h,p=!1,_=!1){if(this.uid=r,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return Se(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const x=this.dim=l.height-2,T=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=h||"mapbox",this.borderReady=p,!p){for(let A=0;A<x;A++)T[this._idx(-1,A)]=T[this._idx(0,A)],T[this._idx(x,A)]=T[this._idx(x-1,A)],T[this._idx(A,-1)]=T[this._idx(A,0)],T[this._idx(A,x)]=T[this._idx(A,x-1)];T[this._idx(-1,-1)]=T[this._idx(0,0)],T[this._idx(x,-1)]=T[this._idx(x-1,0)],T[this._idx(-1,x)]=T[this._idx(0,x-1)],T[this._idx(x,x)]=T[this._idx(x-1,x-1)],_&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new yE(this)}get(r,l,h=!1){h&&(r=xt(r,-1,this.dim),l=xt(l,-1,this.dim));const p=4*this._idx(r,l);return(this.encoding==="terrarium"?DO:kO)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(r){return vE[r]}get unpackVector(){return vE[this.encoding]}_idx(r,l){if(r<-1||r>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(r+1)}static pack(r,l){const h=[0,0,0,0],p=hg.getUnpackVector(l);let _=Math.floor((r+p[3])/p[2]);return h[2]=_%256,_=Math.floor(_/256),h[1]=_%256,_=Math.floor(_/256),h[0]=_,h}getPixels(){return new Zr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,l,h){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let p=l*this.dim,_=l*this.dim+this.dim,x=h*this.dim,T=h*this.dim+this.dim;switch(l){case-1:p=_-1;break;case 1:_=p+1}switch(h){case-1:x=T-1;break;case 1:T=x+1}const A=-l*this.dim,I=-h*this.dim;for(let P=x;P<T;P++)for(let D=p;D<_;D++){const O=4*this._idx(D,P),N=4*this._idx(D+A,P+I);this.pixels[O+0]=r.pixels[N+0],this.pixels[O+1]=r.pixels[N+1],this.pixels[O+2]=r.pixels[N+2],this.pixels[O+3]=r.pixels[N+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Dt(hg,"DEMData"),Dt(yE,"DemMinMaxQuadTree",{omit:["dem"]});class OO{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(const r in this.data)for(const l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,h){const p=r.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const _={value:l,timeout:void 0};if(h!==void 0&&(_.timeout=setTimeout(()=>{this.remove(r,_)},h)),this.data[p].push(_),this.order.push(p),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){const l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;const h=r.wrapped().key,p=l===void 0?0:this.data[h].indexOf(l),_=this.data[h][p];return this.data[h].splice(p,1),_.timeout&&clearTimeout(_.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(_.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){const l=[];for(const h in this.data)for(const p of this.data[h])r(p.value)||l.push(p);for(const h of l)this.remove(h.value.tileID,h)}}class eh{constructor(r,l,h){this.func=r,this.mask=l,this.range=h}}eh.ReadOnly=!1,eh.ReadWrite=!0,eh.disabled=new eh(519,eh.ReadOnly,[0,1]);const G0=7680;class Z0{constructor(r,l,h,p,_,x){this.test=r,this.ref=l,this.mask=h,this.fail=p,this.depthFail=_,this.pass=x}}Z0.disabled=new Z0({func:519,mask:0},0,0,G0,G0,G0);class Eo{constructor(r,l,h){this.blendFunction=r,this.blendColor=l,this.mask=h}}Eo.Replace=[1,0],Eo.disabled=new Eo(Eo.Replace,mn.transparent,[!1,!1,!1,!1]),Eo.unblended=new Eo(Eo.Replace,mn.transparent,[!0,!0,!0,!0]),Eo.alphaBlended=new Eo([1,771],mn.transparent,[!0,!0,!0,!0]);const Y0=1029,K0=2305;class Gs{constructor(r,l,h){this.enable=r,this.mode=l,this.frontFace=h}}Gs.disabled=new Gs(!1,Y0,K0),Gs.backCCW=new Gs(!0,Y0,K0),Gs.backCW=new Gs(!0,Y0,2304),Gs.frontCW=new Gs(!0,1028,2304),Gs.frontCCW=new Gs(!0,1028,K0);class gc extends Ls{constructor(r,l,h){super(),this.id=r,this._onlySymbols=h,l.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new OO(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new PO,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const l=this._tiles[r];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,l){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const h=this._tiles[l];h.upload(r),h.prepare(this.map.style.imageManager)}}getIds(){return On(this._tiles).map(r=>r.tileID).sort(bE).map(r=>r.key)}getRenderableIds(r){const l=[];for(const h in this._tiles)this._isIdRenderable(+h,r)&&l.push(this._tiles[h]);return r?l.sort((h,p)=>{const _=h.tileID,x=p.tileID,T=new me(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),A=new me(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-x.overscaledZ||A.y-T.y||A.x-T.x}).map(h=>h.tileID.key):l.map(h=>h.tileID).sort(bE).map(h=>h.key)}hasRenderableParent(r){const l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,l){const h=this._tiles[r];h&&(h.state!=="loading"&&(h.state=l),this._loadTile(h,this._tileLoaded.bind(this,h,r,l)))}_tileLoaded(r,l,h,p){if(p)if(r.state="errored",p.status!==404)this._source.fire(new ao(p,{tile:r}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=Ii.now(),h==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new Ni("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const l=this.getRenderableIds();for(let p=0;p<l.length;p++){const _=l[p];if(r.neighboringTiles&&r.neighboringTiles[_]){const x=this.getTileByID(_);h(r,x),h(x,r)}}function h(p,_){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let x=_.tileID.canonical.x-p.tileID.canonical.x;const T=_.tileID.canonical.y-p.tileID.canonical.y,A=Math.pow(2,p.tileID.canonical.z),I=_.tileID.key;x===0&&T===0||Math.abs(T)>1||(Math.abs(x)>1&&(Math.abs(x+A)===1?x+=A:Math.abs(x-A)===1&&(x-=A)),_.dem&&p.dem&&(p.dem.backfillBorder(_.dem,x,T),p.neighboringTiles&&p.neighboringTiles[I]&&(p.neighboringTiles[I].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,h,p){for(const _ in this._tiles){let x=this._tiles[_];if(p[_]||!x.hasData()||x.tileID.overscaledZ<=l||x.tileID.overscaledZ>h)continue;let T=x.tileID;for(;x&&x.tileID.overscaledZ>l+1;){const I=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[I.key],x&&x.hasData()&&(T=I)}let A=T;for(;A.overscaledZ>l;)if(A=A.scaledTo(A.overscaledZ-1),r[A.key]){p[T.key]=T;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){const h=this._loadedParentTiles[r.key];return h&&h.tileID.overscaledZ>=l?h:null}for(let h=r.overscaledZ-1;h>=l;h--){const p=r.scaledTo(h),_=this._getLoadedTile(p);if(_)return _}}_getLoadedTile(r){const l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,l){l=l||this._source.tileSize;const h=Math.ceil(r.width/l)+1,p=Math.ceil(r.height/l)+1,_=Math.floor(h*p*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(T)}handleWrapJump(r){const l=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,l){const h={};for(const p in this._tiles){const _=this._tiles[p];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+l),h[_.tileID.key]=_}this._tiles=h;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(r,l,h){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;let p;this.updateCacheSize(r,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new Er(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y)):(p=r.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(T=>this._source.hasTile(T)))):p=[];const _=this._updateRetainedTiles(p);if(wE(this._source.type)&&p.length!==0){const T={},A={},I=Object.keys(_);for(const D of I){const O=_[D],N=this._tiles[D];if(!N||N.fadeEndTime&&N.fadeEndTime<=Ii.now())continue;const z=this.findLoadedParent(O,Math.max(O.overscaledZ-gc.maxOverzooming,this._source.minzoom));z&&(this._addTile(z.tileID),T[z.tileID.key]=z.tileID),A[D]=O}const P=p[p.length-1].overscaledZ;for(const D in this._tiles){const O=this._tiles[D];if(_[D]||!O.hasData())continue;let N=O.tileID;for(;N.overscaledZ>P;){N=N.scaledTo(N.overscaledZ-1);const z=this._tiles[N.key];if(z&&z.hasData()&&A[N.key]){_[D]=O.tileID;break}}}for(const D in T)_[D]||(this._coveredTiles[D]=!0,_[D]=T[D])}for(const T in _)this._tiles[T].clearFadeHold();const x=function(T,A){const I=[];for(const P in T)P in A||I.push(P);return I}(this._tiles,_);for(const T of x){const A=this._tiles[T];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(+T)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const l={};if(r.length===0)return l;const h={},p=r.reduce((I,P)=>Math.min(I,P.overscaledZ),1/0),_=r[0].overscaledZ,x=Math.max(_-gc.maxOverzooming,this._source.minzoom),T=Math.max(_+gc.maxUnderzooming,this._source.minzoom),A={};for(const I of r){const P=this._addTile(I);l[I.key]=I,P.hasData()||p<this._source.maxzoom&&(A[I.key]=I)}this._retainLoadedChildren(A,p,T,l);for(const I of r){let P=this._tiles[I.key];if(P.hasData())continue;if(I.canonical.z>=this._source.maxzoom){const O=I.children(this._source.maxzoom)[0],N=this.getTile(O);if(N&&N.hasData()){l[O.key]=O;continue}}else{const O=I.children(this._source.maxzoom);if(l[O[0].key]&&l[O[1].key]&&l[O[2].key]&&l[O[3].key])continue}let D=P.wasRequested();for(let O=I.overscaledZ-1;O>=x;--O){const N=I.scaledTo(O);if(h[N.key]||(h[N.key]=!0,P=this.getTile(N),!P&&D&&(P=this._addTile(N)),P&&(l[N.key]=N,D=P.wasRequested(),P.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const l=[];let h,p=this._tiles[r].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){h=this._loadedParentTiles[p.key];break}l.push(p.key);const _=p.scaledTo(p.overscaledZ-1);if(h=this._getLoadedTile(_),h)break;p=_}for(const _ of l)this._loadedParentTiles[_]=h}}_addTile(r){let l=this._tiles[r.key];if(l)return l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));const h=!!l;if(!h){const p=this.map?this.map.painter:null;l=new q0(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))}return l?(l.uses++,this._tiles[r.key]=l,h||this._source.fire(new Ni("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const h=l.getExpiryTimeout();h&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},h))}_removeTile(r){const l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,l,h){const p=[],_=this.transform;if(!_)return p;const x=_.projection.name==="globe",T=xo(_.center.lng);for(const A in this._tiles){const I=this._tiles[A];if(h&&I.clearQueryDebugViz(),I.holdingForFade())continue;let P;if(x){const D=I.tileID.canonical;if(D.z===0){const O=[Math.abs(xt(T,...fd(D,-1))-T),Math.abs(xt(T,...fd(D,1))-T)];P=[0,2*O.indexOf(Math.min(...O))-1]}else{const O=[Math.abs(xt(T,...fd(D,-1))-T),Math.abs(xt(T,...fd(D,0))-T),Math.abs(xt(T,...fd(D,1))-T)];P=[O.indexOf(Math.min(...O))-1]}}else P=[0];for(const D of P){const O=r.containsTile(I,_,l,D);O&&p.push(O)}}return p}getVisibleCoordinates(r){const l=this.getRenderableIds(r).map(h=>this._tiles[h].tileID);for(const h of l)h.projMatrix=this.transform.calculateProjMatrix(h.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(wE(this._source.type))for(const r in this._tiles){const l=this._tiles[r];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=Ii.now())return!0}return!1}setFeatureState(r,l,h){this._state.updateState(r=r||"_geojsonTileLayer",l,h)}removeFeatureState(r,l,h){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,h)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,h){const p=this._tiles[r];p&&p.setDependencies(l,h)}reloadTilesForDependencies(r,l){for(const h in this._tiles)this._tiles[h].hasDependency(r,l)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(r,l))}_preloadTiles(r,l){const h=new Map,p=Array.isArray(r)?r:[r],_=this.map.painter.terrain,x=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const T of p){const A=T.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const I of A)h.set(I.key,I);this.usedForTerrain&&T.updateElevation(!1)}wi(Array.from(h.values()),(T,A)=>{const I=new q0(T,this._source.tileSize*T.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(I,P=>{this._source.type==="raster-dem"&&I.dem&&this._backfillDEM(I),A(P,I)})},l)}}function bE(a,r){const l=Math.abs(2*a.wrap)-+(a.wrap<0),h=Math.abs(2*r.wrap)-+(r.wrap<0);return a.overscaledZ-r.overscaledZ||h-l||r.canonical.y-a.canonical.y||r.canonical.x-a.canonical.x}function wE(a){return a==="raster"||a==="image"||a==="video"||a==="custom"}function fd(a,r){const l=1<<a.z;return[a.x/l+r,(a.x+1)/l+r]}gc.maxOverzooming=10,gc.maxUnderzooming=3;class fg{constructor(r,l,h){this._demTile=r,this._dem=this._demTile.dem,this._scale=l,this._offset=h}static create(r,l,h){const p=h||r.findDEMTileFor(l);if(!p||!p.dem)return;const _=p.dem,x=p.tileID,T=1<<l.canonical.z-x.canonical.z;return new fg(p,p.tileSize/Jt/T,[(l.canonical.x/T-x.canonical.x)*_.dim,(l.canonical.y/T-x.canonical.y)*_.dim])}tileCoordToPixel(r,l){const h=l*this._scale+this._offset[1],p=Math.floor(r*this._scale+this._offset[0]),_=Math.floor(h);return new me(p,_)}getElevationAt(r,l,h,p){const _=r*this._scale+this._offset[0],x=l*this._scale+this._offset[1],T=Math.floor(_),A=Math.floor(x),I=this._dem;return p=!!p,h?vi(vi(I.get(T,A,p),I.get(T,A+1,p),x-A),vi(I.get(T+1,A,p),I.get(T+1,A+1,p),x-A),_-T):I.get(T,A,p)}getElevationAtPixel(r,l,h){return this._dem.get(r,l,!!h)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Xs(1,r)*this._dem.stride}}class TE{constructor(r,l){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new qa(Jt,16,0),this.featureIndexArray=new dw,this.promoteId=l}insert(r,l,h,p,_,x=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,p,_,x);const A=this.grid;for(let I=0;I<l.length;I++){const P=l[I],D=[1/0,1/0,-1/0,-1/0];for(let O=0;O<P.length;O++){const N=P[O];D[0]=Math.min(D[0],N.x),D[1]=Math.min(D[1],N.y),D[2]=Math.max(D[2],N.x),D[3]=Math.max(D[3],N.y)}D[0]<Jt&&D[1]<Jt&&D[2]>=0&&D[3]>=0&&A.insert(T,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new k0(new sd(this.rawTileData)).layers,this.sourceLayerCoder=new lE(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,l,h,p){this.loadVTLayers();const _=r.params||{},x=Au(_.filter),T=r.tileResult,A=r.transform,I=T.bufferedTilespaceBounds,P=this.grid.query(I.min.x,I.min.y,I.max.x,I.max.y,(z,$,G,se)=>Kw(T.bufferedTilespaceGeometry,z,$,G,se));P.sort(LO);let D=null;A.elevation&&P.length>0&&(D=fg.create(A.elevation,this.tileID));const O={};let N;for(let z=0;z<P.length;z++){const $=P[z];if($===N)continue;N=$;const G=this.featureIndexArray.get($);let se=null;this.loadMatchingFeature(O,G,x,_.layers,_.availableImages,l,h,p,(pe,ee,de,ye=0)=>(se||(se=ca(pe,this.tileID.canonical,r.tileTransform)),ee.queryIntersectsFeature(T,pe,de,se,this.z,r.transform,r.pixelPosMatrix,D,ye)))}return O}loadMatchingFeature(r,l,h,p,_,x,T,A,I){const{featureIndex:P,bucketIndex:D,sourceLayerIndex:O,layoutVertexArrayOffset:N}=l,z=this.bucketLayerIDs[D];if(p&&!function(pe,ee){for(let de=0;de<pe.length;de++)if(ee.indexOf(pe[de])>=0)return!0;return!1}(p,z))return;const $=this.sourceLayerCoder.decode(O),G=this.vtLayers[$].feature(P);if(h.needGeometry){const pe=fc(G,!0);if(!h.filter(new Re(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!h.filter(new Re(this.tileID.overscaledZ),G))return;const se=this.getId(G,$);for(let pe=0;pe<z.length;pe++){const ee=z[pe];if(p&&p.indexOf(ee)<0)continue;const de=x[ee];if(!de)continue;let ye={};se!==void 0&&A&&(ye=A.getState(de.sourceLayer||"_geojsonTileLayer",se));const ge=yi({},T[ee]);ge.paint=EE(ge.paint,de.paint,G,ye,_),ge.layout=EE(ge.layout,de.layout,G,ye,_);const Ve=!I||I(G,de,ye,N);if(!Ve)continue;const Ne=new cE(G,this.z,this.x,this.y,se);Ne.layer=ge;let Ye=r[ee];Ye===void 0&&(Ye=r[ee]=[]),Ye.push({featureIndex:P,feature:Ne,intersectionZ:Ve})}}lookupSymbolFeatures(r,l,h,p,_,x,T,A){const I={};this.loadVTLayers();const P=Au(_);for(const D of r)this.loadMatchingFeature(I,{bucketIndex:h,sourceLayerIndex:p,featureIndex:D,layoutVertexArrayOffset:0},P,x,T,A,l);return I}loadFeature(r){const{featureIndex:l,sourceLayerIndex:h}=r;this.loadVTLayers();const p=this.sourceLayerCoder.decode(h),_=this.vtFeatures[p];if(_[l])return _[l];const x=this.vtLayers[p].feature(l);return _[l]=x,x}hasLayer(r){for(const l of this.bucketLayerIDs)for(const h of l)if(r===h)return!0;return!1}getId(r,l){let h=r.id;if(this.promoteId){const p=typeof this.promoteId=="string"?this.promoteId:this.promoteId[l];p!=null&&(h=r.properties[p]),typeof h=="boolean"&&(h=Number(h))}return h}}function EE(a,r,l,h,p){return Wr(a,(_,x)=>{const T=r instanceof Ue?r.get(x):null;return T&&T.evaluate?T.evaluate(l,h,p):T})}function LO(a,r){return r-a}Dt(TE,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class AE{constructor(r,l){this.width=r,this.height=l,this.nextRow=0,this.image=new ua({width:r,height:l}),this.positions={},this.uploaded=!1}getDash(r,l){const h=this.getKey(r,l);return this.positions[h]}trim(){const r=this.width,l=this.height=Bn(this.nextRow);this.image.resize({width:r,height:l})}getKey(r,l){return r.join(",")+l}getDashRanges(r,l,h){const p=[];let _=r.length%2==1?-r[r.length-1]*h:0,x=r[0]*h,T=!0;p.push({left:_,right:x,isDash:T,zeroLength:r[0]===0});let A=r[0];for(let I=1;I<r.length;I++){T=!T;const P=r[I];_=A*h,A+=P,x=A*h,p.push({left:_,right:x,isDash:T,zeroLength:P===0})}return p}addRoundDash(r,l,h){const p=l/2;for(let _=-h;_<=h;_++){const x=this.width*(this.nextRow+h+_);let T=0,A=r[T];for(let I=0;I<this.width;I++){I/A.right>1&&(A=r[++T]);const P=Math.abs(I-A.left),D=Math.abs(I-A.right),O=Math.min(P,D);let N;const z=_/h*(p+1);if(A.isDash){const $=p-Math.abs(z);N=Math.sqrt(O*O+$*$)}else N=p-Math.sqrt(O*O+z*z);this.image.data[x+I]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(r,l){for(let A=r.length-1;A>=0;--A){const I=r[A],P=r[A+1];I.zeroLength?r.splice(A,1):P&&P.isDash===I.isDash&&(P.left=I.left,r.splice(A,1))}const h=r[0],p=r[r.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const _=this.width*this.nextRow;let x=0,T=r[x];for(let A=0;A<this.width;A++){A/T.right>1&&(T=r[++x]);const I=Math.abs(A-T.left),P=Math.abs(A-T.right),D=Math.min(I,P);this.image.data[_+A]=Math.max(0,Math.min(255,(T.isDash?D:-D)+l+128))}}addDash(r,l){const h=this.getKey(r,l);if(this.positions[h])return this.positions[h];const p=l==="round",_=p?7:0,x=2*_+1;if(this.nextRow+x>this.height)return Se("LineAtlas out of space"),null;r.length===0&&r.push(1);let T=0;for(let P=0;P<r.length;P++)r[P]<0&&(Se("Negative value is found in line dasharray, replacing values with 0"),r[P]=0),T+=r[P];if(T!==0){const P=this.width/T,D=this.getDashRanges(r,this.width,P);p?this.addRoundDash(D,P,_):this.addRegularDash(D,l==="square"?.5*P:0)}const A=this.nextRow+_;this.nextRow+=x;const I={tl:[A,_],br:[T,0]};return this.positions[h]=I,I}}Dt(AE,"LineAtlas");class SE{constructor(r){const l={},h=[];for(const T in r){const A=r[T],I=l[T]={};for(const P in A.glyphs){const D=A.glyphs[+P];if(!D||D.bitmap.width===0||D.bitmap.height===0)continue;const O=D.metrics.localGlyph?2:1,N={x:0,y:0,w:D.bitmap.width+2*O,h:D.bitmap.height+2*O};h.push(N),I[P]=N}}const{w:p,h:_}=L0(h),x=new ua({width:p||1,height:_||1});for(const T in r){const A=r[T];for(const I in A.glyphs){const P=A.glyphs[+I];if(!P||P.bitmap.width===0||P.bitmap.height===0)continue;const D=l[T][I],O=P.metrics.localGlyph?2:1;ua.copy(P.bitmap,x,{x:0,y:0},{x:D.x+O,y:D.y+O},P.bitmap)}}this.image=x,this.positions=l}}Dt(SE,"GlyphAtlas");class BO{constructor(r){this.tileID=new Er(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=mc(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,l,h,p,_){this.status="parsing",this.data=r,this.collisionBoxArray=new e0;const x=new lE(Object.keys(r.layers).sort()),T=new TE(this.tileID,this.promoteId);T.bucketLayerIDs=[];const A={},I=new AE(256,256),P={featureIndex:T,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:I,availableImages:h},D=l.familiesBySource[this.source];for(const ye in D){const ge=r.layers[ye];if(!ge)continue;let Ve=!1,Ne=!1;for(const He of D[ye])He[0].type==="symbol"?Ve=!0:Ne=!0;if(this.isSymbolTile===!0&&!Ve||this.isSymbolTile===!1&&!Ne)continue;ge.version===1&&Se(`Vector tile source "${this.source}" layer "${ye}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ye=x.encode(ye),ft=[];for(let He=0;He<ge.length;He++){const Je=ge.feature(He),et=T.getId(Je,ye);ft.push({feature:Je,id:et,index:He,sourceLayerIndex:Ye})}for(const He of D[ye]){const Je=He[0];this.isSymbolTile!==void 0&&Je.type==="symbol"!==this.isSymbolTile||Je.minzoom&&this.zoom<Math.floor(Je.minzoom)||Je.maxzoom&&this.zoom>=Je.maxzoom||Je.visibility!=="none"&&(J0(He,this.zoom,h),(A[Je.id]=Je.createBucket({index:T.bucketLayerIDs.length,layers:He,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ye,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:h})).populate(ft,P,this.tileID.canonical,this.tileTransform),T.bucketLayerIDs.push(He.map(et=>et.id)))}}let O,N,z,$;I.trim();const G={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},se=Wr(P.glyphDependencies,ye=>Object.keys(ye).map(Number));Object.keys(se).length?p.send("getGlyphs",{uid:this.uid,stacks:se},(ye,ge)=>{O||(O=ye,N=ge,de.call(this))},void 0,!1,G):N={};const pe=Object.keys(P.iconDependencies);pe.length?p.send("getImages",{icons:pe,source:this.source,tileID:this.tileID,type:"icons"},(ye,ge)=>{O||(O=ye,z=ge,de.call(this))},void 0,!1,G):z={};const ee=Object.keys(P.patternDependencies);function de(){if(O)return _(O);if(N&&z&&$){const ye=new SE(N),ge=new LT(z,$);for(const Ve in A){const Ne=A[Ve];Ne instanceof il?(J0(Ne.layers,this.zoom,h),lO(Ne,N,ye.positions,z,ge.iconPositions,this.showCollisionBoxes,h,this.tileID.canonical,this.tileZoom,this.projection)):Ne.hasPattern&&(Ne instanceof Zm||Ne instanceof Wm||Ne instanceof td)&&(J0(Ne.layers,this.zoom,h),Ne.addFeatures(P,this.tileID.canonical,ge.patternPositions,h,this.tileTransform))}this.status="done",_(null,{buckets:On(A).filter(Ve=>!Ve.isEmpty()),featureIndex:T,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ye.image,lineAtlas:I,imageAtlas:ge,glyphMap:this.returnDependencies?N:null,iconMap:this.returnDependencies?z:null,glyphPositions:this.returnDependencies?ye.positions:null})}}ee.length?p.send("getImages",{icons:ee,source:this.source,tileID:this.tileID,type:"patterns"},(ye,ge)=>{O||(O=ye,$=ge,de.call(this))},void 0,!1,G):$={},de.call(this)}}function J0(a,r,l){const h=new Re(r);for(const p of a)p.recalculate(h,l)}class IE{constructor(r){this.entries={},this.scheduler=r}request(r,l,h,p){const _=this.entries[r]=this.entries[r]||{callbacks:[]};if(_.result){const[x,T]=_.result;return this.scheduler?this.scheduler.add(()=>{p(x,T)},l):p(x,T),()=>{}}return _.callbacks.push(p),_.cancel||(_.cancel=h((x,T)=>{_.result=[x,T];for(const A of _.callbacks)this.scheduler?this.scheduler.add(()=>{A(x,T)},l):A(x,T);setTimeout(()=>delete this.entries[r],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(x=>x!==p),_.callbacks.length||(_.cancel(),delete this.entries[r]))}}}function CE(a,r,l){const h=JSON.stringify(a.request);return a.data&&(this.deduped.entries[h]={result:[null,a.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},p=>{const _=bn(a.request,(x,T,A,I)=>{x?p(x):T&&p(null,{vectorTile:l?void 0:new k0(new sd(T)),rawData:T,cacheControl:A,expires:I})});return()=>{_.cancel(),p()}},r)}o.ARRAY_TYPE=Gr,o.AUTH_ERR_MSG=Go,o.Aabb=Tr,o.Actor=class{constructor(a,r,l){this.target=a,this.parent=r,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Dr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=pt()?a:v,this.scheduler=new MO}send(a,r,l,h,p=!1,_){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=_,this.callbacks[x]=l);const T=At(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:a,hasCallback:!!l,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:ec(r,T)},T),{cancel:()=>{l&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(a){const r=a.data,l=r.id;if(l&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h.cancel()}else if(r.mustQueue||pt()){const h=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,r),h&&h.metadata||{type:"message"})}else this.processTask(l,r)}processTask(a,r){if(r.type==="<response>"){const l=this.callbacks[a];delete this.callbacks[a],l&&(r.error?l(tc(r.error)):l(null,tc(r.data)))}else{const l=At(this.globalScope)?void 0:[],h=r.hasCallback?(_,x)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:_?ec(_):null,data:ec(x,l)},l)}:_=>{},p=tc(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,p,h);else if(this.parent.getWorkerSource){const _=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,_[0],p.source)[_[1]](p,h)}else h(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=Gm,o.Color=mn,o.ColorMode=Eo,o.CullFaceMode=Gs,o.DEMData=hg,o.DataConstantProperty=Ce,o.DedupedRequest=IE,o.DepthMode=eh,o.EXTENT=Jt,o.Elevation=class{isDataAvailableAtPoint(a){const r=this._source();if(this.isUsingMockSource()||!r||a.y<0||a.y>1)return!1;const l=r.getSource().maxzoom,h=1<<l,p=Math.floor(a.x),_=Math.floor((a.x-p)*h),x=Math.floor(a.y*h),T=this.findDEMTileFor(new Er(l,p,l,_,x));return!(!T||!T.dem)}getAtPointOrZero(a,r=0){return this.getAtPoint(a,r)||0}getAtPoint(a,r,l=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const h=this._source();if(!h||a.y<0||a.y>1)return r;const p=h.getSource().maxzoom,_=1<<p,x=Math.floor(a.x),T=a.x-x,A=new Er(p,x,p,Math.floor(T*_),Math.floor(a.y*_)),I=this.findDEMTileFor(A);if(!I||!I.dem)return r;const P=I.dem,D=1<<I.tileID.canonical.z,O=(T*D-I.tileID.canonical.x)*P.dim,N=(a.y*D-I.tileID.canonical.y)*P.dim,z=Math.floor(O),$=Math.floor(N);return(l?this.exaggeration():1)*vi(vi(P.get(z,$),P.get(z,$+1),N-$),vi(P.get(z+1,$),P.get(z+1,$+1),N-$),O-z)}getAtTileOffset(a,r,l){const h=1<<a.canonical.z;return this.getAtPointOrZero(new Vu(a.wrap+(a.canonical.x+r/Jt)/h,(a.canonical.y+l/Jt)/h))}getAtTileOffsetFunc(a,r,l,h){return p=>{const _=this.getAtTileOffset(a,p.x,p.y),x=h.upVector(a.canonical,p.x,p.y);return os(x,x,_*h.upVectorScale(a.canonical,r,l).metersToTile),x}}getForTilePoints(a,r,l,h){if(this.isUsingMockSource())return!1;const p=fg.create(this,a,h);return!!p&&(r.forEach(_=>{_[2]=this.exaggeration()*p.getElevationAt(_[0],_[1],l)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(a);if(!r||!r.dem)return null;const l=r.dem.tree,h=r.tileID,p=1<<a.canonical.z-h.canonical.z;let _=a.canonical.x/p-h.canonical.x,x=a.canonical.y/p-h.canonical.y,T=0;for(let A=0;A<a.canonical.z-h.canonical.z&&!l.leaves[T];A++){_*=2,x*=2;const I=2*Math.floor(x)+Math.floor(_);T=l.childOffsets[T]+I,_%=1,x%=1}return{min:this.exaggeration()*l.minimums[T],max:this.exaggeration()*l.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,r,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=ao,o.EvaluationParameters=Re,o.Event=Ni,o.Evented=Ls,o.FillExtrusionBucket=td,o.Frustum=f0,o.FrustumCorners=h0,o.GLOBE_RADIUS=_o,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GLOBE_ZOOM_THRESHOLD_MIN=5,o.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const a of this._wireframeSegments)a.destroy()}}_fillGridMeshWithLods(a,r){const l=new Wt,h=new or,p=[],_=a+1+2,x=r[0]+1,T=r[0]+1+(1+r.length),A=(I,P,D)=>{let O=I===_-1?I-2:I===0?I:I-1;return O+=D?24575:0,[O,P]};for(let I=0;I<_;++I)l.emplaceBack(...A(I,0,!0));for(let I=0;I<x;++I)for(let P=0;P<_;++P)l.emplaceBack(...A(P,I,(P===0||P===_-1)&&!0));for(let I=0;I<r.length;++I){const P=r[I];for(let D=0;D<_;++D)l.emplaceBack(...A(D,P,!0))}for(let I=0;I<r.length;++I){const P=h.length,D=r[I]+1+2,O=new or;for(let $=0;$<D-1;$++){const G=$===D-2,se=G?_*(T-r.length+I-$):_;for(let pe=0;pe<_-1;pe++){const ee=$*_+pe;$===0||G||pe===0||pe===_-2?(O.emplaceBack(ee+1,ee,ee+se),O.emplaceBack(ee+se,ee+se+1,ee+1)):(h.emplaceBack(ee+1,ee,ee+se),h.emplaceBack(ee+se,ee+se+1,ee+1))}}const N=En.simpleSegment(0,P,l.length,h.length-P);for(let $=0;$<O.uint16.length;$+=3)h.emplaceBack(O.uint16[$],O.uint16[$+1],O.uint16[$+2]);const z=En.simpleSegment(0,P,l.length,h.length-P);p.push({withoutSkirts:N,withSkirts:z})}return{vertices:l,indices:h,segments:p}}_createGrid(a){const r=this._fillGridMeshWithLods(uc,Hf);this._gridSegments=r.segments,this._gridBuffer=a.createVertexBuffer(r.vertices,Wf.members),this._gridIndexBuffer=a.createIndexBuffer(r.indices,!0)}_createPoles(a){const r=new or;for(let p=0;p<=uc;p++)r.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=a.createIndexBuffer(r,!0);const l=new qr,h=new qr;this._poleSegments=[];for(let p=0,_=0;p<5;p++){const x=360/(1<<p);l.emplaceBack(0,-_o,0,.5,0),h.emplaceBack(0,-_o,0,.5,1);for(let T=0;T<=uc;T++){const A=T/uc,I=vi(0,x,A),[P,D,O]=Nu(Mk,Rk,I,_o);l.emplaceBack(P,D,O,A,0),h.emplaceBack(P,D,O,A,1)}this._poleSegments.push(En.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(l,Dw,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(h,Dw,!1)}getGridBuffers(a,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a,r){if(!this._wireframeSegments){const l=new mo,h=uc,p=h+1+2,_=1;this._wireframeSegments=[];for(let x=0,T=0;x<Hf.length;x++){const A=Hf[x];for(let P=_;P<A+_;P++)for(let D=_;D<h+_;D++){const O=P*p+D;l.emplaceBack(O,O+1),l.emplaceBack(O,O+p),l.emplaceBack(O,O+p+1)}const I=A*h*3;this._wireframeSegments.push(En.simpleSegment(0,T,(A+1)*p,I)),T+=I}this._wireframeIndexBuffer=a.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[r]]}},o.GlyphManager=Ku,o.ImagePosition=B0,o.LivePerformanceUtils=nt,o.LngLat=Ti,o.LngLatBounds=Qa,o.LocalGlyphMode=z0,o.MAX_MERCATOR_LATITUDE=qs,o.MercatorCoordinate=Vu,o.ONE_EM=lr,o.OverscaledTileID=Er,o.PerformanceMarkers=Fe,o.Properties=ct,o.RGBAImage=Zr,o.Ray=u0,o.RequestManager=class{constructor(a,r,l){this._transformRequestFn=a,this._customAccessToken=r,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let r="";for(let l=0;l<10;l++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ue,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,r){return this._transformRequestFn&&this._transformRequestFn(a,r)||{url:a}}normalizeStyleURL(a,r){if(!rs(a))return a;const l=Lr(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeGlyphsURL(a,r){if(!rs(a))return a;const l=Lr(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||r)}normalizeSourceURL(a,r,l,h){if(!rs(a))return a;const p=Lr(a);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),l&&p.params.push(`language=${l}`),h&&p.params.push(`worldview=${h}`),this._makeAPIURL(p,this._customAccessToken||r)}normalizeSpriteURL(a,r,l,h){const p=Lr(a);return rs(a)?(p.path=`/styles/v1${p.path}/sprite${r}${l}`,this._makeAPIURL(p,this._customAccessToken||h)):(p.path+=`${r}${l}`,oo(p))}normalizeTileURL(a,r,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!rs(a))return a;const h=Lr(a);h.path=h.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||l&&h.authority!=="raster"&&l===512?"@2x":""}${L.supported?".webp":"$1"}`),h.authority==="raster"?h.path=`/${R.RASTER_URL_PREFIX}${h.path}`:(h.path=h.path.replace(/^.+\/v4\//,"/"),h.path=`/${R.TILE_URL_VERSION}${h.path}`);const p=this._customAccessToken||function(_){for(const x of _){const T=x.match(/^access_token=(.*)$/);if(T)return T[1]}return null}(h.params)||R.ACCESS_TOKEN;return R.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&h.params.push(`sku=${this._skuToken}`),this._makeAPIURL(h,p)}canonicalizeTileURL(a,r){const l=Lr(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let h="mapbox://";l.path.match(/^\/raster\/v1\//)?h+=`raster/${l.path.replace(`/${R.RASTER_URL_PREFIX}/`,"")}`:h+=`tiles/${l.path.replace(`/${R.TILE_URL_VERSION}/`,"")}`;let p=l.params;return r&&(p=p.filter(_=>!_.match(/^access_token=/))),p.length&&(h+=`?${p.join("&")}`),h}canonicalizeTileset(a,r){const l=!!r&&rs(r),h=[];for(const p of a.tiles||[])Zo(p)?h.push(this.canonicalizeTileURL(p,l)):h.push(p);return h}_makeAPIURL(a,r){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",h=Lr(R.API_URL);if(a.protocol=h.protocol,a.authority=h.authority,a.protocol==="http"){const p=a.params.indexOf("secure");p>=0&&a.params.splice(p,1)}if(h.path!=="/"&&(a.path=`${h.path}${a.path}`),!R.REQUIRE_ACCESS_TOKEN)return oo(a);if(r=r||R.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(p=>p.indexOf("access_token")===-1),a.params.push(`access_token=${r||""}`),oo(a)}},o.ResourceType=qn,o.SegmentVector=En,o.SourceCache=gc,o.StencilMode=Z0,o.StructArrayLayout1ui2=go,o.StructArrayLayout2f1f2i16=rr,o.StructArrayLayout2i4=Wt,o.StructArrayLayout2ui4=mo,o.StructArrayLayout3f12=sr,o.StructArrayLayout3ui6=or,o.StructArrayLayout4i8=Ri,o.StructArrayLayout5f20=qr,o.Texture=hd,o.Tile=q0,o.Transitionable=gt,o.Uniform1f=Rm,o.Uniform1i=class extends oa{constructor(a){super(a),this.current=0}set(a,r,l){this.fetchUniformLocation(a,r)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},o.Uniform2f=class extends oa{constructor(a){super(a),this.current=[0,0]}set(a,r,l){this.fetchUniformLocation(a,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},o.Uniform3f=class extends oa{constructor(a){super(a),this.current=[0,0,0]}set(a,r,l){this.fetchUniformLocation(a,r)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},o.Uniform4f=_w,o.UniformColor=yw,o.UniformMatrix2f=class extends oa{constructor(a){super(a),this.current=pk}set(a,r,l){if(this.fetchUniformLocation(a,r)){for(let h=0;h<4;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}},o.UniformMatrix3f=class extends oa{constructor(a){super(a),this.current=dk}set(a,r,l){if(this.fetchUniformLocation(a,r)){for(let h=0;h<9;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}}},o.UniformMatrix4f=class extends oa{constructor(a){super(a),this.current=fk}set(a,r,l){if(this.fetchUniformLocation(a,r)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let h=1;h<16;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},o.UnwrappedTileID=wT,o.ValidationError=Mt,o.VectorTileFeature=Xm,o.VectorTileWorkerSource=class extends Ls{constructor(a,r,l,h,p){super(),this.actor=a,this.layerIndex=r,this.availableImages=l,this.loadVectorData=p||CE,this.loading={},this.loaded={},this.deduped=new IE(a.scheduler),this.isSpriteLoaded=h,this.scheduler=a.scheduler}loadTile(a,r){const l=a.uid,h=a&&a.request,p=h&&h.collectResourceTiming,_=this.loading[l]=new BO(a);_.abort=this.loadVectorData(a,(x,T)=>{const A=!this.loading[l];if(delete this.loading[l],A||x||!T)return _.status="done",A||(this.loaded[l]=_),r(x);const I=T.rawData,P={};T.expires&&(P.expires=T.expires),T.cacheControl&&(P.cacheControl=T.cacheControl),_.vectorTile=T.vectorTile||new k0(new sd(I));const D=()=>{_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,(O,N)=>{if(O||!N)return r(O);const z={};if(p){const $=Xt(h);$.length>0&&(z.resourceTiming=JSON.parse(JSON.stringify($)))}r(null,yi({rawTileData:I.slice(0)},N,P,z))})};this.isSpriteLoaded?D():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(D,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):D()}),this.loaded=this.loaded||{},this.loaded[l]=_})}reloadTile(a,r){const l=this.loaded,h=a.uid,p=this;if(l&&l[h]){const _=l[h];_.showCollisionBoxes=a.showCollisionBoxes,_.enableTerrain=!!a.enableTerrain,_.projection=a.projection,_.tileTransform=mc(a.tileID.canonical,a.projection);const x=(T,A)=>{const I=_.reloadCallback;I&&(delete _.reloadCallback,_.parse(_.vectorTile,p.layerIndex,this.availableImages,p.actor,I)),r(T,A)};_.status==="parsing"?_.reloadCallback=x:_.status==="done"&&(_.vectorTile?_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,x):x())}}abortTile(a,r){const l=a.uid,h=this.loading[l];h&&(h.abort&&h.abort(),delete this.loading[l]),r()}removeTile(a,r){const l=this.loaded,h=a.uid;l&&l[h]&&delete l[h],r()}},o.WritingMode=ls,o.ZoomDependentExpression=ra,o.add=la,o.addDynamicAttributes=lg,o.adjoint=function(a,r){var l=r[0],h=r[1],p=r[2],_=r[3],x=r[4],T=r[5],A=r[6],I=r[7],P=r[8];return a[0]=x*P-T*I,a[1]=p*I-h*P,a[2]=h*T-p*x,a[3]=T*A-_*P,a[4]=l*P-p*A,a[5]=p*_-l*T,a[6]=_*I-x*A,a[7]=h*A-l*I,a[8]=l*x-h*_,a},o.asyncAll=wi,o.bezier=Ot,o.bindAll=Dr,o.boundsAttributes=hE,o.bufferConvexPolygon=function(a,r){const l=[];for(let h=0;h<a.length;h++){const p=ti(h-1,-1,a.length-1),_=ti(h+1,-1,a.length-1),x=a[h],T=a[_],A=a[p].sub(x).unit(),I=T.sub(x).unit(),P=I.angleWithSep(A.x,A.y),D=A.add(I).unit().mult(-1*r/Math.sin(P/2));l.push(x.add(D))}return l},o.cacheEntryPossiblyAdded=function(a){vn++,vn>pi&&(a.getActor().send("enforceCacheSizeLimit",ii),vn=0)},o.calculateGlobeLabelMatrix=function(a,r){const{x:l,y:h}=a.point,p=zw(l,h,a.worldSize/a._pixelsPerMercatorPixel,0,0);return ac(p,p,m0(yo(r)))},o.calculateGlobeMatrix=function(a){const{x:r,y:l}=a.point,{lng:h,lat:p}=a._center;return zw(r,l,a.worldSize,h,p)},o.calculateGlobeMercatorMatrix=function(a){const r=a.pixelsPerMeter,l=r/Xs(1,a.center.lat),h=Ws(new Float64Array(16));return Nf(h,h,[a.point.x,a.point.y,0]),lc(h,h,[l,l,r]),Float32Array.from(h)},o.circumferenceAtLatitude=_0,o.clamp=xt,o.clearTileCache=function(a){if(!ki())return;const r=v.caches.delete(Qt);a&&r.catch(a).then(()=>a())},o.clipLine=qT,o.clone=function(a){var r=new Gr(16);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],r[4]=a[4],r[5]=a[5],r[6]=a[6],r[7]=a[7],r[8]=a[8],r[9]=a[9],r[10]=a[10],r[11]=a[11],r[12]=a[12],r[13]=a[13],r[14]=a[14],r[15]=a[15],r},o.clone$1=_r,o.collisionCircleLayout=OD,o.config=R,o.conjugate=function(a,r){return a[0]=-r[0],a[1]=-r[1],a[2]=-r[2],a[3]=r[3],a},o.create=function(){var a=new Gr(16);return Gr!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},o.create$1=vw,o.createExpression=$a,o.createLayout=zt,o.createStyleLayer=function(a){return a.type==="custom"?new AO(a):new IO[a.type](a)},o.cross=c0,o.degToRad=rt,o.distance=function(a,r){return Math.hypot(r[0]-a[0],r[1]-a[1],r[2]-a[2])},o.div=function(a,r,l){return a[0]=r[0]/l[0],a[1]=r[1]/l[1],a[2]=r[2]/l[2],a},o.dot=Ts,o.earthRadius=Gf,o.ease=mt,o.easeCubicInOut=Vt,o.ecefToLatLng=function([a,r,l]){const h=Math.hypot(a,r,l),p=Math.atan2(a,l),_=.5*Math.PI-Math.acos(-r/h);return new Ti(Ge(p),Ge(_))},o.emitValidationErrors=mm,o.endsWith=gr,o.enforceCacheSizeLimit=function(a){xi(),Pt&&Pt.then(r=>{r.keys().then(l=>{for(let h=0;h<l.length-a;h++)r.delete(l[h])})})},o.evaluateSizeForFeature=Ym,o.evaluateSizeForZoom=qu,o.evaluateVariableOffset=JT,o.evented=ce,o.exactEquals=function(a,r){return a[0]===r[0]&&a[1]===r[1]&&a[2]===r[2]&&a[3]===r[3]},o.exactEquals$1=function(a,r){return a[0]===r[0]&&a[1]===r[1]&&a[2]===r[2]},o.exported=Ii,o.exported$1=L,o.extend=yi,o.extend$1=Bs,o.fillExtrusionHeightLift=xT,o.filterObject=Or,o.fromMat4=function(a,r){return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[4],a[4]=r[5],a[5]=r[6],a[6]=r[8],a[7]=r[9],a[8]=r[10],a},o.fromQuat=function(a,r){var l=r[0],h=r[1],p=r[2],_=r[3],x=l+l,T=h+h,A=p+p,I=l*x,P=h*x,D=h*T,O=p*x,N=p*T,z=p*A,$=_*x,G=_*T,se=_*A;return a[0]=1-D-z,a[1]=P+se,a[2]=O-G,a[3]=0,a[4]=P-se,a[5]=1-I-z,a[6]=N+$,a[7]=0,a[8]=O+G,a[9]=N-$,a[10]=1-I-D,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},o.fromRotation=function(a,r){var l=Math.sin(r),h=Math.cos(r);return a[0]=h,a[1]=l,a[2]=0,a[3]=-l,a[4]=h,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},o.fromScaling=ww,o.furthestTileCorner=function(a){const r=Math.round((a+45+360)%360/90)%4;return Ut[r]},o.getAABBPointSquareDist=function(a,r,l){let h=0;for(let p=0;p<2;++p){const _=l?l[p]:0;a[p]>_&&(h+=(a[p]-_)*(a[p]-_)),r[p]<_&&(h+=(_-r[p])*(_-r[p]))}return h},o.getAnchorAlignment=N0,o.getAnchorJustification=V0,o.getBounds=function(a){let r=1/0,l=1/0,h=-1/0,p=-1/0;for(const _ of a)r=Math.min(r,_.x),l=Math.min(l,_.y),h=Math.max(h,_.x),p=Math.max(p,_.y);return{min:new me(r,l),max:new me(h,p)}},o.getColumn=vt,o.getGridMatrix=function(a,r,l,h){const p=r.getNorth(),_=r.getSouth(),x=r.getWest(),T=r.getEast(),A=1<<a.z,I=T-x,P=p-_,D=I/uc,O=-P/Hf[l],N=[0,D,0,O,0,0,p,x,0];if(a.z>0){const z=180/h;bw(N,N,[z/I+1,0,0,0,z/P+1,0,-.5*z/D,.5*z/O,1])}return N[2]=A,N[5]=a.x,N[8]=a.y,N},o.getImage=Cl,o.getJSON=function(a,r){return ns(yi(a,{type:"json"}),r)},o.getLatitudinalLod=function(a){const r=qs-5;a=xt(a,-80.051129,r)/r*90;const l=Math.pow(Math.abs(Math.sin(rt(a))),3);return Math.round(l*(Hf.length-1))},o.getMapSessionAPI=ke,o.getPerformanceMeasurement=Xt,o.getProjection=oE,o.getRTLTextPluginStatus=ve,o.getReferrer=is,o.getTilePoint=function(a,{x:r,y:l},h=0){return new me(((r-h)*a.scale-a.x)*Jt,(l*a.scale-a.y)*Jt)},o.getTileVec3=function(a,r,l=0){return Fu(((r.x-l)*a.scale-a.x)*Jt,(r.y*a.scale-a.y)*Jt,$w(r.z,r.y))},o.getVideo=function(a,r){const l=v.document.createElement("video");l.muted=!0,l.onloadstart=function(){r(null,l)};for(let h=0;h<a.length;h++){const p=v.document.createElement("source");ir(a[h])||(l.crossOrigin="Anonymous"),p.src=a[h],l.appendChild(p)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(a){const r=[0,0,0],l=Ws(new Float64Array(16));return ac(l,a.pixelMatrix,a.globeMatrix),gn(r,r,l),new me(r[0],r[1])},o.globeDenormalizeECEF=m0,o.globeECEFOrigin=function(a,r){const l=[0,0,0];return gn(l,l,qf(yo(r.canonical))),gn(l,l,a),l},o.globeMetersToEcef=Om,o.globeNormalizeECEF=qf,o.globePixelsToTileUnits=function(a,r){return Jt/(512*Math.pow(2,a))*Bm(yo(r))},o.globePoleMatrixForTile=function(a,r,l){const h=Ws(new Float64Array(16)),p=(r/(1<<a)-.5)*Math.PI*2;return Dm(h,l.globeMatrix,p),Float32Array.from(h)},o.globeTileBounds=yo,o.globeTiltAtLngLat=Uw,o.globeToMercatorTransition=Uu,o.globeUseCustomAntiAliasing=function(a,r,l){const h=Uu(l.zoom),p=a.style.map._antialias,_=!!r.extStandardDerivatives,x=r.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return h===0&&!p&&!x&&_},o.identity=Ws,o.identity$1=Rw,o.invert=s0,o.isFullscreen=function(){return!!v.document.fullscreenElement||!!v.document.webkitFullscreenElement},o.isLngLatBehindGlobe=g0,o.isMapAuthenticated=function(a){return Ae.has(a)},o.isMapboxURL=rs,o.isSafariWithAntialiasingBug=function(a){const r=a.navigator?a.navigator.userAgent:null;return!!At(a)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=ar,o.latLngToECEF=zu,o.len=Tk,o.length=zf,o.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},o.lngFromMercatorX=as,o.loadVectorTile=CE,o.makeRequest=ns,o.mapValue=function(a,r,l,h,p){return xt((a-r)/(l-r)*(p-h)+h,h,p)},o.mercatorScale=Ww,o.mercatorXfromLng=xo,o.mercatorYfromLat=vo,o.mercatorZfromAltitude=Xs,o.mul=bk,o.mul$1=wk,o.multiply=ac,o.multiply$1=bw,o.multiply$2=Aw,o.nextPowerOfTwo=Bn,o.normalize=wr,o.normalize$1=Ek,o.normalize$2=Cw,o.number=vi,o.ortho=function(a,r,l,h,p,_,x){var T=1/(r-l),A=1/(h-p),I=1/(_-x);return a[0]=-2*T,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*A,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*I,a[11]=0,a[12]=(r+l)*T,a[13]=(p+h)*A,a[14]=(x+_)*I,a[15]=1,a},o.pbf=sd,o.perspective=function(a,r,l,h,p){var _,x=1/Math.tan(r/2);return a[0]=x/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=x,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,p!=null&&p!==1/0?(a[10]=(p+h)*(_=1/(h-p)),a[14]=2*p*h*_):(a[10]=-1,a[14]=-2*h),a},o.pick=function(a,r){const l={};for(let h=0;h<r.length;h++){const p=r[h];p in a&&(l[p]=a[p])}return l},o.plugin=Ee,o.pointGeometry=me,o.polesInViewport=function(a){const r=Ws(new Float64Array(16));ac(r,a.pixelMatrix,a.globeMatrix);const l=[0,Es,0],h=[0,As,0];return gn(l,l,r),gn(h,h,r),[l[0]>0&&l[0]<=a.width&&l[1]>0&&l[1]<=a.height&&!g0(a,new Ti(a.center.lat,90)),h[0]>0&&h[0]<=a.width&&h[1]>0&&h[1]<=a.height&&!g0(a,new Ti(a.center.lat,-90))]},o.polygonContainsPoint=dc,o.polygonIntersectsBox=Kw,o.polygonIntersectsPolygon=qw,o.polygonizeBounds=function(a,r,l=0,h=!0){const p=new me(l,l),_=a.sub(p),x=r.add(p),T=[_,new me(x.x,_.y),x,new me(_.x,x.y)];return h&&T.push(_.clone()),T},o.posAttributes=Wf,o.postMapLoadEvent=te,o.postPerformanceEvent=we,o.postTurnstileEvent=V,o.potpack=L0,o.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},o.radToDeg=Ge,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(a){return a({pluginStatus:Q,pluginURL:H}),ce.on("pluginStateChange",a),a},o.removeAuthState=function(a){Ae.delete(a)},o.renderColorRamp=A0,o.resample=Hw,o.rotateX=o0,o.rotateX$1=Pw,o.rotateY=Dm,o.rotateY$1=kw,o.rotateZ=function(a,r,l){var h=Math.sin(l),p=Math.cos(l),_=r[0],x=r[1],T=r[2],A=r[3],I=r[4],P=r[5],D=r[6],O=r[7];return r!==a&&(a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=_*p+I*h,a[1]=x*p+P*h,a[2]=T*p+D*h,a[3]=A*p+O*h,a[4]=I*p-_*h,a[5]=P*p-x*h,a[6]=D*p-T*h,a[7]=O*p-A*h,a},o.rotateZ$1=function(a,r,l){l*=.5;var h=r[0],p=r[1],_=r[2],x=r[3],T=Math.sin(l),A=Math.cos(l);return a[0]=h*A+p*T,a[1]=p*A-h*T,a[2]=_*A+x*T,a[3]=x*A-_*T,a},o.scale=lc,o.scale$1=Iw,o.scale$2=os,o.scaleAndAdd=jf,o.set=function(a,r,l,h){return a[0]=r,a[1]=l,a[2]=h,a},o.setCacheLimits=function(a,r){ii=a,pi=r},o.setColumn=function(a,r,l){a[4*r+0]=l[0],a[4*r+1]=l[1],a[4*r+2]=l[2],a[4*r+3]=l[3]},o.setRTLTextPlugin=function(a,r,l=!1){if(Q===X||Q===Y||Q===K)throw new Error("setRTLTextPlugin cannot be called multiple times.");H=Ii.resolveURL(a),Q=X,J=r,ae(),l||_e()},o.smoothstep=ei,o.spec=Ze,o.squaredLength=function(a){var r=a[0],l=a[1],h=a[2];return r*r+l*l+h*h},o.storeAuthState=function(a,r){r?Ae.add(a):Ae.delete(a)},o.sub=Hs,o.subtract=l0,o.symbolSize=LD,o.tileAABB=function(a,r,l,h,p,_,x,T,A){if(A.name==="globe")return Ck(a,r,new Gm(l,h,p));const I=mc({z:l,x:h,y:p},A);return new Tr([(_+I.x/I.scale)*r,r*(I.y/I.scale),x],[(_+I.x2/I.scale)*r,r*(I.y2/I.scale),T])},o.tileCornersToBounds=Lm,o.tileTransform=mc,o.transformMat3=function(a,r,l){var h=r[0],p=r[1],_=r[2];return a[0]=h*l[0]+p*l[3]+_*l[6],a[1]=h*l[1]+p*l[4]+_*l[7],a[2]=h*l[2]+p*l[5]+_*l[8],a},o.transformMat4=gn,o.transformMat4$1=cc,o.transformQuat=Sw,o.transitionTileAABBinECEF=Bw,o.translate=Nf,o.transpose=function(a,r){if(a===r){var l=r[1],h=r[2],p=r[5];a[1]=r[3],a[2]=r[6],a[3]=l,a[5]=r[7],a[6]=h,a[7]=p}else a[0]=r[0],a[1]=r[3],a[2]=r[6],a[3]=r[1],a[4]=r[4],a[5]=r[7],a[6]=r[2],a[7]=r[5],a[8]=r[8];return a},o.triggerPluginCompletionEvent=le,o.uniqueId=Ln,o.updateGlobeVertexNormal=function(a,r,l,h,p){const _=5*r+2;a.float32[_+0]=l,a.float32[_+1]=h,a.float32[_+2]=p},o.validateCustomStyleLayer=function(a){const r=[],l=a.id;return l===void 0&&r.push({message:`layers.${l}: missing required property "id"`}),a.render===void 0&&r.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&r.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),r},o.validateFilter=a=>zs(Cf(a)),o.validateFog=a=>zs(fm(a)),o.validateLayer=a=>zs(Rf(a)),o.validateLight=a=>zs(hm(a)),o.validateSource=a=>zs(Jl(a)),o.validateStyle=dm,o.validateTerrain=a=>zs(Pf(a)),o.values=On,o.vectorTile=Hm,o.version=w,o.warnOnce=Se,o.window=v,o.wrap=ti}),f(["./shared"],function(o){function v(ne){if(typeof ne=="number"||typeof ne=="boolean"||typeof ne=="string"||ne==null)return JSON.stringify(ne);if(Array.isArray(ne)){let W="[";for(const te of ne)W+=`${v(te)},`;return`${W}]`}let V="{";for(const W of Object.keys(ne).sort())V+=`${W}:${v(ne[W])},`;return`${V}}`}function w(ne){let V="";for(const W of o.refProperties)V+=`/${v(ne[W])}`;return V}class S{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,W){for(const fe of V)this._layerConfigs[fe.id]=fe,(this._layers[fe.id]=o.createStyleLayer(fe)).compileFilter(),this.keyCache[fe.id]&&delete this.keyCache[fe.id];for(const fe of W)delete this.keyCache[fe],delete this._layerConfigs[fe],delete this._layers[fe];this.familiesBySource={};const te=function(fe,we){const Oe={};for(let Ae=0;Ae<fe.length;Ae++){const Fe=we&&we[fe[Ae].id]||w(fe[Ae]);we&&(we[fe[Ae].id]=Fe);let nt=Oe[Fe];nt||(nt=Oe[Fe]=[]),nt.push(fe[Ae])}const ke=[];for(const Ae in Oe)ke.push(Oe[Ae]);return ke}(o.values(this._layerConfigs),this.keyCache);for(const fe of te){const we=fe.map(Ct=>this._layers[Ct.id]),Oe=we[0];if(Oe.visibility==="none")continue;const ke=Oe.source||"";let Ae=this.familiesBySource[ke];Ae||(Ae=this.familiesBySource[ke]={});const Fe=Oe.sourceLayer||"_geojsonTileLayer";let nt=Ae[Fe];nt||(nt=Ae[Fe]=[]),nt.push(we)}}}class R{loadTile(V,W){const{uid:te,encoding:fe,rawImageData:we,padding:Oe,buildQuadTree:ke}=V,Ae=o.window.ImageBitmap&&we instanceof o.window.ImageBitmap?this.getImageData(we,Oe):we;W(null,new o.DEMData(te,Ae,fe,Oe<1,ke))}getImageData(V,W){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const te=this.offscreenCanvasContext.getImageData(-W,-W,V.width+2*W,V.height+2*W);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),te}}var L=function ne(V,W){var te,fe=V&&V.type;if(fe==="FeatureCollection")for(te=0;te<V.features.length;te++)ne(V.features[te],W);else if(fe==="GeometryCollection")for(te=0;te<V.geometries.length;te++)ne(V.geometries[te],W);else if(fe==="Feature")ne(V.geometry,W);else if(fe==="Polygon")j(V.coordinates,W);else if(fe==="MultiPolygon")for(te=0;te<V.coordinates.length;te++)j(V.coordinates[te],W);return V};function j(ne,V){if(ne.length!==0){Z(ne[0],V);for(var W=1;W<ne.length;W++)Z(ne[W],!1)}}function Z(ne,V){for(var W=0,te=0,fe=0,we=ne.length,Oe=we-1;fe<we;Oe=fe++){var ke=(ne[fe][0]-ne[Oe][0])*(ne[Oe][1]+ne[fe][1]),Ae=W+ke;te+=Math.abs(W)>=Math.abs(ke)?W-Ae+ke:ke-Ae+W,W=Ae}W+te>=0!=!!V&&ne.reverse()}const re=o.VectorTileFeature.prototype.toGeoJSON;class xe{constructor(V){this._feature=V,this.extent=o.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))}loadGeometry(){if(this._feature.type===1){const V=[];for(const W of this._feature.geometry)V.push([new o.pointGeometry(W[0],W[1])]);return V}{const V=[];for(const W of this._feature.geometry){const te=[];for(const fe of W)te.push(new o.pointGeometry(fe[0],fe[1]));V.push(te)}return V}}toGeoJSON(V,W,te){return re.call(this,V,W,te)}}class be{constructor(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=V.length,this._features=V}feature(V){return new xe(this._features[V])}}var ue={},oe={get exports(){return ue},set exports(ne){ue=ne}},Ie=o.pointGeometry,me=o.vectorTile.VectorTileFeature,ot=lt;function lt(ne,V){this.options=V||{},this.features=ne,this.length=ne.length}function _t(ne,V){this.id=typeof ne.id=="number"?ne.id:void 0,this.type=ne.type,this.rawGeometry=ne.type===1?[ne.geometry]:ne.geometry,this.properties=ne.tags,this.extent=V||4096}lt.prototype.feature=function(ne){return new _t(this.features[ne],this.options.extent)},_t.prototype.loadGeometry=function(){var ne=this.rawGeometry;this.geometry=[];for(var V=0;V<ne.length;V++){for(var W=ne[V],te=[],fe=0;fe<W.length;fe++)te.push(new Ie(W[fe][0],W[fe][1]));this.geometry.push(te)}return this.geometry},_t.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ne=this.geometry,V=1/0,W=-1/0,te=1/0,fe=-1/0,we=0;we<ne.length;we++)for(var Oe=ne[we],ke=0;ke<Oe.length;ke++){var Ae=Oe[ke];V=Math.min(V,Ae.x),W=Math.max(W,Ae.x),te=Math.min(te,Ae.y),fe=Math.max(fe,Ae.y)}return[V,te,W,fe]},_t.prototype.toGeoJSON=me.prototype.toGeoJSON;var rt=o.pbf,Ge=ot;function Ut(ne){var V=new rt;return function(W,te){for(var fe in W.layers)te.writeMessage(3,Vt,W.layers[fe])}(ne,V),V.finish()}function Vt(ne,V){var W;V.writeVarintField(15,ne.version||1),V.writeStringField(1,ne.name||""),V.writeVarintField(5,ne.extent||4096);var te={keys:[],values:[],keycache:{},valuecache:{}};for(W=0;W<ne.length;W++)te.feature=ne.feature(W),V.writeMessage(2,Ot,te);var fe=te.keys;for(W=0;W<fe.length;W++)V.writeStringField(3,fe[W]);var we=te.values;for(W=0;W<we.length;W++)V.writeMessage(4,wi,we[W])}function Ot(ne,V){var W=ne.feature;W.id!==void 0&&V.writeVarintField(1,W.id),V.writeMessage(2,mt,ne),V.writeVarintField(3,W.type),V.writeMessage(4,ti,W)}function mt(ne,V){var W=ne.feature,te=ne.keys,fe=ne.values,we=ne.keycache,Oe=ne.valuecache;for(var ke in W.properties){var Ae=W.properties[ke],Fe=we[ke];if(Ae!==null){Fe===void 0&&(te.push(ke),we[ke]=Fe=te.length-1),V.writeVarint(Fe);var nt=typeof Ae;nt!=="string"&&nt!=="boolean"&&nt!=="number"&&(Ae=JSON.stringify(Ae));var Ct=nt+":"+Ae,ht=Oe[Ct];ht===void 0&&(fe.push(Ae),Oe[Ct]=ht=fe.length-1),V.writeVarint(ht)}}}function xt(ne,V){return(V<<3)+(7&ne)}function ei(ne){return ne<<1^ne>>31}function ti(ne,V){for(var W=ne.loadGeometry(),te=ne.type,fe=0,we=0,Oe=W.length,ke=0;ke<Oe;ke++){var Ae=W[ke],Fe=1;te===1&&(Fe=Ae.length),V.writeVarint(xt(1,Fe));for(var nt=te===3?Ae.length-1:Ae.length,Ct=0;Ct<nt;Ct++){Ct===1&&te!==1&&V.writeVarint(xt(2,nt-1));var ht=Ae[Ct].x-fe,Xt=Ae[Ct].y-we;V.writeVarint(ei(ht)),V.writeVarint(ei(Xt)),fe+=ht,we+=Xt}te===3&&V.writeVarint(xt(7,1))}}function wi(ne,V){var W=typeof ne;W==="string"?V.writeStringField(1,ne):W==="boolean"?V.writeBooleanField(7,ne):W==="number"&&(ne%1!=0?V.writeDoubleField(3,ne):ne<0?V.writeSVarintField(6,ne):V.writeVarintField(5,ne))}function On(ne,V,W,te,fe,we){if(fe-te<=W)return;const Oe=te+fe>>1;yi(ne,V,Oe,te,fe,we%2),On(ne,V,W,te,Oe-1,we+1),On(ne,V,W,Oe+1,fe,we+1)}function yi(ne,V,W,te,fe,we){for(;fe>te;){if(fe-te>600){const Fe=fe-te+1,nt=W-te+1,Ct=Math.log(Fe),ht=.5*Math.exp(2*Ct/3),Xt=.5*Math.sqrt(Ct*ht*(Fe-ht)/Fe)*(nt-Fe/2<0?-1:1);yi(ne,V,W,Math.max(te,Math.floor(W-nt*ht/Fe+Xt)),Math.min(fe,Math.floor(W+(Fe-nt)*ht/Fe+Xt)),we)}const Oe=V[2*W+we];let ke=te,Ae=fe;for(tn(ne,V,te,W),V[2*fe+we]>Oe&&tn(ne,V,te,fe);ke<Ae;){for(tn(ne,V,ke,Ae),ke++,Ae--;V[2*ke+we]<Oe;)ke++;for(;V[2*Ae+we]>Oe;)Ae--}V[2*te+we]===Oe?tn(ne,V,te,Ae):(Ae++,tn(ne,V,Ae,fe)),Ae<=W&&(te=Ae+1),W<=Ae&&(fe=Ae-1)}}function tn(ne,V,W,te){Ln(ne,W,te),Ln(V,2*W,2*te),Ln(V,2*W+1,2*te+1)}function Ln(ne,V,W){const te=ne[V];ne[V]=ne[W],ne[W]=te}function Xn(ne,V,W,te){const fe=ne-W,we=V-te;return fe*fe+we*we}oe.exports=Ut,ue.fromVectorTileJs=Ut,ue.fromGeojsonVt=function(ne,V){V=V||{};var W={};for(var te in ne)W[te]=new Ge(ne[te].features,V),W[te].name=te,W[te].version=V.version,W[te].extent=V.extent;return Ut({layers:W})},ue.GeoJSONWrapper=Ge;const Bn=ne=>ne[0],$r=ne=>ne[1];class Dr{constructor(V,W=Bn,te=$r,fe=64,we=Float64Array){this.nodeSize=fe,this.points=V;const Oe=V.length<65536?Uint16Array:Uint32Array,ke=this.ids=new Oe(V.length),Ae=this.coords=new we(2*V.length);for(let Fe=0;Fe<V.length;Fe++)ke[Fe]=Fe,Ae[2*Fe]=W(V[Fe]),Ae[2*Fe+1]=te(V[Fe]);On(ke,Ae,fe,0,ke.length-1,0)}range(V,W,te,fe){return function(we,Oe,ke,Ae,Fe,nt,Ct){const ht=[0,we.length-1,0],Xt=[];let $t,jt;for(;ht.length;){const Kt=ht.pop(),oi=ht.pop(),Ii=ht.pop();if(oi-Ii<=Ct){for(let Ni=Ii;Ni<=oi;Ni++)$t=Oe[2*Ni],jt=Oe[2*Ni+1],$t>=ke&&$t<=Fe&&jt>=Ae&&jt<=nt&&Xt.push(we[Ni]);continue}const Gt=Math.floor((Ii+oi)/2);$t=Oe[2*Gt],jt=Oe[2*Gt+1],$t>=ke&&$t<=Fe&&jt>=Ae&&jt<=nt&&Xt.push(we[Gt]);const Fi=(Kt+1)%2;(Kt===0?ke<=$t:Ae<=jt)&&(ht.push(Ii),ht.push(Gt-1),ht.push(Fi)),(Kt===0?Fe>=$t:nt>=jt)&&(ht.push(Gt+1),ht.push(oi),ht.push(Fi))}return Xt}(this.ids,this.coords,V,W,te,fe,this.nodeSize)}within(V,W,te){return function(fe,we,Oe,ke,Ae,Fe){const nt=[0,fe.length-1,0],Ct=[],ht=Ae*Ae;for(;nt.length;){const Xt=nt.pop(),$t=nt.pop(),jt=nt.pop();if($t-jt<=Fe){for(let Fi=jt;Fi<=$t;Fi++)Xn(we[2*Fi],we[2*Fi+1],Oe,ke)<=ht&&Ct.push(fe[Fi]);continue}const Kt=Math.floor((jt+$t)/2),oi=we[2*Kt],Ii=we[2*Kt+1];Xn(oi,Ii,Oe,ke)<=ht&&Ct.push(fe[Kt]);const Gt=(Xt+1)%2;(Xt===0?Oe-Ae<=oi:ke-Ae<=Ii)&&(nt.push(jt),nt.push(Kt-1),nt.push(Gt)),(Xt===0?Oe+Ae>=oi:ke+Ae>=Ii)&&(nt.push(Kt+1),nt.push($t),nt.push(Gt))}return Ct}(this.ids,this.coords,V,W,te,this.nodeSize)}}const gr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ne=>ne},Wr=Math.fround||(Or=new Float32Array(1),ne=>(Or[0]=+ne,Or[0]));var Or;class _r{constructor(V){this.options=At(Object.create(gr),V),this.trees=new Array(this.options.maxZoom+1)}load(V){const{log:W,minZoom:te,maxZoom:fe,nodeSize:we}=this.options;W&&console.time("total time");const Oe=`prepare ${V.length} points`;W&&console.time(Oe),this.points=V;let ke=[];for(let Ae=0;Ae<V.length;Ae++)V[Ae].geometry&&ke.push(Se(V[Ae],Ae));this.trees[fe+1]=new Dr(ke,It,vt,we,Float32Array),W&&console.timeEnd(Oe);for(let Ae=fe;Ae>=te;Ae--){const Fe=+Date.now();ke=this._cluster(ke,Ae),this.trees[Ae]=new Dr(ke,It,vt,we,Float32Array),W&&console.log("z%d: %d clusters in %dms",Ae,ke.length,+Date.now()-Fe)}return W&&console.timeEnd("total time"),this}getClusters(V,W){let te=((V[0]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,V[1]));let we=V[2]===180?180:((V[2]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)te=-180,we=180;else if(te>we){const nt=this.getClusters([te,fe,180,Oe],W),Ct=this.getClusters([-180,fe,we,Oe],W);return nt.concat(Ct)}const ke=this.trees[this._limitZoom(W)],Ae=ke.range(pt(te),yt(Oe),pt(we),yt(fe)),Fe=[];for(const nt of Ae){const Ct=ke.points[nt];Fe.push(Ct.numPoints?Ke(Ct):this.points[Ct.index])}return Fe}getChildren(V){const W=this._getOriginId(V),te=this._getOriginZoom(V),fe="No cluster with the specified id.",we=this.trees[te];if(!we)throw new Error(fe);const Oe=we.points[W];if(!Oe)throw new Error(fe);const ke=this.options.radius/(this.options.extent*Math.pow(2,te-1)),Ae=we.within(Oe.x,Oe.y,ke),Fe=[];for(const nt of Ae){const Ct=we.points[nt];Ct.parentId===V&&Fe.push(Ct.numPoints?Ke(Ct):this.points[Ct.index])}if(Fe.length===0)throw new Error(fe);return Fe}getLeaves(V,W,te){const fe=[];return this._appendLeaves(fe,V,W=W||10,te=te||0,0),fe}getTile(V,W,te){const fe=this.trees[this._limitZoom(V)],we=Math.pow(2,V),{extent:Oe,radius:ke}=this.options,Ae=ke/Oe,Fe=(te-Ae)/we,nt=(te+1+Ae)/we,Ct={features:[]};return this._addTileFeatures(fe.range((W-Ae)/we,Fe,(W+1+Ae)/we,nt),fe.points,W,te,we,Ct),W===0&&this._addTileFeatures(fe.range(1-Ae/we,Fe,1,nt),fe.points,we,te,we,Ct),W===we-1&&this._addTileFeatures(fe.range(0,Fe,Ae/we,nt),fe.points,-1,te,we,Ct),Ct.features.length?Ct:null}getClusterExpansionZoom(V){let W=this._getOriginZoom(V)-1;for(;W<=this.options.maxZoom;){const te=this.getChildren(V);if(W++,te.length!==1)break;V=te[0].properties.cluster_id}return W}_appendLeaves(V,W,te,fe,we){const Oe=this.getChildren(W);for(const ke of Oe){const Ae=ke.properties;if(Ae&&Ae.cluster?we+Ae.point_count<=fe?we+=Ae.point_count:we=this._appendLeaves(V,Ae.cluster_id,te,fe,we):we<fe?we++:V.push(ke),V.length===te)break}return we}_addTileFeatures(V,W,te,fe,we,Oe){for(const ke of V){const Ae=W[ke],Fe=Ae.numPoints;let nt,Ct,ht;if(Fe)nt=tt(Ae),Ct=Ae.x,ht=Ae.y;else{const jt=this.points[Ae.index];nt=jt.properties,Ct=pt(jt.geometry.coordinates[0]),ht=yt(jt.geometry.coordinates[1])}const Xt={type:1,geometry:[[Math.round(this.options.extent*(Ct*we-te)),Math.round(this.options.extent*(ht*we-fe))]],tags:nt};let $t;Fe?$t=Ae.id:this.options.generateId?$t=Ae.index:this.points[Ae.index].id&&($t=this.points[Ae.index].id),$t!==void 0&&(Xt.id=$t),Oe.features.push(Xt)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,W){const te=[],{radius:fe,extent:we,reduce:Oe,minPoints:ke}=this.options,Ae=fe/(we*Math.pow(2,W));for(let Fe=0;Fe<V.length;Fe++){const nt=V[Fe];if(nt.zoom<=W)continue;nt.zoom=W;const Ct=this.trees[W+1],ht=Ct.within(nt.x,nt.y,Ae),Xt=nt.numPoints||1;let $t=Xt;for(const jt of ht){const Kt=Ct.points[jt];Kt.zoom>W&&($t+=Kt.numPoints||1)}if($t>Xt&&$t>=ke){let jt=nt.x*Xt,Kt=nt.y*Xt,oi=Oe&&Xt>1?this._map(nt,!0):null;const Ii=(Fe<<5)+(W+1)+this.points.length;for(const Gt of ht){const Fi=Ct.points[Gt];if(Fi.zoom<=W)continue;Fi.zoom=W;const Ni=Fi.numPoints||1;jt+=Fi.x*Ni,Kt+=Fi.y*Ni,Fi.parentId=Ii,Oe&&(oi||(oi=this._map(nt,!0)),Oe(oi,this._map(Fi)))}nt.parentId=Ii,te.push(Te(jt/$t,Kt/$t,Ii,$t,oi))}else if(te.push(nt),$t>1)for(const jt of ht){const Kt=Ct.points[jt];Kt.zoom<=W||(Kt.zoom=W,te.push(Kt))}}return te}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,W){if(V.numPoints)return W?At({},V.properties):V.properties;const te=this.points[V.index].properties,fe=this.options.map(te);return W&&fe===te?At({},fe):fe}}function Te(ne,V,W,te,fe){return{x:Wr(ne),y:Wr(V),zoom:1/0,id:W,parentId:-1,numPoints:te,properties:fe}}function Se(ne,V){const[W,te]=ne.geometry.coordinates;return{x:Wr(pt(W)),y:Wr(yt(te)),zoom:1/0,index:V,parentId:-1}}function Ke(ne){return{type:"Feature",id:ne.id,properties:tt(ne),geometry:{type:"Point",coordinates:[(V=ne.x,360*(V-.5)),kt(ne.y)]}};var V}function tt(ne){const V=ne.numPoints,W=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V;return At(At({},ne.properties),{cluster:!0,cluster_id:ne.id,point_count:V,point_count_abbreviated:W})}function pt(ne){return ne/360+.5}function yt(ne){const V=Math.sin(ne*Math.PI/180),W=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return W<0?0:W>1?1:W}function kt(ne){const V=(180-360*ne)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function At(ne,V){for(const W in V)ne[W]=V[W];return ne}function It(ne){return ne.x}function vt(ne){return ne.y}function Qt(ne,V,W,te){for(var fe,we=te,Oe=W-V>>1,ke=W-V,Ae=ne[V],Fe=ne[V+1],nt=ne[W],Ct=ne[W+1],ht=V+3;ht<W;ht+=3){var Xt=Pt(ne[ht],ne[ht+1],Ae,Fe,nt,Ct);if(Xt>we)fe=ht,we=Xt;else if(Xt===we){var $t=Math.abs(ht-Oe);$t<ke&&(fe=ht,ke=$t)}}we>te&&(fe-V>3&&Qt(ne,V,fe,te),ne[fe+2]=we,W-fe>3&&Qt(ne,fe,W,te))}function Pt(ne,V,W,te,fe,we){var Oe=fe-W,ke=we-te;if(Oe!==0||ke!==0){var Ae=((ne-W)*Oe+(V-te)*ke)/(Oe*Oe+ke*ke);Ae>1?(W=fe,te=we):Ae>0&&(W+=Oe*Ae,te+=ke*Ae)}return(Oe=ne-W)*Oe+(ke=V-te)*ke}function Ht(ne,V,W,te){var fe={id:ne===void 0?null:ne,type:V,geometry:W,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(we){var Oe=we.geometry,ke=we.type;if(ke==="Point"||ke==="MultiPoint"||ke==="LineString")ii(we,Oe);else if(ke==="Polygon"||ke==="MultiLineString")for(var Ae=0;Ae<Oe.length;Ae++)ii(we,Oe[Ae]);else if(ke==="MultiPolygon")for(Ae=0;Ae<Oe.length;Ae++)for(var Fe=0;Fe<Oe[Ae].length;Fe++)ii(we,Oe[Ae][Fe])}(fe),fe}function ii(ne,V){for(var W=0;W<V.length;W+=3)ne.minX=Math.min(ne.minX,V[W]),ne.minY=Math.min(ne.minY,V[W+1]),ne.maxX=Math.max(ne.maxX,V[W]),ne.maxY=Math.max(ne.maxY,V[W+1])}function pi(ne,V,W,te){if(V.geometry){var fe=V.geometry.coordinates,we=V.geometry.type,Oe=Math.pow(W.tolerance/((1<<W.maxZoom)*W.extent),2),ke=[],Ae=V.id;if(W.promoteId?Ae=V.properties[W.promoteId]:W.generateId&&(Ae=te||0),we==="Point")ki(fe,ke);else if(we==="MultiPoint")for(var Fe=0;Fe<fe.length;Fe++)ki(fe[Fe],ke);else if(we==="LineString")xi(fe,ke,Oe,!1);else if(we==="MultiLineString"){if(W.lineMetrics){for(Fe=0;Fe<fe.length;Fe++)xi(fe[Fe],ke=[],Oe,!1),ne.push(Ht(Ae,"LineString",ke,V.properties));return}Cn(fe,ke,Oe,!1)}else if(we==="Polygon")Cn(fe,ke,Oe,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(Fe=0;Fe<V.geometry.geometries.length;Fe++)pi(ne,{id:Ae,geometry:V.geometry.geometries[Fe],properties:V.properties},W,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Fe=0;Fe<fe.length;Fe++){var nt=[];Cn(fe[Fe],nt,Oe,!0),ke.push(nt)}}ne.push(Ht(Ae,we,ke,V.properties))}}function ki(ne,V){V.push(vn(ne[0])),V.push(qn(ne[1])),V.push(0)}function xi(ne,V,W,te){for(var fe,we,Oe=0,ke=0;ke<ne.length;ke++){var Ae=vn(ne[ke][0]),Fe=qn(ne[ke][1]);V.push(Ae),V.push(Fe),V.push(0),ke>0&&(Oe+=te?(fe*Fe-Ae*we)/2:Math.sqrt(Math.pow(Ae-fe,2)+Math.pow(Fe-we,2))),fe=Ae,we=Fe}var nt=V.length-3;V[2]=1,Qt(V,0,nt,W),V[nt+2]=1,V.size=Math.abs(Oe),V.start=0,V.end=V.size}function Cn(ne,V,W,te){for(var fe=0;fe<ne.length;fe++){var we=[];xi(ne[fe],we,W,te),V.push(we)}}function vn(ne){return ne/360+.5}function qn(ne){var V=Math.sin(ne*Math.PI/180),W=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return W<0?0:W>1?1:W}function cn(ne,V,W,te,fe,we,Oe,ke){if(te/=V,we>=(W/=V)&&Oe<te)return ne;if(Oe<W||we>=te)return null;for(var Ae=[],Fe=0;Fe<ne.length;Fe++){var nt=ne[Fe],Ct=nt.geometry,ht=nt.type,Xt=fe===0?nt.minX:nt.minY,$t=fe===0?nt.maxX:nt.maxY;if(Xt>=W&&$t<te)Ae.push(nt);else if(!($t<W||Xt>=te)){var jt=[];if(ht==="Point"||ht==="MultiPoint")is(Ct,jt,W,te,fe);else if(ht==="LineString")ns(Ct,jt,W,te,fe,!1,ke.lineMetrics);else if(ht==="MultiLineString")ir(Ct,jt,W,te,fe,!1);else if(ht==="Polygon")ir(Ct,jt,W,te,fe,!0);else if(ht==="MultiPolygon")for(var Kt=0;Kt<Ct.length;Kt++){var oi=[];ir(Ct[Kt],oi,W,te,fe,!0),oi.length&&jt.push(oi)}if(jt.length){if(ke.lineMetrics&&ht==="LineString"){for(Kt=0;Kt<jt.length;Kt++)Ae.push(Ht(nt.id,ht,jt[Kt],nt.tags));continue}ht!=="LineString"&&ht!=="MultiLineString"||(jt.length===1?(ht="LineString",jt=jt[0]):ht="MultiLineString"),ht!=="Point"&&ht!=="MultiPoint"||(ht=jt.length===3?"Point":"MultiPoint"),Ae.push(Ht(nt.id,ht,jt,nt.tags))}}}return Ae.length?Ae:null}function is(ne,V,W,te,fe){for(var we=0;we<ne.length;we+=3){var Oe=ne[we+fe];Oe>=W&&Oe<=te&&(V.push(ne[we]),V.push(ne[we+1]),V.push(ne[we+2]))}}function ns(ne,V,W,te,fe,we,Oe){for(var ke,Ae,Fe=bn(ne),nt=fe===0?Ia:qo,Ct=ne.start,ht=0;ht<ne.length-3;ht+=3){var Xt=ne[ht],$t=ne[ht+1],jt=ne[ht+2],Kt=ne[ht+3],oi=ne[ht+4],Ii=fe===0?Xt:$t,Gt=fe===0?Kt:oi,Fi=!1;Oe&&(ke=Math.sqrt(Math.pow(Xt-Kt,2)+Math.pow($t-oi,2))),Ii<W?Gt>W&&(Ae=nt(Fe,Xt,$t,Kt,oi,W),Oe&&(Fe.start=Ct+ke*Ae)):Ii>te?Gt<te&&(Ae=nt(Fe,Xt,$t,Kt,oi,te),Oe&&(Fe.start=Ct+ke*Ae)):Os(Fe,Xt,$t,jt),Gt<W&&Ii>=W&&(Ae=nt(Fe,Xt,$t,Kt,oi,W),Fi=!0),Gt>te&&Ii<=te&&(Ae=nt(Fe,Xt,$t,Kt,oi,te),Fi=!0),!we&&Fi&&(Oe&&(Fe.end=Ct+ke*Ae),V.push(Fe),Fe=bn(ne)),Oe&&(Ct+=ke)}var Ni=ne.length-3;Xt=ne[Ni],$t=ne[Ni+1],jt=ne[Ni+2],(Ii=fe===0?Xt:$t)>=W&&Ii<=te&&Os(Fe,Xt,$t,jt),Ni=Fe.length-3,we&&Ni>=3&&(Fe[Ni]!==Fe[0]||Fe[Ni+1]!==Fe[1])&&Os(Fe,Fe[0],Fe[1],Fe[2]),Fe.length&&V.push(Fe)}function bn(ne){var V=[];return V.size=ne.size,V.start=ne.start,V.end=ne.end,V}function ir(ne,V,W,te,fe,we){for(var Oe=0;Oe<ne.length;Oe++)ns(ne[Oe],V,W,te,fe,we,!1)}function Os(ne,V,W,te){ne.push(V),ne.push(W),ne.push(te)}function Ia(ne,V,W,te,fe,we){var Oe=(we-V)/(te-V);return ne.push(we),ne.push(W+(fe-W)*Oe),ne.push(1),Oe}function qo(ne,V,W,te,fe,we){var Oe=(we-W)/(fe-W);return ne.push(V+(te-V)*Oe),ne.push(we),ne.push(1),Oe}function Cl(ne,V){for(var W=[],te=0;te<ne.length;te++){var fe,we=ne[te],Oe=we.type;if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")fe=Go(we.geometry,V);else if(Oe==="MultiLineString"||Oe==="Polygon"){fe=[];for(var ke=0;ke<we.geometry.length;ke++)fe.push(Go(we.geometry[ke],V))}else if(Oe==="MultiPolygon")for(fe=[],ke=0;ke<we.geometry.length;ke++){for(var Ae=[],Fe=0;Fe<we.geometry[ke].length;Fe++)Ae.push(Go(we.geometry[ke][Fe],V));fe.push(Ae)}W.push(Ht(we.id,Oe,fe,we.tags))}return W}function Go(ne,V){var W=[];W.size=ne.size,ne.start!==void 0&&(W.start=ne.start,W.end=ne.end);for(var te=0;te<ne.length;te+=3)W.push(ne[te]+V,ne[te+1],ne[te+2]);return W}function rs(ne,V){if(ne.transformed)return ne;var W,te,fe,we=1<<ne.z,Oe=ne.x,ke=ne.y;for(W=0;W<ne.features.length;W++){var Ae=ne.features[W],Fe=Ae.geometry,nt=Ae.type;if(Ae.geometry=[],nt===1)for(te=0;te<Fe.length;te+=2)Ae.geometry.push(Zo(Fe[te],Fe[te+1],V,we,Oe,ke));else for(te=0;te<Fe.length;te++){var Ct=[];for(fe=0;fe<Fe[te].length;fe+=2)Ct.push(Zo(Fe[te][fe],Fe[te][fe+1],V,we,Oe,ke));Ae.geometry.push(Ct)}}return ne.transformed=!0,ne}function Zo(ne,V,W,te,fe,we){return[Math.round(W*(ne*te-fe)),Math.round(W*(V*te-we))]}function Jc(ne,V,W,te,fe){for(var we=V===fe.maxZoom?0:fe.tolerance/((1<<V)*fe.extent),Oe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:W,y:te,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ke=0;ke<ne.length;ke++){Oe.numFeatures++,Qc(Oe,ne[ke],we,fe);var Ae=ne[ke].minX,Fe=ne[ke].minY,nt=ne[ke].maxX,Ct=ne[ke].maxY;Ae<Oe.minX&&(Oe.minX=Ae),Fe<Oe.minY&&(Oe.minY=Fe),nt>Oe.maxX&&(Oe.maxX=nt),Ct>Oe.maxY&&(Oe.maxY=Ct)}return Oe}function Qc(ne,V,W,te){var fe=V.geometry,we=V.type,Oe=[];if(we==="Point"||we==="MultiPoint")for(var ke=0;ke<fe.length;ke+=3)Oe.push(fe[ke]),Oe.push(fe[ke+1]),ne.numPoints++,ne.numSimplified++;else if(we==="LineString")Ca(Oe,fe,ne,W,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(ke=0;ke<fe.length;ke++)Ca(Oe,fe[ke],ne,W,we==="Polygon",ke===0);else if(we==="MultiPolygon")for(var Ae=0;Ae<fe.length;Ae++){var Fe=fe[Ae];for(ke=0;ke<Fe.length;ke++)Ca(Oe,Fe[ke],ne,W,!0,ke===0)}if(Oe.length){var nt=V.tags||null;if(we==="LineString"&&te.lineMetrics){for(var Ct in nt={},V.tags)nt[Ct]=V.tags[Ct];nt.mapbox_clip_start=fe.start/fe.size,nt.mapbox_clip_end=fe.end/fe.size}var ht={geometry:Oe,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:nt};V.id!==null&&(ht.id=V.id),ne.features.push(ht)}}function Ca(ne,V,W,te,fe,we){var Oe=te*te;if(te>0&&V.size<(fe?Oe:te))W.numPoints+=V.length/3;else{for(var ke=[],Ae=0;Ae<V.length;Ae+=3)(te===0||V[Ae+2]>Oe)&&(W.numSimplified++,ke.push(V[Ae]),ke.push(V[Ae+1])),W.numPoints++;fe&&function(Fe,nt){for(var Ct=0,ht=0,Xt=Fe.length,$t=Xt-2;ht<Xt;$t=ht,ht+=2)Ct+=(Fe[ht]-Fe[$t])*(Fe[ht+1]+Fe[$t+1]);if(Ct>0===nt)for(ht=0,Xt=Fe.length;ht<Xt/2;ht+=2){var jt=Fe[ht],Kt=Fe[ht+1];Fe[ht]=Fe[Xt-2-ht],Fe[ht+1]=Fe[Xt-1-ht],Fe[Xt-2-ht]=jt,Fe[Xt-1-ht]=Kt}}(ke,we),ne.push(ke)}}function Yo(ne,V){var W=(V=this.options=function(fe,we){for(var Oe in we)fe[Oe]=we[Oe];return fe}(Object.create(this.options),V)).debug;if(W&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var te=function(fe,we){var Oe=[];if(fe.type==="FeatureCollection")for(var ke=0;ke<fe.features.length;ke++)pi(Oe,fe.features[ke],we,ke);else pi(Oe,fe.type==="Feature"?fe:{geometry:fe},we);return Oe}(ne,V);this.tiles={},this.tileCoords=[],W&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),te=function(fe,we){var Oe=we.buffer/we.extent,ke=fe,Ae=cn(fe,1,-1-Oe,Oe,0,-1,2,we),Fe=cn(fe,1,1-Oe,2+Oe,0,-1,2,we);return(Ae||Fe)&&(ke=cn(fe,1,-Oe,1+Oe,0,-1,2,we)||[],Ae&&(ke=Cl(Ae,1).concat(ke)),Fe&&(ke=ke.concat(Cl(Fe,-1)))),ke}(te,V),te.length&&this.splitTile(te,0,0,0),W&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Lr(ne,V,W){return 32*((1<<ne)*W+V)+ne}function oo(ne,V){const W=ne.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const te=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!te)return V(null,null);const fe=new be(te.features);let we=ue(fe);we.byteOffset===0&&we.byteLength===we.buffer.byteLength||(we=new Uint8Array(we)),V(null,{vectorTile:fe,rawData:we.buffer})}Yo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Yo.prototype.splitTile=function(ne,V,W,te,fe,we,Oe){for(var ke=[ne,V,W,te],Ae=this.options,Fe=Ae.debug;ke.length;){te=ke.pop(),W=ke.pop(),V=ke.pop(),ne=ke.pop();var nt=1<<V,Ct=Lr(V,W,te),ht=this.tiles[Ct];if(!ht&&(Fe>1&&console.time("creation"),ht=this.tiles[Ct]=Jc(ne,V,W,te,Ae),this.tileCoords.push({z:V,x:W,y:te}),Fe)){Fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,W,te,ht.numFeatures,ht.numPoints,ht.numSimplified),console.timeEnd("creation"));var Xt="z"+V;this.stats[Xt]=(this.stats[Xt]||0)+1,this.total++}if(ht.source=ne,fe){if(V===Ae.maxZoom||V===fe)continue;var $t=1<<fe-V;if(W!==Math.floor(we/$t)||te!==Math.floor(Oe/$t))continue}else if(V===Ae.indexMaxZoom||ht.numPoints<=Ae.indexMaxPoints)continue;if(ht.source=null,ne.length!==0){Fe>1&&console.time("clipping");var jt,Kt,oi,Ii,Gt,Fi,Ni=.5*Ae.buffer/Ae.extent,ao=.5-Ni,Ls=.5+Ni,Ze=1+Ni;jt=Kt=oi=Ii=null,Gt=cn(ne,nt,W-Ni,W+Ls,0,ht.minX,ht.maxX,Ae),Fi=cn(ne,nt,W+ao,W+Ze,0,ht.minX,ht.maxX,Ae),ne=null,Gt&&(jt=cn(Gt,nt,te-Ni,te+Ls,1,ht.minY,ht.maxY,Ae),Kt=cn(Gt,nt,te+ao,te+Ze,1,ht.minY,ht.maxY,Ae),Gt=null),Fi&&(oi=cn(Fi,nt,te-Ni,te+Ls,1,ht.minY,ht.maxY,Ae),Ii=cn(Fi,nt,te+ao,te+Ze,1,ht.minY,ht.maxY,Ae),Fi=null),Fe>1&&console.timeEnd("clipping"),ke.push(jt||[],V+1,2*W,2*te),ke.push(Kt||[],V+1,2*W,2*te+1),ke.push(oi||[],V+1,2*W+1,2*te),ke.push(Ii||[],V+1,2*W+1,2*te+1)}}},Yo.prototype.getTile=function(ne,V,W){var te=this.options,fe=te.extent,we=te.debug;if(ne<0||ne>24)return null;var Oe=1<<ne,ke=Lr(ne,V=(V%Oe+Oe)%Oe,W);if(this.tiles[ke])return rs(this.tiles[ke],fe);we>1&&console.log("drilling down to z%d-%d-%d",ne,V,W);for(var Ae,Fe=ne,nt=V,Ct=W;!Ae&&Fe>0;)Fe--,nt=Math.floor(nt/2),Ct=Math.floor(Ct/2),Ae=this.tiles[Lr(Fe,nt,Ct)];return Ae&&Ae.source?(we>1&&console.log("found parent tile z%d-%d-%d",Fe,nt,Ct),we>1&&console.time("drilling down"),this.splitTile(Ae.source,Fe,nt,Ct,ne,V,W),we>1&&console.timeEnd("drilling down"),this.tiles[ke]?rs(this.tiles[ke],fe):null):null};class eu extends o.VectorTileWorkerSource{constructor(V,W,te,fe,we){super(V,W,te,fe,oo),we&&(this.loadGeoJSON=we)}loadData(V,W){const te=V&&V.request,fe=te&&te.collectResourceTiming;this.loadGeoJSON(V,(we,Oe)=>{if(we||!Oe)return W(we);if(typeof Oe!="object")return W(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{L(Oe,!0);try{if(V.filter){const Ae=o.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ae.result==="error")throw new Error(Ae.value.map(nt=>`${nt.key}: ${nt.message}`).join(", "));Oe={type:"FeatureCollection",features:Oe.features.filter(nt=>Ae.value.evaluate({zoom:0},nt))}}this._geoJSONIndex=V.cluster?new _r(function({superclusterOptions:Ae,clusterProperties:Fe}){if(!Fe||!Ae)return Ae;const nt={},Ct={},ht={accumulated:null,zoom:0},Xt={properties:null},$t=Object.keys(Fe);for(const jt of $t){const[Kt,oi]=Fe[jt],Ii=o.createExpression(oi),Gt=o.createExpression(typeof Kt=="string"?[Kt,["accumulated"],["get",jt]]:Kt);nt[jt]=Ii.value,Ct[jt]=Gt.value}return Ae.map=jt=>{Xt.properties=jt;const Kt={};for(const oi of $t)Kt[oi]=nt[oi].evaluate(ht,Xt);return Kt},Ae.reduce=(jt,Kt)=>{Xt.properties=Kt;for(const oi of $t)ht.accumulated=jt[oi],jt[oi]=Ct[oi].evaluate(ht,Xt)},Ae}(V)).load(Oe.features):function(Ae,Fe){return new Yo(Ae,Fe)}(Oe,V.geojsonVtOptions)}catch(Ae){return W(Ae)}this.loaded={};const ke={};if(fe){const Ae=o.getPerformanceMeasurement(te);Ae&&(ke.resourceTiming={},ke.resourceTiming[V.source]=JSON.parse(JSON.stringify(Ae)))}W(null,ke)}})}reloadTile(V,W){const te=this.loaded;return te&&te[V.uid]?super.reloadTile(V,W):this.loadTile(V,W)}loadGeoJSON(V,W){if(V.request)o.getJSON(V.request,W);else{if(typeof V.data!="string")return W(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return W(null,JSON.parse(V.data))}catch{return W(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,W){try{W(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(te){W(te)}}getClusterChildren(V,W){try{W(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(te){W(te)}}getClusterLeaves(V,W){try{W(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(te){W(te)}}}class Ko{constructor(V){this.self=V,this.actor=new o.Actor(V,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:eu},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(W,te)=>{if(this.workerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.workerSourceTypes[W]=te},this.self.registerRTLTextPlugin=W=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=W.applyArabicShaping,o.plugin.processBidirectionalText=W.processBidirectionalText,o.plugin.processStyledBidirectionalText=W.processStyledBidirectionalText}}clearCaches(V,W,te){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],te()}checkIfReady(V,W,te){te()}setReferrer(V,W){this.referrer=W}spriteLoaded(V,W){this.isSpriteLoaded[V]=W;for(const te in this.workerSources[V]){const fe=this.workerSources[V][te];for(const we in fe)fe[we]instanceof o.VectorTileWorkerSource&&(fe[we].isSpriteLoaded=W,fe[we].fire(new o.Event("isSpriteLoaded")))}}setImages(V,W,te){this.availableImages[V]=W;for(const fe in this.workerSources[V]){const we=this.workerSources[V][fe];for(const Oe in we)we[Oe].availableImages=W}te()}enableTerrain(V,W,te){this.terrain=W,te()}setProjection(V,W){this.projections[V]=o.getProjection(W)}setLayers(V,W,te){this.getLayerIndex(V).replace(W),te()}updateLayers(V,W,te){this.getLayerIndex(V).update(W.layers,W.removedIds),te()}loadTile(V,W,te){const fe=this.enableTerrain?o.extend({enableTerrain:this.terrain},W):W;fe.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,W.type,W.source).loadTile(fe,te)}loadDEMTile(V,W,te){const fe=this.enableTerrain?o.extend({buildQuadTree:this.terrain},W):W;this.getDEMWorkerSource(V,W.source).loadTile(fe,te)}reloadTile(V,W,te){const fe=this.enableTerrain?o.extend({enableTerrain:this.terrain},W):W;fe.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,W.type,W.source).reloadTile(fe,te)}abortTile(V,W,te){this.getWorkerSource(V,W.type,W.source).abortTile(W,te)}removeTile(V,W,te){this.getWorkerSource(V,W.type,W.source).removeTile(W,te)}removeSource(V,W,te){if(!this.workerSources[V]||!this.workerSources[V][W.type]||!this.workerSources[V][W.type][W.source])return;const fe=this.workerSources[V][W.type][W.source];delete this.workerSources[V][W.type][W.source],fe.removeSource!==void 0?fe.removeSource(W,te):te()}loadWorkerSource(V,W,te){try{this.self.importScripts(W.url),te()}catch(fe){te(fe.toString())}}syncRTLPluginState(V,W,te){try{o.plugin.setState(W);const fe=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&fe!=null){this.self.importScripts(fe);const we=o.plugin.isParsed();te(we?void 0:new Error(`RTL Text Plugin failed to import scripts from ${fe}`),we)}}catch(fe){te(fe.toString())}}getAvailableImages(V){let W=this.availableImages[V];return W||(W=[]),W}getLayerIndex(V){let W=this.layerIndexes[V];return W||(W=this.layerIndexes[V]=new S),W}getWorkerSource(V,W,te){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][W]||(this.workerSources[V][W]={}),!this.workerSources[V][W][te]){const fe={send:(we,Oe,ke,Ae,Fe,nt)=>{this.actor.send(we,Oe,ke,V,Fe,nt)},scheduler:this.actor.scheduler};this.workerSources[V][W][te]=new this.workerSourceTypes[W](fe,this.getLayerIndex(V),this.getAvailableImages(V),this.isSpriteLoaded[V])}return this.workerSources[V][W][te]}getDEMWorkerSource(V,W){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][W]||(this.demWorkerSources[V][W]=new R),this.demWorkerSources[V][W]}enforceCacheSizeLimit(V,W){o.enforceCacheSizeLimit(W)}getWorkerPerformanceMetrics(V,W,te){te(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ko(self)),Ko}),f(["./shared"],function(o){function v(g,c){if(Array.isArray(g)){if(!Array.isArray(c)||g.length!==c.length)return!1;for(let d=0;d<g.length;d++)if(!v(g[d],c[d]))return!1;return!0}if(typeof g=="object"&&g!==null&&c!==null){if(typeof c!="object"||Object.keys(g).length!==Object.keys(c).length)return!1;for(const d in g)if(!v(g[d],c[d]))return!1;return!0}return g===c}var w=S;function S(g){return!function(c){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,b,E=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(E);try{b=new Worker(C),y=!0}catch{y=!1}return b&&b.terminate(),URL.revokeObjectURL(C),y}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var y=document.createElement("canvas");y.width=y.height=1;var b=y.getContext("2d");if(!b)return!1;var E=b.getImageData(0,0,1,1);return E&&E.width===y.width}()?(R[d=c&&c.failIfMajorPerformanceCaveat]===void 0&&(R[d]=function(y){var b,E=function(C){var M=document.createElement("canvas"),k=Object.create(S.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=C,M.getContext("webgl",k)||M.getContext("experimental-webgl",k)}(y);if(!E)return!1;try{b=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!b||E.isContextLost())&&(E.shaderSource(b,"void main() {}"),E.compileShader(b),E.getShaderParameter(b,E.COMPILE_STATUS)===!0)}(d)),R[d]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var d}(g)}var R={};function L(g,c,d){const y=o.window.document.createElement(g);return c!==void 0&&(y.className=c),d&&d.appendChild(y),y}function j(g,c,d){const y=o.window.document.createElementNS("http://www.w3.org/2000/svg",g);for(const b of Object.keys(c))y.setAttributeNS(null,b,c[b]);return d&&d.appendChild(y),y}S.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Z=o.window.document&&o.window.document.documentElement.style,re=Z&&Z.userSelect!==void 0?"userSelect":"WebkitUserSelect";let xe;function be(){Z&&re&&(xe=Z[re],Z[re]="none")}function ue(){Z&&re&&(Z[re]=xe)}function oe(g){g.preventDefault(),g.stopPropagation(),o.window.removeEventListener("click",oe,!0)}function Ie(){o.window.addEventListener("click",oe,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",oe,!0)},0)}function me(g,c){const d=g.getBoundingClientRect();return _t(g,d,c)}function ot(g,c){const d=g.getBoundingClientRect(),y=[];for(let b=0;b<c.length;b++)y.push(_t(g,d,c[b]));return y}function lt(g){return o.window.InstallTrigger!==void 0&&g.button===2&&g.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function _t(g,c,d){const y=g.offsetWidth===c.width?1:g.offsetWidth/c.width;return new o.pointGeometry((d.clientX-c.left)*y,(d.clientY-c.top)*y)}function rt(g,c){var d=c[0],y=c[1],b=c[2],E=c[3],C=d*E-b*y;return C?(g[0]=E*(C=1/C),g[1]=-y*C,g[2]=-b*C,g[3]=d*C,g):null}function Ge(g){const{userImage:c}=g;return!!(c&&c.render&&c.render())&&(g.data.replace(new Uint8Array(c.data.buffer)),!0)}class Ut extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:d,callback:y}of this.requestors)this._notify(d,y);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,d){this._validate(c,d)&&(this.images[c]=d)}_validate(c,d){let y=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),y=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),y=!1),this._validateContent(d.content,d)||(this.fire(new o.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),y=!1),y}_validateStretch(c,d){if(!c)return!0;let y=0;for(const b of c){if(b[0]<y||b[1]<b[0]||d<b[1])return!1;y=b[1]}return!0}_validateContent(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0}removeImage(c){const d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,d){let y=!0;if(!this.isLoaded())for(const b of c)this.images[b]||(y=!1);this.isLoaded()||y?this._notify(c,d):this.requestors.push({ids:c,callback:d})}_notify(c,d){const y={};for(const b of c){this.images[b]||this.fire(new o.Event("styleimagemissing",{id:b}));const E=this.images[b];E?y[b]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)}:o.warnOnce(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,y)}getPixelSize(){const{width:c,height:d}=this.atlasImage;return{width:c,height:d}}getPattern(c){const d=this.patterns[c],y=this.getImage(c);if(!y)return null;if(d&&d.position.version===y.version)return d.position;if(d)d.position.version=y.version;else{const b={w:y.data.width+2,h:y.data.height+2,x:0,y:0},E=new o.ImagePosition(b,y);this.patterns[c]={bin:b,position:E}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture&&this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const E in this.patterns)c.push(this.patterns[E].bin);const{w:d,h:y}=o.potpack(c),b=this.atlasImage;b.resize({width:d||1,height:y||1});for(const E in this.patterns){const{bin:C}=this.patterns[E],M=C.x+1,k=C.y+1,F=this.images[E].data,B=F.width,U=F.height;o.RGBAImage.copy(F,b,{x:0,y:0},{x:M,y:k},{width:B,height:U}),o.RGBAImage.copy(F,b,{x:0,y:U-1},{x:M,y:k-1},{width:B,height:1}),o.RGBAImage.copy(F,b,{x:0,y:0},{x:M,y:k+U},{width:B,height:1}),o.RGBAImage.copy(F,b,{x:B-1,y:0},{x:M-1,y:k},{width:1,height:U}),o.RGBAImage.copy(F,b,{x:0,y:0},{x:M+B,y:k},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const d of c){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const y=this.images[d];Ge(y)&&this.updateImage(d,y)}}}const Vt=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(g,c){return function([d,y,b]){const E=o.degToRad(y+90),C=o.degToRad(b);return{x:d*Math.cos(E)*Math.sin(C),y:d*Math.sin(E)*Math.sin(C),z:d*Math.cos(C),azimuthal:y,polar:b}}(g.expression.evaluate(c))}interpolate(g,c,d){return{x:o.number(g.x,c.x,d),y:o.number(g.y,c.y,d),z:o.number(g.z,c.z,d),azimuthal:o.number(g.azimuthal,c.azimuthal,d),polar:o.number(g.polar,c.polar,d)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),Ot="-transition";class mt extends o.Evented{constructor(c){super(),this._transitionable=new o.Transitionable(Vt),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,d={}){if(!this._validate(o.validateLight,c,d))for(const y in c){const b=c[y];o.endsWith(y,Ot)?this._transitionable.setTransition(y.slice(0,-Ot.length),b):this._transitionable.setValue(y,b)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,d,y){return(!y||y.validate!==!1)&&o.emitValidationErrors(this,c.call(o.validateStyle,o.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const xt=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),ei="-transition";class ti extends o.Evented{constructor(c,d){super(),this._transitionable=new o.Transitionable(xt),this.set(c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=d}get(){return this._transitionable.serialize()}set(c){for(const d in c){const y=c[d];o.endsWith(d,ei)?this._transitionable.setTransition(d.slice(0,-ei.length),y):this._transitionable.setValue(d,y)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}}function wi(g,c,d,y){const b=o.smoothstep(45,65,d),[E,C]=On(g,y),M=o.length(c);let k=1-Math.min(1,Math.exp((M-E)/(C-E)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*b*g.alpha}function On(g,c){const d=.5/Math.tan(.5*c);return[g.range[0]+d,g.range[1]+d]}const yi=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])}),tn="-transition";class Ln extends o.Evented{constructor(c,d){super(),this._transitionable=new o.Transitionable(yi),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){const c=this._transform,d=c.projection.name==="globe",y=o.globeToMercatorTransition(c.zoom),b=this.properties.get("range"),E=[.5,3];return{range:d?[o.number(E[0],b[0],y),o.number(E[1],b[1],y)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,d={}){if(!this._validate(o.validateFog,c,d)){for(const y of Object.keys(o.spec.fog))c&&c[y]===void 0&&(c[y]=o.spec.fog[y].default);for(const y in c){const b=c[y];o.endsWith(y,tn)?this._transitionable.setTransition(y.slice(0,-tn.length),b):this._transitionable.setValue(y,b)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,c))*d.a}getOpacityAtLatLng(c,d){return this._transform.projection.supportsFog?function(y,b,E){const C=o.MercatorCoordinate.fromLngLat(b),M=E.elevation?E.elevation.getAtPointOrZero(C):0,k=[C.x,C.y,M];return o.transformMat4(k,k,E.mercatorFogMatrix),wi(y,k,E.pitch,E._fov)}(this.state,c,d):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?On(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,d,y){return(!y||y.validate!==!1)&&o.emitValidationErrors(this,c.call(o.validateStyle,o.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Xn{constructor(c,d){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const y=this.workerPool.acquire(this.id);for(let b=0;b<y.length;b++){const E=new Xn.Actor(y[b],d,this.id);E.name=`Worker ${b}`,this.actors.push(E)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,d,y){o.asyncAll(this.actors,(b,E)=>{b.send(c,d,E)},y=y||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Bn(g,c,d){return c*(o.EXTENT/(g.tileSize*Math.pow(2,d-g.tileID.overscaledZ)))}Xn.Actor=o.Actor;class $r{constructor(c,d,y,b){this.screenBounds=c,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(c,d){let y,b;if(c instanceof o.pointGeometry||typeof c[0]=="number"){const E=o.pointGeometry.convert(c);y=[E],b=d.isPointAboveHorizon(E)}else{const E=o.pointGeometry.convert(c[0]),C=o.pointGeometry.convert(c[1]);y=[E,C],b=o.polygonizeBounds(E,C).every(M=>d.isPointAboveHorizon(M))}return new $r(y,d.getCameraPoint(),b,d)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(c){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const d=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],b=o.polygonizeBounds(d,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<y.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?b[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(b[3]=this.cameraPoint)),o.bufferConvexPolygon(b,c)}bufferedCameraGeometryGlobe(c){const d=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],b=o.polygonizeBounds(d,y,c),E=this.cameraPoint.clone();switch(3*((E.y>d.y)+(E.y>y.y))+((E.x>d.x)+(E.x>y.x))){case 0:b[0]=E,b[4]=E.clone();break;case 1:b.splice(1,0,E);break;case 2:b[1]=E;break;case 3:b.splice(4,0,E);break;case 5:b.splice(2,0,E);break;case 6:b[3]=E;break;case 7:b.splice(3,0,E);break;case 8:b[2]=E}return b}containsTile(c,d,y,b=0){const E=c.queryPadding/d._pixelsPerMercatorPixel+1,C=y?this._bufferedCameraMercator(E,d):this._bufferedScreenMercator(E,d);let M=c.tileID.wrap+(C.unwrapped?b:0);const k=C.polygon.map(Q=>o.getTilePoint(c.tileTransform,Q,M));if(!o.polygonIntersectsBox(k,0,0,o.EXTENT,o.EXTENT))return;M=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const F=this.screenGeometryMercator.polygon.map(Q=>o.getTileVec3(c.tileTransform,Q,M)),B=F.map(Q=>new o.pointGeometry(Q[0],Q[1])),U=d.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),X=o.getTileVec3(c.tileTransform,U,M),Y=F.map(Q=>{const H=o.sub(Q,Q,X);return o.normalize(H,H),new o.Ray(X,H)}),K=Bn(c,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:Y,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(J=o.getBounds(k),J.min.x=o.clamp(J.min.x,0,o.EXTENT),J.min.y=o.clamp(J.min.y,0,o.EXTENT),J.max.x=o.clamp(J.max.x,0,o.EXTENT),J.max.y=o.clamp(J.max.y,0,o.EXTENT),J),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:K};var J}_bufferedScreenMercator(c,d){const y=Wr(c);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let b;return b=d.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(c),d):{polygon:this.bufferedScreenGeometry(c).map(E=>d.pointCoordinate3D(E)),unwrapped:!0},this._screenRaycastCache[y]=b,b}}_bufferedCameraMercator(c,d){const y=Wr(c);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let b;return b=d.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),d):{polygon:this.bufferedCameraGeometry(c).map(E=>d.pointCoordinate3D(E)),unwrapped:!0},this._cameraRaycastCache[y]=b,b}}_projectAndResample(c,d){const y=function(E,C){const M=o.multiply([],C.pixelMatrix,C.globeMatrix),k=[0,-o.GLOBE_RADIUS,0,1],F=[0,o.GLOBE_RADIUS,0,1],B=[0,0,0,1];o.transformMat4$1(k,k,M),o.transformMat4$1(F,F,M),o.transformMat4$1(B,B,M);const U=new o.pointGeometry(k[0]/k[3],k[1]/k[3]),X=new o.pointGeometry(F[0]/F[3],F[1]/F[3]),Y=o.polygonContainsPoint(E,U)&&k[3]<B[3],K=o.polygonContainsPoint(E,X)&&F[3]<B[3];if(!Y&&!K)return null;const J=function(Ee,Re,ze){for(let je=1;je<Ee.length;je++){const gt=gr(Re.pointCoordinate3D(Ee[je-1]).x),Le=gr(Re.pointCoordinate3D(Ee[je]).x);if(ze<0){if(gt<Le)return{idx:je,t:-gt/(Le-1-gt)}}else if(Le<gt)return{idx:je,t:(1-gt)/(Le+1-gt)}}return null}(E,C,Y?-1:1);if(!J)return null;const{idx:Q,t:H}=J;let le=Q>1?Dr(E.slice(0,Q),C):[],ae=Q<E.length?Dr(E.slice(Q),C):[];le=le.map(Ee=>new o.pointGeometry(gr(Ee.x),Ee.y)),ae=ae.map(Ee=>new o.pointGeometry(gr(Ee.x),Ee.y));const ce=[...le];ce.length===0&&ce.push(ae[ae.length-1]);const ve=o.number(ce[ce.length-1].y,(ae.length===0?le[0]:ae[0]).y,H);let _e;return _e=Y?[new o.pointGeometry(0,ve),new o.pointGeometry(0,0),new o.pointGeometry(1,0),new o.pointGeometry(1,ve)]:[new o.pointGeometry(1,ve),new o.pointGeometry(1,1),new o.pointGeometry(0,1),new o.pointGeometry(0,ve)],ce.push(..._e),ae.length===0?ce.push(le[0]):ce.push(...ae),{polygon:ce.map(Ee=>new o.MercatorCoordinate(Ee.x,Ee.y)),unwrapped:!1}}(c,d);if(y)return y;const b=function(E,C){let M=!1,k=-1/0,F=0;for(let U=0;U<E.length-1;U++)E[U].x>k&&(k=E[U].x,F=U);for(let U=0;U<E.length-1;U++){const X=(F+U)%(E.length-1),Y=E[X],K=E[X+1];Math.abs(Y.x-K.x)>.5&&(Y.x<K.x?(Y.x+=1,X===0&&(E[E.length-1].x+=1)):(K.x+=1,X+1===E.length-1&&(E[0].x+=1)),M=!0)}const B=o.mercatorXfromLng(C.center.lng);return M&&B<Math.abs(B-1)&&E.forEach(U=>{U.x-=1}),{polygon:E,unwrapped:M}}(Dr(c,d).map(E=>new o.pointGeometry(gr(E.x),E.y)),d);return{polygon:b.polygon.map(E=>new o.MercatorCoordinate(E.x,E.y)),unwrapped:b.unwrapped}}}function Dr(g,c){return o.resample(g,d=>{const y=c.pointCoordinate3D(d);d.x=y.x,d.y=y.y},1/256)}function gr(g){return g<0?1+g%1:g%1}function Wr(g){return 100*g|0}function Or(g,c,d,y,b){const E=function(C,M){if(C)return b(C);if(M){g.url&&M.tiles&&g.tiles&&delete g.tiles;const k=o.pick(o.extend(M,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(k.vectorLayers=M.vector_layers,k.vectorLayerIds=k.vectorLayers.map(F=>F.id)),k.tiles=c.canonicalizeTileset(k,g.url),b(null,k)}};return g.url?o.getJSON(c.transformRequest(c.normalizeSourceURL(g.url,null,d,y),o.ResourceType.Source),E):o.exported.frame(()=>E(null,g))}class _r{constructor(c,d,y){this.bounds=o.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=d||0,this.maxzoom=y||24}validateBounds(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const d=Math.pow(2,c.z),y=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*d),b=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*d),E=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*d),C=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*d);return c.x>=y&&c.x<E&&c.y>=b&&c.y<C}}class Te{constructor(c,d,y){this.context=c;const b=c.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Se={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ke{constructor(c,d,y,b){this.length=d.length,this.attributes=y,this.itemSize=d.bytesPerElement,this.dynamicDraw=b,this.context=c;const E=c.gl;this.buffer=E.createBuffer(),c.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,d){for(let y=0;y<this.attributes.length;y++){const b=d.attributes[this.attributes[y].name];b!==void 0&&c.enableVertexAttribArray(b)}}setVertexAttribPointers(c,d,y){for(let b=0;b<this.attributes.length;b++){const E=this.attributes[b],C=d.attributes[E.name];C!==void 0&&c.vertexAttribPointer(C,E.components,c[Se[E.type]],!1,this.itemSize,E.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class tt{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pt extends tt{getDefault(){return o.Color.transparent}set(c){const d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class yt extends tt{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class kt extends tt{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class At extends tt{getDefault(){return[!0,!0,!0,!0]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class It extends tt{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class vt extends tt{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class Qt extends tt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class Pt extends tt{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class Ht extends tt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}}class ii extends tt{getDefault(){return[0,1]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class pi extends tt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}}class ki extends tt{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class xi extends tt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}}class Cn extends tt{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class vn extends tt{getDefault(){return o.Color.transparent}set(c){const d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class qn extends tt{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class cn extends tt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}}class is extends tt{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class ns extends tt{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}class bn extends tt{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}}class ir extends tt{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class Os extends tt{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Ia extends tt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class qo extends tt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Cl extends tt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class Go extends tt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class rs extends tt{getDefault(){return null}set(c){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class Zo extends tt{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class Jc extends tt{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class Qc extends tt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class Ca extends tt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Yo extends tt{constructor(c,d){super(c),this.context=c,this.parent=d}getDefault(){return null}}class Lr extends Yo{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class oo extends Yo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class eu extends oo{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ko{constructor(c,d,y,b){this.context=c,this.width=d,this.height=y;const E=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new Lr(c,E),b&&(this.depthAttachment=new oo(c,E))}destroy(){const c=this.context.gl,d=this.colorAttachment.get();if(d&&c.deleteTexture(d),this.depthAttachment){const y=this.depthAttachment.get();y&&c.deleteRenderbuffer(y)}c.deleteFramebuffer(this.framebuffer)}}class ne{constructor(c,d=!1){if(this.gl=c,this.isWebGL2=d,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),d){const y=c;this.extVertexArrayObject={createVertexArrayOES:y.createVertexArray.bind(c),deleteVertexArrayOES:y.deleteVertexArray.bind(c),bindVertexArrayOES:y.bindVertexArray.bind(c)}}this.clearColor=new pt(this),this.clearDepth=new yt(this),this.clearStencil=new kt(this),this.colorMask=new At(this),this.depthMask=new It(this),this.stencilMask=new vt(this),this.stencilFunc=new Qt(this),this.stencilOp=new Pt(this),this.stencilTest=new Ht(this),this.depthRange=new ii(this),this.depthTest=new pi(this),this.depthFunc=new ki(this),this.blend=new xi(this),this.blendFunc=new Cn(this),this.blendColor=new vn(this),this.blendEquation=new qn(this),this.cullFace=new cn(this),this.cullFaceSide=new is(this),this.frontFace=new ns(this),this.program=new bn(this),this.activeTexture=new ir(this),this.viewport=new Os(this),this.bindFramebuffer=new Ia(this),this.bindRenderbuffer=new qo(this),this.bindTexture=new Cl(this),this.bindVertexBuffer=new Go(this),this.bindElementBuffer=new rs(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Zo(this),this.pixelStoreUnpack=new Jc(this),this.pixelStoreUnpackPremultiplyAlpha=new Qc(this),this.pixelStoreUnpackFlipY=new Ca(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),d||(this.extTextureHalfFloat=c.getExtension("OES_texture_half_float")),(d||this.extTextureHalfFloat&&c.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=d||c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,d){return new Te(this,c,d)}createVertexBuffer(c,d,y){return new Ke(this,c,d,y)}createRenderbuffer(c,d,y){const b=this.gl,E=b.createRenderbuffer();return this.bindRenderbuffer.set(E),b.renderbufferStorage(b.RENDERBUFFER,c,d,y),this.bindRenderbuffer.set(null),E}createFramebuffer(c,d,y){return new Ko(this,c,d,y)}clear({color:c,depth:d,stencil:y}){const b=this.gl;let E=0;c&&(E|=b.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(E|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),y!==void 0&&(E|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),b.clear(E)}setCullFace(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){v(c.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class V extends o.Evented{constructor(c,d,y,b){if(super(),this.id=c,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(d,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(c){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map._worldview;this._tileJSONRequest=Or(this._options,this.map._requestManager,d,y,(b,E)=>{this._tileJSONRequest=null,this._loaded=!0,b?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),y&&y.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new o.ErrorEvent(b))):E&&(o.extend(this,E),E.bounds&&(this.tileBounds=new _r(E.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(E.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(b)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(c,d){const y=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(y,o.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(b.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",b,E.bind(this));else if(c.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",b,E.bind(this),void 0,!0);else{const C=o.loadVectorTile.call({deduped:this._deduped},b,(M,k)=>{M||!k?E.call(this,M):(b.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},c.actor&&c.actor.send("loadTile",b,E.bind(this),void 0,!0))},!0);c.request={cancel:C}}function E(C,M){return delete c.request,c.aborted?d(null):C&&C.status!==404?d(C):(M&&M.resourceTiming&&(c.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&c.setExpiryData(M),c.loadVectorData(M,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class W extends o.Evented{constructor(c,d,y,b){super(),this.id=c,this.dispatcher=y,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},d),o.extend(this,o.pick(d,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Or(this._options,this.map._requestManager,null,null,(d,y)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new o.ErrorEvent(d)):y&&(o.extend(this,y),y.bounds&&(this.tileBounds=new _r(y.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(y.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(d)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,d){const y=o.exported.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);c.request=o.getImage(this.map._requestManager.transformRequest(b,o.ResourceType.Tile),(E,C,M,k)=>(delete c.request,c.aborted?(c.state="unloaded",d(null)):E?(c.state="errored",d(E)):C?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:M,expires:k}),c.setTexture(C,this.map.painter),c.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void d(null)):d(null)))}static loadTileData(c,d,y){c.setTexture(d,y)}static unloadTileData(c,d){c.texture&&d.saveTileTexture(c.texture)}abortTile(c,d){c.request&&(c.request.cancel(),delete c.request),d()}unloadTile(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let te;function fe(g,c,d,y,b,E,C,M){const k=[g,d,b,c,y,E,1,1,1],F=[C,M,1],B=o.adjoint([],k),[U,X,Y]=o.transformMat3(F,F,o.transpose(B,B));return o.multiply$1(k,[U,0,0,0,X,0,0,0,Y],k)}class we extends o.Evented{constructor(c,d,y,b){super(),this.id=c,this.dispatcher=y,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=d,this._dirty=!1}load(c,d){this._loaded=d||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(y,b)=>{if(this._imageRequest=null,this._loaded=!0,y)this.fire(new o.ErrorEvent(y));else if(b){const{HTMLImageElement:E}=o.window;this.image=b instanceof E?o.exported.getImageData(b):b,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const d=c.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(y){let b=1/0,E=1/0,C=-1/0,M=-1/0;for(const U of y)b=Math.min(b,U.x),E=Math.min(E,U.y),C=Math.max(C,U.x),M=Math.max(M,U.y);const k=Math.max(C-b,M-E),F=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),B=Math.pow(2,F);return new o.CanonicalTileID(F,Math.floor((b+C)/2*B),Math.floor((E+M)/2*B))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const k in this.tiles){const F=this.tiles[k];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture)}if(this._boundsArray)return;const d=o.tileTransform(this.tileID,this.map.transform.projection),[y,b,E,C]=this.coordinates.map(k=>{const F=d.projection.project(k[0],k[1]);return o.getTilePoint(d,F)._round()});this.perspectiveTransform=function(k,F,B,U,X,Y,K,J,Q,H){const le=fe(0,0,k,0,0,F,k,F),ae=fe(B,U,X,Y,K,J,Q,H);return o.multiply$1(ae,o.adjoint(le,le),ae),[ae[6]/ae[8]*k/o.EXTENT,ae[7]/ae[8]*F/o.EXTENT]}(this.width,this.height,y.x,y.y,b.x,b.y,C.x,C.y,E.x,E.y);const M=this._boundsArray=new o.StructArrayLayout4i8;M.emplaceBack(y.x,y.y,0,0),M.emplaceBack(b.x,b.y,o.EXTENT,0),M.emplaceBack(C.x,C.y,0,o.EXTENT),M.emplaceBack(E.x,E.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(M,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const c=this.map.painter.context,d=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Oe={vector:V,raster:W,"raster-dem":class extends W{constructor(g,c,d,y){super(g,c,d,y),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(g,c){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(b,E){b&&(g.state="errored",c(b)),E&&(g.dem=E,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",c(null))}g.request=o.getImage(this.map._requestManager.transformRequest(d,o.ResourceType.Tile),(function(b,E,C,M){if(delete g.request,g.aborted)g.state="unloaded",c(null);else if(b)g.state="errored",c(b);else if(E){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:C,expires:M});const k=o.window.ImageBitmap&&E instanceof o.window.ImageBitmap&&(te==null&&(te=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),te),F=1-(E.width-o.prevPowerOfTwo(E.width))/2;F<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const B=k?E:o.exported.getImageData(E,F),U={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:B,encoding:this.encoding,padding:F};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",U,y.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const c=g.canonical,d=Math.pow(2,c.z),y=(c.x-1+d)%d,b=c.x===0?g.wrap-1:g.wrap,E=(c.x+1+d)%d,C=c.x+1===d?g.wrap+1:g.wrap,M={};return M[new o.OverscaledTileID(g.overscaledZ,b,c.z,y,c.y).key]={backfilled:!1},M[new o.OverscaledTileID(g.overscaledZ,C,c.z,E,c.y).key]={backfilled:!1},c.y>0&&(M[new o.OverscaledTileID(g.overscaledZ,b,c.z,y,c.y-1).key]={backfilled:!1},M[new o.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},M[new o.OverscaledTileID(g.overscaledZ,C,c.z,E,c.y-1).key]={backfilled:!1}),c.y+1<d&&(M[new o.OverscaledTileID(g.overscaledZ,b,c.z,y,c.y+1).key]={backfilled:!1},M[new o.OverscaledTileID(g.overscaledZ,g.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},M[new o.OverscaledTileID(g.overscaledZ,C,c.z,E,c.y+1).key]={backfilled:!1}),M}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded"}},geojson:class extends o.Evented{constructor(g,c,d,y){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(y),this._data=c.data,this._options=o.extend({},c),this._collectResourceTiming=c.collectResourceTiming,c.maxzoom!==void 0&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const b=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(c.buffer!==void 0?c.buffer:128)*b,tolerance:(c.tolerance!==void 0?c.tolerance:.375)*b,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:c.clusterMaxZoom!==void 0?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:o.EXTENT,radius:(c.clusterRadius!==void 0?c.clusterRadius:50)*b,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},c),this}getClusterChildren(g,c){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},c),this}getClusterLeaves(g,c,d,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:c,offset:d},y),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const g=o.extend({},this.workerOptions),c=this._data;typeof c=="string"?(g.request=this.map._requestManager.transformRequest(o.exported.resolveURL(c),o.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(d,y)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new o.ErrorEvent(d));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(b.resourceTiming=y.resourceTiming[this.id]),this.fire(new o.Event("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,c){const d=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(d,{type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(y,b)=>(delete g.request,g.unloadVectorData(),g.aborted?c(null):y?c(y):(g.loadVectorData(b,this.map.painter,d==="reloadTile"),c(null))),void 0,d==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends we{constructor(g,c,d,y){super(g,c,d,y),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const c of g.urls)this.urls.push(this.map._requestManager.transformRequest(c,o.ResourceType.Source).url);o.getVideo(this.urls,(c,d)=>{this._loaded=!0,c?this.fire(new o.ErrorEvent(c)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const c=this.video.seekable;g<c.start(0)||g>c.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,c=g.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(g,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:we,canvas:class extends we{constructor(g,c,d,y){super(g,c,d,y),c.coordinates?Array.isArray(c.coordinates)&&c.coordinates.length===4&&!c.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(E=>typeof E!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),c.animate&&typeof c.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),c.canvas?typeof c.canvas=="string"||c.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=c,this.animate=c.animate===void 0||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const c=this.map.painter.context;this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends o.Evented{constructor(g,c,d,y){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=c,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new _r(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:c,y:d,z:y}=g.canonical;return this._implementation.hasTile({x:c,y:d,z:y})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,c){const{x:d,y,z:b}=g.tileID.canonical,E=new o.window.AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:d,y,z:b},{signal:E.signal})).then((function(C){return delete g.request,g.aborted?(g.state="unloaded",c(null)):C===void 0?(g.state="errored",c(null)):C===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",c(null)):function(M){return M instanceof o.window.ImageData||M instanceof o.window.HTMLCanvasElement||M instanceof o.window.ImageBitmap||M instanceof o.window.HTMLImageElement}(C)?(this.loadTileData(g,C),g.state="loaded",void c(null)):(g.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(C=>{C.code!==20&&(g.state="errored",c(C))}),g.request.cancel=()=>E.abort()}loadTileData(g,c){W.loadTileData(g,c,this._map.painter)}unloadTileData(g){W.unloadTileData(g,this._map.painter)}unloadTile(g,c){if(this.unloadTileData(g),this._implementation.unloadTile){const{x:d,y,z:b}=g.tileID.canonical;this._implementation.unloadTile({x:d,y,z:b})}c()}abortTile(g,c){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ke=function(g,c,d,y){const b=new Oe[c.type](g,c,d,y);if(b.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${b.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],b),b};function Ae(g,c){const d=o.identity([]);return o.scale(d,d,[.5*g.width,.5*-g.height,1]),o.translate(d,d,[1,-1,0]),o.multiply(d,d,g.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(d)}function Fe(g,c,d,y,b,E,C,M=!1){const k=g.tilesIn(y,C,M);k.sort(Ct);const F=[];for(const U of k)F.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(c,d,g._state,U,b,E,Ae(g.transform,U.tile.tileID),M)});const B=function(U){const X={},Y={};for(const K of U){const J=K.queryResults,Q=K.wrappedTileID,H=Y[Q]=Y[Q]||{};for(const le in J){const ae=J[le],ce=H[le]=H[le]||{},ve=X[le]=X[le]||[];for(const _e of ae)ce[_e.featureIndex]||(ce[_e.featureIndex]=!0,ve.push(_e))}}return X}(F);for(const U in B)B[U].forEach(X=>{const Y=X.feature,K=Y.layer;K&&K.type!=="background"&&K.type!=="sky"&&(Y.source=K.source,K["source-layer"]&&(Y.sourceLayer=K["source-layer"]),Y.state=Y.id!==void 0?g.getFeatureState(K["source-layer"],Y.id):{})});return B}function nt(g,c){const d=g.getRenderableIds().map(E=>g.getTileByID(E)),y=[],b={};for(let E=0;E<d.length;E++){const C=d[E],M=C.tileID.canonical.key;b[M]||(b[M]=!0,C.querySourceFeatures(y,c))}return y}function Ct(g,c){const d=g.tileID,y=c.tileID;return d.overscaledZ-y.overscaledZ||d.canonical.y-y.canonical.y||d.wrap-y.wrap||d.canonical.x-y.canonical.x}function ht(){return rc.workerClass!=null?new rc.workerClass:new o.window.Worker(rc.workerUrl)}const Xt="mapboxgl_preloaded_worker_pool";class $t{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<$t.workerCount;)this.workers.push(new ht);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Xt]}numActive(){return Object.keys(this.active).length}}let jt;function Kt(){return jt||(jt=new $t),jt}function oi(g,c){const d={};for(const y in g)y!=="ref"&&(d[y]=g[y]);return o.refProperties.forEach(y=>{y in c&&(d[y]=c[y])}),d}function Ii(g){g=g.slice();const c=Object.create(null);for(let d=0;d<g.length;d++)c[g[d].id]=g[d];for(let d=0;d<g.length;d++)"ref"in g[d]&&(g[d]=oi(g[d],c[g[d].ref]));return g}$t.workerCount=2;const Gt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Fi(g,c,d){d.push({command:Gt.addSource,args:[g,c[g]]})}function Ni(g,c,d){c.push({command:Gt.removeSource,args:[g]}),d[g]=!0}function ao(g,c,d,y){Ni(g,d,y),Fi(g,c,d)}function Ls(g,c,d){let y;for(y in g[d])if(g[d].hasOwnProperty(y)&&y!=="data"&&!v(g[d][y],c[d][y]))return!1;for(y in c[d])if(c[d].hasOwnProperty(y)&&y!=="data"&&!v(g[d][y],c[d][y]))return!1;return!0}function Ze(g,c,d,y,b,E){let C;for(C in c=c||{},g=g||{})g.hasOwnProperty(C)&&(v(g[C],c[C])||d.push({command:E,args:[y,C,c[C],b]}));for(C in c)c.hasOwnProperty(C)&&!g.hasOwnProperty(C)&&(v(g[C],c[C])||d.push({command:E,args:[y,C,c[C],b]}))}function Bs(g){return g.id}function wn(g,c){return g[c.id]=c,g}class lo{constructor(c,d){this.reset(c,d)}reset(c,d){this.points=c||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(this.points.length===1)return this.points[0];c=o.clamp(c,0,1);let d=1,y=this._distances[d];const b=c*this.paddedLength+this.padding;for(;y<b&&d<this._distances.length;)y=this._distances[++d];const E=d-1,C=this._distances[E],M=y-C,k=M>0?(b-C)/M:0;return this.points[E].mult(1-k).add(this.points[d].mult(k))}}class Rp{constructor(c,d,y){const b=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(c/y),this.yCellCount=Math.ceil(d/y);for(let C=0;C<this.xCellCount*this.yCellCount;C++)b.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=d,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,d,y,b,E){this._forEachCell(d,y,b,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(b),this.bboxes.push(E)}insertCircle(c,d,y,b){this._forEachCell(d-b,y-b,d+b,y+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(d),this.circles.push(y),this.circles.push(b)}_insertBoxCell(c,d,y,b,E,C){this.boxCells[E].push(C)}_insertCircleCell(c,d,y,b,E,C){this.circleCells[E].push(C)}_query(c,d,y,b,E,C){if(y<0||c>this.width||b<0||d>this.height)return!E&&[];const M=[];if(c<=0&&d<=0&&this.width<=y&&this.height<=b){if(E)return!0;for(let k=0;k<this.boxKeys.length;k++)M.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const F=this.circles[3*k],B=this.circles[3*k+1],U=this.circles[3*k+2];M.push({key:this.circleKeys[k],x1:F-U,y1:B-U,x2:F+U,y2:B+U})}return C?M.filter(C):M}return this._forEachCell(c,d,y,b,this._queryCell,M,{hitTest:E,seenUids:{box:{},circle:{}}},C),E?M.length>0:M}_queryCircle(c,d,y,b,E){const C=c-y,M=c+y,k=d-y,F=d+y;if(M<0||C>this.width||F<0||k>this.height)return!b&&[];const B=[];return this._forEachCell(C,k,M,F,this._queryCellCircle,B,{hitTest:b,circle:{x:c,y:d,radius:y},seenUids:{box:{},circle:{}}},E),b?B.length>0:B}query(c,d,y,b,E){return this._query(c,d,y,b,!1,E)}hitTest(c,d,y,b,E){return this._query(c,d,y,b,!0,E)}hitTestCircle(c,d,y,b){return this._queryCircle(c,d,y,!0,b)}_queryCell(c,d,y,b,E,C,M,k){const F=M.seenUids,B=this.boxCells[E];if(B!==null){const X=this.bboxes;for(const Y of B)if(!F.box[Y]){F.box[Y]=!0;const K=4*Y;if(c<=X[K+2]&&d<=X[K+3]&&y>=X[K+0]&&b>=X[K+1]&&(!k||k(this.boxKeys[Y]))){if(M.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[Y],x1:X[K],y1:X[K+1],x2:X[K+2],y2:X[K+3]})}}}const U=this.circleCells[E];if(U!==null){const X=this.circles;for(const Y of U)if(!F.circle[Y]){F.circle[Y]=!0;const K=3*Y;if(this._circleAndRectCollide(X[K],X[K+1],X[K+2],c,d,y,b)&&(!k||k(this.circleKeys[Y]))){if(M.hitTest)return C.push(!0),!0;{const J=X[K],Q=X[K+1],H=X[K+2];C.push({key:this.circleKeys[Y],x1:J-H,y1:Q-H,x2:J+H,y2:Q+H})}}}}}_queryCellCircle(c,d,y,b,E,C,M,k){const F=M.circle,B=M.seenUids,U=this.boxCells[E];if(U!==null){const Y=this.bboxes;for(const K of U)if(!B.box[K]){B.box[K]=!0;const J=4*K;if(this._circleAndRectCollide(F.x,F.y,F.radius,Y[J+0],Y[J+1],Y[J+2],Y[J+3])&&(!k||k(this.boxKeys[K])))return C.push(!0),!0}}const X=this.circleCells[E];if(X!==null){const Y=this.circles;for(const K of X)if(!B.circle[K]){B.circle[K]=!0;const J=3*K;if(this._circlesCollide(Y[J],Y[J+1],Y[J+2],F.x,F.y,F.radius)&&(!k||k(this.circleKeys[K])))return C.push(!0),!0}}}_forEachCell(c,d,y,b,E,C,M,k){const F=this._convertToXCellCoord(c),B=this._convertToYCellCoord(d),U=this._convertToXCellCoord(y),X=this._convertToYCellCoord(b);for(let Y=F;Y<=U;Y++)for(let K=B;K<=X;K++)if(E.call(this,c,d,y,b,this.xCellCount*K+Y,C,M,k))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,d,y,b,E,C){const M=b-c,k=E-d,F=y+C;return F*F>M*M+k*k}_circleAndRectCollide(c,d,y,b,E,C,M){const k=(C-b)/2,F=Math.abs(c-(b+k));if(F>k+y)return!1;const B=(M-E)/2,U=Math.abs(d-(E+B));if(U>B+y)return!1;if(F<=k||U<=B)return!0;const X=F-k,Y=U-B;return X*X+Y*Y<=y*y}}const xs=Math.tan(85*Math.PI/180);function Ma(g,c,d,y,b,E,C){const M=o.create();if(d)if(E.name==="globe"){const k=o.calculateGlobeLabelMatrix(b,c);o.multiply(M,M,k)}else{const k=rt([],C);M[0]=k[0],M[1]=k[1],M[4]=k[2],M[5]=k[3],y||o.rotateZ(M,M,b.angle)}else o.multiply(M,b.labelPlaneMatrix,g);return M}function Pp(g,c,d,y,b,E,C){const M=Ma(g,c,d,y,b,E,C);return E.name==="globe"&&d||(M[2]=M[6]=M[10]=M[14]=0),M}function Ra(g,c,d,y,b,E,C){if(d){if(E.name==="globe"){const M=Ma(g,c,d,y,b,E,C);return o.invert(M,M),o.multiply(M,g,M),M}{const M=o.clone(g),k=o.identity([]);return k[0]=C[0],k[1]=C[1],k[4]=C[2],k[5]=C[3],o.multiply(M,M,k),y||o.rotateZ(M,M,-b.angle),M}}return b.glCoordMatrix}function bt(g,c,d,y){const b=[g,c,d,1];d?o.transformMat4$1(b,b,y):kp(b,b,y);const E=b[3];return b[0]/=E,b[1]/=E,b[2]/=E,b}function mi(g,c){return Math.min(.5+g/c*.5,1.5)}function ui(g,c){const d=g[0]/g[3],y=g[1]/g[3];return d>=-c[0]&&d<=c[0]&&y>=-c[1]&&y<=c[1]}function vs(g,c,d,y,b,E,C,M,k,F){const B=d.transform,U=y?g.textSizeData:g.iconSizeData,X=o.evaluateSizeForZoom(U,d.transform.zoom),Y=B.projection.name==="globe",K=[256/d.width*2+1,256/d.height*2+1],J=y?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;J.clear();let Q=null;Y&&(Q=y?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const H=g.lineVertexArray,le=y?g.text.placedSymbolArray:g.icon.placedSymbolArray,ae=d.transform.width/d.transform.height;let ce,ve=!1;for(let _e=0;_e<le.length;_e++){const Ee=le.get(_e),{numGlyphs:Re,writingMode:ze}=Ee;if(ze!==o.WritingMode.vertical||ve||ce===o.WritingMode.horizontal||(ve=!0),ce=ze,(Ee.hidden||ze===o.WritingMode.vertical)&&!ve){$i(Re,J);continue}ve=!1;const je=new o.pointGeometry(Ee.tileAnchorX,Ee.tileAnchorY);let{x:gt,y:Le,z:Qe}=B.projection.projectTilePoint(je.x,je.y,F.canonical);if(k){const[si,Lt,Rt]=k(je);gt+=si,Le+=Lt,Qe+=Rt}const qe=[gt,Le,Qe,1];if(o.transformMat4$1(qe,qe,c),!ui(qe,K)){$i(Re,J);continue}const st=mi(d.transform.cameraToCenterDistance,qe[3]),Ue=o.evaluateSizeForFeature(U,X,Ee),Ce=C?Ue/st:Ue*st,$e=bt(gt,Le,Qe,b);if($e[3]<=0){$i(Re,J);continue}let it={};const ct=C?null:k,Nt=Ml(Ee,Ce,!1,M,c,b,E,g.glyphOffsetArray,H,J,Q,$e,je,it,ae,ct,B.projection,F,C);ve=Nt.useVertical,ct&&Nt.needsFlipping&&(it={}),(Nt.notEnoughRoom||ve||Nt.needsFlipping&&Ml(Ee,Ce,!0,M,c,b,E,g.glyphOffsetArray,H,J,Q,$e,je,it,ae,ct,B.projection,F,C).notEnoughRoom)&&$i(Re,J)}y?(g.text.dynamicLayoutVertexBuffer.updateData(J),Q&&g.text.globeExtVertexBuffer.updateData(Q)):(g.icon.dynamicLayoutVertexBuffer.updateData(J),Q&&g.icon.globeExtVertexBuffer.updateData(Q))}function Jo(g,c,d,y,b,E,C,M,k,F,B,U,X,Y,K,J){const{lineStartIndex:Q,glyphStartIndex:H,segment:le}=M,ae=H+M.numGlyphs,ce=Q+M.lineLength,ve=c.getoffsetX(H),_e=c.getoffsetX(ae-1),Ee=hr(g*ve,d,y,b,E,C,le,Q,ce,k,F,B,U,X,!0,Y,K,J);if(!Ee)return null;const Re=hr(g*_e,d,y,b,E,C,le,Q,ce,k,F,B,U,X,!0,Y,K,J);return Re?{first:Ee,last:Re}:null}function li(g,c,d,y){return g===o.WritingMode.horizontal&&Math.abs(y)>Math.abs(d)?{useVertical:!0}:g===o.WritingMode.vertical?y>0?{needsFlipping:!0}:null:c!==0&&function(b,E){return b===0||Math.abs(E/b)>xs}(d,y)?c===1?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null}function Ml(g,c,d,y,b,E,C,M,k,F,B,U,X,Y,K,J,Q,H,le){const ae=c/24,ce=g.lineOffsetX*ae,ve=g.lineOffsetY*ae,{lineStartIndex:_e,glyphStartIndex:Ee,numGlyphs:Re,segment:ze,writingMode:je,flipState:gt}=g,Le=_e+g.lineLength,Qe=qe=>{if(B){const[$e,it,ct]=qe.up,Nt=F.length;o.updateGlobeVertexNormal(B,Nt+0,$e,it,ct),o.updateGlobeVertexNormal(B,Nt+1,$e,it,ct),o.updateGlobeVertexNormal(B,Nt+2,$e,it,ct),o.updateGlobeVertexNormal(B,Nt+3,$e,it,ct)}const[st,Ue,Ce]=qe.point;o.addDynamicAttributes(F,st,Ue,Ce,qe.angle)};if(Re>1){const qe=Jo(ae,M,ce,ve,d,U,X,g,k,E,Y,J,!1,Q,H,le);if(!qe)return{notEnoughRoom:!0};if(y&&!d){let[st,Ue,Ce]=qe.first.point,[$e,it,ct]=qe.last.point;[st,Ue]=bt(st,Ue,Ce,C),[$e,it]=bt($e,it,ct,C);const Nt=li(je,gt,($e-st)*K,it-Ue);if(g.flipState=Nt&&Nt.needsFlipping?1:2,Nt)return Nt}Qe(qe.first);for(let st=Ee+1;st<Ee+Re-1;st++){const Ue=hr(ae*M.getoffsetX(st),ce,ve,d,U,X,ze,_e,Le,k,E,Y,J,!1,!1,Q,H,le);if(!Ue)return F.length-=4*(st-Ee),{notEnoughRoom:!0};Qe(Ue)}Qe(qe.last)}else{if(y&&!d){const st=bt(X.x,X.y,0,b),Ue=_e+ze+1,Ce=new o.pointGeometry(k.getx(Ue),k.gety(Ue)),$e=bt(Ce.x,Ce.y,0,b),it=$e[3]>0?$e:ka(X,Ce,st,1,b,void 0,Q,H.canonical),ct=li(je,gt,(it[0]-st[0])*K,it[1]-st[1]);if(g.flipState=ct&&ct.needsFlipping?1:2,ct)return ct}const qe=hr(ae*M.getoffsetX(Ee),ce,ve,d,U,X,ze,_e,Le,k,E,Y,J,!1,!1,Q,H,le);if(!qe)return{notEnoughRoom:!0};Qe(qe)}return{}}function Pa(g,c,d,y,b){const{x:E,y:C,z:M}=y.projectTilePoint(g.x,g.y,c);if(!b)return bt(E,C,M,d);const[k,F,B]=b(g);return bt(E+k,C+F,M+B,d)}function ka(g,c,d,y,b,E,C,M){const k=Pa(g.sub(c)._unit()._add(g),M,b,C,E);return o.sub(k,d,k),o.normalize(k,k),o.scaleAndAdd(k,d,k,y)}function hr(g,c,d,y,b,E,C,M,k,F,B,U,X,Y,K,J,Q,H){const le=y?g-c:g+c;let ae=le>0?1:-1,ce=0;y&&(ae*=-1,ce=Math.PI),ae<0&&(ce+=Math.PI);let ve=M+C+(ae>0?0:1)|0,_e=b,Ee=b,Re=0,ze=0;const je=Math.abs(le),gt=[],Le=[];let Qe=E,qe=Qe;const st=()=>ka(qe,Qe,Ee,je-Re+1,B,X,J,Q.canonical);for(;Re+ze<=je;){if(ve+=ae,ve<M||ve>=k)return null;if(Ee=_e,qe=Qe,gt.push(Ee),Y&&Le.push(qe),Qe=new o.pointGeometry(F.getx(ve),F.gety(ve)),_e=U[ve],!_e){const Rt=Pa(Qe,Q.canonical,B,J,X);_e=Rt[3]>0?U[ve]=Rt:st()}Re+=ze,ze=o.distance(Ee,_e)}K&&X&&(U[ve]&&(_e=st(),ze=o.distance(Ee,_e)),U[ve]=_e);const Ue=(je-Re)/ze,Ce=Qe.sub(qe)._mult(Ue)._add(qe),$e=o.sub([],_e,Ee),it=o.scaleAndAdd([],Ee,$e,Ue);let ct=[0,0,1],Nt=$e[0],si=$e[1];if(H&&(ct=J.upVector(Q.canonical,Ce.x,Ce.y),ct[0]!==0||ct[1]!==0||ct[2]!==1)){const Rt=[ct[2],0,-ct[0]],zt=o.cross([],ct,Rt);o.normalize(Rt,Rt),o.normalize(zt,zt),Nt=o.dot($e,Rt),si=o.dot($e,zt)}if(d){const Rt=o.cross([],ct,$e);o.normalize(Rt,Rt),o.scaleAndAdd(it,it,Rt,d*ae)}const Lt=ce+Math.atan2(si,Nt);return gt.push(it),Y&&Le.push(Ce),{point:it,angle:Lt,path:gt,tilePath:Le,up:ct}}function $i(g,c){const d=c.length,y=d+4*g;c.resize(y),c.float32.fill(-1/0,4*d,4*y)}function kp(g,c,d){const y=c[0],b=c[1];return g[0]=d[0]*y+d[4]*b+d[12],g[1]=d[1]*y+d[5]*b+d[13],g[3]=d[3]*y+d[7]*b+d[15],g}const yr=100;class Zh{constructor(c,d,y=new Rp(c.width+200,c.height+200,25),b=new Rp(c.width+200,c.height+200,25)){this.transform=c,this.grid=y,this.ignoredGrid=b,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+yr,this.screenBottomBoundary=c.height+yr,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=d}placeCollisionBox(c,d,y,b,E,C,M,k){let F=y.projectedAnchorX,B=y.projectedAnchorY,U=y.projectedAnchorZ;const X=y.elevation,Y=y.tileID,K=c.getProjection();if(X&&Y){const[_e,Ee,Re]=K.upVector(Y.canonical,y.tileAnchorX,y.tileAnchorY),ze=K.upVectorScale(Y.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=_e*X*ze,B+=Ee*X*ze,U+=Re*X*ze}const J=this.projectAndGetPerspectiveRatio(M,F,B,U,y.tileID,K.name==="globe"||!!X||this.transform.pitch>0,K),Q=C*J.perspectiveRatio,H=(y.x1*d+b.x-y.padding)*Q+J.point.x,le=(y.y1*d+b.y-y.padding)*Q+J.point.y,ae=(y.x2*d+b.x+y.padding)*Q+J.point.x,ce=(y.y2*d+b.y+y.padding)*Q+J.point.y,ve=J.perspectiveRatio<=.55||J.occluded;return!this.isInsideGrid(H,le,ae,ce)||!E&&this.grid.hitTest(H,le,ae,ce,k)||ve?{box:[],offscreen:!1,occluded:J.occluded}:{box:[H,le,ae,ce],offscreen:this.isOffscreen(H,le,ae,ce),occluded:!1}}placeCollisionCircles(c,d,y,b,E,C,M,k,F,B,U,X,Y,K,J){const Q=[],H=this.transform.elevation,le=c.getProjection(),ae=H?H.getAtTileOffsetFunc(J,this.transform.center.lat,this.transform.worldSize,le):null,ce=new o.pointGeometry(y.tileAnchorX,y.tileAnchorY);let{x:ve,y:_e,z:Ee}=le.projectTilePoint(ce.x,ce.y,J.canonical);if(ae){const[Ce,$e,it]=ae(ce);ve+=Ce,_e+=$e,Ee+=it}const Re=le.name==="globe",ze=this.projectAndGetPerspectiveRatio(M,ve,_e,Ee,J,Re||!!H||this.transform.pitch>0,le),{perspectiveRatio:je}=ze,gt=(U?C/je:C*je)/o.ONE_EM,Le=bt(ve,_e,Ee,k),Qe=ze.signedDistanceFromCamera>0?Jo(gt,E,y.lineOffsetX*gt,y.lineOffsetY*gt,!1,Le,ce,y,b,k,{},H&&!U?ae:null,U&&!!H,le,J,U):null;let qe=!1,st=!1,Ue=!0;if(Qe&&!ze.occluded){const Ce=.5*Y*je+K,$e=new o.pointGeometry(-100,-100),it=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),ct=new lo,{first:Nt,last:si}=Qe,Lt=Nt.path.length;let Rt=[];for(let Wt=Lt-1;Wt>=1;Wt--)Rt.push(Nt.path[Wt]);for(let Wt=1;Wt<si.path.length;Wt++)Rt.push(si.path[Wt]);const zt=2.5*Ce;F&&(Rt=Rt.map(([Wt,Mi,Ri],Wi)=>(ae&&!Re&&(Ri=ae(Wi<Lt-1?Nt.tilePath[Lt-1-Wi]:si.tilePath[Wi-Lt+2])[2]),bt(Wt,Mi,Ri,F))),Rt.some(Wt=>Wt[3]<=0)&&(Rt=[]));let hi=[];if(Rt.length>0){let Wt=1/0,Mi=-1/0,Ri=1/0,Wi=-1/0;for(const Vi of Rt)Wt=Math.min(Wt,Vi[0]),Ri=Math.min(Ri,Vi[1]),Mi=Math.max(Mi,Vi[0]),Wi=Math.max(Wi,Vi[1]);Mi>=$e.x&&Wt<=it.x&&Wi>=$e.y&&Ri<=it.y&&(hi=[Rt.map(Vi=>new o.pointGeometry(Vi[0],Vi[1]))],(Wt<$e.x||Mi>it.x||Ri<$e.y||Wi>it.y)&&(hi=o.clipLine(hi,$e.x,$e.y,it.x,it.y)))}for(const Wt of hi){ct.reset(Wt,.25*Ce);let Mi=0;Mi=ct.length<=.5*Ce?1:Math.ceil(ct.paddedLength/zt)+1;for(let Ri=0;Ri<Mi;Ri++){const Wi=Ri/Math.max(Mi-1,1),Vi=ct.lerp(Wi),Tn=Vi.x+yr,br=Vi.y+yr;Q.push(Tn,br,Ce,0);const ss=Tn-Ce,Us=br-Ce,nn=Tn+Ce,ji=br+Ce;if(Ue=Ue&&this.isOffscreen(ss,Us,nn,ji),st=st||this.isInsideGrid(ss,Us,nn,ji),!d&&this.grid.hitTestCircle(Tn,br,Ce,X)&&(qe=!0,!B))return{circles:[],offscreen:!1,collisionDetected:qe,occluded:!1}}}}return{circles:!B&&qe||!st?[]:Q,offscreen:Ue,collisionDetected:qe,occluded:ze.occluded}}queryRenderedSymbols(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let y=1/0,b=1/0,E=-1/0,C=-1/0;for(const B of c){const U=new o.pointGeometry(B.x+yr,B.y+yr);y=Math.min(y,U.x),b=Math.min(b,U.y),E=Math.max(E,U.x),C=Math.max(C,U.y),d.push(U)}const M=this.grid.query(y,b,E,C).concat(this.ignoredGrid.query(y,b,E,C)),k={},F={};for(const B of M){const U=B.key;if(k[U.bucketInstanceId]===void 0&&(k[U.bucketInstanceId]={}),k[U.bucketInstanceId][U.featureIndex])continue;const X=[new o.pointGeometry(B.x1,B.y1),new o.pointGeometry(B.x2,B.y1),new o.pointGeometry(B.x2,B.y2),new o.pointGeometry(B.x1,B.y2)];o.polygonIntersectsPolygon(d,X)&&(k[U.bucketInstanceId][U.featureIndex]=!0,F[U.bucketInstanceId]===void 0&&(F[U.bucketInstanceId]=[]),F[U.bucketInstanceId].push(U.featureIndex))}return F}insertCollisionBox(c,d,y,b,E){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:b,collisionGroupID:E},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,d,y,b,E){const C=d?this.ignoredGrid:this.grid,M={bucketInstanceId:y,featureIndex:b,collisionGroupID:E};for(let k=0;k<c.length;k+=4)C.insertCircle(M,c[k],c[k+1],c[k+2])}projectAndGetPerspectiveRatio(c,d,y,b,E,C,M){const k=[d,y,b,1];let F=!1;if(b||this.transform.pitch>0){o.transformMat4$1(k,k,c);const U=M.name==="globe";this.fogState&&E&&!U&&(F=function(Y,K,J,Q,H,le){const ae=le.calculateFogTileMatrix(H),ce=[K,J,Q];return o.transformMat4(ce,ce,ae),wi(Y,ce,le.pitch,le._fov)}(this.fogState,d,y,b,E.toUnwrapped(),this.transform)>.9)}else kp(k,k,c);const B=k[3];return{point:new o.pointGeometry((k[0]/B+1)/2*this.transform.width+yr,(-k[1]/B+1)/2*this.transform.height+yr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/B*.5,1.5),signedDistanceFromCamera:B,occluded:C&&k[2]>B||F}}isOffscreen(c,d,y,b){return y<yr||c>=this.screenRightBoundary||b<yr||d>this.screenBottomBoundary}isInsideGrid(c,d,y,b){return y>=0&&c<this.gridRightBoundary&&b>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const c=o.identity([]);return o.translate(c,c,[-100,-100,0]),c}}function Qo(g,c,d){const y=c.createTileMatrix(g,g.worldSize,d.toUnwrapped());return o.multiply(new Float32Array(16),g.projMatrix,y)}function Yh(g,c,d){if(c.projection.name===d.projection.name)return g.projMatrix;const y=d.clone();return y.setProjection(c.projection),Qo(y,c.getProjection(),g)}function tu(g,c,d){return c.name===d.projection.name?g.projMatrix:Qo(d,c,g)}class Rl{constructor(c,d,y,b){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?d:-d))):b&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class ea{constructor(c,d,y,b,E,C=!1){this.text=new Rl(c?c.text:null,d,y,E),this.icon=new Rl(c?c.icon:null,d,b,E),this.clipped=C}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Da{constructor(c,d,y,b=!1){this.text=c,this.icon=d,this.skipFade=y,this.clipped=b}}class Kh{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class xr{constructor(c,d,y,b,E){this.bucketInstanceId=c,this.featureIndex=d,this.sourceLayerIndex=y,this.bucketIndex=b,this.tileID=E}}class mn{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const d=++this.maxGroupID;this.collisionGroups[c]={ID:d,predicate:y=>y.collisionGroupID===d}}return this.collisionGroups[c]}}function iu(g,c,d,y,b){const{horizontalAlign:E,verticalAlign:C}=o.getAnchorAlignment(g),M=-(E-.5)*c,k=-(C-.5)*d,F=o.evaluateVariableOffset(g,y);return new o.pointGeometry(M+F[0]*b,k+F[1]*b)}function Pl(g,c,d,y,b){const E=new o.pointGeometry(g,c);return d&&E._rotate(y?b:-b),E}class vr{constructor(c,d,y,b,E){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new Zh(this.transform,E),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new mn(y),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,d,y,b){const E=y.getBucket(d),C=y.latestFeatureIndex;if(!E||!C||d.id!==E.layerIds[0])return;const M=E.layers[0].layout,k=y.collisionBoxArray,F=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),B=y.tileSize/o.EXTENT,U=y.tileID.toUnwrapped();this.transform.setProjection(E.projection);const X=(Y=y.tileID,K=E.getProjection(),J=this.transform,K.name===this.projection?J.calculateProjMatrix(Y.toUnwrapped()):Qo(J,K,Y));var Y,K,J;const Q=M.get("text-pitch-alignment")==="map",H=M.get("text-rotation-alignment")==="map";d.compileFilter();const le=d.dynamicFilter(),ae=d.dynamicFilterNeedsFeature(),ce=this.transform.calculatePixelsToTileUnitsMatrix(y),ve=Pp(X,y.tileID.canonical,Q,H,this.transform,E.getProjection(),ce);let _e=null;if(Q){const ze=Ra(X,y.tileID.canonical,Q,H,this.transform,E.getProjection(),ce);_e=o.multiply([],this.transform.labelPlaneMatrix,ze)}let Ee=null;le&&y.latestFeatureIndex&&(Ee={unwrappedTileID:U,dynamicFilter:le,dynamicFilterNeedsFeature:ae,featureIndex:y.latestFeatureIndex}),this.retainedQueryData[E.bucketInstanceId]=new xr(E.bucketInstanceId,C,E.sourceLayerIndex,E.index,y.tileID);const Re={bucket:E,layout:M,posMatrix:X,textLabelPlaneMatrix:ve,labelToScreenMatrix:_e,clippingData:Ee,scale:F,textPixelRatio:B,holdingForFade:y.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(E.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(b)for(const ze of E.sortKeyRanges){const{sortKey:je,symbolInstanceStart:gt,symbolInstanceEnd:Le}=ze;c.push({sortKey:je,symbolInstanceStart:gt,symbolInstanceEnd:Le,parameters:Re})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Re})}attemptAnchorPlacement(c,d,y,b,E,C,M,k,F,B,U,X,Y,K,J,Q,H,le){const{textOffset0:ae,textOffset1:ce,crossTileID:ve}=X,_e=[ae,ce],Ee=iu(c,y,b,_e,E),Re=this.collisionIndex.placeCollisionBox(K,E,d,Pl(Ee.x,Ee.y,C,M,this.transform.angle),U,k,F,B.predicate);if(Q){const ze=K.getSymbolInstanceIconSize(le,this.transform.zoom,X.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(K,ze,Q,Pl(Ee.x,Ee.y,C,M,this.transform.angle),U,k,F,B.predicate).box.length===0)return}if(Re.box.length>0){let ze;return this.prevPlacement&&this.prevPlacement.variableOffsets[ve]&&this.prevPlacement.placements[ve]&&this.prevPlacement.placements[ve].text&&(ze=this.prevPlacement.variableOffsets[ve].anchor),this.variableOffsets[ve]={textOffset:_e,width:y,height:b,anchor:c,textScale:E,prevAnchor:ze},this.markUsedJustification(K,c,X,J),K.allowVerticalPlacement&&(this.markUsedOrientation(K,J,X),this.placedOrientations[ve]=J),{shift:Ee,placedGlyphBoxes:Re}}}placeLayerBucketPart(c,d,y,b){const{bucket:E,layout:C,posMatrix:M,textLabelPlaneMatrix:k,labelToScreenMatrix:F,clippingData:B,textPixelRatio:U,holdingForFade:X,collisionBoxArray:Y,partiallyEvaluatedTextSize:K,partiallyEvaluatedIconSize:J,collisionGroup:Q}=c.parameters,H=C.get("text-optional"),le=C.get("icon-optional"),ae=C.get("text-allow-overlap"),ce=C.get("icon-allow-overlap"),ve=C.get("text-rotation-alignment")==="map",_e=C.get("text-pitch-alignment")==="map",Ee=C.get("icon-text-fit")!=="none",Re=C.get("symbol-z-order")==="viewport-y";this.transform.setProjection(E.projection);let ze=ae&&(ce||!E.hasIconData()||le),je=ce&&(ae||!E.hasTextData()||H);!E.collisionArrays&&Y&&E.deserializeCollisionBoxes(Y),y&&b&&E.updateCollisionDebugBuffers(this.transform.zoom,Y);const gt=(Le,Qe,qe)=>{const{crossTileID:st,numVerticalGlyphVertices:Ue}=Le;if(B){const nn={zoom:this.transform.zoom,pitch:this.transform.pitch};let ji=null;if(B.dynamicFilterNeedsFeature){const Ai=this.retainedQueryData[E.bucketInstanceId];ji=B.featureIndex.loadFeature({featureIndex:Le.featureIndex,bucketIndex:Ai.bucketIndex,sourceLayerIndex:Ai.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,B.dynamicFilter)(nn,ji,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new o.pointGeometry(Le.tileAnchorX,Le.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[st]=new Da(!1,!1,!1,!0),void(d[st]=!0)}if(d[st])return;if(X)return void(this.placements[st]=new Da(!1,!1,!1));let Ce=!1,$e=!1,it=!0,ct=!1,Nt=!1,si=null,Lt={box:null,offscreen:null,occluded:null},Rt={box:null},zt=null,hi=null,Wt=null,Mi=0,Ri=0,Wi=0;qe.textFeatureIndex?Mi=qe.textFeatureIndex:Le.useRuntimeCollisionCircles&&(Mi=Le.featureIndex),qe.verticalTextFeatureIndex&&(Ri=qe.verticalTextFeatureIndex);const Vi=nn=>{nn.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const ji=this.transform.elevation;(ji||nn.elevation)&&(nn.elevation=ji?ji.getAtTileOffset(nn.tileID,nn.tileAnchorX,nn.tileAnchorY):0)},Tn=qe.textBox;if(Tn){Vi(Tn);const nn=Ai=>{let fn=o.WritingMode.horizontal;if(E.allowVerticalPlacement&&!Ai&&this.prevPlacement){const rr=this.prevPlacement.placedOrientations[st];rr&&(this.placedOrientations[st]=rr,fn=rr,this.markUsedOrientation(E,fn,Le))}return fn},ji=(Ai,fn)=>{if(E.allowVerticalPlacement&&Ue>0&&qe.verticalTextBox){for(const rr of E.writingModes)if(rr===o.WritingMode.vertical?(Lt=fn(),Rt=Lt):Lt=Ai(),Lt&&Lt.box&&Lt.box.length)break}else Lt=Ai()};if(C.get("text-variable-anchor")){let Ai=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[st]){const Zi=this.prevPlacement.variableOffsets[st];Ai.indexOf(Zi.anchor)>0&&(Ai=Ai.filter(sr=>sr!==Zi.anchor),Ai.unshift(Zi.anchor))}const fn=(Zi,sr,or)=>{const po=E.getSymbolInstanceTextSize(K,Le,this.transform.zoom,Qe),Za=(Zi.x2-Zi.x1)*po+2*Zi.padding,Br=(Zi.y2-Zi.y1)*po+2*Zi.padding,qr=Ee&&!ce?sr:null;qr&&Vi(qr);let Vs={box:[],offscreen:!1,occluded:!1};const mo=ae?2*Ai.length:Ai.length;for(let go=0;go<mo;++go){const Ya=this.attemptAnchorPlacement(Ai[go%Ai.length],Zi,Za,Br,po,ve,_e,U,M,Q,go>=Ai.length,Le,Qe,E,or,qr,K,J);if(Ya&&(Vs=Ya.placedGlyphBoxes,Vs&&Vs.box&&Vs.box.length)){Ce=!0,si=Ya.shift;break}}return Vs};ji(()=>fn(Tn,qe.iconBox,o.WritingMode.horizontal),()=>{const Zi=qe.verticalTextBox;return Zi&&Vi(Zi),E.allowVerticalPlacement&&!(Lt&&Lt.box&&Lt.box.length)&&Ue>0&&Zi?fn(Zi,qe.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Lt&&(Ce=Lt.box,it=Lt.offscreen,ct=Lt.occluded);const rr=nn(Lt&&Lt.box);if(!Ce&&this.prevPlacement){const Zi=this.prevPlacement.variableOffsets[st];Zi&&(this.variableOffsets[st]=Zi,this.markUsedJustification(E,Zi.anchor,Le,rr))}}else{const Ai=(fn,rr)=>{const Zi=E.getSymbolInstanceTextSize(K,Le,this.transform.zoom,Qe),sr=this.collisionIndex.placeCollisionBox(E,Zi,fn,new o.pointGeometry(0,0),ae,U,M,Q.predicate);return sr&&sr.box&&sr.box.length&&(this.markUsedOrientation(E,rr,Le),this.placedOrientations[st]=rr),sr};ji(()=>Ai(Tn,o.WritingMode.horizontal),()=>{const fn=qe.verticalTextBox;return E.allowVerticalPlacement&&Ue>0&&fn?(Vi(fn),Ai(fn,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),nn(Lt&&Lt.box&&Lt.box.length)}}if(zt=Lt,Ce=zt&&zt.box&&zt.box.length>0,it=zt&&zt.offscreen,ct=zt&&zt.occluded,Le.useRuntimeCollisionCircles){const nn=E.text.placedSymbolArray.get(Le.centerJustifiedTextSymbolIndex>=0?Le.centerJustifiedTextSymbolIndex:Le.verticalPlacedTextSymbolIndex),ji=o.evaluateSizeForFeature(E.textSizeData,K,nn),Ai=C.get("text-padding");hi=this.collisionIndex.placeCollisionCircles(E,ae,nn,E.lineVertexArray,E.glyphOffsetArray,ji,M,k,F,y,_e,Q.predicate,Le.collisionCircleDiameter*ji/o.ONE_EM,Ai,this.retainedQueryData[E.bucketInstanceId].tileID),Ce=ae||hi.circles.length>0&&!hi.collisionDetected,it=it&&hi.offscreen,ct=hi.occluded}if(qe.iconFeatureIndex&&(Wi=qe.iconFeatureIndex),qe.iconBox){const nn=ji=>{Vi(ji);const Ai=Ee&&si?Pl(si.x,si.y,ve,_e,this.transform.angle):new o.pointGeometry(0,0),fn=E.getSymbolInstanceIconSize(J,this.transform.zoom,Le.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,fn,ji,Ai,ce,U,M,Q.predicate)};Rt&&Rt.box&&Rt.box.length&&qe.verticalIconBox?(Wt=nn(qe.verticalIconBox),$e=Wt.box.length>0):(Wt=nn(qe.iconBox),$e=Wt.box.length>0),it=it&&Wt.offscreen,Nt=Wt.occluded}const br=H||Le.numHorizontalGlyphVertices===0&&Ue===0,ss=le||Le.numIconVertices===0;if(br||ss?ss?br||($e=$e&&Ce):Ce=$e&&Ce:$e=Ce=$e&&Ce,Ce&&zt&&zt.box&&this.collisionIndex.insertCollisionBox(zt.box,C.get("text-ignore-placement"),E.bucketInstanceId,Rt&&Rt.box&&Ri?Ri:Mi,Q.ID),$e&&Wt&&this.collisionIndex.insertCollisionBox(Wt.box,C.get("icon-ignore-placement"),E.bucketInstanceId,Wi,Q.ID),hi&&(Ce&&this.collisionIndex.insertCollisionCircles(hi.circles,C.get("text-ignore-placement"),E.bucketInstanceId,Mi,Q.ID),y)){const nn=E.bucketInstanceId;let ji=this.collisionCircleArrays[nn];ji===void 0&&(ji=this.collisionCircleArrays[nn]=new Kh);for(let Ai=0;Ai<hi.circles.length;Ai+=4)ji.circles.push(hi.circles[Ai+0]),ji.circles.push(hi.circles[Ai+1]),ji.circles.push(hi.circles[Ai+2]),ji.circles.push(hi.collisionDetected?1:0)}const Us=E.projection.name!=="globe";ze=ze&&(Us||!ct),je=je&&(Us||!Nt),this.placements[st]=new Da(Ce||ze,$e||je,it||E.justReloaded),d[st]=!0};if(Re){const Le=E.getSortedSymbolIndexes(this.transform.angle);for(let Qe=Le.length-1;Qe>=0;--Qe){const qe=Le[Qe];gt(E.symbolInstances.get(qe),qe,E.collisionArrays[qe])}}else for(let Le=c.symbolInstanceStart;Le<c.symbolInstanceEnd;Le++)gt(E.symbolInstances.get(Le),Le,E.collisionArrays[Le]);if(y&&E.bucketInstanceId in this.collisionCircleArrays){const Le=this.collisionCircleArrays[E.bucketInstanceId];o.invert(Le.invProjMatrix,M),Le.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(c,d,y,b){const{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:k,crossTileID:F}=y,B=o.getAnchorJustification(d),U=b===o.WritingMode.vertical?k:B==="left"?E:B==="center"?C:B==="right"?M:-1;E>=0&&(c.text.placedSymbolArray.get(E).crossTileID=U>=0&&E!==U?0:F),C>=0&&(c.text.placedSymbolArray.get(C).crossTileID=U>=0&&C!==U?0:F),M>=0&&(c.text.placedSymbolArray.get(M).crossTileID=U>=0&&M!==U?0:F),k>=0&&(c.text.placedSymbolArray.get(k).crossTileID=U>=0&&k!==U?0:F)}markUsedOrientation(c,d,y){const b=d===o.WritingMode.horizontal||d===o.WritingMode.horizontalOnly?d:0,E=d===o.WritingMode.vertical?d:0,{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:F}=y,B=c.text.placedSymbolArray;C>=0&&(B.get(C).placedOrientation=b),M>=0&&(B.get(M).placedOrientation=b),k>=0&&(B.get(k).placedOrientation=b),F>=0&&(B.get(F).placedOrientation=E)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let y=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const b=d?d.symbolFadeChange(c):1,E=d?d.opacities:{},C=d?d.variableOffsets:{},M=d?d.placedOrientations:{};for(const k in this.placements){const F=this.placements[k],B=E[k];B?(this.opacities[k]=new ea(B,b,F.text,F.icon,null,F.clipped),y=y||F.text!==B.text.placed||F.icon!==B.icon.placed):(this.opacities[k]=new ea(null,b,F.text,F.icon,F.skipFade,F.clipped),y=y||F.text||F.icon)}for(const k in E){const F=E[k];if(!this.opacities[k]){const B=new ea(F,b,!1,!1);B.isHidden()||(this.opacities[k]=B,y=y||F.text.placed||F.icon.placed)}}for(const k in C)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=C[k]);for(const k in M)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=M[k]);y?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:c)}updateLayerOpacities(c,d){const y={};for(const b of d){const E=b.getBucket(c);E&&b.latestFeatureIndex&&c.id===E.layerIds[0]&&this.updateBucketOpacities(E,y,b.collisionBoxArray)}}updateBucketOpacities(c,d,y){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const b=c.layers[0].layout,E=!!c.layers[0].dynamicFilter(),C=new ea(null,0,!1,!1,!0),M=b.get("text-allow-overlap"),k=b.get("icon-allow-overlap"),F=b.get("text-variable-anchor"),B=b.get("text-rotation-alignment")==="map",U=b.get("text-pitch-alignment")==="map",X=b.get("icon-text-fit")!=="none",Y=new ea(null,0,M&&(k||!c.hasIconData()||b.get("icon-optional")),k&&(M||!c.hasTextData()||b.get("text-optional")),!0);!c.collisionArrays&&y&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(y);const K=(Q,H,le)=>{for(let ae=0;ae<H/4;ae++)Q.opacityVertexArray.emplaceBack(le)};let J=0;for(let Q=0;Q<c.symbolInstances.length;Q++){const H=c.symbolInstances.get(Q),{numHorizontalGlyphVertices:le,numVerticalGlyphVertices:ae,crossTileID:ce,numIconVertices:ve}=H;let _e=this.opacities[ce];d[ce]?_e=C:_e||(_e=Y,this.opacities[ce]=_e),d[ce]=!0;const Ee=le>0||ae>0,Re=ve>0,ze=this.placedOrientations[ce],je=ze===o.WritingMode.vertical,gt=ze===o.WritingMode.horizontal||ze===o.WritingMode.horizontalOnly;if(!Ee&&!Re||_e.isHidden()||J++,Ee){const Le=ru(_e.text);K(c.text,le,je?Oa:Le),K(c.text,ae,gt?Oa:Le);const Qe=_e.text.isHidden(),{leftJustifiedTextSymbolIndex:qe,centerJustifiedTextSymbolIndex:st,rightJustifiedTextSymbolIndex:Ue,verticalPlacedTextSymbolIndex:Ce}=H,$e=c.text.placedSymbolArray,it=Qe||je?1:0;qe>=0&&($e.get(qe).hidden=it),st>=0&&($e.get(st).hidden=it),Ue>=0&&($e.get(Ue).hidden=it),Ce>=0&&($e.get(Ce).hidden=Qe||gt?1:0);const ct=this.variableOffsets[ce];ct&&this.markUsedJustification(c,ct.anchor,H,ze);const Nt=this.placedOrientations[ce];Nt&&(this.markUsedJustification(c,"left",H,Nt),this.markUsedOrientation(c,Nt,H))}if(Re){const Le=ru(_e.icon),{placedIconSymbolIndex:Qe,verticalPlacedIconSymbolIndex:qe}=H,st=c.icon.placedSymbolArray,Ue=_e.icon.isHidden()?1:0;Qe>=0&&(K(c.icon,ve,je?Oa:Le),st.get(Qe).hidden=Ue),qe>=0&&(K(c.icon,H.numVerticalIconVertices,gt?Oa:Le),st.get(qe).hidden=Ue)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const Le=c.collisionArrays[Q];if(Le){let Qe=new o.pointGeometry(0,0),qe=!0;if(Le.textBox||Le.verticalTextBox){if(F){const Ue=this.variableOffsets[ce];Ue?(Qe=iu(Ue.anchor,Ue.width,Ue.height,Ue.textOffset,Ue.textScale),B&&Qe._rotate(U?this.transform.angle:-this.transform.angle)):qe=!1}E&&(qe=!_e.clipped),Le.textBox&&fr(c.textCollisionBox.collisionVertexArray,_e.text.placed,!qe||je,Qe.x,Qe.y),Le.verticalTextBox&&fr(c.textCollisionBox.collisionVertexArray,_e.text.placed,!qe||gt,Qe.x,Qe.y)}const st=qe&&!!(!gt&&Le.verticalIconBox);Le.iconBox&&fr(c.iconCollisionBox.collisionVertexArray,_e.icon.placed,st,X?Qe.x:0,X?Qe.y:0),Le.verticalIconBox&&fr(c.iconCollisionBox.collisionVertexArray,_e.icon.placed,!st,X?Qe.x:0,X?Qe.y:0)}}}if(c.fullyClipped=J===0,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const Q=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=Q.invProjMatrix,c.placementViewportMatrix=Q.viewportMatrix,c.collisionCircleArray=Q.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,d){const y=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*y>c}setStale(){this.stale=!0}}function fr(g,c,d,y,b){g.emplaceBack(c?1:0,d?1:0,y||0,b||0),g.emplaceBack(c?1:0,d?1:0,y||0,b||0),g.emplaceBack(c?1:0,d?1:0,y||0,b||0),g.emplaceBack(c?1:0,d?1:0,y||0,b||0)}const Dp=Math.pow(2,25),nu=Math.pow(2,24),Mn=Math.pow(2,17),kl=Math.pow(2,16),Jh=Math.pow(2,9),Dl=Math.pow(2,8),Gn=Math.pow(2,1);function ru(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const c=g.placed?1:0,d=Math.floor(127*g.opacity);return d*Dp+c*nu+d*Mn+c*kl+d*Jh+c*Dl+d*Gn+c}const Oa=0;class Fs{constructor(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(c,d,y,b,E){const C=this._bucketParts;for(;this._currentTileIndex<c.length;)if(d.getBucketParts(C,b,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((M,k)=>M.sortKey-k.sortKey));this._currentPartIndex<C.length;){const M=C[this._currentPartIndex];if(d.placeLayerBucketPart(M,this._seenCrossTileIDs,y,M.symbolInstanceStart===0),this._currentPartIndex++,E())return!0}return!1}}class Ol{constructor(c,d,y,b,E,C,M,k){this.placement=new vr(c,E,C,M,k),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(c,d,y){const b=o.exported.now(),E=()=>{const C=o.exported.now()-b;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=d[c[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=M)&&(!C.maxzoom||C.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Fs(C)),this._inProgressLayer.continuePlacement(y[C.source],this.placement,this._showCollisionBoxes,C,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const su=512/o.EXTENT/2;class jy{constructor(c,d,y){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=y;for(let b=0;b<d.length;b++){const E=d.get(b),C=E.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,c)})}}getScaledCoordinates(c,d){const y=su/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*o.EXTENT+c.tileAnchorX)*y),y:Math.floor((d.canonical.y*o.EXTENT+c.tileAnchorY)*y)}}findMatches(c,d,y){const b=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let E=0;E<c.length;E++){const C=c.get(E);if(C.crossTileID)continue;const M=this.indexedSymbolInstances[C.key];if(!M)continue;const k=this.getScaledCoordinates(C,d);for(const F of M)if(Math.abs(F.coord.x-k.x)<=b&&Math.abs(F.coord.y-k.y)<=b&&!y[F.crossTileID]){y[F.crossTileID]=!0,C.crossTileID=F.crossTileID;break}}}}class Qh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class La{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const d=Math.round((c-this.lng)/360);if(d!==0)for(const y in this.indexes){const b=this.indexes[y],E={};for(const C in b){const M=b[C];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+d),E[M.tileID.key]=M}this.indexes[y]=E}this.lng=c}addBucket(c,d,y){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let E=0;E<d.symbolInstances.length;E++)d.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});const b=this.usedCrossTileIDs[c.overscaledZ];for(const E in this.indexes){const C=this.indexes[E];if(Number(E)>c.overscaledZ)for(const M in C){const k=C[M];k.tileID.isChildOf(c)&&k.findMatches(d.symbolInstances,c,b)}else{const M=C[c.scaledTo(Number(E)).key];M&&M.findMatches(d.symbolInstances,c,b)}}for(let E=0;E<d.symbolInstances.length;E++){const C=d.symbolInstances.get(E);C.crossTileID||(C.crossTileID=y.generate(),b[C.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new jy(c,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(c,d){for(const y in d.indexedSymbolInstances)for(const b of d.indexedSymbolInstances[y])delete this.usedCrossTileIDs[c][b.crossTileID]}removeStaleBuckets(c){let d=!1;for(const y in this.indexes){const b=this.indexes[y];for(const E in b)c[b[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,b[E]),delete b[E],d=!0)}return d}}class Op{constructor(){this.layerIndexes={},this.crossTileIDs=new Qh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,d,y,b){let E=this.layerIndexes[c.id];E===void 0&&(E=this.layerIndexes[c.id]=new La);let C=!1;const M={};b.name!=="globe"&&E.handleWrapJump(y);for(const k of d){const F=k.getBucket(c);F&&c.id===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(k.tileID,F,this.crossTileIDs)&&(C=!0),M[F.bucketInstanceId]=!0)}return E.removeStaleBuckets(M)&&(C=!0),C}pruneUnusedLayers(c){const d={};c.forEach(y=>{d[y]=!0});for(const y in this.layerIndexes)d[y]||delete this.layerIndexes[y]}}const Ll=(g,c)=>o.emitValidationErrors(g,c&&c.filter(d=>d.identifier!=="source.canvas")),Ba=o.pick(Gt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),co=o.pick(Gt,["setCenter","setZoom","setBearing","setPitch"]),ou={version:8,layers:[],sources:{}},uo={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Hr extends o.Evented{constructor(c,d={}){super(),this.map=c,this.dispatcher=new Xn(Kt(),this),this.imageManager=new Ut,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(c._requestManager,d.localFontFamily?o.LocalGlyphMode.all:d.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.crossTileSymbolIndex=new Op,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const y=this;this._rtlTextPluginCallback=Hr.registerForPluginStateChange(b=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(E,C)=>{if(o.triggerPluginCompletionEvent(E),C&&C.every(M=>M))for(const M in y._sourceCaches){const k=y._sourceCaches[M],F=k.getSource().type;F!=="vector"&&F!=="geojson"||k.reload()}})}),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const E=this.getSource(b.sourceId);if(E&&E.vectorLayerIds)for(const C in this._layers){const M=this._layers[C];M.source===E.id&&this._validateLayer(M)}})}loadURL(c,d={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const y=typeof d.validate=="boolean"?d.validate:!o.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);const b=this.map._requestManager.transformRequest(c,o.ResourceType.Style);this._request=o.getJSON(b,(E,C)=>{this._request=null,E?this.fire(new o.ErrorEvent(E)):C&&this._load(C,y)})}loadJSON(c,d={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(c,d.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(ou,!1)}_updateLayerCount(c,d){const y=d?1:-1;c.is3D()&&(this._num3DLayers+=y),c.type==="circle"&&(this._numCircleLayers+=y),c.type==="symbol"&&(this._numSymbolLayers+=y)}_load(c,d){if(d&&Ll(this,o.validateStyle(c)))return;this._loaded=!0,this.stylesheet=o.clone$1(c),this._updateMapProjection();for(const b in c.sources)this.addSource(b,c.sources[b],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const y=Ii(this.stylesheet.layers);this._order=y.map(b=>b.id),this._layers={},this._serializedLayers={};for(const b of y){const E=o.createStyleLayer(b);E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E,this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new mt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(d,y,b){let E,C,M;const k=o.exported.devicePixelRatio>1?"@2x":"";let F=o.getJSON(y.transformRequest(y.normalizeSpriteURL(d,k,".json"),o.ResourceType.SpriteJSON),(X,Y)=>{F=null,M||(M=X,E=Y,U())}),B=o.getImage(y.transformRequest(y.normalizeSpriteURL(d,k,".png"),o.ResourceType.SpriteImage),(X,Y)=>{B=null,M||(M=X,C=Y,U())});function U(){if(M)b(M);else if(E&&C){const X=o.exported.getImageData(C),Y={};for(const K in E){const{width:J,height:Q,x:H,y:le,sdf:ae,pixelRatio:ce,stretchX:ve,stretchY:_e,content:Ee}=E[K],Re=new o.RGBAImage({width:J,height:Q});o.RGBAImage.copy(X,Re,{x:H,y:le},{x:0,y:0},{width:J,height:Q}),Y[K]={data:Re,pixelRatio:ce,sdf:ae,stretchX:ve,stretchY:_e,content:Ee}}b(null,Y)}}return{cancel(){F&&(F.cancel(),F=null),B&&(B.cancel(),B=null)}}}(c,this.map._requestManager,(d,y)=>{if(this._spriteRequest=null,d)this.fire(new o.ErrorEvent(d));else if(y)for(const b in y)this.imageManager.addImage(b,y[b]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(c){const d=this.getSource(c.source);if(!d)return;const y=c.sourceLayer;y&&(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(y)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${y}" does not exist on source "${d.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const d=[];for(const y of c){const b=this._layers[y];b.type!=="custom"&&d.push(b.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&(typeof c.isLayerDraped=="function"?c.isLayerDraped():uo[c.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const d=this._changed;if(this._changed){const b=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(b.length||E.length)&&this._updateWorkerLayers(b,E);for(const C in this._updatedSources){const M=this._updatedSources[C];M==="reload"?this._reloadSource(C):M==="clear"&&this._clearSource(C)}this._updateTilesForChangedImages();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const y={};for(const b in this._sourceCaches){const E=this._sourceCaches[b];y[b]=E.used,E.used=!1}for(const b of this._order){const E=this._layers[b];if(E.recalculate(c,this._availableImages),!E.isHidden(c.zoom)){const M=this._getLayerSourceCache(E);M&&(M.used=!0)}const C=this.map.painter;if(C){const M=E.getProgramIds();if(!M)continue;const k=E.getProgramConfiguration(c.zoom);for(const F of M)C.useProgram(F,k)}}for(const b in y){const E=this._sourceCaches[b];y[b]!==E.used&&E.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),Ll(this,o.validateStyle(c)))return!1;(c=o.clone$1(c)).layers=Ii(c.layers);const d=function(b,E){if(!b)return[{command:Gt.setStyle,args:[E]}];let C=[];try{if(!v(b.version,E.version))return[{command:Gt.setStyle,args:[E]}];v(b.center,E.center)||C.push({command:Gt.setCenter,args:[E.center]}),v(b.zoom,E.zoom)||C.push({command:Gt.setZoom,args:[E.zoom]}),v(b.bearing,E.bearing)||C.push({command:Gt.setBearing,args:[E.bearing]}),v(b.pitch,E.pitch)||C.push({command:Gt.setPitch,args:[E.pitch]}),v(b.sprite,E.sprite)||C.push({command:Gt.setSprite,args:[E.sprite]}),v(b.glyphs,E.glyphs)||C.push({command:Gt.setGlyphs,args:[E.glyphs]}),v(b.transition,E.transition)||C.push({command:Gt.setTransition,args:[E.transition]}),v(b.light,E.light)||C.push({command:Gt.setLight,args:[E.light]}),v(b.fog,E.fog)||C.push({command:Gt.setFog,args:[E.fog]}),v(b.projection,E.projection)||C.push({command:Gt.setProjection,args:[E.projection]});const M={},k=[];(function(U,X,Y,K){let J;for(J in X=X||{},U=U||{})U.hasOwnProperty(J)&&(X.hasOwnProperty(J)||Ni(J,Y,K));for(J in X){if(!X.hasOwnProperty(J))continue;const Q=X[J];U.hasOwnProperty(J)?v(U[J],Q)||(U[J].type==="geojson"&&Q.type==="geojson"&&Ls(U,X,J)?Y.push({command:Gt.setGeoJSONSourceData,args:[J,Q.data]}):ao(J,X,Y,K)):Fi(J,X,Y)}})(b.sources,E.sources,k,M);const F=[];b.layers&&b.layers.forEach(U=>{U.source&&M[U.source]?C.push({command:Gt.removeLayer,args:[U.id]}):F.push(U)});let B=b.terrain;B&&M[B.source]&&(C.push({command:Gt.setTerrain,args:[void 0]}),B=void 0),C=C.concat(k),v(B,E.terrain)||C.push({command:Gt.setTerrain,args:[E.terrain]}),function(U,X,Y){X=X||[];const K=(U=U||[]).map(Bs),J=X.map(Bs),Q=U.reduce(wn,{}),H=X.reduce(wn,{}),le=K.slice(),ae=Object.create(null);let ce,ve,_e,Ee,Re,ze,je;for(ce=0,ve=0;ce<K.length;ce++)_e=K[ce],H.hasOwnProperty(_e)?ve++:(Y.push({command:Gt.removeLayer,args:[_e]}),le.splice(le.indexOf(_e,ve),1));for(ce=0,ve=0;ce<J.length;ce++)_e=J[J.length-1-ce],le[le.length-1-ce]!==_e&&(Q.hasOwnProperty(_e)?(Y.push({command:Gt.removeLayer,args:[_e]}),le.splice(le.lastIndexOf(_e,le.length-ve),1)):ve++,ze=le[le.length-ce],Y.push({command:Gt.addLayer,args:[H[_e],ze]}),le.splice(le.length-ce,0,_e),ae[_e]=!0);for(ce=0;ce<J.length;ce++)if(_e=J[ce],Ee=Q[_e],Re=H[_e],!ae[_e]&&!v(Ee,Re))if(v(Ee.source,Re.source)&&v(Ee["source-layer"],Re["source-layer"])&&v(Ee.type,Re.type)){for(je in Ze(Ee.layout,Re.layout,Y,_e,null,Gt.setLayoutProperty),Ze(Ee.paint,Re.paint,Y,_e,null,Gt.setPaintProperty),v(Ee.filter,Re.filter)||Y.push({command:Gt.setFilter,args:[_e,Re.filter]}),v(Ee.minzoom,Re.minzoom)&&v(Ee.maxzoom,Re.maxzoom)||Y.push({command:Gt.setLayerZoomRange,args:[_e,Re.minzoom,Re.maxzoom]}),Ee)Ee.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&(je.indexOf("paint.")===0?Ze(Ee[je],Re[je],Y,_e,je.slice(6),Gt.setPaintProperty):v(Ee[je],Re[je])||Y.push({command:Gt.setLayerProperty,args:[_e,je,Re[je]]}));for(je in Re)Re.hasOwnProperty(je)&&!Ee.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&(je.indexOf("paint.")===0?Ze(Ee[je],Re[je],Y,_e,je.slice(6),Gt.setPaintProperty):v(Ee[je],Re[je])||Y.push({command:Gt.setLayerProperty,args:[_e,je,Re[je]]}))}else Y.push({command:Gt.removeLayer,args:[_e]}),ze=le[le.lastIndexOf(_e)+1],Y.push({command:Gt.addLayer,args:[Re,ze]})}(F,E.layers,C)}catch(M){console.warn("Unable to compute style diff:",M),C=[{command:Gt.setStyle,args:[E]}]}return C}(this.serialize(),c).filter(b=>!(b.command in co));if(d.length===0)return!1;const y=d.filter(b=>!(b.command in Ba));if(y.length>0)throw new Error(`Unimplemented: ${y.map(b=>b.command).join(", ")}.`);return d.forEach(b=>{b.command!=="setTransition"&&b.command!=="setProjection"&&this[b.command].apply(this,b.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,d){return this.getImage(c)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,d),this._afterImageUpdated(c),this)}updateImage(c,d){this.imageManager.updateImage(c,d)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,d,y={}){if(this._checkLoaded(),this.getSource(c)!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(o.validateSource,`sources.${c}`,d,null,y))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const b=ke(c,d,this.dispatcher,this);b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:b.serialize(),sourceId:c}));const E=C=>{const M=(C?"symbol:":"other:")+c,k=this._sourceCaches[M]=new o.SourceCache(M,b,C);(C?this._symbolSourceCaches:this._otherSourceCaches)[c]=k,k.style=this,k.onAdd(this.map)};E(!1),d.type!=="vector"&&d.type!=="geojson"||E(!0),b.onAdd&&b.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const d=this.getSource(c);if(!d)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===c)return this.fire(new o.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new o.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const y=this._getSourceCaches(c);for(const b of y)delete this._sourceCaches[b.id],delete this._updatedSources[b.id],b.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,d){this._checkLoaded(),this.getSource(c).setData(d),this._changed=!0}getSource(c){const d=this._getSourceCache(c);return d&&d.getSource()}_getSources(){const c=[];for(const d in this._otherSourceCaches){const y=this._getSourceCache(d);y&&c.push(y.getSource())}return c}addLayer(c,d,y={}){this._checkLoaded();const b=c.id;if(this.getLayer(b))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${b}" already exists on this map`)));let E;if(c.type==="custom"){if(Ll(this,o.validateCustomStyleLayer(c)))return;E=o.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(b,c.source),c=o.clone$1(c),c=o.extend(c,{source:b})),this._validate(o.validateLayer,`layers.${b}`,c,{arrayIndex:-1},y))return;E=o.createStyleLayer(c),this._validateLayer(E),E.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}const C=d?this._order.indexOf(d):this._order.length;if(d&&C===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(C,0,b),this._layerOrderChanged=!0,this._layers[b]=E;const M=this._getLayerSourceCache(E);if(this._removedLayers[b]&&E.source&&M&&E.type!=="custom"){const k=this._removedLayers[b];delete this._removedLayers[b],k.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",M.pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,d){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new o.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===d)return;const y=this._order.indexOf(c);this._order.splice(y,1);const b=d?this._order.indexOf(d):this._order.length;d&&b===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(b,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const d=this._layers[c];if(!d)return void this.fire(new o.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);const y=this._order.indexOf(c);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const d in this._layers)if(this._layers[d].type===c)return!0;return!1}setLayerZoomRange(c,d,y){this._checkLoaded();const b=this.getLayer(c);b?b.minzoom===d&&b.maxzoom===y||(d!=null&&(b.minzoom=d),y!=null&&(b.maxzoom=y),this._updateLayer(b)):this.fire(new o.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,d,y={}){this._checkLoaded();const b=this.getLayer(c);if(b){if(!v(b.filter,d))return d==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(o.validateFilter,`layers.${b.id}.filter`,d,{layerType:b.type},y)||(b.filter=o.clone$1(d),this._updateLayer(b)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const d=this.getLayer(c);return d&&o.clone$1(d.filter)}setLayoutProperty(c,d,y,b={}){this._checkLoaded();const E=this.getLayer(c);E?v(E.getLayoutProperty(d),y)||(E.setLayoutProperty(d,y,b),this._updateLayer(E)):this.fire(new o.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,d){const y=this.getLayer(c);if(y)return y.getLayoutProperty(d);this.fire(new o.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,d,y,b={}){this._checkLoaded();const E=this.getLayer(c);E?v(E.getPaintProperty(d),y)||(E.setPaintProperty(d,y,b)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,d){const y=this.getLayer(c);return y&&y.getPaintProperty(d)}setFeatureState(c,d){this._checkLoaded();const y=c.source,b=c.sourceLayer,E=this.getSource(y);if(!E)return void this.fire(new o.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`)));const C=E.type;if(C==="geojson"&&b)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(C==="vector"&&!b)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));c.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const M=this._getSourceCaches(y);for(const k of M)k.setFeatureState(b,c.id,d)}removeFeatureState(c,d){this._checkLoaded();const y=c.source,b=this.getSource(y);if(!b)return void this.fire(new o.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`)));const E=b.type,C=E==="vector"?c.sourceLayer:void 0;if(E==="vector"&&!C)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&typeof c.id!="string"&&typeof c.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const M=this._getSourceCaches(y);for(const k of M)k.removeFeatureState(C,c.id,d)}getFeatureState(c){this._checkLoaded();const d=c.source,y=c.sourceLayer,b=this.getSource(d);if(b){if(b.type!=="vector"||y)return c.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(y,c.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const d in this._sourceCaches){const y=this._sourceCaches[d].getSource();c[y.id]||(c[y.id]=y.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateLayer(c){this._updatedLayers[c.id]=!0;const d=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&d&&d.getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",d.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const d=C=>this._layers[C].type==="fill-extrusion",y={},b=[];for(let C=this._order.length-1;C>=0;C--){const M=this._order[C];if(d(M)){y[M]=C;for(const k of c){const F=k[M];if(F)for(const B of F)b.push(B)}}}b.sort((C,M)=>M.intersectionZ-C.intersectionZ);const E=[];for(let C=this._order.length-1;C>=0;C--){const M=this._order[C];if(d(M))for(let k=b.length-1;k>=0;k--){const F=b[k].feature;if(y[F.layer.id]<C)break;E.push(F),b.pop()}else for(const k of c){const F=k[M];if(F)for(const B of F)E.push(B.feature)}}return E}queryRenderedFeatures(c,d,y){d&&d.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",d.filter,null,d);const b={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const k of d.layers){const F=this._layers[k];if(!F)return this.fire(new o.ErrorEvent(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];b[F.source]=!0}}const E=[];d.availableImages=this._availableImages;const C=d&&d.layers?d.layers.some(k=>{const F=this.getLayer(k);return F&&F.is3D()}):this.has3DLayers(),M=$r.createFromScreenPoints(c,y);for(const k in this._sourceCaches){const F=this._sourceCaches[k].getSource().id;d.layers&&!b[F]||E.push(Fe(this._sourceCaches[k],this._layers,this._serializedLayers,M,d,y,C,!!this.map._showQueryGeometry))}return this.placement&&E.push(function(k,F,B,U,X,Y,K){const J={},Q=Y.queryRenderedSymbols(U),H=[];for(const le of Object.keys(Q).map(Number))H.push(K[le]);H.sort(Ct);for(const le of H){const ae=le.featureIndex.lookupSymbolFeatures(Q[le.bucketInstanceId],F,le.bucketIndex,le.sourceLayerIndex,X.filter,X.layers,X.availableImages,k);for(const ce in ae){const ve=J[ce]=J[ce]||[],_e=ae[ce];_e.sort((Ee,Re)=>{const ze=le.featureSortOrder;if(ze){const je=ze.indexOf(Ee.featureIndex);return ze.indexOf(Re.featureIndex)-je}return Re.featureIndex-Ee.featureIndex});for(const Ee of _e)ve.push(Ee)}}for(const le in J)J[le].forEach(ae=>{const ce=ae.feature,ve=B(k[le]);if(!ve)return;const _e=ve.getFeatureState(ce.layer["source-layer"],ce.id);ce.source=ce.layer.source,ce.layer["source-layer"]&&(ce.sourceLayer=ce.layer["source-layer"]),ce.state=_e});return J}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),M.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(c,d){d&&d.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",d.filter,null,d);const y=this._getSourceCaches(c);let b=[];for(const E of y)b=b.concat(nt(E,d));return b}addSourceType(c,d,y){return Hr.getSourceType(c)?y(new Error(`A source type called "${c}" already exists.`)):(Hr.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},y):y(null,null))}getLight(){return this.light.getLight()}setLight(c,d={}){this._checkLoaded();const y=this.light.getLight();let b=!1;for(const C in c)if(!v(c[C],y[C])){b=!0;break}if(!b)return;const E=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,d),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,d=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let y=c;if(d===1){if(typeof y.source=="object"){const b="terrain-dem-src";this.addSource(b,y.source),y=o.clone$1(y),y=o.extend(y,{source:b})}if(this._validate(o.validateTerrain,"terrain",y))return}if(!this.terrain||this.terrain&&d!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,d)}else{const b=this.terrain,E=b.get();for(const C of Object.keys(o.spec.terrain))!y.hasOwnProperty(C)&&o.spec.terrain[C].default&&(y[C]=o.spec.terrain[C].default);for(const C in y)if(!v(y[C],E[C])){b.set(y),this.stylesheet.terrain=y;const M=this._setTransitionParameters({duration:0});b.updateTransitions(M);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const d=this.fog=new Ln(c,this.map.transform);this.stylesheet.fog=c;const y=this._setTransitionParameters({duration:0});d.updateTransitions(y)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog,y=d.get();Object.keys(c).length===0&&d.set(c);for(const b in c)if(!v(c[b],y[b])){d.set(c),this.stylesheet.fog=c;const E=this._setTransitionParameters({duration:0});d.updateTransitions(E);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:o.exported.now(),transition:o.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(y=>this.isLayerDraped(this._layers[y])),d=this._order.filter(y=>!this.isLayerDraped(this._layers[y]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...d)}_createTerrain(c,d){const y=this.terrain=new ti(c,d);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const b=this._setTransitionParameters({duration:0});y.updateTransitions(b)}_force3DLayerUpdate(){for(const c in this._layers){const d=this._layers[c];d.type==="fill-extrusion"&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const d=this._layers[c];d.type==="symbol"&&this._updateLayer(d)}}_validate(c,d,y,b,E={}){return(!E||E.validate!==!1)&&Ll(this,c.call(o.validateStyle,o.extend({key:d,style:this.serialize(),value:y,styleSpec:o.spec},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const d=this._getSourceCaches(c);for(const y of d)y.clearTiles()}_reloadSource(c){const d=this._getSourceCaches(c);for(const y of d)y.resume(),y.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const d in this._sourceCaches)this._sourceCaches[d].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const d=this._sourceCaches[c];d.resume(),d.reload()}}_updatePlacement(c,d,y,b,E=!1){let C=!1,M=!1;const k={};for(const F of this._order){const B=this._layers[F];if(B.type!=="symbol")continue;if(!k[B.source]){const X=this._getLayerSourceCache(B);if(!X)continue;k[B.source]=X.getRenderableIds(!0).map(Y=>X.getTileByID(Y)).sort((Y,K)=>K.tileID.overscaledZ-Y.tileID.overscaledZ||(Y.tileID.isLessThan(K.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(B,k[B.source],c.center.lng,c.projection);C=C||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),E=E||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),c.zoom))&&(this.pauseablePlacement=new Ol(c,this._order,E,d,y,b,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),M=!0),C&&this.pauseablePlacement.placement.setStale()),M||C)for(const F of this._order){const B=this._layers[F];B.type==="symbol"&&this.placement.updateLayerOpacities(B,k[B.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,d,y){this.imageManager.getImages(d.icons,y),this._updateTilesForChangedImages();const b=E=>{E&&E.setDependencies(d.tileID.key,d.type,d.icons)};b(this._otherSourceCaches[d.source]),b(this._symbolSourceCaches[d.source])}getGlyphs(c,d,y){this.glyphManager.getGlyphs(d.stacks,y)}getResource(c,d,y){return o.makeRequest(d,y)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return c.type==="symbol"?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const d=[];return this._otherSourceCaches[c]&&d.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&d.push(this._symbolSourceCaches[c]),d}_isSourceCacheLoaded(c){const d=this._getSourceCaches(c);return d.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):d.every(y=>y.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Hr.getSourceType=function(g){return Oe[g]},Hr.setSourceType=function(g,c){Oe[g]=c},Hr.registerForPluginStateChange=o.registerForPluginStateChange;var Bl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Lp="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Bp=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,au=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Fp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let ef={},tf={};const Fa=[];ta(Bl,Fa),ta(Bp,Fa),ta(au,Fa),ta(Fp,Fa),ef=Ci("",Bp),tf=Ci(Fp,au);const Np=Ci(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),lu=Bl,cu=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var nf={background:Ci(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ci(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ci(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ci("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ci(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ci(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ci("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ci("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ci("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ci(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ci(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ci(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ci(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ci(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Ci(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Ci(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ci(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ci(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ci(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ci(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Ci(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Ci(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Ci(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Ci(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Ci(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ci(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Lp),skyboxGradient:Ci(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Lp),skyboxCapture:Ci(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ci(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ci(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function ta(g,c){const d=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let y of d)if(y=y.trim(),y[0]==="#"&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=y.split(" ");for(const E of b)c.includes(E)||c.push(E)}}function Ci(g,c){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),b={},E=[...Fa];return ta(g,E),ta(c,E),{fragmentSource:g=g.replace(d,(C,M,k,F,B)=>(b[B]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${B}
varying ${k} ${F} ${B};
#else
uniform ${k} ${F} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${k} ${F} ${B} = u_${B};
#endif
`)),vertexSource:c=c.replace(d,(C,M,k,F,B)=>{const U=F==="float"?"vec2":"vec4",X=B.match(/color/)?"color":U;return b[B]?M==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${k} ${U} a_${B};
varying ${k} ${F} ${B};
#else
uniform ${k} ${F} u_${B};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${k} ${F} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${X}(a_${B}, u_${B}_t);
#else
    ${k} ${F} ${B} = u_${B};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${k} ${U} a_${B};
#else
uniform ${k} ${F} u_${B};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${k} ${F} ${B} = a_${B};
#else
    ${k} ${F} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${k} ${F} ${B} = unpack_mix_${X}(a_${B}, u_${B}_t);
#else
    ${k} ${F} ${B} = u_${B};
#endif
`}),staticAttributes:y,usedDefines:E}}class Fl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,d,y,b,E,C,M){this.context=c;let k=this.boundPaintVertexBuffers.length!==b.length;for(let B=0;!k&&B<b.length;B++)this.boundPaintVertexBuffers[B]!==b[B]&&(k=!0);let F=this.boundDynamicVertexBuffers.length!==M.length;for(let B=0;!F&&B<M.length;B++)this.boundDynamicVertexBuffers[B]!==M[B]&&(F=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==y||k||F||this.boundIndexBuffer!==E||this.boundVertexOffset!==C)this.freshBind(d,y,b,E,C,M);else{c.bindVertexArrayOES.set(this.vao);for(const B of M)B&&B.bind();E&&E.dynamicDraw&&E.bind()}}freshBind(c,d,y,b,E,C){let M;const k=c.numAttributes,F=this.context,B=F.gl;if(F.extVertexArrayObject)this.vao&&this.destroy(),this.vao=F.extVertexArrayObject.createVertexArrayOES(),F.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=c,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=b,this.boundVertexOffset=E,this.boundDynamicVertexBuffers=C;else{M=F.currentNumAttributes||0;for(let U=k;U<M;U++)B.disableVertexAttribArray(U)}d.enableAttributes(B,c),d.bind(),d.setVertexAttribPointers(B,c,E);for(const U of y)U.enableAttributes(B,c),U.bind(),U.setVertexAttribPointers(B,c,E);for(const U of C)U&&(U.enableAttributes(B,c),U.bind(),U.setVertexAttribPointers(B,c,E));b&&b.bind(),F.currentNumAttributes=k}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function rf(g,c){const d=Math.pow(2,c.canonical.z),y=c.canonical.y;return[new o.MercatorCoordinate(0,y/d).toLngLat().lat,new o.MercatorCoordinate(0,(y+1)/d).toLngLat().lat]}function Nl(g,c,d,y,b,E,C){const M=g.context,k=M.gl,F=d.fbo;if(!F)return;g.prepareDrawTile();const B=g.useProgram("hillshade");M.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,F.colorAttachment.get());const U=((J,Q,H,le)=>{const ae=H.paint.get("hillshade-shadow-color"),ce=H.paint.get("hillshade-highlight-color"),ve=H.paint.get("hillshade-accent-color");let _e=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);H.paint.get("hillshade-illumination-anchor")==="viewport"&&(_e-=J.transform.angle);const Ee=!J.options.moving;return{u_matrix:le||J.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),Ee),u_image:0,u_latrange:rf(0,Q.tileID),u_light:[H.paint.get("hillshade-exaggeration"),_e],u_shadow:ae,u_highlight:ce,u_accent:ve}})(g,d,y,g.terrain?c.projMatrix:null);g.prepareDrawProgram(M,B,c.toUnwrapped());const{tileBoundsBuffer:X,tileBoundsIndexBuffer:Y,tileBoundsSegments:K}=g.getTileBoundsBuffers(d);B.draw(M,k.TRIANGLES,b,E,C,o.CullFaceMode.disabled,U,y.id,X,Y,K)}function zl(g,c,d){if(!c.needsDEMTextureUpload)return;const y=g.context,b=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||g.getTileTexture(d.stride);const E=d.getPixels();c.demTexture?c.demTexture.update(E,{premultiply:!1}):c.demTexture=new o.Texture(y,E,b.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function uu(g,c,d,y,b,E){const C=g.context,M=C.gl;if(!c.dem)return;const k=c.dem;if(C.activeTexture.set(M.TEXTURE1),zl(g,c,k),!c.demTexture)return;c.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);const F=k.dim;C.activeTexture.set(M.TEXTURE0);let B=c.fbo;if(!B){const K=new o.Texture(C,{width:F,height:F,data:null},M.RGBA);K.bind(M.LINEAR,M.CLAMP_TO_EDGE),B=c.fbo=C.createFramebuffer(F,F,!0),B.colorAttachment.set(K.texture)}C.bindFramebuffer.set(B.framebuffer),C.viewport.set([0,0,F,F]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:X,tileBoundsSegments:Y}=g.getMercatorTileBoundsBuffers();g.useProgram("hillshadePrepare").draw(C,M.TRIANGLES,y,b,E,o.CullFaceMode.disabled,((K,J)=>{const Q=J.stride,H=o.create();return o.ortho(H,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(H,H,[0,-o.EXTENT,0]),{u_matrix:H,u_image:1,u_dimension:[Q,Q],u_zoom:K.overscaledZ,u_unpack:J.unpackVector}})(c.tileID,k),d.id,U,X,Y),c.needsHillshadePrepare=!1}const hu=g=>({u_matrix:new o.UniformMatrix4f(g),u_image0:new o.Uniform1i(g),u_skirt_height:new o.Uniform1f(g)}),sf=(g,c)=>({u_matrix:g,u_image0:0,u_skirt_height:c}),fu=(g,c,d,y,b,E,C,M,k,F,B,U,X,Y,K)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:d,u_zoom_transition:b,u_merc_center:E,u_image0:0,u_frustum_tl:C,u_frustum_tr:M,u_frustum_br:k,u_frustum_bl:F,u_globe_pos:B,u_globe_radius:U,u_viewport:X,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9),u_skirt_height:Y});function of(g,c){return g!=null&&c!=null&&!(!g.hasData()||!c.hasData())&&g.demTexture!=null&&c.demTexture!=null&&g.tileID.key!==c.tileID.key}const ho=new class{constructor(){this.operations={}}newMorphing(g,c,d,y,b){if(g in this.operations){const E=this.operations[g];E.to.tileID.key!==d.tileID.key&&(E.queued=d)}else this.operations[g]={startTime:y,phase:0,duration:b,from:c,to:d,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const c=this.operations[g];return{from:c.from,to:c.to,phase:c.phase}}update(g){for(const c in this.operations){const d=this.operations[c];for(d.phase=(g-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,g)){delete this.operations[c];break}}}_nextOp(g,c){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=c,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},ia={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function du(g){return 6*Math.pow(1.5,22-g)}function af(g,c){const d=1<<g.z;return!c&&(g.x===0||g.x===d-1)||g.y===0||g.y===d-1}const vi=g=>({u_matrix:g});function Ul(g,c,d,y,b){if(b>0){const E=o.exported.now(),C=(E-g.timeAdded)/b,M=c?(E-c.timeAdded)/b:-1,k=d.getSource(),F=y.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),B=!c||Math.abs(c.tileID.overscaledZ-F)>Math.abs(g.tileID.overscaledZ-F),U=B&&g.refreshedUponExpiration?1:o.clamp(B?C:1-M,0,1);return g.refreshedUponExpiration&&C>=1&&(g.refreshedUponExpiration=!1),c?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class zp extends o.SourceCache{constructor(c){const d={type:"raster-dem",maxzoom:c.transform.maxZoom},y=new Xn(Kt(),null),b=ke("mock-dem",d,y,c.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,d){c.state="loaded",d(null)}}class Up extends o.SourceCache{constructor(c){const d=ke("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new Xn(Kt(),null),c.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,d,y){if(c.freezeTileCoverage)return;this.transform=c;const b=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((E,C)=>{if(E[C.key]="",!this._tiles[C.key]){const M=new o.Tile(C,this._source.tileSize*C.overscaleFactor(),c.tileZoom);M.state="loaded",this._tiles[C.key]=M}return E},{});for(const E in this._tiles)E in b||(this.freeFBO(E),this._tiles[E].unloadVectorData(),delete this._tiles[E])}freeFBO(c){const d=this.proxyCachedFBO[c];if(d!==void 0){const y=Object.values(d);this.renderCachePool.push(...y),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class lf extends o.OverscaledTileID{constructor(c,d,y){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=d,this.projMatrix=y}}class cf extends o.Elevation{constructor(c,d){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,b,E]=function(k){const F=new o.StructArrayLayout2i4,B=new o.StructArrayLayout3ui6,U=131;F.reserve(17161),B.reserve(33800);const X=o.EXTENT/128,Y=o.EXTENT+X/2,K=Y+X;for(let Q=-X;Q<K;Q+=X)for(let H=-X;H<K;H+=X){const le=H<0||H>Y||Q<0||Q>Y?24575:0,ae=o.clamp(Math.round(H),0,o.EXTENT),ce=o.clamp(Math.round(Q),0,o.EXTENT);F.emplaceBack(ae+le,ce)}const J=(Q,H)=>{const le=H*U+Q;B.emplaceBack(le+1,le,le+U),B.emplaceBack(le+U,le+U+1,le+1)};for(let Q=1;Q<129;Q++)for(let H=1;H<129;H++)J(H,Q);return[0,129].forEach(Q=>{for(let H=0;H<130;H++)J(H,Q),J(Q,H)}),[F,B,32768]}(),C=c.context;this.gridBuffer=C.createVertexBuffer(y,o.posAttributes.members),this.gridIndexBuffer=C.createIndexBuffer(b),this.gridSegments=o.SegmentVector.simpleSegment(0,0,y.length,b.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,y.length,E),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Up(d.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const M=C.gl;this._overlapStencilMode=new o.StencilMode({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new zp(d.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,d,y){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const b=c.terrain.properties;this.sourceCache=c.terrain.drapeRenderMode===0?this._mockSourceCache:c._getSourceCache(b.get("source")),this._exaggeration=b.get("exaggeration");const E=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const C=this.getScaledDemTileSize();this.sourceCache.update(d,C,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,E(),this._initializing=!0),E(),d.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||c.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&c.dataType==="source"?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):c.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=y._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(y.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=d.getIds().map(k=>{const F=d.getTileByID(k).tileID;return F.projMatrix=y.calculateProjMatrix(F.toUnwrapped()),F});(function(k,F){const B=F.transform.pointCoordinate(F.transform.getCameraPoint()),U=new o.pointGeometry(B.x,B.y);k.sort((X,Y)=>{if(Y.overscaledZ-X.overscaledZ)return Y.overscaledZ-X.overscaledZ;const K=new o.pointGeometry(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),J=new o.pointGeometry(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),Q=U.mult(1<<X.canonical.z);return Q.x-=.5,Q.y-=.5,Q.distSqr(K)-Q.distSqr(J)})})(b,this.painter),this._previousZoom=y.zoom;const E=this.proxyToSource||{};this.proxyToSource={},b.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const C=this._style._sourceCaches;for(const k in C){const F=C[k];if(!F.used||(F!==this.sourceCache&&this.resetTileLookupCache(F.id),this._setupProxiedCoordsForOrtho(F,c[k],E),F.usedForTerrain))continue;const B=c[k];F.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[d.id]=b.map(k=>new lf(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(E),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const M={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const F=this.terrainTileForTile[k.key];if(!F)continue;const B=F.tileID.key;B in M||(this._visibleDemTiles.push(F),M[B]=B)}}_assignTerrainTiles(c){this._initializing||c.forEach(d=>{if(this.terrainTileForTile[d.key])return;const y=this._findTileCoveringTileID(d,this.sourceCache);y&&(this.terrainTileForTile[d.key]=y)})}_prepareDEMTextures(){const c=this.painter.context,d=c.gl;for(const y in this.terrainTileForTile){const b=this.terrainTileForTile[y],E=b.dem;!E||b.demTexture&&!b.needsDEMTextureUpload||(c.activeTexture.set(d.TEXTURE1),zl(this.painter,b,E))}}_prepareDemTileUniforms(c,d,y,b){if(!d||d.demTexture==null)return!1;const E=c.tileID.canonical,C=Math.pow(2,d.tileID.canonical.z-E.z),M=b||"";return y[`u_dem_tl${M}`]=[E.x*C%1,E.y*C%1],y[`u_dem_scale${M}`]=C,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,d=c.gl;if(!this._emptyDepthBufferTexture){const y=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(c,y,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const d=this._visibleDemTiles.reduce((y,b)=>{if(!b.dem)return y;const E=b.dem.tree.minimums[0];return E>0&&c++,y+E},0);return c?d/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,d=c.gl;c.activeTexture.set(d.TEXTURE2);const y=this._getLoadedAreaMinimum(),b=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(y,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(b,{premultiply:!1}):E=this._emptyDEMTexture=new o.Texture(c,b,d.RGBA,{premultiply:!1}),E}setupElevationDraw(c,d,y){const b=this.painter.context,E=b.gl,C=(M=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(M),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var M;C.u_dem_size=this.sourceCache.getSource().tileSize,C.u_exaggeration=this.exaggeration();let k=null,F=null,B=1;if(y&&y.morphing&&this._useVertexMorphing){const U=y.morphing.srcDemTile,X=y.morphing.dstDemTile;B=y.morphing.phase,U&&X&&(this._prepareDemTileUniforms(c,U,C,"_prev")&&(F=U),this._prepareDemTileUniforms(c,X,C)&&(k=X))}if(F&&k?(b.activeTexture.set(E.TEXTURE2),k.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),b.activeTexture.set(E.TEXTURE4),F.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),C.u_dem_lerp=B):(k=this.terrainTileForTile[c.tileID.key],b.activeTexture.set(E.TEXTURE2),(this._prepareDemTileUniforms(c,k,C)?k.demTexture:this.emptyDEMTexture).bind(E.NEAREST,E.CLAMP_TO_EDGE)),b.activeTexture.set(E.TEXTURE3),y&&y.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),this._depthFBO&&(C.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),C.u_depth_size_inv=[1,1]),y&&y.useMeterToDem&&k){const U=(1<<k.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;C.u_meter_to_dem=U}if(y&&y.labelPlaneMatrixInv&&(C.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),d.setTerrainUniformValues(b,C),this.painter.transform.projection.name==="globe"){const U=this.globeUniformValues(this.painter.transform,c.tileID.canonical,y&&y.useDenormalizedUpVectorScale);d.setGlobeUniformValues(b,U)}}globeUniformValues(c,d,y){const b=c.projection;return{u_tile_tl_up:b.upVector(d,0,0),u_tile_tr_up:b.upVector(d,o.EXTENT,0),u_tile_br_up:b.upVector(d,o.EXTENT,o.EXTENT),u_tile_bl_up:b.upVector(d,0,o.EXTENT),u_tile_up_scale:y?o.globeMetersToEcef(1):b.upVectorScale(d,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const d=this.painter,y=this.painter.context;c.length!==0&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,E,C,M,k){if(b.transform.projection.name==="globe")(function(F,B,U,X,Y){const K=F.context,J=K.gl;let Q,H;const le=F.options.showTerrainWireframe?2:0,ae=F.transform,ce=o.globeUseCustomAntiAliasing(F,K,ae),ve=(st,Ue)=>{if(H===st)return;const Ce=[ia[st],"PROJECTION_GLOBE_VIEW"];ce&&Ce.push("CUSTOM_ANTIALIASING"),Ue&&Ce.push(ia[le]),Q=F.useProgram("globeRaster",null,Ce),H=st},_e=F.colorModeForRenderPass(),Ee=new o.DepthMode(J.LEQUAL,o.DepthMode.ReadWrite,F.depthRangeFor3D);ho.update(Y);const Re=o.calculateGlobeMercatorMatrix(ae),ze=[o.mercatorXfromLng(ae.center.lng),o.mercatorYfromLat(ae.center.lat)],je=le?[!1,!0]:[!1],gt=F.globeSharedBuffers,Le=[ae.width*o.exported.devicePixelRatio,ae.height*o.exported.devicePixelRatio],Qe=Float32Array.from(ae.globeMatrix),qe={useDenormalizedUpVectorScale:!0};if(je.forEach(st=>{const Ue=F.transform,Ce=du(Ue.zoom)*B.exaggeration();H=-1;const $e=st?J.LINES:J.TRIANGLES;for(const it of X){const ct=U.getTile(it),Nt=o.StencilMode.disabled,si=B.prevTerrainTileForTile[it.key],Lt=B.terrainTileForTile[it.key];of(si,Lt)&&ho.newMorphing(it.key,si,Lt,Y,250),K.activeTexture.set(J.TEXTURE0),ct.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const Rt=ho.getMorphValuesForProxy(it.key),zt=Rt?1:0;Rt&&o.extend$1(qe,{morphing:{srcDemTile:Rt.from,dstDemTile:Rt.to,phase:o.easeCubicInOut(Rt.phase)}});const hi=o.tileCornersToBounds(it.canonical),Wt=o.getLatitudinalLod(hi.getCenter().lat),Mi=o.getGridMatrix(it.canonical,hi,Wt,Ue.worldSize/Ue._pixelsPerMercatorPixel),Ri=o.globeNormalizeECEF(o.globeTileBounds(it.canonical)),Wi=fu(Ue.projMatrix,Qe,Re,Ri,o.globeToMercatorTransition(Ue.zoom),ze,Ue.frustumCorners.TL,Ue.frustumCorners.TR,Ue.frustumCorners.BR,Ue.frustumCorners.BL,Ue.globeCenterInViewSpace,Ue.globeRadius,Le,Ce,Mi);if(ve(zt,st),B.setupElevationDraw(ct,Q,qe),F.prepareDrawProgram(K,Q,it.toUnwrapped()),gt){const[Vi,Tn,br]=st?gt.getWirefameBuffers(F.context,Wt):gt.getGridBuffers(Wt,Ce!==0);Q.draw(K,$e,Ee,Nt,_e,o.CullFaceMode.backCCW,Wi,"globe_raster",Vi,Tn,br)}}}),gt){const st=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ce&&st.push("CUSTOM_ANTIALIASING"),Q=F.useProgram("globeRaster",null,st);for(const Ue of X){const{x:Ce,y:$e,z:it}=Ue.canonical,ct=$e===0,Nt=$e===(1<<it)-1,[si,Lt,Rt,zt]=gt.getPoleBuffers(it);if(zt&&(ct||Nt)){const hi=U.getTile(Ue);K.activeTexture.set(J.TEXTURE0),hi.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let Wt=o.globePoleMatrixForTile(it,Ce,ae);const Mi=o.globeNormalizeECEF(o.globeTileBounds(Ue.canonical)),Ri=(Wi,Vi)=>Wi.draw(K,J.TRIANGLES,Ee,o.StencilMode.disabled,_e,o.CullFaceMode.disabled,fu(ae.projMatrix,Wt,Wt,Mi,0,ze,ae.frustumCorners.TL,ae.frustumCorners.TR,ae.frustumCorners.BR,ae.frustumCorners.BL,ae.globeCenterInViewSpace,ae.globeRadius,Le,0),"globe_pole_raster",Vi,Rt,zt);B.setupElevationDraw(hi,Q,qe),F.prepareDrawProgram(K,Q,Ue.toUnwrapped()),ct&&Ri(Q,si),Nt&&(Wt=o.scale(o.create(),Wt,[1,-1,1]),Ri(Q,Lt))}}}})(b,E,C,M,k);else{const F=b.context,B=F.gl;let U,X;const Y=b.options.showTerrainWireframe?2:0,K=(ae,ce)=>{if(X===ae)return;const ve=[ia[ae]];ce&&ve.push(ia[Y]),U=b.useProgram("terrainRaster",null,ve),X=ae},J=b.colorModeForRenderPass(),Q=new o.DepthMode(B.LEQUAL,o.DepthMode.ReadWrite,b.depthRangeFor3D);ho.update(k);const H=b.transform,le=du(H.zoom)*E.exaggeration();(Y?[!1,!0]:[!1]).forEach(ae=>{X=-1;const ce=ae?B.LINES:B.TRIANGLES,[ve,_e]=ae?E.getWirefameBuffer():[E.gridIndexBuffer,E.gridSegments];for(const Ee of M){const Re=C.getTile(Ee),ze=o.StencilMode.disabled,je=E.prevTerrainTileForTile[Ee.key],gt=E.terrainTileForTile[Ee.key];of(je,gt)&&ho.newMorphing(Ee.key,je,gt,k,250),F.activeTexture.set(B.TEXTURE0),Re.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST);const Le=ho.getMorphValuesForProxy(Ee.key),Qe=Le?1:0;let qe;Le&&(qe={morphing:{srcDemTile:Le.from,dstDemTile:Le.to,phase:o.easeCubicInOut(Le.phase)}});const st=sf(Ee.projMatrix,af(Ee.canonical,H.renderWorldCopies)?le/10:le);K(Qe,ae),E.setupElevationDraw(Re,U,qe),b.prepareDrawProgram(F,U,Ee.toUnwrapped()),U.draw(F,ce,Q,ze,J,o.CullFaceMode.backCCW,st,"terrain_raster",E.gridBuffer,ve,_e)}})}}(d,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(this._drapedRenderBatches.length===0)return c+1;this.renderingToTexture=!0;const d=this.painter,y=this.painter.context,b=this.proxySourceCache,E=this.proxiedCoords[b.id],C=this._drapedRenderBatches.shift(),M=[],k=d.style.order;let F=0;for(const B of E){const U=b.getTileByID(B.proxyTileKey),X=b.proxyCachedFBO[B.key]?b.proxyCachedFBO[B.key][c]:void 0,Y=X!==void 0?b.renderCache[X]:this.pool[F++],K=X!==void 0;if(U.texture=Y.tex,K&&!Y.dirty){M.push(U.tileID);continue}let J;y.bindFramebuffer.set(Y.fb.framebuffer),this.renderedToTile=!1,Y.dirty&&(y.clear({color:o.Color.transparent,stencil:0}),Y.dirty=!1);for(let Q=C.start;Q<=C.end;++Q){const H=d.style._layers[k[Q]];if(H.isHidden(d.transform.zoom))continue;const le=d.style._getLayerSourceCache(H),ae=le?this.proxyToSource[B.key][le.id]:[B];if(!ae)continue;const ce=ae;y.viewport.set([0,0,Y.fb.width,Y.fb.height]),J!==(le?le.id:null)&&(this._setupStencil(Y,ae,H,le),J=le?le.id:null),d.renderLayer(d,le,H,ce)}this.renderedToTile?(Y.dirty=!0,M.push(U.tileID)):K||--F,F===5&&(F=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height]),C.end+1}postRender(){}renderCacheEfficiency(c){const d=c.order.length;if(d===0)return{efficiency:100};let y,b=0,E=0,C=!1;for(let M=0;M<d;++M){const k=c._layers[c.order[M]];this._style.isLayerDraped(k)?(C&&++b,++E):C||(C=!0,y=k.id)}return E===0?{efficiency:100}:{efficiency:100*(1-b/E),firstUndrapedLayer:y}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{c=Math.min(c,d.dem.tree.minimums[0])}),c===0?c:(c-30)*this._exaggeration}raycast(c,d,y){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(E=>E.dem).map(E=>{const C=E.tileID,M=1<<C.overscaledZ,{x:k,y:F}=C.canonical,B=k/M,U=(k+1)/M,X=F/M,Y=(F+1)/M;return{minx:B,miny:X,maxx:U,maxy:Y,t:E.dem.tree.raycastRoot(B,X,U,Y,c,d,y),tile:E}});b.sort((E,C)=>(E.t!==null?E.t:Number.MAX_VALUE)-(C.t!==null?C.t:Number.MAX_VALUE));for(const E of b){if(E.t==null)return null;const C=E.tile.dem.tree.raycast(E.minx,E.miny,E.maxx,E.maxy,c,d,y);if(C!=null)return C}return null}_createFBO(){const c=this.painter.context,d=c.gl,y=this.drapeBufferSize;c.activeTexture.set(d.TEXTURE0);const b=new o.Texture(c,{width:y[0],height:y[1],data:null},d.RGBA);b.bind(d.LINEAR,d.CLAMP_TO_EDGE);const E=c.createFramebuffer(y[0],y[1],!1);return E.colorAttachment.set(b.texture),E.depthAttachment=new eu(c,E.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,E.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):E.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:E,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const d=this._style._layers[c],y=d.isHidden(this.painter.transform.zoom);return d.type==="custom"?!y&&d.shouldRedrape():!y&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const y of this._style._getSources())if(y instanceof V){c=!0;break}if(!c)return;const d={};for(let y=0;y<this._style.order.length;++y){const b=this._style._layers[this._style.order[y]],E=this._style._getLayerSourceCache(b);if(E&&!d[E.id]&&!b.isHidden(this.painter.transform.zoom)&&b.type==="line"&&b.widthExpression()instanceof o.ZoomDependentExpression){d[E.id]=!0;for(const C of this.proxyCoords){const M=this.proxyToSource[C.key][E.id];if(M)for(const k of M)this._clearRenderCacheForTile(E.id,k)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const y in this._style._sourceCaches)if(this._style._sourceCaches[y]._source instanceof W){c=!0;break}if(!c)return;const d={};for(let y=0;y<this._style.order.length;++y){const b=this._style._layers[this._style.order[y]],E=this._style._getLayerSourceCache(b);if(!E||d[E.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="raster")continue;const C=b.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const k=this.proxyToSource[M.key][E.id];if(k)for(const F of k){const B=Ul(E.getTile(F),E.findLoadedParent(F,0),E,this.painter.transform,C);(B.opacity!==1||B.mix!==0)&&this._clearRenderCacheForTile(E.id,F)}}}}_setupDrapedRenderBatches(){const c=this._style.order,d=c.length;if(d===0)return;const y=[];let b,E=0,C=this._style._layers[c[E]];for(;!this._style.isLayerDraped(C)&&C.isHidden(this.painter.transform.zoom)&&++E<d;)C=this._style._layers[c[E]];for(;E<d;++E){const M=this._style._layers[c[E]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?b===void 0&&(b=E):b!==void 0&&(y.push({start:b,end:E-1}),b=void 0))}b!==void 0&&y.push({start:b,end:E-1}),this._drapedRenderBatches=y}_setupRenderCache(c){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const C=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let M=0;M<C.length;++M){const k=Object.values(C[M]);d.renderCachePool.push(...k)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,b=this._tilesDirty;for(let C=y.length-1;C>=0;C--){const M=y[C];if(d.getTileByID(M.key),d.proxyCachedFBO[M.key]!==void 0){const k=c[M.key],F=this.proxyToSource[M.key];let B=0;for(const U in F){const X=F[U],Y=k[U];if(!Y||Y.length!==X.length||X.some((K,J)=>K!==Y[J]||b[U]&&b[U].hasOwnProperty(K.key))){B=-1;break}++B}for(const U in d.proxyCachedFBO[M.key])d.renderCache[d.proxyCachedFBO[M.key][U]].dirty=B<0||B!==Object.values(k).length}}const E=[...this._drapedRenderBatches];E.sort((C,M)=>M.end-M.start-(C.end-C.start));for(const C of E)for(const M of y){if(d.proxyCachedFBO[M.key])continue;let k=d.renderCachePool.pop();k===void 0&&d.renderCache.length<50&&(k=d.renderCache.length,d.renderCache.push(this._createFBO())),k!==void 0&&(d.proxyCachedFBO[M.key]={},d.proxyCachedFBO[M.key][C.start]=k,d.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(c,d,y,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const E=this.painter.context,C=E.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let M;if(y.isTileClipped())M=d.length,this._overlapStencilMode.test={func:C.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:C.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(E.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(c,d){const y=this.painter,b=this.painter.context,E=b.gl;y._tileClippingMaskIDs={},b.setColorMode(o.ColorMode.disabled),b.setDepthMode(o.DepthMode.disabled);const C=y.useProgram("clippingMask");for(const M of c){const k=y._tileClippingMaskIDs[M.key]=--d;C.draw(b,E.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:E.ALWAYS,mask:0},k,255,E.KEEP,E.KEEP,E.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,vi(M.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(c){const d=this.painter.transform;if(c.x<0||c.x>d.width||c.y<0||c.y>d.height)return null;const y=[c.x,c.y,1,1];o.transformMat4$1(y,y,d.pixelMatrixInverse),o.scale$1(y,y,1/y[3]),y[0]/=d.worldSize,y[1]/=d.worldSize;const b=d._camera.position,E=o.mercatorZfromAltitude(1,d.center.lat),C=[b[0],b[1],b[2]/E,0],M=o.subtract([],y.slice(0,3),C);o.normalize(M,M);const k=this.raycast(C,M,this._exaggeration);return k!==null&&k?(o.scaleAndAdd(C,C,M,k),C[3]=C[2],C[2]*=E,C):null}drawDepth(){const c=this.painter,d=c.context,y=this.proxySourceCache,b=Math.ceil(c.width),E=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===E||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const C=d.gl,M=d.createFramebuffer(b,E,!0);d.activeTexture.set(C.TEXTURE0);const k=new o.Texture(d,{width:b,height:E,data:null},C.RGBA);k.bind(C.NEAREST,C.CLAMP_TO_EDGE),M.colorAttachment.set(k.texture);const F=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,b,E);M.depthAttachment.set(F),this._depthFBO=M,this._depthTexture=k}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,b,E]),function(C,M,k,F){if(C.transform.projection.name==="globe")return;const B=C.context,U=B.gl;B.clear({depth:1});const X=C.useProgram("terrainDepth"),Y=new o.DepthMode(U.LESS,o.DepthMode.ReadWrite,C.depthRangeFor3D);for(const K of F){const J=k.getTile(K),Q=sf(K.projMatrix,0);M.setupElevationDraw(J,X),X.draw(B,U.TRIANGLES,Y,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,Q,"terrain_depth",M.gridBuffer,M.gridIndexBuffer,M.gridNoSkirtSegments)}}(c,this,y,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,d,y){if(c.getSource()instanceof we)return this._setupProxiedCoordsForImageSource(c,d,y);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const b=this.proxiedCoords[c.id]=[],E=this.proxyCoords;for(let M=0;M<E.length;M++){const k=E[M],F=this._findTileCoveringTileID(k,c);if(F){const B=this._createProxiedId(k,F,y[k.key]&&y[k.key][c.id]);b.push(B),this.proxyToSource[k.key][c.id]=[B]}}let C=!1;for(let M=0;M<d.length;M++){const k=c.getTile(d[M]);if(!k||!k.hasData())continue;const F=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==k.tileID.canonical.z){const B=this.proxyToSource[F.tileID.key][c.id],U=this._createProxiedId(F.tileID,k,y[F.tileID.key]&&y[F.tileID.key][c.id]);B?B.splice(B.length-1,0,U):this.proxyToSource[F.tileID.key][c.id]=[U],b.push(U),C=!0}}this._sourceTilesOverlap[c.id]=C}_setupProxiedCoordsForImageSource(c,d,y){if(!c.getSource().loaded())return;const b=this.proxiedCoords[c.id]=[],E=this.proxyCoords,C=c.getSource(),M=new o.pointGeometry(C.tileID.x,C.tileID.y)._div(1<<C.tileID.z),k=C.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((B,U)=>(B.min.x=Math.min(B.min.x,U.x-M.x),B.min.y=Math.min(B.min.y,U.y-M.y),B.max.x=Math.max(B.max.x,U.x-M.x),B.max.y=Math.max(B.max.y,U.y-M.y),B),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(B,U)=>{const X=B.wrap+B.canonical.x/(1<<B.canonical.z),Y=B.canonical.y/(1<<B.canonical.z),K=o.EXTENT/(1<<B.canonical.z),J=U.wrap+U.canonical.x/(1<<U.canonical.z),Q=U.canonical.y/(1<<U.canonical.z);return X+K<J+k.min.x||X>J+k.max.x||Y+K<Q+k.min.y||Y>Q+k.max.y};for(let B=0;B<E.length;B++){const U=E[B];for(let X=0;X<d.length;X++){const Y=c.getTile(d[X]);if(!Y||!Y.hasData()||F(U,Y.tileID))continue;const K=this._createProxiedId(U,Y,y[U.key]&&y[U.key][c.id]),J=this.proxyToSource[U.key][c.id];J?J.push(K):this.proxyToSource[U.key][c.id]=[K],b.push(K)}}}_createProxiedId(c,d,y){let b=this.orthoMatrix;if(y){const E=y.find(C=>C.key===d.tileID.key);if(E)return E}if(d.tileID.key!==c.key){const E=c.canonical.z-d.tileID.canonical.z;let C,M,k;b=o.create();const F=d.tileID.wrap-c.wrap<<c.overscaledZ;E>0?(C=o.EXTENT>>E,M=C*((d.tileID.canonical.x<<E)-c.canonical.x+F),k=C*((d.tileID.canonical.y<<E)-c.canonical.y)):(C=o.EXTENT<<-E,M=o.EXTENT*(d.tileID.canonical.x-(c.canonical.x+F<<-E)),k=o.EXTENT*(d.tileID.canonical.y-(c.canonical.y<<-E))),o.ortho(b,0,C,0,C,0,1),o.translate(b,b,[M,k,0])}return new lf(d.tileID,c.key,b)}_findTileCoveringTileID(c,d){let y=d.getTile(c);if(y&&y.hasData())return y;const b=this._findCoveringTileCache[d.id],E=b[c.key];if(y=E?d.getTileByID(E):null,y&&y.hasData()||E===null)return y;let C=y?y.tileID:c,M=C.overscaledZ;const k=d.getSource().minzoom,F=[];if(!E){const U=d.getSource().maxzoom;if(c.canonical.z>=U){const X=c.canonical.z-U;d.getSource().reparseOverscaled?(M=Math.max(c.canonical.z+2,d.transform.tileZoom),C=new o.OverscaledTileID(M,c.wrap,U,c.canonical.x>>X,c.canonical.y>>X)):X!==0&&(M=U,C=new o.OverscaledTileID(M,c.wrap,U,c.canonical.x>>X,c.canonical.y>>X))}C.key!==c.key&&(F.push(C.key),y=d.getTile(C))}const B=U=>{F.forEach(X=>{b[X]=U}),F.length=0};for(M-=1;M>=k&&(!y||!y.hasData());M--){y&&B(y.tileID.key);const U=C.calculateScaledKey(M);if(y=d.getTileByID(U),y&&y.hasData())break;const X=b[U];if(X===null)break;X===void 0?F.push(U):y=d.getTileByID(X)}return B(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,d){let y=this._tilesDirty[c];y||(y=this._tilesDirty[c]={}),y[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(d){let y=0;const b=new o.StructArrayLayout2ui4,E=131;for(let C=1;C<129;C++){for(let M=1;M<129;M++)y=C*E+M,b.emplaceBack(y,y+1),b.emplaceBack(y,y+E),b.emplaceBack(y+1,y+E),C===128&&b.emplaceBack(y+E,y+E+1);b.emplaceBack(y+1,y+1+E)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class uf{static cacheKey(c,d,y,b){let E=`${d}${b?b.cacheKey:""}`;for(const C of y)c.usedDefines.includes(C)&&(E+=`/${C}`);return E}constructor(c,d,y,b,E,C){const M=c.gl;this.program=M.createProgram();const k=function(H){const le=[];for(let ae=0;ae<H.length;ae++){if(H[ae]===null)continue;const ce=H[ae].split(" ");le.push(ce.pop())}return le}(y.staticAttributes),F=b?b.getBinderAttributes():[],B=k.concat(F);let U=b?b.defines():[];U=U.concat(C.map(H=>`#define ${H}`));const X=c.isWebGL2?`#version 300 es
`:"",Y=X+U.concat(c.extStandardDerivatives&&X.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(cu):cu,cu,lu,Np.fragmentSource,tf.fragmentSource,y.fragmentSource).join(`
`),K=X+U.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,lu,Np.vertexSource,tf.vertexSource,ef.vertexSource,y.vertexSource).join(`
`),J=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(J,Y),M.compileShader(J),M.attachShader(this.program,J);const Q=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(Q,K),M.compileShader(Q),M.attachShader(this.program,Q),this.attributes={},this.numAttributes=B.length;for(let H=0;H<this.numAttributes;H++)B[H]&&(M.bindAttribLocation(this.program,H,B[H]),this.attributes[B[H]]=H);M.linkProgram(this.program),M.deleteShader(Q),M.deleteShader(J),this.fixedUniforms=E(c),this.binderUniforms=b?b.getUniforms(c):[],C.includes("TERRAIN")&&(this.terrainUniforms=(H=>({u_dem:new o.Uniform1i(H),u_dem_prev:new o.Uniform1i(H),u_dem_unpack:new o.Uniform4f(H),u_dem_tl:new o.Uniform2f(H),u_dem_scale:new o.Uniform1f(H),u_dem_tl_prev:new o.Uniform2f(H),u_dem_scale_prev:new o.Uniform1f(H),u_dem_size:new o.Uniform1f(H),u_dem_lerp:new o.Uniform1f(H),u_exaggeration:new o.Uniform1f(H),u_depth:new o.Uniform1i(H),u_depth_size_inv:new o.Uniform2f(H),u_meter_to_dem:new o.Uniform1f(H),u_label_plane_matrix_inv:new o.UniformMatrix4f(H)}))(c)),C.includes("GLOBE")&&(this.globeUniforms=(H=>({u_tile_tl_up:new o.Uniform3f(H),u_tile_tr_up:new o.Uniform3f(H),u_tile_br_up:new o.Uniform3f(H),u_tile_bl_up:new o.Uniform3f(H),u_tile_up_scale:new o.Uniform1f(H)}))(c)),C.includes("FOG")&&(this.fogUniforms=(H=>({u_fog_matrix:new o.UniformMatrix4f(H),u_fog_range:new o.Uniform2f(H),u_fog_color:new o.Uniform4f(H),u_fog_horizon_blend:new o.Uniform1f(H),u_fog_temporal_offset:new o.Uniform1f(H),u_frustum_tl:new o.Uniform3f(H),u_frustum_tr:new o.Uniform3f(H),u_frustum_br:new o.Uniform3f(H),u_frustum_bl:new o.Uniform3f(H),u_globe_pos:new o.Uniform3f(H),u_globe_radius:new o.Uniform1f(H),u_globe_transition:new o.Uniform1f(H),u_is_globe:new o.Uniform1i(H),u_viewport:new o.Uniform2f(H)}))(c))}}setTerrainUniformValues(c,d){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const b in d)y[b]&&y[b].set(this.program,b,d[b])}}setGlobeUniformValues(c,d){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const b in d)y[b]&&y[b].set(this.program,b,d[b])}}setFogUniformValues(c,d){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}}draw(c,d,y,b,E,C,M,k,F,B,U,X,Y,K,J){const Q=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(y),c.setStencilMode(b),c.setColorMode(E),c.setCullFace(C);for(const le of Object.keys(this.fixedUniforms))this.fixedUniforms[le].set(this.program,le,M[le]);K&&K.setUniforms(this.program,c,this.binderUniforms,X,{zoom:Y});const H={[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[d];for(const le of U.get()){const ae=le.vaos||(le.vaos={});(ae[k]||(ae[k]=new Fl)).bind(c,this,F,K?K.getPaintVertexBuffers():[],B,le.vertexOffset,J||[]),Q.drawElements(d,le.primitiveLength*H,Q.UNSIGNED_SHORT,le.primitiveOffset*H*2)}}}function Vp(g,c){const d=Math.pow(2,c.tileID.overscaledZ),y=c.tileSize*Math.pow(2,g.transform.tileZoom)/d,b=y*(c.tileID.canonical.x+c.tileID.wrap*d),E=y*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_tile_units_to_pixels:1/Bn(c,1,g.transform.tileZoom),u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E]}}const $y=o.create(),pu=(g,c,d,y,b,E,C,M,k,F,B)=>{const U=c.style.light,X=U.properties.get("position"),Y=[X.x,X.y,X.z],K=o.create$1();U.properties.get("anchor")==="viewport"&&(o.fromRotation(K,-c.transform.angle),o.transformMat3(Y,Y,K));const J=U.properties.get("color"),Q=c.transform,H={u_matrix:g,u_lightpos:Y,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_vertical_gradient:+d,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$y,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:E};return Q.projection.name==="globe"&&(H.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],H.u_zoom_transition=k,H.u_inv_rot_matrix=B,H.u_merc_center=F,H.u_up_dir=Q.projection.upVector(new o.CanonicalTileID(0,0,0),F[0]*o.EXTENT,F[1]*o.EXTENT),H.u_height_lift=M),H},hf=(g,c,d,y,b,E,C,M,k,F,B,U)=>{const X=pu(g,c,d,y,b,E,C,k,F,B,U),Y={u_height_factor:-Math.pow(2,C.overscaledZ)/M.tileSize/8};return o.extend(X,Vp(c,M),Y)},mu=g=>({u_matrix:g}),gu=(g,c,d)=>o.extend(mu(g),Vp(c,d)),jp=(g,c)=>({u_matrix:g,u_world:c}),$p=(g,c,d,y)=>o.extend(gu(g,c,d),{u_world:y}),Wy=o.create(),Vl=(g,c,d,y,b,E)=>{const C=g.transform,M=C.projection.name==="globe";let k;if(E.paint.get("circle-pitch-alignment")==="map")if(M){const B=o.globePixelsToTileUnits(C.zoom,c.canonical)*C._pixelsPerMercatorPixel;k=Float32Array.from([B,0,0,B])}else k=C.calculatePixelsToTileUnitsMatrix(d);else k=new Float32Array([C.pixelsToGLUnits[0],0,0,C.pixelsToGLUnits[1]]);const F={u_camera_to_center_distance:C.cameraToCenterDistance,u_matrix:g.translatePosMatrix(c.projMatrix,d,E.paint.get("circle-translate"),E.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:k,u_inv_rot_matrix:Wy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){F.u_inv_rot_matrix=y,F.u_merc_center=b,F.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],F.u_zoom_transition=o.globeToMercatorTransition(C.zoom);const B=b[0]*o.EXTENT,U=b[1]*o.EXTENT;F.u_up_dir=C.projection.upVector(new o.CanonicalTileID(0,0,0),B,U)}return F},jl=g=>{const c=[];return g.paint.get("circle-pitch-alignment")==="map"&&c.push("PITCH_WITH_MAP"),g.paint.get("circle-pitch-scale")==="map"&&c.push("SCALE_WITH_MAP"),c},Wp=(g,c,d,y)=>{const b=o.EXTENT/d.tileSize;return{u_matrix:g,u_camera_to_center_distance:c.getCameraToCenterDistance(y),u_extrude_scale:[c.pixelsToGLUnits[0]/b,c.pixelsToGLUnits[1]/b]}},$l=(g,c,d=1)=>({u_matrix:g,u_color:c,u_overlay:0,u_overlay_scale:d}),ff=o.create(),bs=(g,c,d,y,b,E,C)=>{const M=g.transform,k=M.projection.name==="globe",F=k?o.globePixelsToTileUnits(M.zoom,c.canonical)*M._pixelsPerMercatorPixel:Bn(d,1,E),B={u_matrix:c.projMatrix,u_extrude_scale:F,u_intensity:C,u_inv_rot_matrix:ff,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){B.u_inv_rot_matrix=y,B.u_merc_center=b,B.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],B.u_zoom_transition=o.globeToMercatorTransition(M.zoom);const U=b[0]*o.EXTENT,X=b[1]*o.EXTENT;B.u_up_dir=M.projection.upVector(new o.CanonicalTileID(0,0,0),U,X)}return B},df=(g,c,d,y,b,E,C)=>{const M=g.transform,k=M.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:pf(g,c,d,y),u_pixels_to_tile_units:k,u_device_pixel_ratio:E,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:yu(d)?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:_u(c,g.transform),u_alpha_discard_threshold:0,u_trim_offset:C}},Hp=(g,c,d,y,b)=>{const E=g.transform;return{u_matrix:pf(g,c,d,y),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:b,u_image:0,u_tile_units_to_pixels:_u(c,E),u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function _u(g,c){return 1/Bn(g,1,c.tileZoom)}function pf(g,c,d,y){return g.translatePosMatrix(y||c.tileID.projMatrix,c,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}function yu(g){const c=g.paint.get("line-dasharray").value;return c.value||c.kind!=="constant"}const Hy=(g,c,d,y,b,E)=>{return{u_matrix:g,u_tl_parent:c,u_scale_parent:d,u_fade_t:y.mix,u_opacity:y.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(M=b.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(C=b.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:mf(b.paint.get("raster-hue-rotate")),u_perspective_transform:E};var C,M};function mf(g){g*=Math.PI/180;const c=Math.sin(g),d=Math.cos(g);return[(2*d+1)/3,(-Math.sqrt(3)*c-d+1)/3,(Math.sqrt(3)*c-d+1)/3]}const Xp=o.create(),Wl=(g,c,d,y,b,E,C,M,k,F,B,U,X,Y,K,J)=>{const Q=b.transform,H={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:Q.cameraToCenterDistance,u_rotate_symbol:+d,u_aspect_ratio:Q.width/Q.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:C,u_coord_matrix:M,u_is_text:+k,u_pitch_with_map:+y,u_texsize:F,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Xp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Xp,u_up_vector:[0,-1,0]};return J.name==="globe"&&(H.u_tile_id=[B.canonical.x,B.canonical.y,1<<B.canonical.z],H.u_zoom_transition=U,H.u_inv_rot_matrix=Y,H.u_merc_center=X,H.u_camera_forward=Q._camera.forward(),H.u_ecef_origin=o.globeECEFOrigin(Q.globeMatrix,B.toUnwrapped()),H.u_tile_matrix=Float32Array.from(Q.globeMatrix),H.u_up_vector=K),H},qp=(g,c,d,y,b,E,C,M,k,F,B,U,X,Y,K,J,Q)=>o.extend(Wl(g,c,d,y,b,E,C,M,k,F,U,X,Y,K,J,Q),{u_gamma_scale:y?b.transform.cameraToCenterDistance*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:1}),gf=(g,c,d,y,b,E,C,M,k,F,B,U,X,Y,K,J)=>o.extend(qp(g,c,d,y,b,E,C,M,!0,k,!0,B,U,X,Y,K,J),{u_texsize_icon:F,u_texture_icon:1}),Xy=(g,c,d)=>({u_matrix:g,u_opacity:c,u_color:d}),_f=(g,c,d,y,b)=>o.extend(function(E,C,M){const k=C.imageManager.getPattern(E.toString()),{width:F,height:B}=C.imageManager.getPixelSize(),U=Math.pow(2,M.tileID.overscaledZ),X=M.tileSize*Math.pow(2,C.transform.tileZoom)/U,Y=X*(M.tileID.canonical.x+M.tileID.wrap*U),K=X*M.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[F,B],u_pattern_size:k.displaySize,u_tile_units_to_pixels:1/Bn(M,1,C.transform.tileZoom),u_pixel_coord_upper:[Y>>16,K>>16],u_pixel_coord_lower:[65535&Y,65535&K]}}(y,d,b),{u_matrix:g,u_opacity:c}),qy={fillExtrusion:g=>({u_matrix:new o.UniformMatrix4f(g),u_lightpos:new o.Uniform3f(g),u_lightintensity:new o.Uniform1f(g),u_lightcolor:new o.Uniform3f(g),u_vertical_gradient:new o.Uniform1f(g),u_opacity:new o.Uniform1f(g),u_edge_radius:new o.Uniform1f(g),u_ao:new o.Uniform2f(g),u_tile_id:new o.Uniform3f(g),u_zoom_transition:new o.Uniform1f(g),u_inv_rot_matrix:new o.UniformMatrix4f(g),u_merc_center:new o.Uniform2f(g),u_up_dir:new o.Uniform3f(g),u_height_lift:new o.Uniform1f(g)}),fillExtrusionPattern:g=>({u_matrix:new o.UniformMatrix4f(g),u_lightpos:new o.Uniform3f(g),u_lightintensity:new o.Uniform1f(g),u_lightcolor:new o.Uniform3f(g),u_vertical_gradient:new o.Uniform1f(g),u_height_factor:new o.Uniform1f(g),u_edge_radius:new o.Uniform1f(g),u_ao:new o.Uniform2f(g),u_tile_id:new o.Uniform3f(g),u_zoom_transition:new o.Uniform1f(g),u_inv_rot_matrix:new o.UniformMatrix4f(g),u_merc_center:new o.Uniform2f(g),u_up_dir:new o.Uniform3f(g),u_height_lift:new o.Uniform1f(g),u_image:new o.Uniform1i(g),u_texsize:new o.Uniform2f(g),u_pixel_coord_upper:new o.Uniform2f(g),u_pixel_coord_lower:new o.Uniform2f(g),u_tile_units_to_pixels:new o.Uniform1f(g),u_opacity:new o.Uniform1f(g)}),fill:g=>({u_matrix:new o.UniformMatrix4f(g)}),fillPattern:g=>({u_matrix:new o.UniformMatrix4f(g),u_image:new o.Uniform1i(g),u_texsize:new o.Uniform2f(g),u_pixel_coord_upper:new o.Uniform2f(g),u_pixel_coord_lower:new o.Uniform2f(g),u_tile_units_to_pixels:new o.Uniform1f(g)}),fillOutline:g=>({u_matrix:new o.UniformMatrix4f(g),u_world:new o.Uniform2f(g)}),fillOutlinePattern:g=>({u_matrix:new o.UniformMatrix4f(g),u_world:new o.Uniform2f(g),u_image:new o.Uniform1i(g),u_texsize:new o.Uniform2f(g),u_pixel_coord_upper:new o.Uniform2f(g),u_pixel_coord_lower:new o.Uniform2f(g),u_tile_units_to_pixels:new o.Uniform1f(g)}),circle:g=>({u_camera_to_center_distance:new o.Uniform1f(g),u_extrude_scale:new o.UniformMatrix2f(g),u_device_pixel_ratio:new o.Uniform1f(g),u_matrix:new o.UniformMatrix4f(g),u_inv_rot_matrix:new o.UniformMatrix4f(g),u_merc_center:new o.Uniform2f(g),u_tile_id:new o.Uniform3f(g),u_zoom_transition:new o.Uniform1f(g),u_up_dir:new o.Uniform3f(g)}),collisionBox:g=>({u_matrix:new o.UniformMatrix4f(g),u_camera_to_center_distance:new o.Uniform1f(g),u_extrude_scale:new o.Uniform2f(g)}),collisionCircle:g=>({u_matrix:new o.UniformMatrix4f(g),u_inv_matrix:new o.UniformMatrix4f(g),u_camera_to_center_distance:new o.Uniform1f(g),u_viewport_size:new o.Uniform2f(g)}),debug:g=>({u_color:new o.UniformColor(g),u_matrix:new o.UniformMatrix4f(g),u_overlay:new o.Uniform1i(g),u_overlay_scale:new o.Uniform1f(g)}),clippingMask:g=>({u_matrix:new o.UniformMatrix4f(g)}),heatmap:g=>({u_extrude_scale:new o.Uniform1f(g),u_intensity:new o.Uniform1f(g),u_matrix:new o.UniformMatrix4f(g),u_inv_rot_matrix:new o.UniformMatrix4f(g),u_merc_center:new o.Uniform2f(g),u_tile_id:new o.Uniform3f(g),u_zoom_transition:new o.Uniform1f(g),u_up_dir:new o.Uniform3f(g)}),heatmapTexture:g=>({u_image:new o.Uniform1i(g),u_color_ramp:new o.Uniform1i(g),u_opacity:new o.Uniform1f(g)}),hillshade:g=>({u_matrix:new o.UniformMatrix4f(g),u_image:new o.Uniform1i(g),u_latrange:new o.Uniform2f(g),u_light:new o.Uniform2f(g),u_shadow:new o.UniformColor(g),u_highlight:new o.UniformColor(g),u_accent:new o.UniformColor(g)}),hillshadePrepare:g=>({u_matrix:new o.UniformMatrix4f(g),u_image:new o.Uniform1i(g),u_dimension:new o.Uniform2f(g),u_zoom:new o.Uniform1f(g),u_unpack:new o.Uniform4f(g)}),line:g=>({u_matrix:new o.UniformMatrix4f(g),u_pixels_to_tile_units:new o.UniformMatrix2f(g),u_device_pixel_ratio:new o.Uniform1f(g),u_units_to_pixels:new o.Uniform2f(g),u_dash_image:new o.Uniform1i(g),u_gradient_image:new o.Uniform1i(g),u_image_height:new o.Uniform1f(g),u_texsize:new o.Uniform2f(g),u_tile_units_to_pixels:new o.Uniform1f(g),u_alpha_discard_threshold:new o.Uniform1f(g),u_trim_offset:new o.Uniform2f(g)}),linePattern:g=>({u_matrix:new o.UniformMatrix4f(g),u_texsize:new o.Uniform2f(g),u_pixels_to_tile_units:new o.UniformMatrix2f(g),u_device_pixel_ratio:new o.Uniform1f(g),u_image:new o.Uniform1i(g),u_units_to_pixels:new o.Uniform2f(g),u_tile_units_to_pixels:new o.Uniform1f(g),u_alpha_discard_threshold:new o.Uniform1f(g)}),raster:g=>({u_matrix:new o.UniformMatrix4f(g),u_tl_parent:new o.Uniform2f(g),u_scale_parent:new o.Uniform1f(g),u_fade_t:new o.Uniform1f(g),u_opacity:new o.Uniform1f(g),u_image0:new o.Uniform1i(g),u_image1:new o.Uniform1i(g),u_brightness_low:new o.Uniform1f(g),u_brightness_high:new o.Uniform1f(g),u_saturation_factor:new o.Uniform1f(g),u_contrast_factor:new o.Uniform1f(g),u_spin_weights:new o.Uniform3f(g),u_perspective_transform:new o.Uniform2f(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new o.Uniform1i(g),u_is_size_feature_constant:new o.Uniform1i(g),u_size_t:new o.Uniform1f(g),u_size:new o.Uniform1f(g),u_camera_to_center_distance:new o.Uniform1f(g),u_rotate_symbol:new o.Uniform1i(g),u_aspect_ratio:new o.Uniform1f(g),u_fade_change:new o.Uniform1f(g),u_matrix:new o.UniformMatrix4f(g),u_label_plane_matrix:new o.UniformMatrix4f(g),u_coord_matrix:new o.UniformMatrix4f(g),u_is_text:new o.Uniform1i(g),u_pitch_with_map:new o.Uniform1i(g),u_texsize:new o.Uniform2f(g),u_tile_id:new o.Uniform3f(g),u_zoom_transition:new o.Uniform1f(g),u_inv_rot_matrix:new o.UniformMatrix4f(g),u_merc_center:new o.Uniform2f(g),u_camera_forward:new o.Uniform3f(g),u_tile_matrix:new o.UniformMatrix4f(g),u_up_vector:new o.Uniform3f(g),u_ecef_origin:new o.Uniform3f(g),u_texture:new o.Uniform1i(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new o.Uniform1i(g),u_is_size_feature_constant:new o.Uniform1i(g),u_size_t:new o.Uniform1f(g),u_size:new o.Uniform1f(g),u_camera_to_center_distance:new o.Uniform1f(g),u_rotate_symbol:new o.Uniform1i(g),u_aspect_ratio:new o.Uniform1f(g),u_fade_change:new o.Uniform1f(g),u_matrix:new o.UniformMatrix4f(g),u_label_plane_matrix:new o.UniformMatrix4f(g),u_coord_matrix:new o.UniformMatrix4f(g),u_is_text:new o.Uniform1i(g),u_pitch_with_map:new o.Uniform1i(g),u_texsize:new o.Uniform2f(g),u_texture:new o.Uniform1i(g),u_gamma_scale:new o.Uniform1f(g),u_device_pixel_ratio:new o.Uniform1f(g),u_tile_id:new o.Uniform3f(g),u_zoom_transition:new o.Uniform1f(g),u_inv_rot_matrix:new o.UniformMatrix4f(g),u_merc_center:new o.Uniform2f(g),u_camera_forward:new o.Uniform3f(g),u_tile_matrix:new o.UniformMatrix4f(g),u_up_vector:new o.Uniform3f(g),u_ecef_origin:new o.Uniform3f(g),u_is_halo:new o.Uniform1i(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new o.Uniform1i(g),u_is_size_feature_constant:new o.Uniform1i(g),u_size_t:new o.Uniform1f(g),u_size:new o.Uniform1f(g),u_camera_to_center_distance:new o.Uniform1f(g),u_rotate_symbol:new o.Uniform1i(g),u_aspect_ratio:new o.Uniform1f(g),u_fade_change:new o.Uniform1f(g),u_matrix:new o.UniformMatrix4f(g),u_label_plane_matrix:new o.UniformMatrix4f(g),u_coord_matrix:new o.UniformMatrix4f(g),u_is_text:new o.Uniform1i(g),u_pitch_with_map:new o.Uniform1i(g),u_texsize:new o.Uniform2f(g),u_texsize_icon:new o.Uniform2f(g),u_texture:new o.Uniform1i(g),u_texture_icon:new o.Uniform1i(g),u_gamma_scale:new o.Uniform1f(g),u_device_pixel_ratio:new o.Uniform1f(g),u_is_halo:new o.Uniform1i(g)}),background:g=>({u_matrix:new o.UniformMatrix4f(g),u_opacity:new o.Uniform1f(g),u_color:new o.UniformColor(g)}),backgroundPattern:g=>({u_matrix:new o.UniformMatrix4f(g),u_opacity:new o.Uniform1f(g),u_image:new o.Uniform1i(g),u_pattern_tl:new o.Uniform2f(g),u_pattern_br:new o.Uniform2f(g),u_texsize:new o.Uniform2f(g),u_pattern_size:new o.Uniform2f(g),u_pixel_coord_upper:new o.Uniform2f(g),u_pixel_coord_lower:new o.Uniform2f(g),u_tile_units_to_pixels:new o.Uniform1f(g)}),terrainRaster:hu,terrainDepth:hu,skybox:g=>({u_matrix:new o.UniformMatrix4f(g),u_sun_direction:new o.Uniform3f(g),u_cubemap:new o.Uniform1i(g),u_opacity:new o.Uniform1f(g),u_temporal_offset:new o.Uniform1f(g)}),skyboxGradient:g=>({u_matrix:new o.UniformMatrix4f(g),u_color_ramp:new o.Uniform1i(g),u_center_direction:new o.Uniform3f(g),u_radius:new o.Uniform1f(g),u_opacity:new o.Uniform1f(g),u_temporal_offset:new o.Uniform1f(g)}),skyboxCapture:g=>({u_matrix_3f:new o.UniformMatrix3f(g),u_sun_direction:new o.Uniform3f(g),u_sun_intensity:new o.Uniform1f(g),u_color_tint_r:new o.Uniform4f(g),u_color_tint_m:new o.Uniform4f(g),u_luminance:new o.Uniform1f(g)}),globeRaster:g=>({u_proj_matrix:new o.UniformMatrix4f(g),u_globe_matrix:new o.UniformMatrix4f(g),u_normalize_matrix:new o.UniformMatrix4f(g),u_merc_matrix:new o.UniformMatrix4f(g),u_zoom_transition:new o.Uniform1f(g),u_merc_center:new o.Uniform2f(g),u_image0:new o.Uniform1i(g),u_grid_matrix:new o.UniformMatrix3f(g),u_skirt_height:new o.Uniform1f(g),u_frustum_tl:new o.Uniform3f(g),u_frustum_tr:new o.Uniform3f(g),u_frustum_br:new o.Uniform3f(g),u_frustum_bl:new o.Uniform3f(g),u_globe_pos:new o.Uniform3f(g),u_globe_radius:new o.Uniform1f(g),u_viewport:new o.Uniform2f(g)}),globeAtmosphere:g=>({u_frustum_tl:new o.Uniform3f(g),u_frustum_tr:new o.Uniform3f(g),u_frustum_br:new o.Uniform3f(g),u_frustum_bl:new o.Uniform3f(g),u_horizon:new o.Uniform1f(g),u_transition:new o.Uniform1f(g),u_fadeout_range:new o.Uniform1f(g),u_color:new o.Uniform4f(g),u_high_color:new o.Uniform4f(g),u_space_color:new o.Uniform4f(g),u_star_intensity:new o.Uniform1f(g),u_star_density:new o.Uniform1f(g),u_star_size:new o.Uniform1f(g),u_temporal_offset:new o.Uniform1f(g),u_horizon_angle:new o.Uniform1f(g),u_rotation_matrix:new o.UniformMatrix4f(g)})};let na;function Gp(g,c,d,y,b,E,C){const M=g.context,k=M.gl,F=g.transform,B=g.useProgram("collisionBox"),U=[];let X=0,Y=0;for(let ce=0;ce<y.length;ce++){const ve=y[ce],_e=c.getTile(ve),Ee=_e.getBucket(d);if(!Ee)continue;const Re=Yh(ve,Ee,F);let ze=Re;b[0]===0&&b[1]===0||(ze=g.translatePosMatrix(Re,_e,b,E));const je=C?Ee.textCollisionBox:Ee.iconCollisionBox,gt=Ee.collisionCircleArray;if(gt.length>0){const Le=o.create(),Qe=ze;o.mul(Le,Ee.placementInvProjMatrix,F.glCoordMatrix),o.mul(Le,Le,Ee.placementViewportMatrix),U.push({circleArray:gt,circleOffset:Y,transform:Qe,invTransform:Le,projection:Ee.getProjection()}),X+=gt.length/4,Y=X}je&&(g.terrain&&g.terrain.setupElevationDraw(_e,B),B.draw(M,k.LINES,o.DepthMode.disabled,o.StencilMode.disabled,g.colorModeForRenderPass(),o.CullFaceMode.disabled,Wp(ze,F,_e,Ee.getProjection()),d.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,null,F.zoom,null,[je.collisionVertexBuffer,je.collisionVertexBufferExt]))}if(!C||!U.length)return;const K=g.useProgram("collisionCircle"),J=new o.StructArrayLayout2f1f2i16;J.resize(4*X),J._trim();let Q=0;for(const ce of U)for(let ve=0;ve<ce.circleArray.length/4;ve++){const _e=4*ve,Ee=ce.circleArray[_e+0],Re=ce.circleArray[_e+1],ze=ce.circleArray[_e+2],je=ce.circleArray[_e+3];J.emplace(Q++,Ee,Re,ze,je,0),J.emplace(Q++,Ee,Re,ze,je,1),J.emplace(Q++,Ee,Re,ze,je,2),J.emplace(Q++,Ee,Re,ze,je,3)}(!na||na.length<2*X)&&(na=function(ce){const ve=2*ce,_e=new o.StructArrayLayout3ui6;_e.resize(ve),_e._trim();for(let Ee=0;Ee<ve;Ee++){const Re=6*Ee;_e.uint16[Re+0]=4*Ee+0,_e.uint16[Re+1]=4*Ee+1,_e.uint16[Re+2]=4*Ee+2,_e.uint16[Re+3]=4*Ee+2,_e.uint16[Re+4]=4*Ee+3,_e.uint16[Re+5]=4*Ee+0}return _e}(X));const H=M.createIndexBuffer(na,!0),le=M.createVertexBuffer(J,o.collisionCircleLayout.members,!0);for(const ce of U){const ve={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(ae=F).getCameraToCenterDistance(ce.projection),u_viewport_size:[ae.width,ae.height]};K.draw(M,k.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,g.colorModeForRenderPass(),o.CullFaceMode.disabled,ve,d.id,le,H,o.SegmentVector.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,F.zoom)}var ae;le.destroy(),H.destroy()}const yf=o.create();function Zp({width:g,height:c,anchor:d,textOffset:y,textScale:b},E){const{horizontalAlign:C,verticalAlign:M}=o.getAnchorAlignment(d),k=-(C-.5)*g,F=-(M-.5)*c,B=o.evaluateVariableOffset(d,y);return new o.pointGeometry((k/b+B[0])*E,(F/b+B[1])*E)}function Na(g,c,d,y,b,E,C,M,k,F,B){const U=g.text.placedSymbolArray,X=g.text.dynamicLayoutVertexArray,Y=g.icon.dynamicLayoutVertexArray,K={},J=g.getProjection(),Q=tu(M,J,E),H=E.elevation,le=J.upVectorScale(M.canonical,E.center.lat,E.worldSize).metersToTile;X.clear();for(let ae=0;ae<U.length;ae++){const ce=U.get(ae),{tileAnchorX:ve,tileAnchorY:_e,numGlyphs:Ee}=ce,Re=g.allowVerticalPlacement&&!ce.placedOrientation,ze=ce.hidden||!ce.crossTileID||Re?null:y[ce.crossTileID];if(ze){let je=0,gt=0,Le=0;if(H){const Nt=H?H.getAtTileOffset(M,ve,_e):0,[si,Lt,Rt]=J.upVector(M.canonical,ve,_e);je=Nt*si*le,gt=Nt*Lt*le,Le=Nt*Rt*le}let[Qe,qe,st,Ue]=bt(ce.projectedAnchorX+je,ce.projectedAnchorY+gt,ce.projectedAnchorZ+Le,d?Q:C);const Ce=mi(E.getCameraToCenterDistance(J),Ue);let $e=b.evaluateSizeForFeature(g.textSizeData,F,ce)*Ce/o.ONE_EM;d&&($e*=g.tilePixelRatio/k);const it=Zp(ze,$e);d?({x:Qe,y:qe,z:st}=J.projectTilePoint(ve+it.x,_e+it.y,M.canonical),[Qe,qe,st]=bt(Qe+je,qe+gt,st+Le,C)):(c&&it._rotate(-E.angle),Qe+=it.x,qe+=it.y,st=0);const ct=g.allowVerticalPlacement&&ce.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Nt=0;Nt<Ee;Nt++)o.addDynamicAttributes(X,Qe,qe,st,ct);B&&ce.associatedIconIndex>=0&&(K[ce.associatedIconIndex]={x:Qe,y:qe,z:st,angle:ct})}else $i(Ee,X)}if(B){Y.clear();const ae=g.icon.placedSymbolArray;for(let ce=0;ce<ae.length;ce++){const ve=ae.get(ce),{numGlyphs:_e}=ve,Ee=K[ce];if(ve.hidden||!Ee)$i(_e,Y);else{const{x:Re,y:ze,z:je,angle:gt}=Ee;for(let Le=0;Le<_e;Le++)o.addDynamicAttributes(Y,Re,ze,je,gt)}}g.icon.dynamicLayoutVertexBuffer.updateData(Y)}g.text.dynamicLayoutVertexBuffer.updateData(X)}function Gy(g,c,d){return d.iconsInText&&c?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Yp(g,c,d,y,b,E,C,M,k,F,B,U){const X=g.context,Y=X.gl,K=g.transform,J=M==="map",Q=k==="map",H=J&&d.layout.get("symbol-placement")!=="point",le=J&&!Q&&!H,ae=d.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ce=!1;const ve=g.depthModeForSublayer(0,o.DepthMode.ReadOnly),_e=[o.mercatorXfromLng(K.center.lng),o.mercatorYfromLat(K.center.lat)],Ee=d.layout.get("text-variable-anchor"),Re=K.projection.name==="globe",ze=[],je=[0,-1,0];let gt=je;!Re&&!K.mercatorFromTransition||J||(gt=function(Le){const Qe=Le._camera.getWorldToCamera(Le.worldSize,1),qe=o.multiply([],Qe,Le.globeMatrix);o.invert(qe,qe);const st=[0,0,0],Ue=[0,1,0,0];return o.transformMat4$1(Ue,Ue,qe),st[0]=Ue[0],st[1]=Ue[1],st[2]=Ue[2],o.normalize(st,st),st}(K));for(const Le of y){const Qe=c.getTile(Le),qe=Qe.getBucket(d);if(!qe||qe.projection.name==="mercator"&&Re)continue;const st=b?qe.text:qe.icon;if(!st||qe.fullyClipped||!st.segments.get().length)continue;const Ue=st.programConfigurations.get(d.id),Ce=b||qe.sdfIcons,$e=b?qe.textSizeData:qe.iconSizeData,it=Q||K.pitch!==0,ct=o.evaluateSizeForZoom($e,K.zoom);let Nt,si,Lt,Rt,zt=[0,0],hi=null;if(b){if(si=Qe.glyphAtlasTexture,Lt=Y.LINEAR,Nt=Qe.glyphAtlasTexture.size,qe.iconsInText){zt=Qe.imageAtlasTexture.size,hi=Qe.imageAtlasTexture;const Br=$e.kind==="composite"||$e.kind==="camera";Rt=it||g.options.rotating||g.options.zooming||Br?Y.LINEAR:Y.NEAREST}}else{const Br=d.layout.get("icon-size").constantOr(0)!==1||qe.iconsNeedLinear;si=Qe.imageAtlasTexture,Lt=Ce||g.options.rotating||g.options.zooming||Br||it?Y.LINEAR:Y.NEAREST,Nt=Qe.imageAtlasTexture.size}const Wt=qe.projection.name==="globe",Mi=Wt?gt:je,Ri=Wt?o.globeToMercatorTransition(K.zoom):0,Wi=tu(Le,qe.getProjection(),K),Vi=K.calculatePixelsToTileUnitsMatrix(Qe),Tn=Ma(Wi,Qe.tileID.canonical,Q,J,K,qe.getProjection(),Vi),br=g.terrain&&Q&&H?o.invert(o.create(),Tn):yf,ss=Ra(Wi,Qe.tileID.canonical,Q,J,K,qe.getProjection(),Vi),Us=Ee&&qe.hasTextData(),nn=d.layout.get("icon-text-fit")!=="none"&&Us&&qe.hasIconData();if(H){const Br=K.elevation,qr=Br?Br.getAtTileOffsetFunc(Le,K.center.lat,K.worldSize,qe.getProjection()):null,Vs=Pp(Wi,Qe.tileID.canonical,Q,J,K,qe.getProjection(),Vi);vs(qe,Wi,g,b,Vs,ss,Q,F,qr,Le)}const ji=H||b&&Ee||nn,Ai=g.translatePosMatrix(Wi,Qe,E,C),fn=ji?yf:Tn,rr=g.translatePosMatrix(ss,Qe,E,C,!0),Zi=qe.getProjection().createInversionMatrix(K,Le.canonical),sr=[];g.terrainRenderModeElevated()&&Q&&sr.push("PITCH_WITH_MAP_TERRAIN"),Wt&&sr.push("PROJECTION_GLOBE_VIEW"),ji&&sr.push("PROJECTED_POS_ON_VIEWPORT");const or=Ce&&d.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let po;po=Ce?qe.iconsInText?gf($e.kind,ct,le,Q,g,Ai,fn,rr,Nt,zt,Le,Ri,_e,Zi,Mi,qe.getProjection()):qp($e.kind,ct,le,Q,g,Ai,fn,rr,b,Nt,!0,Le,Ri,_e,Zi,Mi,qe.getProjection()):Wl($e.kind,ct,le,Q,g,Ai,fn,rr,b,Nt,Le,Ri,_e,Zi,Mi,qe.getProjection());const Za={program:g.useProgram(Gy(Ce,b,qe),Ue,sr),buffers:st,uniformValues:po,atlasTexture:si,atlasTextureIcon:hi,atlasInterpolation:Lt,atlasInterpolationIcon:Rt,isSDF:Ce,hasHalo:or,tile:Qe,labelPlaneMatrixInv:br};if(ae&&qe.canOverlap){ce=!0;const Br=st.segments.get();for(const qr of Br)ze.push({segments:new o.SegmentVector([qr]),sortKey:qr.sortKey,state:Za})}else ze.push({segments:st.segments,sortKey:0,state:Za})}ce&&ze.sort((Le,Qe)=>Le.sortKey-Qe.sortKey);for(const Le of ze){const Qe=Le.state;if(g.terrain&&g.terrain.setupElevationDraw(Qe.tile,Qe.program,{useDepthForOcclusion:!Re,labelPlaneMatrixInv:Qe.labelPlaneMatrixInv}),X.activeTexture.set(Y.TEXTURE0),Qe.atlasTexture.bind(Qe.atlasInterpolation,Y.CLAMP_TO_EDGE),Qe.atlasTextureIcon&&(X.activeTexture.set(Y.TEXTURE1),Qe.atlasTextureIcon&&Qe.atlasTextureIcon.bind(Qe.atlasInterpolationIcon,Y.CLAMP_TO_EDGE)),Qe.isSDF){const qe=Qe.uniformValues;Qe.hasHalo&&(qe.u_is_halo=1,Kp(Qe.buffers,Le.segments,d,g,Qe.program,ve,B,U,qe)),qe.u_is_halo=0}Kp(Qe.buffers,Le.segments,d,g,Qe.program,ve,B,U,Qe.uniformValues)}}function Kp(g,c,d,y,b,E,C,M,k){const F=y.context,B=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.globeExtVertexBuffer];b.draw(F,F.gl.TRIANGLES,E,C,M,o.CullFaceMode.disabled,k,d.id,g.layoutVertexBuffer,g.indexBuffer,c,d.paint,y.transform.zoom,g.programConfigurations.get(d.id),B)}function Jp(g,c,d,y,b,E,C){const M=g.context.gl,k=d.paint.get("fill-pattern"),F=k&&k.constantOr(1);let B,U,X,Y,K;C?(U=F&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=M.LINES):(U=F?"fillPattern":"fill",B=M.TRIANGLES);for(const J of y){const Q=c.getTile(J);if(F&&!Q.patternsLoaded())continue;const H=Q.getBucket(d);if(!H)continue;g.prepareDrawTile();const le=H.programConfigurations.get(d.id),ae=g.useProgram(U,le);F&&(g.context.activeTexture.set(M.TEXTURE0),Q.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),le.updatePaintBuffers());const ce=k.constantOr(null);if(ce&&Q.imageAtlas){const _e=Q.imageAtlas.patternPositions[ce.toString()];_e&&le.setConstantPatternPositions(_e)}const ve=g.translatePosMatrix(J.projMatrix,Q,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(C){Y=H.indexBuffer2,K=H.segments2;const _e=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];X=U==="fillOutlinePattern"&&F?$p(ve,g,Q,_e):jp(ve,_e)}else Y=H.indexBuffer,K=H.segments,X=F?gu(ve,g,Q):mu(ve);g.prepareDrawProgram(g.context,ae,J.toUnwrapped()),ae.draw(g.context,B,b,g.stencilModeForClipping(J),E,o.CullFaceMode.disabled,X,d.id,H.layoutVertexBuffer,Y,K,d.paint,g.transform.zoom,le)}}function xf(g,c,d,y,b,E,C){const M=g.context,k=M.gl,F=g.transform,B=d.paint.get("fill-extrusion-pattern"),U=B.constantOr(1),X=d.paint.get("fill-extrusion-opacity"),Y=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),d.paint.get("fill-extrusion-ambient-occlusion-radius")],K=d.layout.get("fill-extrusion-edge-radius"),J=F.projection.name==="globe"?o.fillExtrusionHeightLift():0,Q=F.projection.name==="globe",H=Q?o.globeToMercatorTransition(F.zoom):0,le=[o.mercatorXfromLng(F.center.lng),o.mercatorYfromLat(F.center.lat)],ae=[];Q&&ae.push("PROJECTION_GLOBE_VIEW"),Y[0]>0&&ae.push("FAUX_AO");for(const ce of y){const ve=c.getTile(ce),_e=ve.getBucket(d);if(!_e||_e.projection.name!==F.projection.name)continue;const Ee=_e.programConfigurations.get(d.id),Re=g.useProgram(U?"fillExtrusionPattern":"fillExtrusion",Ee,ae);if(g.terrain){const st=g.terrain;if(g.style.terrainSetForDrapingOnly())st.setupElevationDraw(ve,Re,{useMeterToDem:!0});else{if(!_e.enableTerrain)continue;if(st.setupElevationDraw(ve,Re,{useMeterToDem:!0}),Zy(M,c,ce,_e,d,st),!_e.centroidVertexBuffer){const Ue=Re.attributes.a_centroid_pos;Ue!==void 0&&k.vertexAttrib2f(Ue,0,0)}}}U&&(g.context.activeTexture.set(k.TEXTURE0),ve.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Ee.updatePaintBuffers());const ze=B.constantOr(null);if(ze&&ve.imageAtlas){const st=ve.imageAtlas.patternPositions[ze.toString()];st&&Ee.setConstantPatternPositions(st)}const je=g.translatePosMatrix(ce.projMatrix,ve,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),gt=F.projection.createInversionMatrix(F,ce.canonical),Le=d.paint.get("fill-extrusion-vertical-gradient"),Qe=U?hf(je,g,Le,X,Y,K,ce,ve,J,H,le,gt):pu(je,g,Le,X,Y,K,ce,J,H,le,gt);g.prepareDrawProgram(M,Re,ce.toUnwrapped());const qe=[];g.terrain&&qe.push(_e.centroidVertexBuffer),Q&&qe.push(_e.layoutVertexExtBuffer),Re.draw(M,M.gl.TRIANGLES,b,E,C,o.CullFaceMode.backCCW,Qe,d.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,d.paint,g.transform.zoom,Ee,qe)}}function Zy(g,c,d,y,b,E){const C=[H=>{let le=H.canonical.x-1,ae=H.wrap;return le<0&&(le=(1<<H.canonical.z)-1,ae--),new o.OverscaledTileID(H.overscaledZ,ae,H.canonical.z,le,H.canonical.y)},H=>{let le=H.canonical.x+1,ae=H.wrap;return le===1<<H.canonical.z&&(le=0,ae++),new o.OverscaledTileID(H.overscaledZ,ae,H.canonical.z,le,H.canonical.y)},H=>new o.OverscaledTileID(H.overscaledZ,H.wrap,H.canonical.z,H.canonical.x,(H.canonical.y===0?1<<H.canonical.z:H.canonical.y)-1),H=>new o.OverscaledTileID(H.overscaledZ,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y===(1<<H.canonical.z)-1?0:H.canonical.y+1)],M=H=>{const le=c.getSource().minzoom,ae=ve=>{const _e=c.getTileByID(ve);if(_e&&_e.hasData())return _e.getBucket(b)},ce=[0,-1,1];for(const ve of ce){if(H.overscaledZ+ve<le)continue;const _e=ae(H.calculateScaledKey(H.overscaledZ+ve));if(_e)return _e}},k=[0,0,0],F=(H,le)=>(k[0]=Math.min(H.min.y,le.min.y),k[1]=Math.max(H.max.y,le.max.y),k[2]=o.EXTENT-le.min.x>H.max.x?le.min.x-o.EXTENT:H.max.x,k),B=(H,le)=>(k[0]=Math.min(H.min.x,le.min.x),k[1]=Math.max(H.max.x,le.max.x),k[2]=o.EXTENT-le.min.y>H.max.y?le.min.y-o.EXTENT:H.max.y,k),U=[(H,le)=>F(H,le),(H,le)=>F(le,H),(H,le)=>B(H,le),(H,le)=>B(le,H)],X=new o.pointGeometry(0,0);let Y,K,J;const Q=(H,le,ae,ce,ve)=>{const _e=[[ce?ae:H,ce?H:ae,0],[ce?ae:le,ce?le:ae,0]],Ee=ve<0?o.EXTENT+ve:ve,Re=[ce?Ee:(H+le)/2,ce?(H+le)/2:Ee,0];return ae===0&&ve<0||ae!==0&&ve>0?E.getForTilePoints(J,[Re],!0,K):_e.push(Re),E.getForTilePoints(d,_e,!0,Y),Math.max(_e[0][2],_e[1][2],Re[2])/E.exaggeration()};for(let H=0;H<4;H++){const le=(H<2?1:5)-H,ae=y.borders[H];if(ae.length===0)continue;const ce=J=C[H](d),ve=M(ce);if(!(ve&&ve instanceof o.FillExtrusionBucket&&ve.enableTerrain)||y.borderDoneWithNeighborZ[H]===ve.canonical.z&&ve.borderDoneWithNeighborZ[le]===y.canonical.z||(K=E.findDEMTileFor(ce),!K||!K.dem))continue;if(!Y){const ze=E.findDEMTileFor(d);if(!ze||!ze.dem)return;Y=ze}const _e=ve.borders[le];let Ee=0;const Re=ve.borderDoneWithNeighborZ[le]!==y.canonical.z;if(y.canonical.z===ve.canonical.z){for(let ze=0;ze<ae.length;ze++){const je=y.featuresOnBorder[ae[ze]],gt=je.borders[H];let Le;for(;Ee<_e.length&&(Le=ve.featuresOnBorder[_e[Ee]],!(Le.borders[le][1]>gt[0]+3));)Re&&ve.encodeCentroid(void 0,Le,!1),Ee++;if(Le&&Ee<_e.length){const Qe=Ee;let qe=0;for(;!(Le.borders[le][0]>gt[1]-3)&&(qe++,++Ee!==_e.length);)Le=ve.featuresOnBorder[_e[Ee]];if(Le=ve.featuresOnBorder[_e[Qe]],je.intersectsCount()>1||Le.intersectsCount()>1||qe!==1){qe!==1&&(Ee=Qe),y.encodeCentroid(void 0,je,!1),Re&&ve.encodeCentroid(void 0,Le,!1);continue}const st=U[H](je,Le),Ue=H%2?o.EXTENT-1:0;X.x=Q(st[0],Math.min(o.EXTENT-1,st[1]),Ue,H<2,st[2]),X.y=0,y.encodeCentroid(X,je,!1),Re&&ve.encodeCentroid(X,Le,!1)}else y.encodeCentroid(void 0,je,!1)}y.borderDoneWithNeighborZ[H]=ve.canonical.z,y.needsCentroidUpdate=!0,Re&&(ve.borderDoneWithNeighborZ[le]=y.canonical.z,ve.needsCentroidUpdate=!0)}else{for(const ze of ae)y.encodeCentroid(void 0,y.featuresOnBorder[ze],!1);if(Re){for(const ze of _e)ve.encodeCentroid(void 0,ve.featuresOnBorder[ze],!1);ve.borderDoneWithNeighborZ[le]=y.canonical.z,ve.needsCentroidUpdate=!0}y.borderDoneWithNeighborZ[H]=ve.canonical.z,y.needsCentroidUpdate=!0}}(y.needsCentroidUpdate||!y.centroidVertexBuffer&&y.centroidVertexArray.length!==0)&&y.uploadCentroid(g)}const vf=new o.Color(1,0,0,1),bf=new o.Color(0,1,0,1),Qp=new o.Color(0,0,1,1),em=new o.Color(1,0,1,1),tm=new o.Color(0,1,1,1);function wf(g,c,d){const y=g.context,b=g.transform,E=y.gl,C=b.projection.name==="globe",M=C?["PROJECTION_GLOBE_VIEW"]:null;let k=d.projMatrix;if(C&&o.globeToMercatorTransition(b.zoom)>0){const je=o.transitionTileAABBinECEF(d.canonical,b),gt=o.globeDenormalizeECEF(je);k=o.multiply(new Float32Array(16),b.globeMatrix,gt),o.multiply(k,b.projMatrix,k)}const F=g.useProgram("debug",null,M),B=c.getTileByID(d.key);g.terrain&&g.terrain.setupElevationDraw(B,F);const U=o.DepthMode.disabled,X=o.StencilMode.disabled,Y=g.colorModeForRenderPass(),K="$debug";y.activeTexture.set(E.TEXTURE0),g.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),C?B._makeGlobeTileDebugBuffers(g.context,b):B._makeDebugTileBoundsBuffers(g.context,b.projection);const J=B._tileDebugBuffer||g.debugBuffer,Q=B._tileDebugIndexBuffer||g.debugIndexBuffer,H=B._tileDebugSegments||g.debugSegments;F.draw(y,E.LINE_STRIP,U,X,Y,o.CullFaceMode.disabled,$l(k,o.Color.red),K,J,Q,H,null,null,null,[B._globeTileDebugBorderBuffer]);const le=B.latestRawTileData,ae=Math.floor((le&&le.byteLength||0)/1024),ce=c.getTile(d).tileSize,ve=512/Math.min(ce,512)*(d.overscaledZ/b.zoom)*.5;let _e=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(_e+=` => ${d.overscaledZ}`),_e+=` ${ae}kb`,function(je,gt){je.initDebugOverlayCanvas();const Le=je.debugOverlayCanvas,Qe=je.context.gl,qe=je.debugOverlayCanvas.getContext("2d");qe.clearRect(0,0,Le.width,Le.height),qe.shadowColor="white",qe.shadowBlur=2,qe.lineWidth=1.5,qe.strokeStyle="white",qe.textBaseline="top",qe.font="bold 36px Open Sans, sans-serif",qe.fillText(gt,5,5),qe.strokeText(gt,5,5),je.debugOverlayTexture.update(Le),je.debugOverlayTexture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE)}(g,_e);const Ee=B._tileDebugTextBuffer||g.debugBuffer,Re=B._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,ze=B._tileDebugTextSegments||g.debugSegments;F.draw(y,E.TRIANGLES,U,X,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,$l(k,o.Color.transparent,ve),K,Ee,Re,ze,null,null,null,[B._globeTileDebugTextBuffer])}function fo(g,c,d,y){Hl(g,0,c+d/2,g.transform.width,d,y)}function za(g,c,d,y){Hl(g,c-d/2,0,d,g.transform.height,y)}function Hl(g,c,d,y,b,E){const C=g.context,M=C.gl;M.enable(M.SCISSOR_TEST),M.scissor(c*o.exported.devicePixelRatio,d*o.exported.devicePixelRatio,y*o.exported.devicePixelRatio,b*o.exported.devicePixelRatio),C.clear({color:E}),M.disable(M.SCISSOR_TEST)}const Ua=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Va}=Ua;function Ns(g,c,d,y){g.emplaceBack(c,d,y)}class xu{constructor(c){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,Ns(this.vertexArray,-1,-1,1),Ns(this.vertexArray,1,-1,1),Ns(this.vertexArray,-1,1,1),Ns(this.vertexArray,1,1,1),Ns(this.vertexArray,-1,-1,-1),Ns(this.vertexArray,1,-1,-1),Ns(this.vertexArray,-1,1,-1),Ns(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,Va),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function _i(g,c,d,y,b,E){const C=g.gl,M=c.paint.get("sky-atmosphere-color"),k=c.paint.get("sky-atmosphere-halo-color"),F=c.paint.get("sky-atmosphere-sun-intensity"),B=((U,X,Y,K,J)=>({u_matrix_3f:U,u_sun_direction:X,u_sun_intensity:Y,u_color_tint_r:[K.r,K.g,K.b,K.a],u_color_tint_m:[J.r,J.g,J.b,J.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),y),b,F,M,k);C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+E,c.skyboxTexture,0),d.draw(g,C.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,B,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const vu=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Yy{constructor(c){const d=new o.StructArrayLayout5f20;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const y=new o.StructArrayLayout3ui6;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(d,vu.members),this.indexBuffer=c.createIndexBuffer(y),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Tf={symbol:function(g,c,d,y,b){if(g.renderPass!=="translucent")return;const E=o.StencilMode.disabled,C=g.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(M,k,F,B,U,X,Y){const K=k.transform,J=U==="map",Q=X==="map";for(const H of M){const le=B.getTile(H),ae=le.getBucket(F);if(!ae||!ae.text||!ae.text.segments.get().length)continue;const ce=o.evaluateSizeForZoom(ae.textSizeData,K.zoom),ve=tu(H,ae.getProjection(),K),_e=K.calculatePixelsToTileUnitsMatrix(le),Ee=Ma(ve,le.tileID.canonical,Q,J,K,ae.getProjection(),_e),Re=F.layout.get("icon-text-fit")!=="none"&&ae.hasIconData();if(ce){const ze=Math.pow(2,K.zoom-le.tileID.overscaledZ);Na(ae,J,Q,Y,o.symbolSize,K,Ee,H,ze,ce,Re)}}}(y,g,d,c,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),b),d.paint.get("icon-opacity").constantOr(1)!==0&&Yp(g,c,d,y,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),E,C),d.paint.get("text-opacity").constantOr(1)!==0&&Yp(g,c,d,y,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),E,C),c.map.showCollisionBoxes&&(Gp(g,c,d,y,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),Gp(g,c,d,y,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(g,c,d,y){if(g.renderPass!=="translucent")return;const b=d.paint.get("circle-opacity"),E=d.paint.get("circle-stroke-width"),C=d.paint.get("circle-stroke-opacity"),M=d.layout.get("circle-sort-key").constantOr(1)!==void 0;if(b.constantOr(1)===0&&(E.constantOr(1)===0||C.constantOr(1)===0))return;const k=g.context,F=k.gl,B=g.transform,U=g.depthModeForSublayer(0,o.DepthMode.ReadOnly),X=o.StencilMode.disabled,Y=g.colorModeForRenderPass(),K=B.projection.name==="globe",J=[o.mercatorXfromLng(B.center.lng),o.mercatorYfromLat(B.center.lat)],Q=[];for(let le=0;le<y.length;le++){const ae=y[le],ce=c.getTile(ae),ve=ce.getBucket(d);if(!ve||ve.projection.name!==B.projection.name)continue;const _e=ve.programConfigurations.get(d.id),Ee=jl(d);K&&Ee.push("PROJECTION_GLOBE_VIEW");const Re=g.useProgram("circle",_e,Ee),ze=ve.layoutVertexBuffer,je=ve.globeExtVertexBuffer,gt=ve.indexBuffer,Le=B.projection.createInversionMatrix(B,ae.canonical),Qe={programConfiguration:_e,program:Re,layoutVertexBuffer:ze,globeExtVertexBuffer:je,indexBuffer:gt,uniformValues:Vl(g,ae,ce,Le,J,d),tile:ce};if(M){const qe=ve.segments.get();for(const st of qe)Q.push({segments:new o.SegmentVector([st]),sortKey:st.sortKey,state:Qe})}else Q.push({segments:ve.segments,sortKey:0,state:Qe})}M&&Q.sort((le,ae)=>le.sortKey-ae.sortKey);const H={useDepthForOcclusion:!K};for(const le of Q){const{programConfiguration:ae,program:ce,layoutVertexBuffer:ve,globeExtVertexBuffer:_e,indexBuffer:Ee,uniformValues:Re,tile:ze}=le.state,je=le.segments;g.terrain&&g.terrain.setupElevationDraw(ze,ce,H),g.prepareDrawProgram(k,ce,ze.tileID.toUnwrapped()),ce.draw(k,F.TRIANGLES,U,X,Y,o.CullFaceMode.disabled,Re,d.id,ve,Ee,je,d.paint,B.zoom,ae,[_e])}},heatmap:function(g,c,d,y){if(d.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const b=g.context,E=b.gl,C=o.StencilMode.disabled,M=new o.ColorMode([E.ONE,E.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(Y,K,J,Q){const H=Y.gl,le=K.width*Q,ae=K.height*Q;Y.activeTexture.set(H.TEXTURE1),Y.viewport.set([0,0,le,ae]);let ce=J.heatmapFbo;if(!ce||ce&&(ce.width!==le||ce.height!==ae)){ce&&ce.destroy();const ve=H.createTexture();H.bindTexture(H.TEXTURE_2D,ve),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MAG_FILTER,H.LINEAR),ce=J.heatmapFbo=Y.createFramebuffer(le,ae,!1),function(_e,Ee,Re,ze,je,gt){const Le=_e.gl;Le.texImage2D(Le.TEXTURE_2D,0,_e.isWebGL2&&_e.extRenderToTextureHalfFloat?Le.RGBA16F:Le.RGBA,je,gt,0,Le.RGBA,_e.extRenderToTextureHalfFloat?_e.isWebGL2?Le.HALF_FLOAT:_e.extTextureHalfFloat.HALF_FLOAT_OES:Le.UNSIGNED_BYTE,null),ze.colorAttachment.set(Re)}(Y,0,ve,ce,le,ae)}else H.bindTexture(H.TEXTURE_2D,ce.colorAttachment.get()),Y.bindFramebuffer.set(ce.framebuffer)})(b,g,d,g.transform.projection.name==="globe"?.5:.25),b.clear({color:o.Color.transparent});const k=g.transform,F=k.projection.name==="globe",B=F?["PROJECTION_GLOBE_VIEW"]:null,U=F?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,X=[o.mercatorXfromLng(k.center.lng),o.mercatorYfromLat(k.center.lat)];for(let Y=0;Y<y.length;Y++){const K=y[Y];if(c.hasRenderableParent(K))continue;const J=c.getTile(K),Q=J.getBucket(d);if(!Q||Q.projection.name!==k.projection.name)continue;const H=Q.programConfigurations.get(d.id),le=g.useProgram("heatmap",H,B),{zoom:ae}=g.transform;g.terrain&&g.terrain.setupElevationDraw(J,le),g.prepareDrawProgram(b,le,K.toUnwrapped());const ce=k.projection.createInversionMatrix(k,K.canonical);le.draw(b,E.TRIANGLES,o.DepthMode.disabled,C,M,U,bs(g,K,J,ce,X,ae,d.paint.get("heatmap-intensity")),d.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,d.paint,g.transform.zoom,H,F?[Q.globeExtVertexBuffer]:null)}b.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(b,E){const C=b.context,M=C.gl,k=E.heatmapFbo;if(!k)return;C.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,k.colorAttachment.get()),C.activeTexture.set(M.TEXTURE1);let F=E.colorRampTexture;F||(F=E.colorRampTexture=new o.Texture(C,E.colorRamp,M.RGBA)),F.bind(M.LINEAR,M.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(C,M.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,b.colorModeForRenderPass(),o.CullFaceMode.disabled,((B,U,X,Y)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,E),E.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,E.paint,b.transform.zoom)}(g,d))},line:function(g,c,d,y){if(g.renderPass!=="translucent")return;const b=d.paint.get("line-opacity"),E=d.paint.get("line-width");if(b.constantOr(1)===0||E.constantOr(1)===0)return;const C=g.depthModeForSublayer(0,o.DepthMode.ReadOnly),M=g.colorModeForRenderPass(),k=g.terrain&&g.terrain.renderingToTexture?1:o.exported.devicePixelRatio,F=d.paint.get("line-dasharray"),B=F.constantOr(1),U=d.layout.get("line-cap"),X=d.paint.get("line-pattern"),Y=X.constantOr(1),K=d.paint.get("line-gradient"),J=Y?"linePattern":"line",Q=g.context,H=Q.gl,le=(ce=>{const ve=[];yu(ce)&&ve.push("RENDER_LINE_DASH"),ce.paint.get("line-gradient")&&ve.push("RENDER_LINE_GRADIENT");const _e=ce.paint.get("line-trim-offset");_e[0]===0&&_e[1]===0||ve.push("RENDER_LINE_TRIM_OFFSET");const Ee=ce.paint.get("line-pattern").constantOr(1),Re=ce.paint.get("line-opacity").constantOr(1)!==1;return!Ee&&Re&&ve.push("RENDER_LINE_ALPHA_DISCARD"),ve})(d);let ae=le.includes("RENDER_LINE_ALPHA_DISCARD");g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(ae=!1);for(const ce of y){const ve=c.getTile(ce);if(Y&&!ve.patternsLoaded())continue;const _e=ve.getBucket(d);if(!_e)continue;g.prepareDrawTile();const Ee=_e.programConfigurations.get(d.id),Re=g.useProgram(J,Ee,le),ze=X.constantOr(null);if(ze&&ve.imageAtlas){const Ce=ve.imageAtlas.patternPositions[ze.toString()];Ce&&Ee.setConstantPatternPositions(Ce)}const je=F.constantOr(null),gt=U.constantOr(null);if(!Y&&je&&gt&&ve.lineAtlas){const Ce=ve.lineAtlas.getDash(je,gt);Ce&&Ee.setConstantPatternPositions(Ce)}let[Le,Qe]=d.paint.get("line-trim-offset");(gt==="round"||gt==="square")&&Le!==Qe&&(Le===0&&(Le-=1),Qe===1&&(Qe+=1));const qe=g.terrain?ce.projMatrix:null,st=Y?Hp(g,ve,d,qe,k):df(g,ve,d,qe,_e.lineClipsArray.length,k,[Le,Qe]);if(K){const Ce=_e.gradients[d.id];let $e=Ce.texture;if(d.gradientVersion!==Ce.version){let it=256;if(d.stepInterpolant){const ct=c.getSource().maxzoom,Nt=ce.canonical.z===ct?Math.ceil(1<<g.transform.maxZoom-ce.canonical.z):1;it=o.clamp(o.nextPowerOfTwo(_e.maxLineLength/o.EXTENT*1024*Nt),256,Q.maxTextureSize)}Ce.gradient=o.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:it,image:Ce.gradient||void 0,clips:_e.lineClipsArray}),Ce.texture?Ce.texture.update(Ce.gradient):Ce.texture=new o.Texture(Q,Ce.gradient,H.RGBA),Ce.version=d.gradientVersion,$e=Ce.texture}Q.activeTexture.set(H.TEXTURE1),$e.bind(d.stepInterpolant?H.NEAREST:H.LINEAR,H.CLAMP_TO_EDGE)}B&&(Q.activeTexture.set(H.TEXTURE0),ve.lineAtlasTexture.bind(H.LINEAR,H.REPEAT),Ee.updatePaintBuffers()),Y&&(Q.activeTexture.set(H.TEXTURE0),ve.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Ee.updatePaintBuffers()),g.prepareDrawProgram(Q,Re,ce.toUnwrapped());const Ue=Ce=>{Re.draw(Q,H.TRIANGLES,C,Ce,M,o.CullFaceMode.disabled,st,d.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,d.paint,g.transform.zoom,Ee,[_e.layoutVertexBuffer2])};if(ae){const Ce=g.stencilModeForClipping(ce).ref;Ce===0&&g.terrain&&Q.clear({stencil:0});const $e={func:H.EQUAL,mask:255};st.u_alpha_discard_threshold=.8,Ue(new o.StencilMode($e,Ce,255,H.KEEP,H.KEEP,H.INVERT)),st.u_alpha_discard_threshold=0,Ue(new o.StencilMode($e,Ce,255,H.KEEP,H.KEEP,H.KEEP))}else Ue(g.stencilModeForClipping(ce))}ae&&(g.resetStencilClippingMasks(),g.terrain&&Q.clear({stencil:0}))},fill:function(g,c,d,y){const b=d.paint.get("fill-color"),E=d.paint.get("fill-opacity");if(E.constantOr(1)===0)return;const C=g.colorModeForRenderPass(),M=d.paint.get("fill-pattern"),k=g.opaquePassEnabledForLayer()&&!M.constantOr(1)&&b.constantOr(o.Color.transparent).a===1&&E.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===k){const F=g.depthModeForSublayer(1,g.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);Jp(g,c,d,y,F,C,!1)}if(g.renderPass==="translucent"&&d.paint.get("fill-antialias")){const F=g.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);Jp(g,c,d,y,F,C,!0)}},"fill-extrusion":function(g,c,d,y){const b=d.paint.get("fill-extrusion-opacity");if(b!==0&&g.renderPass==="translucent"){const E=new o.DepthMode(g.context.gl.LEQUAL,o.DepthMode.ReadWrite,g.depthRangeFor3D);if(b!==1||d.paint.get("fill-extrusion-pattern").constantOr(1))xf(g,c,d,y,E,o.StencilMode.disabled,o.ColorMode.disabled),xf(g,c,d,y,E,g.stencilModeFor3D(),g.colorModeForRenderPass()),g.resetStencilClippingMasks();else{const C=g.colorModeForRenderPass();xf(g,c,d,y,E,o.StencilMode.disabled,C)}}},hillshade:function(g,c,d,y){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent")return;const b=g.context,E=g.depthModeForSublayer(0,o.DepthMode.ReadOnly),C=g.colorModeForRenderPass(),M=g.terrain&&g.terrain.renderingToTexture,[k,F]=g.renderPass!=="translucent"||M?[{},y]:g.stencilConfigForOverlap(y);for(const B of F){const U=c.getTile(B);if(U.needsHillshadePrepare&&g.renderPass==="offscreen")uu(g,U,d,E,o.StencilMode.disabled,C);else if(g.renderPass==="translucent"){const X=M&&g.terrain?g.terrain.stencilModeForRTTOverlap(B):k[B.overscaledZ];Nl(g,B,U,d,E,X,C)}}b.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,c,d,y,b,E){if(g.renderPass!=="translucent"||d.paint.get("raster-opacity")===0||!y.length)return;const C=g.context,M=C.gl,k=c.getSource(),F=g.useProgram("raster"),B=g.colorModeForRenderPass(),U=g.terrain&&g.terrain.renderingToTexture,[X,Y]=k instanceof we||U?[{},y]:g.stencilConfigForOverlap(y),K=Y[Y.length-1].overscaledZ,J=!g.options.moving;for(const Q of Y){const H=U?o.DepthMode.disabled:g.depthModeForSublayer(Q.overscaledZ-K,d.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,M.LESS),le=Q.toUnwrapped(),ae=c.getTile(Q);if(U&&(!ae||!ae.hasData()))continue;const ce=U?Q.projMatrix:g.transform.calculateProjMatrix(le,J),ve=g.terrain&&U?g.terrain.stencilModeForRTTOverlap(Q):X[Q.overscaledZ],_e=E?0:d.paint.get("raster-fade-duration");ae.registerFadeDuration(_e);const Ee=c.findLoadedParent(Q,0),Re=Ul(ae,Ee,c,g.transform,_e);let ze,je;g.terrain&&g.terrain.prepareDrawTile();const gt=d.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;C.activeTexture.set(M.TEXTURE0),ae.texture.bind(gt,M.CLAMP_TO_EDGE),C.activeTexture.set(M.TEXTURE1),Ee?(Ee.texture.bind(gt,M.CLAMP_TO_EDGE),ze=Math.pow(2,Ee.tileID.overscaledZ-ae.tileID.overscaledZ),je=[ae.tileID.canonical.x*ze%1,ae.tileID.canonical.y*ze%1]):ae.texture.bind(gt,M.CLAMP_TO_EDGE),ae.texture.useMipmap&&C.extTextureFilterAnisotropic&&g.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);const Le=Hy(ce,je||[0,0],ze||1,Re,d,k instanceof we?k.perspectiveTransform:[0,0]);if(g.prepareDrawProgram(C,F,le),k instanceof we)k.boundsBuffer&&k.boundsSegments&&F.draw(C,M.TRIANGLES,H,o.StencilMode.disabled,B,o.CullFaceMode.disabled,Le,d.id,k.boundsBuffer,g.quadTriangleIndexBuffer,k.boundsSegments);else{const{tileBoundsBuffer:Qe,tileBoundsIndexBuffer:qe,tileBoundsSegments:st}=g.getTileBoundsBuffers(ae);F.draw(C,M.TRIANGLES,H,ve,B,o.CullFaceMode.disabled,Le,d.id,Qe,qe,st)}}g.resetStencilClippingMasks()},background:function(g,c,d,y){const b=d.paint.get("background-color"),E=d.paint.get("background-opacity");if(E===0)return;const C=g.context,M=C.gl,k=g.transform,F=k.tileSize,B=d.paint.get("background-pattern");if(g.isPatternMissing(B))return;const U=!B&&b.a===1&&E===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==U)return;const X=o.StencilMode.disabled,Y=g.depthModeForSublayer(0,U==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),K=g.colorModeForRenderPass(),J=g.useProgram(B?"backgroundPattern":"background");let Q,H=y;H||(Q=g.getBackgroundTiles(),H=Object.values(Q).map(le=>le.tileID)),B&&(C.activeTexture.set(M.TEXTURE0),g.imageManager.bind(g.context));for(const le of H){const ae=le.toUnwrapped(),ce=y?le.projMatrix:g.transform.calculateProjMatrix(ae);g.prepareDrawTile();const ve=c?c.getTile(le):Q?Q[le.key]:new o.Tile(le,F,k.zoom,g),_e=B?_f(ce,E,g,B,{tileID:le,tileSize:F}):Xy(ce,E,b);g.prepareDrawProgram(C,J,ae);const{tileBoundsBuffer:Ee,tileBoundsIndexBuffer:Re,tileBoundsSegments:ze}=g.getTileBoundsBuffers(ve);J.draw(C,M.TRIANGLES,Y,X,K,o.CullFaceMode.disabled,_e,d.id,Ee,Re,ze)}},sky:function(g,c,d){const y=g.transform,b=y.projection.name==="mercator"||y.projection.name==="globe"?1:o.smoothstep(7,8,y.zoom),E=d.paint.get("sky-opacity")*b;if(E===0)return;const C=g.context,M=d.paint.get("sky-type"),k=new o.DepthMode(C.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),F=g.frameCounter/1e3%1;M==="atmosphere"?g.renderPass==="offscreen"?d.needsSkyboxCapture(g)&&(function(B,U,X,Y){const K=B.context,J=K.gl;let Q=U.skyboxFbo;if(!Q){Q=U.skyboxFbo=K.createFramebuffer(32,32,!1),U.skyboxGeometry=new xu(K),U.skyboxTexture=K.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,U.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let ce=0;ce<6;++ce)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}K.bindFramebuffer.set(Q.framebuffer),K.viewport.set([0,0,32,32]);const H=U.getCenter(B,!0),le=B.useProgram("skyboxCapture"),ae=new Float64Array(16);o.identity(ae),o.rotateY(ae,ae,.5*-Math.PI),_i(K,U,le,ae,H,0),o.identity(ae),o.rotateY(ae,ae,.5*Math.PI),_i(K,U,le,ae,H,1),o.identity(ae),o.rotateX(ae,ae,.5*-Math.PI),_i(K,U,le,ae,H,2),o.identity(ae),o.rotateX(ae,ae,.5*Math.PI),_i(K,U,le,ae,H,3),o.identity(ae),_i(K,U,le,ae,H,4),o.identity(ae),o.rotateY(ae,ae,Math.PI),_i(K,U,le,ae,H,5),K.viewport.set([0,0,B.width,B.height])}(g,d),d.markSkyboxValid(g)):g.renderPass==="sky"&&function(B,U,X,Y,K){const J=B.context,Q=J.gl,H=B.transform,le=B.useProgram("skybox");J.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_CUBE_MAP,U.skyboxTexture);const ae=((ce,ve,_e,Ee,Re)=>({u_matrix:ce,u_sun_direction:ve,u_cubemap:0,u_opacity:Ee,u_temporal_offset:Re}))(H.skyboxMatrix,U.getCenter(B,!1),0,Y,K);B.prepareDrawProgram(J,le),le.draw(J,Q.TRIANGLES,X,o.StencilMode.disabled,B.colorModeForRenderPass(),o.CullFaceMode.backCW,ae,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(g,d,k,E,F):M==="gradient"&&g.renderPass==="sky"&&function(B,U,X,Y,K){const J=B.context,Q=J.gl,H=B.transform,le=B.useProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new xu(J)),J.activeTexture.set(Q.TEXTURE0);let ae=U.colorRampTexture;ae||(ae=U.colorRampTexture=new o.Texture(J,U.colorRamp,Q.RGBA)),ae.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const ce=((ve,_e,Ee,Re,ze)=>({u_matrix:ve,u_color_ramp:0,u_center_direction:_e,u_radius:o.degToRad(Ee),u_opacity:Re,u_temporal_offset:ze}))(H.skyboxMatrix,U.getCenter(B,!1),U.paint.get("sky-gradient-radius"),Y,K);B.prepareDrawProgram(J,le),le.draw(J,Q.TRIANGLES,X,o.StencilMode.disabled,B.colorModeForRenderPass(),o.CullFaceMode.backCW,ce,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(g,d,k,E,F)},debug:function(g,c,d){for(let y=0;y<d.length;y++)wf(g,c,d[y])},custom:function(g,c,d,y){const b=g.context,E=d.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&d.isLayerDraped()){if(g.renderPass==="offscreen"){const C=E.prerender;if(C){if(g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const M=g.transform.pointMerc;C.call(E,b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(g.transform.zoom),[M.x,M.y],g.transform.pixelsPerMeterRatio)}else C.call(E,b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const M=E.renderToTile;if(M){const k=y[0].canonical,F=new o.MercatorCoordinate(k.x+y[0].wrap*(1<<k.z),k.y,k.z);b.setDepthMode(o.DepthMode.disabled),b.setStencilMode(o.StencilMode.disabled),b.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),M.call(E,b.gl,F),b.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),b.setStencilMode(o.StencilMode.disabled);const C=E.renderingMode==="3d"?new o.DepthMode(g.context.gl.LEQUAL,o.DepthMode.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,o.DepthMode.ReadOnly);if(b.setDepthMode(C),g.transform.projection.name==="globe"){const M=g.transform.pointMerc;E.render(b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(g.transform.zoom),[M.x,M.y],g.transform.pixelsPerMeterRatio)}else E.render(b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState(),b.bindFramebuffer.set(null)}}else o.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Xl{constructor(c,d,y=!1){this.context=new ne(c,y),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Op,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,d){const y=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new cf(this,c));const b=this._terrain;this.transform.elevation=y?b:null,b.update(c,this.transform,d)}_updateFog(c){const d=c.fog;if(!d||this.transform.projection.name==="globe"||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,b]=d.getFovAdjustedRange(this.transform._fov);if(y>b)return void(this.transform.fogCullDistSq=null);const E=y+.78*(b-y);this.transform.fogCullDistSq=E*E}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,d){if(this.width=c*o.exported.devicePixelRatio,this.height=d*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._layers[y].resize()}setup(){const c=this.context,d=new o.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(o.EXTENT,0),d.emplaceBack(0,o.EXTENT),d.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(d,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const y=new o.StructArrayLayout2i4;y.emplaceBack(0,0),y.emplaceBack(o.EXTENT,0),y.emplaceBack(0,o.EXTENT),y.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=c.createVertexBuffer(y,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const b=new o.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(b,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const E=new o.StructArrayLayout4i8;E.emplaceBack(0,0,0,0),E.emplaceBack(o.EXTENT,0,o.EXTENT,0),E.emplaceBack(0,o.EXTENT,0,o.EXTENT),E.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(E,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const C=new o.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(C);const M=new o.StructArrayLayout1ui2;for(const F of[0,1,3,2,0])M.emplaceBack(F);this.debugIndexBuffer=c.createIndexBuffer(M),this.emptyTexture=new o.Texture(c,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=o.create();const k=this.context.gl;this.stencilClearMode=new o.StencilMode({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Yy(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,d=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,d.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,vi(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,d,y){if(!d||this.currentStencilSource===d.id||!c.isTileClipped()||!y||y.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const k of y)if(this._tileClippingMaskIDs[k.key]===void 0){M=!0;break}if(!M)return}this.currentStencilSource=d.id;const b=this.context,E=b.gl;this.nextStencilID+y.length>256&&this.clearStencil(),b.setColorMode(o.ColorMode.disabled),b.setDepthMode(o.DepthMode.disabled);const C=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of y){const k=d.getTile(M),F=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:U,tileBoundsSegments:X}=this.getTileBoundsBuffers(k);C.draw(b,E.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:E.ALWAYS,mask:0},F,255,E.KEEP,E.KEEP,E.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,vi(M.projMatrix),"$clipping",B,U,X)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,d=this.context.gl;return new o.StencilMode({func:d.NOTEQUAL,mask:255},c,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const d=this.context.gl;return new o.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(c){const d=this.context.gl,y=c.sort((C,M)=>M.overscaledZ-C.overscaledZ),b=y[y.length-1].overscaledZ,E=y[0].overscaledZ-b+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const C={};for(let M=0;M<E;M++)C[M+b]=new o.StencilMode({func:d.GEQUAL,mask:255},M+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=E,[C,y]}return[{[b]:o.StencilMode.disabled},y]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([c.CONSTANT_COLOR,c.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(c,d,y){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new o.DepthMode(y||this.context.gl.LEQUAL,d,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,d){this.style=c,this.options=d,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const y=this.style.order,b=this.style._sourceCaches;for(const F in b){const B=b[F];B.used&&B.prepare(this.context)}const E={},C={},M={};for(const F in b){const B=b[F];E[F]=B.getVisibleCoordinates(),C[F]=E[F].slice().reverse(),M[F]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<y.length;F++)if(this.style._layers[y[F]].is3D()){this.opaquePassCutoff=F;break}if(this.terrain&&(this.terrain.updateTileBinding(M),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const F of y){const B=this.style._layers[F],U=c._getLayerSourceCache(B);if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const X=U?C[U.id]:void 0;(B.type==="custom"||B.isSky()||X&&X.length)&&this.renderLayer(this,U,B,X)}this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon];const k=this.terrain;if(k&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&k.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:d.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[y[this.currentLayer]],B=c._getLayerSourceCache(F);if(F.isSky())continue;const U=B?C[B.id]:void 0;this._renderTileClippingMasks(F,B,U),this.renderLayer(this,B,F,U)}if(this.style.fog&&this.transform.projection.supportsFog&&function(F,B){const U=F.context,X=U.gl,Y=F.transform,K=new o.DepthMode(X.LEQUAL,o.DepthMode.ReadOnly,[0,1]),J=F.useProgram("globeAtmosphere",null,Y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Q=o.globeToMercatorTransition(Y.zoom),H=B.properties.get("color").toArray01(),le=B.properties.get("high-color").toArray01(),ae=B.properties.get("space-color").toArray01PremultipliedAlpha(),ce=o.identity$1([]);o.rotateY$1(ce,ce,-o.degToRad(Y._center.lng)),o.rotateX$1(ce,ce,o.degToRad(Y._center.lat)),o.rotateZ$1(ce,ce,Y.angle),o.rotateX$1(ce,ce,-Y._pitch);const ve=o.fromQuat(new Float32Array(16),ce),_e=o.mapValue(B.properties.get("star-intensity"),0,1,0,.25),Ee=5e-4,Re=o.mapValue(B.properties.get("horizon-blend"),0,1,Ee,.25),ze=o.globeUseCustomAntiAliasing(F,U,Y)&&Re===Ee?Y.worldSize/(2*Math.PI*1.025)-1:Y.globeRadius,je=F.frameCounter/1e3%1,gt=o.length(Y.globeCenterInViewSpace),Le=Math.sqrt(Math.pow(gt,2)-Math.pow(ze,2)),Qe=Math.acos(Le/gt),qe=((Ue,Ce,$e,it,ct,Nt,si,Lt,Rt,zt,hi,Wt,Mi,Ri)=>({u_frustum_tl:Ue,u_frustum_tr:Ce,u_frustum_br:$e,u_frustum_bl:it,u_horizon:ct,u_transition:Nt,u_fadeout_range:si,u_color:Lt,u_high_color:Rt,u_space_color:zt,u_star_intensity:hi,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Wt,u_horizon_angle:Mi,u_rotation_matrix:Ri}))(Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.frustumCorners.horizon,Q,Re,H,le,ae,_e,je,Qe,ve);F.prepareDrawProgram(U,J);const st=F.atmosphereBuffer;st&&J.draw(U,X.TRIANGLES,K,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,qe,"skybox",st.vertexBuffer,st.indexBuffer,st.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const F=this.style._layers[y[this.currentLayer]],B=c._getLayerSourceCache(F);F.isSky()&&this.renderLayer(this,B,F,B?C[B.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;){const F=this.style._layers[y[this.currentLayer]],B=c._getLayerSourceCache(F);if(F.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(F)){if(F.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const U=B?(F.type==="symbol"?M:C)[B.id]:void 0;this._renderTileClippingMasks(F,B,B?E[B.id]:void 0),this.renderLayer(this,B,F,U),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let F=null;o.values(this.style._layers).forEach(B=>{const U=c._getLayerSourceCache(B);U&&!B.isHidden(this.transform.zoom)&&(!F||F.getSource().maxzoom<U.getSource().maxzoom)&&(F=U)}),F&&this.options.showTileBoundaries&&Tf.debug(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){const B=F.transform.padding;fo(F,F.transform.height-(B.top||0),3,vf),fo(F,B.bottom||0,3,bf),za(F,B.left||0,3,Qp),za(F,F.transform.width-(B.right||0),3,em);const U=F.transform.centerPoint;(function(X,Y,K,J){Hl(X,Y-1,K-10,2,20,J),Hl(X,Y-10,K-1,20,2,J)})(F,U.x,F.transform.height-U.y,tm)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(c,d,y,b){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="sky"||y.type==="custom"||b&&b.length)&&(this.id=y.id,this.gpuTimingStart(y),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(y.type)||c.terrain&&y.type==="custom")&&Tf[y.type](c,d,y,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let y=this.gpuTimers[c.id];y||(y=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),y.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,d=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(d),c.beginQueryEXT(c.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const d={};for(const y in c){const b=c[y],E=this.context.extTimerQuery,C=E.getQueryObjectEXT(b.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(b.query),d[y]=C}return d}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.extTimerQuery;let y=0;for(const b of c)y+=d.getQueryObjectEXT(b,d.QUERY_RESULT_EXT)/1e6,d.deleteQueryEXT(b);return y}translatePosMatrix(c,d,y,b,E){if(!y[0]&&!y[1])return c;const C=E?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(C){const F=Math.sin(C),B=Math.cos(C);y=[y[0]*B-y[1]*F,y[0]*F+y[1]*B]}const M=[E?y[0]:Bn(d,y[0],this.transform.zoom),E?y[1]:Bn(d,y[1],this.transform.zoom),0],k=new Float32Array(16);return o.translate(k,c,M),k}saveTileTexture(c){const d=this._tileTextures[c.size[0]];d?d.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const d=this._tileTextures[c];return d&&d.length>0?d.pop():null}isPatternMissing(c){return c===null||c!==void 0&&!this.imageManager.getPattern(c.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,d=this.terrain&&this.terrain.exaggeration()===0,y=this.style&&this.style.fog,b=[];return this.terrainRenderModeElevated()&&b.push("TERRAIN"),this.transform.projection.name==="globe"&&b.push("GLOBE"),d&&b.push("ZERO_EXAGGERATION"),y&&!c&&y.getOpacity(this.transform.pitch)!==0&&b.push("FOG"),c&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}useProgram(c,d,y){this.cache=this.cache||{};const b=y||[],E=this.currentGlobalDefines().concat(b),C=uf.cacheKey(nf[c],c,E,d);return this.cache[C]||(this.cache[C]=new uf(this.context,c,nf[c],d,qy[c],E)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,d,y){if(this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const E=b.getOpacity(this.transform.pitch),C=((M,k,F,B,U,X,Y,K,J,Q,H)=>{const le=M.transform,ae=k.properties.get("color").toArray01();ae[3]=B;const ce=M.frameCounter/1e3%1;return{u_fog_matrix:F?le.calculateFogTileMatrix(F):M.identityMat,u_fog_range:k.getFovAdjustedRange(le._fov),u_fog_color:ae,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_temporal_offset:ce,u_frustum_tl:U,u_frustum_tr:X,u_frustum_br:Y,u_frustum_bl:K,u_globe_pos:J,u_globe_radius:Q,u_viewport:H,u_globe_transition:o.globeToMercatorTransition(le.zoom),u_is_globe:+(le.projection.name==="globe")}})(this,b,y,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);d.setFogUniformValues(c,C)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,d=c.createTexture();return c.bindTexture(c.TEXTURE_2D,d),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&c.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const c=this._backgroundTiles,d=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const b of y)d[b.key]=c[b.key]||new o.Tile(b,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class Ef{constructor(c=0,d=0,y=0,b=0){if(isNaN(c)||c<0||isNaN(d)||d<0||isNaN(y)||y<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=d,this.left=y,this.right=b}interpolate(c,d,y){return d.top!=null&&c.top!=null&&(this.top=o.number(c.top,d.top,y)),d.bottom!=null&&c.bottom!=null&&(this.bottom=o.number(c.bottom,d.bottom,y)),d.left!=null&&c.left!=null&&(this.left=o.number(c.left,d.left,y)),d.right!=null&&c.right!=null&&(this.right=o.number(c.right,d.right,y)),this}getCenter(c,d){const y=o.clamp((this.left+c-this.right)/2,0,c),b=o.clamp((this.top+d-this.bottom)/2,0,d);return new o.pointGeometry(y,b)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new Ef(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function im(g,c){const d=o.getColumn(g,3);o.fromQuat(g,c),o.setColumn(g,3,d)}function bu(g,c){const d=o.identity$1([]);return o.rotateZ$1(d,d,-c),o.rotateX$1(d,d,-g),d}function nm(g,c){const d=[g[0],g[1],0],y=[c[0],c[1],0];if(o.length(d)>=1e-15){const C=o.normalize([],d);o.scale$2(y,C,o.dot(y,C)),c[0]=y[0],c[1]=y[1]}const b=o.cross([],c,g);if(o.len(b)<1e-15)return null;const E=Math.atan2(-b[1],b[0]);return bu(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),E)}class wu{constructor(c,d){this.position=c,this.orientation=d}get position(){return this._position}set position(c){if(c){const d=c instanceof o.MercatorCoordinate?c:new o.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(d.x=o.wrap(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(c,d){if(this.orientation=null,!this.position)return;const y=this.position,b=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(c)):0,E=o.MercatorCoordinate.fromLngLat(c,b),C=[E.x-y.x,E.y-y.y,E.z-y.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=nm(C,d)}setPitchBearing(c,d){this.orientation=bu(o.degToRad(c),o.degToRad(-d))}}class ja{constructor(c,d){this._transform=o.identity([]),this.orientation=d,this.position=c}get mercatorPosition(){const c=this.position;return new o.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=o.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var d;c&&o.setColumn(this._transform,3,[(d=c)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||o.identity$1([]),c&&im(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,d){this._orientation=bu(c,d),im(this._transform,this._orientation)}forward(){const c=o.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=o.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=o.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,d){const y=new Float64Array(16);return o.invert(y,this.getWorldToCamera(c,d)),y}getWorldToCameraPosition(c,d,y){const b=this.position;o.scale$2(b,b,-c);const E=new Float64Array(16);return o.fromScaling(E,[y,y,y]),o.translate(E,E,b),E[10]*=d,E}getWorldToCamera(c,d){const y=new Float64Array(16),b=new Float64Array(4),E=this.position;return o.conjugate(b,this._orientation),o.scale$2(E,E,-c),o.fromQuat(y,b),o.translate(y,y,E),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=d,y[9]*=d,y[10]*=d,y[11]*=d,y}getCameraToClipPerspective(c,d,y,b){const E=new Float64Array(16);return o.perspective(E,c,d,y,b),E}getDistanceToElevation(c,d=!1){const y=c===0?0:o.mercatorZfromAltitude(c,d?o.latFromMercatorY(this.position[1]):this.position[1]),b=this.forward();return(y-this.position[2])/b[2]}clone(){return new ja([...this.position],[...this.orientation])}}function $a(g,c){const d=ra(g.projection,g.zoom,g.width,g.height),y=function(E,C,M,k,F){const B=new o.LngLat(M.lng-180*sa,M.lat),U=new o.LngLat(M.lng+180*sa,M.lat),X=E.project(B.lng,B.lat),Y=E.project(U.lng,U.lat),K=-Math.atan2(Y.y-X.y,Y.x-X.x),J=o.MercatorCoordinate.fromLngLat(M);J.y=o.clamp(J.y,-.999975,.999975);const Q=J.toLngLat(),H=E.project(Q.lng,Q.lat),le=o.MercatorCoordinate.fromLngLat(Q);le.x+=sa;const ae=le.toLngLat(),ce=E.project(ae.lng,ae.lat),ve=Gl(ce.x-H.x,ce.y-H.y,K),_e=o.MercatorCoordinate.fromLngLat(Q);_e.y+=sa;const Ee=_e.toLngLat(),Re=E.project(Ee.lng,Ee.lat),ze=Gl(Re.x-H.x,Re.y-H.y,K),je=Math.abs(ve.x)/Math.abs(ze.y),gt=o.identity([]);o.rotateZ(gt,gt,-K*(1-(F?0:k)));const Le=o.identity([]);return o.scale(Le,Le,[1,1-(1-je)*k,1]),Le[4]=-ze.x/ze.y*k,o.rotateZ(Le,Le,K),o.multiply(Le,gt,Le),Le}(g.projection,0,g.center,d,c),b=Tu(g);return o.scale(y,y,[b,b,1]),y}function Tu(g){const c=g.projection,d=ra(g.projection,g.zoom,g.width,g.height),y=ql(c,g.center),b=ql(c,o.LngLat.convert(c.center));return Math.pow(2,y*d+(1-d)*b)}function ra(g,c,d,y,b=1/0){const E=g.range;if(!E)return 0;const C=Math.min(b,Math.max(d,y)),M=Math.log(C/1024)/Math.LN2;return o.smoothstep(E[0]+M,E[1]+M,c)}const sa=1/4e4;function ql(g,c){const d=o.clamp(c.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),y=new o.LngLat(c.lng-180*sa,d),b=new o.LngLat(c.lng+180*sa,d),E=g.project(y.lng,d),C=g.project(b.lng,d),M=o.MercatorCoordinate.fromLngLat(y),k=o.MercatorCoordinate.fromLngLat(b),F=C.x-E.x,B=C.y-E.y,U=k.x-M.x,X=k.y-M.y,Y=Math.sqrt((U*U+X*X)/(F*F+B*B));return Math.log(Y)/Math.LN2}function Gl(g,c,d){const y=Math.cos(d),b=Math.sin(d);return{x:g*y-c*b,y:g*b+c*y}}class Mt{constructor(c,d,y,b,E,C,M){this.tileSize=512,this._renderWorldCopies=E===void 0||E,this._minZoom=c||0,this._maxZoom=d||22,this._minPitch=y??0,this._maxPitch=b??60,this.setProjection(C),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ef,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ja,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new Mt(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c,d=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||y)&&this._updateCameraOnTerrain(),(c||y)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const y=!v(d,this.getProjection());return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const d=c!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const d=-c*Math.PI/180;var y;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(y=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y),function(b,E,C){var M=E[0],k=E[1],F=E[2],B=E[3],U=Math.sin(C),X=Math.cos(C);b[0]=M*X+F*U,b[1]=k*X+B*U,b[2]=M*-U+F*X,b[3]=k*-U+B*X}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const d=o.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=o.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const d=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let b=0,E=0;for(let C=0;C<d.length;C++){const M=new o.pointGeometry(d[C][0]*this.width,y+d[C][1]*(this.height-y)),k=c.pointCoordinate(M);if(!k)continue;const F=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);b+=k[3]*F,E+=F}return E===0?NaN:b/E}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const c=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*d,b=this._mercatorZfromZoom(c),E=this._mercatorZfromZoom(this._maxZoom),C=Math.max(b-y,E);this._setZoom(this._zoomFromMercatorZ(C))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let y;y=c.z<this._camera.position[2]?[d.x,d.y,d.z]:[c.x,c.y,c.z];const b=o.length(o.sub([],this._camera.position,y));return o.clamp(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let d=!1;if(c.orientation&&!o.exactEquals(c.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(c.orientation)),c.position){const y=[c.position.x,c.position.y,c.position.z];o.exactEquals$1(y,this._camera.position)||(this._setCameraPosition(y),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,d=new wu;return d.position=new o.MercatorCoordinate(c[0],c[1],c[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(c){if(!o.length$1(c))return!1;o.normalize$1(c,c);const d=o.transformQuat([],[0,0,-1],c),y=o.transformQuat([],[0,-1,0],c);if(y[2]<0)return!1;const b=nm(d,y);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(c){const d=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;c[2]=o.clamp(c[2],b/y,b/d),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,d,y){this._unmodified=!1,this._edgeInsets.interpolate(c,d,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const d=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(c){const d=[new o.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const y=this.pointCoordinate(new o.pointGeometry(0,0)),b=this.pointCoordinate(new o.pointGeometry(this.width,0)),E=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),C=this.pointCoordinate(new o.pointGeometry(0,this.height)),M=Math.floor(Math.min(y.x,b.x,E.x,C.x)),k=Math.floor(Math.max(y.x,b.x,E.x,C.x)),F=1;for(let B=M-F;B<=k+F;B++)B!==0&&d.push(new o.UnwrappedTileID(B,c))}return d}coveringTiles(c){let d=this.coveringZoomLevel(c);const y=d,b=this.elevation&&!c.isTerrainDEM,E=this.projection.name==="mercator";if(c.minzoom!==void 0&&d<c.minzoom)return[];c.maxzoom!==void 0&&d>c.maxzoom&&(d=c.maxzoom);const C=this.locationCoordinate(this.center),M=this.center.lat,k=1<<d,F=[k*C.x,k*C.y,0],B=this.projection.name==="globe",U=!B,X=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,U),Y=B?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=k*o.mercatorZfromAltitude(1,this.center.lat),J=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),Q=[k*Y.x,k*Y.y,J*(U?1:K)],H=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),le=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?d:0,ae=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ce=c.isTerrainDEM?-ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?Tu(this):1,_e=Ue=>{const $e=new o.MercatorCoordinate(Ue.x+25e-6,Ue.y,Ue.z),it=new o.MercatorCoordinate(Ue.x,Ue.y+25e-6,Ue.z),ct=Ue.toLngLat(),Nt=$e.toLngLat(),si=it.toLngLat(),Lt=this.locationCoordinate(ct),Rt=this.locationCoordinate(Nt),zt=this.locationCoordinate(si),hi=Math.hypot(Rt.x-Lt.x,Rt.y-Lt.y),Wt=Math.hypot(zt.x-Lt.x,zt.y-Lt.y);return Math.sqrt(hi*Wt)*ve/25e-6},Ee=Ue=>{const Ce=ae,$e=ce;return{aabb:o.tileAABB(this,k,0,0,0,Ue,$e,Ce,this.projection),zoom:0,x:0,y:0,minZ:$e,maxZ:Ce,wrap:Ue,fullyVisible:!1}},Re=[];let ze=[];const je=d,gt=c.reparseOverscaled?y:d,Le=Ue=>Ue*Ue,Qe=Le((J-this._centerAltitude)*K),qe=Ue=>{if(!this._elevation||!Ue.tileID||!E)return;const Ce=this._elevation.getMinMaxForTile(Ue.tileID),$e=Ue.aabb;Ce?($e.min[2]=Ce.min,$e.max[2]=Ce.max,$e.center[2]=($e.min[2]+$e.max[2])/2):(Ue.shouldSplit=st(Ue),Ue.shouldSplit||($e.min[2]=$e.max[2]=$e.center[2]=this._centerAltitude))},st=Ue=>{if(Ue.zoom<le)return!0;if(Ue.zoom===je)return!1;if(Ue.shouldSplit!=null)return Ue.shouldSplit;const Ce=Ue.aabb.distanceX(Q),$e=Ue.aabb.distanceY(Q);let it=Qe,ct=1;if(B){it=Le(Ue.aabb.distanceZ(Q));const Lt=Math.pow(2,Ue.zoom),Rt=o.latFromMercatorY((Ue.y+1)/Lt),zt=o.latFromMercatorY(Ue.y/Lt),hi=Math.min(Math.max(M,Rt),zt),Wt=o.circumferenceAtLatitude(hi)/o.circumferenceAtLatitude(M);if(ct=hi===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Wt/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&Ue.zoom===je-1&&Wt>=.9)return!0}else if(b&&(it=Le(Ue.aabb.distanceZ(Q)*K)),this.projection.isReprojectedInTileSpace&&y<=5){const Lt=Math.pow(2,Ue.zoom),Rt=_e(new o.MercatorCoordinate((Ue.x+.5)/Lt,(Ue.y+.5)/Lt));ct=Rt>.85?1:Rt}const Nt=Ce*Ce+$e*$e+it,si=Le((1<<je-Ue.zoom)*H*ct*((Lt,Rt)=>{if(Rt*Le(.707)<Lt)return 1;const zt=Math.sqrt(Rt/Lt);return zt/(1.4144271570014144+(Math.pow(1.1,zt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(it,Qe),Nt));return Nt<si};if(this.renderWorldCopies)for(let Ue=1;Ue<=3;Ue++)Re.push(Ee(-Ue)),Re.push(Ee(Ue));for(Re.push(Ee(0));Re.length>0;){const Ue=Re.pop(),Ce=Ue.x,$e=Ue.y;let it=Ue.fullyVisible;if(!it){const ct=Ue.aabb.intersects(X);if(ct===0)continue;it=ct===2}if(Ue.zoom!==je&&st(Ue))for(let ct=0;ct<4;ct++){const Nt=(Ce<<1)+ct%2,si=($e<<1)+(ct>>1),Lt={aabb:E?Ue.aabb.quadrant(ct):o.tileAABB(this,k,Ue.zoom+1,Nt,si,Ue.wrap,Ue.minZ,Ue.maxZ,this.projection),zoom:Ue.zoom+1,x:Nt,y:si,wrap:Ue.wrap,fullyVisible:it,tileID:void 0,shouldSplit:void 0,minZ:Ue.minZ,maxZ:Ue.maxZ};b&&!B&&(Lt.tileID=new o.OverscaledTileID(Ue.zoom+1===je?gt:Ue.zoom+1,Ue.wrap,Ue.zoom+1,Nt,si),qe(Lt)),Re.push(Lt)}else{const ct=Ue.zoom===je?gt:Ue.zoom;if(c.minzoom&&c.minzoom>ct)continue;const Nt=F[0]-(.5+Ce+(Ue.wrap<<Ue.zoom))*(1<<d-Ue.zoom),si=F[1]-.5-$e,Lt=Ue.tileID?Ue.tileID:new o.OverscaledTileID(ct,Ue.wrap,Ue.zoom,Ce,$e);ze.push({tileID:Lt,distanceSq:Nt*Nt+si*si})}}if(this.fogCullDistSq){const Ue=this.fogCullDistSq,Ce=this.horizonLineFromTop();ze=ze.filter($e=>{const it=[0,0,0,1],ct=[o.EXTENT,o.EXTENT,0,1],Nt=this.calculateFogTileMatrix($e.tileID.toUnwrapped());o.transformMat4$1(it,it,Nt),o.transformMat4$1(ct,ct,Nt);const si=o.getAABBPointSquareDist(it,ct);if(si===0)return!0;let Lt=!1;const Rt=this._elevation;if(Rt&&si>Ue&&Ce!==0){const zt=this.calculateProjMatrix($e.tileID.toUnwrapped());let hi;c.isTerrainDEM||(hi=Rt.getMinMaxForTile($e.tileID)),hi||(hi={min:ce,max:ae});const Wt=o.furthestTileCorner(this.rotation),Mi=[Wt[0]*o.EXTENT,Wt[1]*o.EXTENT,hi.max];o.transformMat4(Mi,Mi,zt),Lt=(1-Mi[1])*this.height*.5<Ce}return si<Ue||Lt})}return ze.sort((Ue,Ce)=>Ue.distanceSq-Ce.distanceSq).map(Ue=>Ue.tileID)}resize(c,d){this.width=c,this.height=d,this.pixelsToGLUnits=[2/c,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const d=o.clamp(c.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),y=this.projection.project(c.lng,d);return new o.pointGeometry(y.x*this.worldSize,y.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,d){let y,b;const E=this.centerPoint;if(this.projection.name==="globe"){const M=this.worldSize;y=(d.x-E.x)/M,b=(d.y-E.y)/M}else{const M=this.pointCoordinate(d),k=this.pointCoordinate(E);y=M.x-k.x,b=M.y-k.y}const C=this.locationCoordinate(c);this.setLocation(new o.MercatorCoordinate(C.x-y,C.y-b))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,d){const y=d?o.mercatorZfromAltitude(d,c.lat):void 0,b=this.projection.project(c.lng,c.lat);return new o.MercatorCoordinate(b.x,b.y,y)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,d){const y=d??this._centerAltitude,b=[c.x,c.y,0,1],E=[c.x,c.y,1,1];o.transformMat4$1(b,b,this.pixelMatrixInverse),o.transformMat4$1(E,E,this.pixelMatrixInverse);const C=E[3];o.scale$1(b,b,1/b[3]),o.scale$1(E,E,1/C);const M=b[2],k=E[2];return{p0:b,p1:E,t:M===k?0:(y-M)/(k-M)}}screenPointToMercatorRay(c){const d=[c.x,c.y,0,1],y=[c.x,c.y,1,1];return o.transformMat4$1(d,d,this.pixelMatrixInverse),o.transformMat4$1(y,y,this.pixelMatrixInverse),o.scale$1(d,d,1/d[3]),o.scale$1(y,y,1/y[3]),d[2]=o.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,y[2]=o.mercatorZfromAltitude(y[2],this._center.lat)*this.worldSize,o.scale$1(d,d,1/this.worldSize),o.scale$1(y,y,1/this.worldSize),new o.Ray([d[0],d[1],d[2]],o.normalize([],o.sub([],y,d)))}rayIntersectionCoordinate(c){const{p0:d,p1:y,t:b}=c,E=o.mercatorZfromAltitude(d[2],this._center.lat),C=o.mercatorZfromAltitude(y[2],this._center.lat);return new o.MercatorCoordinate(o.number(d[0],y[0],b)/this.worldSize,o.number(d[1],y[1],b)/this.worldSize,o.number(E,C,b))}pointCoordinate(c,d=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,d)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let d=this.projection.pointCoordinate3D(this,c.x,c.y);if(d)return new o.MercatorCoordinate(d[0],d[1],d[2]);let y=0,b=this.horizonLineFromTop();if(c.y>b)return this.pointCoordinate(c);const E=.02*b,C=c.clone();for(let M=0;M<10&&b-y>E;M++){C.y=o.number(y,b,.66);const k=this.projection.pointCoordinate3D(this,C.x,C.y);k?(b=C.y,d=k):y=C.y}return d?new o.MercatorCoordinate(d[0],d[1],d[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}_coordinatePoint(c,d){const y=d&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,b=[c.x*this.worldSize,c.y*this.worldSize,y+c.toAltitude(),1];return o.transformMat4$1(b,b,this.pixelMatrix),b[3]>0?new o.pointGeometry(b[0]/b[3],b[1]/b[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:d}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,E=this.pointLocation3D(new o.pointGeometry(d,c)),C=this.pointLocation3D(new o.pointGeometry(b,c)),M=this.pointLocation3D(new o.pointGeometry(b,y)),k=this.pointLocation3D(new o.pointGeometry(d,y));let F=Math.min(E.lng,C.lng,M.lng,k.lng),B=Math.max(E.lng,C.lng,M.lng,k.lng),U=Math.min(E.lat,C.lat,M.lat,k.lat),X=Math.max(E.lat,C.lat,M.lat,k.lat);const Y=Math.pow(2,-this.zoom)/16*270,K=this.projection.name==="globe"?1:4,J=(Q,H,le,ae,ce)=>{const ve=(Q+le)/2,_e=(H+ae)/2,Ee=new o.pointGeometry(ve,_e),{lng:Re,lat:ze}=this.pointLocation3D(Ee),je=Math.max(0,F-Re,U-ze,Re-B,ze-X);F=Math.min(F,Re),B=Math.max(B,Re),U=Math.min(U,ze),X=Math.max(X,ze),(ce<K||je>Y)&&(J(Q,H,ve,_e,ce+1),J(ve,_e,le,ae,ce+1))};if(J(d,c,b,c,1),J(b,c,b,y,1),J(b,y,d,y,1),J(d,y,d,c,1),this.projection.name==="globe"){const[Q,H]=o.polesInViewport(this);Q?(X=90,B=180,F=-180):H&&(U=-90,B=180,F=-180)}return new o.LngLatBounds(new o.LngLat(F,U),new o.LngLat(B,X))}_getBoundsRectangular(c,d){const{top:y,left:b}=this._edgeInsets,E=this.height-this._edgeInsets.bottom,C=this.width-this._edgeInsets.right,M=new o.pointGeometry(b,y),k=new o.pointGeometry(C,y),F=new o.pointGeometry(C,E),B=new o.pointGeometry(b,E);let U=this.pointCoordinate(M,c),X=this.pointCoordinate(k,c);const Y=this.pointCoordinate(F,d),K=this.pointCoordinate(B,d),J=(Q,H)=>(H.y-Q.y)/(H.x-Q.x);return U.y>1&&X.y>=0?U=new o.MercatorCoordinate((1-K.y)/J(K,U)+K.x,1):U.y<0&&X.y<=1&&(U=new o.MercatorCoordinate(-K.y/J(K,U)+K.x,0)),X.y>1&&U.y>=0?X=new o.MercatorCoordinate((1-Y.y)/J(Y,X)+Y.x,1):X.y<0&&U.y<=1&&(X=new o.MercatorCoordinate(-Y.y/J(Y,X)+Y.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(Y))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=c.visibleDemTiles.reduce((y,b)=>{if(b.dem){const E=b.dem.tree;y.min=Math.min(y.min,E.minimums[0]),y.max=Math.max(y.max,E.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*c.exaggeration(),d.max*c.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,y=this.height/2-d*(1-this._horizonShift);return c?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,d){return this.projection.createTileMatrix(this,d,c)}calculateDistanceTileData(c){const d=c.key,y=this._distanceTileDataCache;if(y[d])return y[d];const b=c.canonical,E=1/this.height,C=this.cameraWorldSize,M=C/this.zoomScale(b.z),k=(b.x+Math.pow(2,b.z)*c.wrap)*M,F=b.y*M,B=this.point;B.x*=C/this.worldSize,B.y*=C/this.worldSize;const U=this.angle,X=Math.sin(-U),Y=-Math.cos(-U);return y[d]={bearing:[X,Y],center:[(B.x-k)*E,(B.y-F)*E],scale:M/o.EXTENT*E},y[d]}calculateFogTileMatrix(c){const d=c.key,y=this._fogTileMatrixCache;if(y[d])return y[d];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return o.multiply(b,this.worldToFogMatrix,b),y[d]=new Float32Array(b),y[d]}calculateProjMatrix(c,d=!1){const y=c.key,b=d?this._alignedProjMatrixCache:this._projMatrixCache;if(b[y])return b[y];const E=this.calculatePosMatrix(c,this.worldSize);return o.multiply(E,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.alignedProjMatrix:this.projMatrix,E),b[y]=new Float32Array(E),b[y]}calculatePixelsToTileUnitsMatrix(c){const d=c.tileID.key,y=this._pixelsToTileUnitsCache;if(y[d])return y[d];const b=function(E,C){const{scale:M}=E.tileTransform,k=M*o.EXTENT/(E.tileSize*Math.pow(2,C.zoom-E.tileID.overscaledZ+E.tileID.canonical.z));return F=new Float32Array(4),X=(B=C.inverseAdjustmentMatrix)[1],Y=B[2],K=B[3],Q=(U=[k,k])[1],F[0]=B[0]*(J=U[0]),F[1]=X*J,F[2]=Y*Q,F[3]=K*Q,F;var F,B,U,X,Y,K,J,Q}(c,this);return y[d]=b,y[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const c=1/this.worldSize,d=o.fromScaling([],[c,c,c]);return o.multiply(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const c=this._elevation;this._updateCameraState();const d=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(d),b=this._camera.forward(),E=o.mercatorZfromAltitude(1,this._center.lat);y[2]/=E,b[2]/=E,o.normalize(b,b);const C=c.raycast(y,b,c.exaggeration());if(C){const M=o.scaleAndAdd([],y,b,C),k=new o.MercatorCoordinate(M[0],M[1],o.mercatorZfromAltitude(M[2],o.latFromMercatorY(M[1]))),F=(k.z+o.length([k.x-y[0],k.y-y[1],k.z-y[2]*E]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(F),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const d=this._elevation,y=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(y),E=d.getAtPointOrZero(new o.MercatorCoordinate(...b)),C=this.pixelsPerMeter/this.worldSize*E,M=this._minimumHeightOverTerrain(),k=b[2]-C;if(k<=M)if(k<0||c){const F=this.locationCoordinate(this._center,this._centerAltitude),B=[b[0],b[1],F.z-b[2]],U=o.length(B);B[2]-=(M-k)/this._pixelsPerMercatorPixel;const X=o.length(B);if(X===0)return;o.scale$2(B,B,U/X*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],F.z*this._pixelsPerMercatorPixel-B[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const X=this.center;return X.lat=o.clamp(X.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(X.lng=o.clamp(X.lng,this.minLng,this.maxLng)),this.center=X,void(this._constraining=!1)}const d=this._unmodified,{x:y,y:b}=this.point;let E=0,C=y,M=b;const k=this.width/2,F=this.height/2,B=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(b-F<B&&(M=B+F),b+F>U&&(M=U-F),U-B<this.height&&(E=Math.max(E,this.height/(U-B)),M=(U+B)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const X=this.worldMinX*this.scale,Y=this.worldMaxX*this.scale,K=this.worldSize/2-(X+Y)/2;C=(y+K+this.worldSize)%this.worldSize-K,C-k<X&&(C=X+k),C+k>Y&&(C=Y-k),Y-X<this.width&&(E=Math.max(E,this.width/(Y-X)),C=(Y+X)/2)}C===y&&M===b||(this.center=this.unproject(new o.pointGeometry(C,M))),E&&(this.zoom+=this.scaleZoom(E)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const y=ra(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?d:1,E=this._camera.getWorldToCamera(this.worldSize,b),C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);C[8]=2*-c.x/this.width,C[9]=2*c.y/this.height;let M=o.mul([],C,E);if(this.projection.isReprojectedInTileSpace){const _e=this.locationCoordinate(this.center),Ee=o.identity([]);o.translate(Ee,Ee,[_e.x*this.worldSize,_e.y*this.worldSize,0]),o.multiply(Ee,Ee,$a(this)),o.translate(Ee,Ee,[-_e.x*this.worldSize,-_e.y*this.worldSize,0]),o.multiply(M,M,Ee),this.inverseAdjustmentMatrix=function(Re){const ze=$a(Re,!0);return rt([],[ze[0],ze[1],ze[4],ze[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],M,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=M,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const k=o.invert([],C);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height);const F=new Float32Array(16);o.identity(F),o.scale(F,F,[1,-1,1]),o.rotateX(F,F,this._pitch),o.rotateZ(F,F,this.angle);const B=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),U=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;B[8]=2*-c.x/this.width,B[9]=2*(c.y+U)/this.height,this.skyboxMatrix=o.multiply(F,B,F);const X=this.point,Y=X.x,K=X.y,J=this.width%2/2,Q=this.height%2/2,H=Math.cos(this.angle),le=Math.sin(this.angle),ae=Y-Math.round(Y)+H*J+le*Q,ce=K-Math.round(K)+H*Q+le*J,ve=new Float64Array(M);if(o.translate(ve,ve,[ae>.5?ae-1:ae,ce>.5?ce-1:ce,0]),this.alignedProjMatrix=ve,M=o.create(),o.scale(M,M,[this.width/2,-this.height/2,1]),o.translate(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=o.create(),o.scale(M,M,[1,-1,1]),o.translate(M,M,[-1,-1,0]),o.scale(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},M=o.invert(new Float64Array(16),this.pixelMatrix),!M)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=M,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const _e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(_e,_e,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=M;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,y=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,E=[c,c,d];o.scale$2(E,E,b),o.scale$2(y,y,-1),o.multiply$2(y,y,E);const C=o.create();o.translate(C,C,y),o.scale(C,C,E),this.mercatorFogMatrix=C,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,d,b)}_computeCameraPosition(c){const d=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),b=this.point,E=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-c/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-y[0]*E,b.y/this.worldSize-y[1]*E,c/this.worldSize*this._centerAltitude-y[2]*E]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],b=c[2];let E=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(E=Math.min((d-y)/b,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,c,E),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,d=this._camera.forward(),{pitch:y,bearing:b}=this._camera.getPitchBearing(),E=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,C=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),M=Math.max((c[2]-E)/Math.cos(y),C),k=this._zoomFromMercatorZ(M);o.scaleAndAdd(c,c,d,M),this._pitch=o.clamp(y,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(b,-Math.PI,Math.PI),this._setZoom(o.clamp(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let d=0,y=o.GLOBE_ZOOM_THRESHOLD_MAX,b=0,E=1/0;for(;y-d>1e-6&&y>d;){const C=d+.5*(y-d),M=this.tileSize*Math.pow(2,C),k=this.getCameraToCenterDistance(this.projection,C,M),F=this.scaleZoom(k/(c*this.tileSize)),B=Math.abs(C-F);B<E&&(E=B,b=C),C<F?d=C:y=C}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,d){const y=Math.min(c.x,d.x),b=Math.max(c.x,d.x),E=Math.min(c.y,d.y),C=Math.max(c.y,d.y);if(E<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const M=[new o.pointGeometry(y,E),new o.pointGeometry(b,C),new o.pointGeometry(y,C),new o.pointGeometry(b,E)],k=this.renderWorldCopies?-3:0,F=this.renderWorldCopies?4:1;for(const B of M){const U=this.pointRayIntersection(B);if(U.t<0)return!0;const X=this.rayIntersectionCoordinate(U);if(X.x<k||X.y<0||X.x>F||X.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(c,d){const y=o.length(o.sub([],this._camera.position,c)),b=this._zoomFromMercatorZ(y)+d;return y-this._mercatorZfromZoom(b)}getCameraPoint(){if(this.projection.name==="globe"){const c=function([d,y,b],E){const C=[d,y,b,1];o.transformMat4$1(C,C,E);const M=C[3]=Math.max(C[3],1e-6);return C[0]/=M,C[1]/=M,C[2]/=M,C}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.pointGeometry(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,c))}}getCameraToCenterDistance(c,d=this.zoom,y=this.worldSize){const b=ra(c,d,this.width,this.height,1024),E=c.pixelSpaceConversion(this.center.lat,y,b);return .5/Math.tan(.5*this._fov)*this.height*E}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(c,c,this.globeMatrix),c}}function Xr(g,c){let d=!1,y=null;const b=()=>{y=null,d&&(g(),y=setTimeout(b,c),d=!1)};return()=>(d=!0,y||b(),y)}class rm{constructor(c){this._hashName=c&&encodeURIComponent(c),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Xr(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,o.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const d=Af(c);if(this._hashName){const y=this._hashName;let b=!1;const E=o.window.location.hash.slice(1).split("&").map(C=>{const M=C.split("=")[0];return M===y?(b=!0,`${M}=${d}`):C}).filter(C=>C);return b||E.push(`${y}=${d}`),`#${E.join("&")}`}return`#${d}`}_getCurrentHash(){const c=o.window.location.hash.replace("#","");if(this._hashName){let d;return c.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(d=y)}),(d&&d[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(y=>isNaN(y))){const y=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(d[3]||0):c.getBearing();return c.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:y,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,c)}}function Af(g,c){const d=g.getCenter(),y=Math.round(100*g.getZoom())/100,b=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,b),C=Math.round(d.lng*E)/E,M=Math.round(d.lat*E)/E,k=g.getBearing(),F=g.getPitch();let B=c?`/${C}/${M}/${y}`:`${y}/${M}/${C}`;return(k||F)&&(B+="/"+Math.round(10*k)/10),F&&(B+=`/${Math.round(F)}`),B}const Zl={linearity:.3,easing:o.bezier(0,0,.3,1)},Wa=o.extend({deceleration:2500,maxSpeed:1400},Zl),sm=o.extend({deceleration:20,maxSpeed:1400},Zl),Eu=o.extend({deceleration:1e3,maxSpeed:360},Zl),Sf=o.extend({deceleration:1e3,maxSpeed:90},Zl);class Au{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,d=o.exported.now();for(;c.length>0&&d-c[0].time>160;)c.shift()}_onMoveEnd(c){if(o.exported.prefersReducedMotion||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)d.zoom+=E.zoomDelta||0,d.bearing+=E.bearingDelta||0,d.pitch+=E.pitchDelta||0,E.panDelta&&d.pan._add(E.panDelta),E.around&&(d.around=E.around),E.pinchAround&&(d.pinchAround=E.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(d.pan.mag()){const E=Kl(d.pan.mag(),y,o.extend({},Wa,c||{}));b.offset=d.pan.mult(E.amount/d.pan.mag()),b.center=this._map.transform.center,Yl(b,E)}if(d.zoom){const E=Kl(d.zoom,y,sm);b.zoom=this._map.transform.zoom+E.amount,Yl(b,E)}if(d.bearing){const E=Kl(d.bearing,y,Eu);b.bearing=this._map.transform.bearing+o.clamp(E.amount,-179,179),Yl(b,E)}if(d.pitch){const E=Kl(d.pitch,y,Sf);b.pitch=this._map.transform.pitch+E.amount,Yl(b,E)}if(b.zoom||b.bearing){const E=d.pinchAround===void 0?d.around:d.pinchAround;b.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function Yl(g,c){(!g.duration||g.duration<c.duration)&&(g.duration=c.duration,g.easing=c.easing)}function Kl(g,c,d){const{maxSpeed:y,linearity:b,deceleration:E}=d,C=o.clamp(g*b/(c/1e3),-y,y),M=Math.abs(C)/(E*b);return{easing:d.easing,duration:1e3*M,amount:C*(M/2)}}class Un extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,y,b={}){const E=me(d.getCanvasContainer(),y),C=d.unproject(E);super(c,o.extend({point:E,lngLat:C,originalEvent:y},b)),this._defaultPrevented=!1,this.target=d}}class Su extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,y){const b=c==="touchend"?y.changedTouches:y.touches,E=ot(d.getCanvasContainer(),b),C=E.map(k=>d.unproject(k)),M=E.reduce((k,F,B,U)=>k.add(F.div(U.length)),new o.pointGeometry(0,0));super(c,{points:E,point:M,lngLats:C,lngLat:d.unproject(M),originalEvent:y}),this._defaultPrevented=!1}}class Ky extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,y){super(c,{originalEvent:y}),this._defaultPrevented=!1}}class om{constructor(c,d){this._map=c,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new Ky(c.type,this._map,c))}mousedown(c,d){return this._mousedownPos=d,this._firePreventable(new Un(c.type,this._map,c))}mouseup(c){this._map.fire(new Un(c.type,this._map,c))}preclick(c){const d=o.extend({},c);d.type="preclick",this._map.fire(new Un(d.type,this._map,d))}click(c,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(c),this._map.fire(new Un(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new Un(c.type,this._map,c))}mouseover(c){this._map.fire(new Un(c.type,this._map,c))}mouseout(c){this._map.fire(new Un(c.type,this._map,c))}touchstart(c){return this._firePreventable(new Su(c.type,this._map,c))}touchmove(c){this._map.fire(new Su(c.type,this._map,c))}touchend(c){this._map.fire(new Su(c.type,this._map,c))}touchcancel(c){this._map.fire(new Su(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Iu{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new Un(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Un("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Un(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class If{constructor(c,d){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,d){this.isEnabled()&&c.shiftKey&&c.button===0&&(be(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(c,d){if(!this._active)return;const y=d,b=this._startPos,E=this._lastPos;if(!b||!E||E.equals(y)||!this._box&&y.dist(b)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=L("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const C=Math.min(b.x,y.x),M=Math.max(b.x,y.x),k=Math.min(b.y,y.y),F=Math.max(b.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${C}px,${k}px)`,this._box.style.width=M-C+"px",this._box.style.height=F-k+"px")})}mouseupWindow(c,d){if(!this._active)return;const y=this._startPos,b=d;if(y&&c.button===0){if(this.reset(),Ie(),y.x!==b.x||y.y!==b.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:E=>E.fitScreenCoordinates(y,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ue(),delete this._startPos,delete this._lastPos}_fireEvent(c,d){return this._map.fire(new o.Event(c,{originalEvent:d}))}}function Cu(g,c){const d={};for(let y=0;y<g.length;y++)d[g[y].identifier]=c[y];return d}class am{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,d,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=c.timeStamp),y.length===this.numTouches&&(this.centroid=function(b){const E=new o.pointGeometry(0,0);for(const C of b)E._add(C);return E.div(b.length)}(d),this.touches=Cu(y,d)))}touchmove(c,d,y){if(this.aborted||!this.centroid)return;const b=Cu(y,d);for(const E in this.touches){const C=this.touches[E],M=b[E];(!M||M.dist(C)>30)&&(this.aborted=!0)}}touchend(c,d,y){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Ha{constructor(c){this.singleTap=new am(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,d,y){this.singleTap.touchstart(c,d,y)}touchmove(c,d,y){this.singleTap.touchmove(c,d,y)}touchend(c,d,y){const b=this.singleTap.touchend(c,d,y);if(b){const E=c.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(b)<30;if(E&&C||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Cf{constructor(){this._zoomIn=new Ha({numTouches:1,numTaps:2}),this._zoomOut=new Ha({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,d,y){this._zoomIn.touchstart(c,d,y),this._zoomOut.touchstart(c,d,y)}touchmove(c,d,y){this._zoomIn.touchmove(c,d,y),this._zoomOut.touchmove(c,d,y)}touchend(c,d,y){const b=this._zoomIn.touchend(c,d,y),E=this._zoomOut.touchend(c,d,y);return b?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(b)},{originalEvent:c})}):E?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(E)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const lm={0:1,2:2};class Mu{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,d){return!1}_move(c,d){return{}}mousedown(c,d){if(this._lastPoint)return;const y=lt(c);this._correctButton(c,y)&&(this._lastPoint=d,this._eventButton=y)}mousemoveWindow(c,d){const y=this._lastPoint;if(y){if(c.preventDefault(),this._eventButton!=null&&function(b,E){const C=lm[E];return b.buttons===void 0||(b.buttons&C)!==C}(c,this._eventButton))this.reset();else if(this._moved||!(d.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(y,d)}}mouseupWindow(c){this._lastPoint&&lt(c)===this._eventButton&&(this._moved&&Ie(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cm extends Mu{mousedown(c,d){super.mousedown(c,d),this._lastPoint&&(this._active=!0)}_correctButton(c,d){return d===0&&!c.ctrlKey}_move(c,d){return{around:d,panDelta:d.sub(c)}}}class Mf extends Mu{_correctButton(c,d){return d===0&&c.ctrlKey||d===2}_move(c,d){const y=.8*(d.x-c.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(c){c.preventDefault()}}class Rf extends Mu{_correctButton(c,d){return d===0&&c.ctrlKey||d===2}_move(c,d){const y=-.5*(d.y-c.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(c){c.preventDefault()}}class Xa{constructor(c,d){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(c,d,y){return this._calculateTransform(c,d,y)}touchmove(c,d,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(y.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,d,y)}}touchend(c,d,y){this._calculateTransform(c,d,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,d,y){y.length>0&&(this._active=!0);const b=Cu(y,d),E=new o.pointGeometry(0,0),C=new o.pointGeometry(0,0);let M=0;for(const F in b){const B=b[F],U=this._touches[F];U&&(E._add(B),C._add(B.sub(U)),M++,b[F]=B)}if(this._touches=b,M<this._minTouches||!C.mag())return;const k=C.div(M);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(M),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=L("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Ru{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,d,y){return{}}touchstart(c,d,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([d[0],d[1]]))}touchmove(c,d,y){const b=this._firstTwoTouches;if(!b)return;c.preventDefault();const[E,C]=b,M=Jl(y,d,E),k=Jl(y,d,C);if(!M||!k)return;const F=this._aroundCenter?null:M.add(k).div(2);return this._move([M,k],F,c)}touchend(c,d,y){if(!this._firstTwoTouches)return;const[b,E]=this._firstTwoTouches,C=Jl(y,d,b),M=Jl(y,d,E);C&&M||(this._active&&Ie(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Jl(g,c,d){for(let y=0;y<g.length;y++)if(g[y].identifier===d)return c[y]}function um(g,c){return Math.log(g/c)/Math.LN2}class hm extends Ru{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,d){const y=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(um(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:um(this._distance,y),pinchAround:d}}}function Pf(g,c){return 180*g.angleWith(c)/Math.PI}class fm extends Ru{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,d){const y=this._vector;if(this._vector=c[0].sub(c[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Pf(this._vector,y),pinchAround:d}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const d=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const b=Pf(c,y);return Math.abs(b)<d}}function Pu(g){return Math.abs(g.y)>Math.abs(g.x)}class nr extends Ru{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,Pu(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,d,y){const b=this._lastPoints;if(!b)return;const E=c[0].sub(b[0]),C=c[1].sub(b[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(E,C,y.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(E.y+C.y)/2*-.5})}gestureBeginsVertically(c,d,y){if(this._valid!==void 0)return this._valid;const b=c.mag()>=2,E=d.mag()>=2;if(!b&&!E)return;if(!b||!E)return this._firstMove==null&&(this._firstMove=y),y-this._firstMove<100&&void 0;const C=c.y>0==d.y>0;return Pu(c)&&Pu(d)&&C}}const Jy={panStep:100,bearingStep:15,pitchStep:10};class dm{constructor(){const c=Jy;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let d=0,y=0,b=0,E=0,C=0;switch(c.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:c.shiftKey?y=-1:(c.preventDefault(),E=-1);break;case 39:c.shiftKey?y=1:(c.preventDefault(),E=1);break;case 38:c.shiftKey?b=1:(c.preventDefault(),C=-1);break;case 40:c.shiftKey?b=-1:(c.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(y=0,b=0),{cameraAnimation:M=>{const k=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:Qy,zoom:d?Math.round(k)+d*(c.shiftKey?2:1):k,bearing:M.getBearing()+y*this._bearingStep,pitch:M.getPitch()+b*this._pitchStep,offset:[-E*this._panStep,-C*this._panStep],center:M.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Qy(g){return g*(2-g)}const pm=4.000244140625;class zs{constructor(c,d){this._map=c,this._el=c.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&c.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=c.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const y=o.exported.now(),b=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,d!==0&&d%pm==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(b*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),c.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=c,this._delta-=d,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=me(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;this._type==="wheel"&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>pm?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&F!==0&&(F=1/F);const B=d(),U=Math.pow(2,B),X=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(X*F))),this._type==="wheel"&&(this._startZoom=B,this._easing=this._smoothOutEasing(200)),this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:d(),b=this._startZoom,E=this._easing;let C,M=!1;if(this._type==="wheel"&&b&&E){const k=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),F=E(k);C=o.number(b,y,F),k<1?this._frameId||(this._frameId=!0):M=!0}else C=y,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:C-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let d=o.ease;if(this._prevEase){const y=this._prevEase,b=(o.exported.now()-y.start)/y.duration,E=y.easing(b+.01)-y.easing(b),C=.27/Math.sqrt(E*E+1e-4)*.01,M=Math.sqrt(.0729-C*C);d=o.bezier(C,M,.25,1)}return this._prevEase={start:o.exported.now(),duration:c,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=L("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class mm{constructor(c,d){this._clickZoom=c,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qa{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,d){return c.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(c.shiftKey?-1:1),around:y.unproject(d)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ws{constructor(){this._tap=new Ha({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,d,y){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=d[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(c,d,y))}touchmove(c,d,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const b=d[0],E=b.y-this._swipePoint.y;return this._swipePoint=b,c.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(c,d,y)}touchend(c,d,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(c,d,y)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ku{constructor(c,d,y){this._el=c,this._mousePan=d,this._touchPan=y}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Dt{constructor(c,d,y){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=d,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class gm{constructor(c,d,y,b){this._el=c,this._touchZoom=d,this._touchRotate=y,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ql=g=>g.zoom||g.drag||g.pitch||g.rotate;class ec extends o.Event{}class tc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,d){const y=o.sub([],d,c);this.radius=o.length(y[2]<0?o.div([],y,this.constants):[y[0],y[1],0])}projectRay(c){o.div(c,c,this.constants),o.normalize(c,c),o.mul$1(c,c,this.constants);const d=o.scale$2([],c,this.radius);if(d[2]>0){const y=o.scale$2([],[0,0,1],o.dot(d,[0,0,1])),b=o.scale$2([],o.normalize([],[d[0],d[1],0]),this.radius),E=o.add([],d,o.scale$2([],o.sub([],o.add([],b,y),d),2));d[0]=E[0],d[1]=E[1]}return d}}function ic(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class _m{constructor(c,d){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Au(c),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new tc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),o.bindAll(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[b,E,C]of this._listeners)b.addEventListener(E,b===o.window.document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[c,d,y]of this._listeners)c.removeEventListener(d,c===o.window.document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(c){const d=this._map,y=d.getCanvasContainer();this._add("mapEvent",new om(d,c));const b=d.boxZoom=new If(d,c);this._add("boxZoom",b);const E=new Cf,C=new qa;d.doubleClickZoom=new mm(C,E),this._add("tapZoom",E),this._add("clickZoom",C);const M=new ws;this._add("tapDragZoom",M);const k=d.touchPitch=new nr(d);this._add("touchPitch",k);const F=new Mf(c),B=new Rf(c);d.dragRotate=new Dt(c,F,B),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const U=new cm(c),X=new Xa(d,c);d.dragPan=new ku(y,U,X),this._add("mousePan",U),this._add("touchPan",X,["touchZoom","touchRotate"]);const Y=new fm,K=new hm;d.touchZoomRotate=new gm(y,K,Y,M),this._add("touchRotate",Y,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Iu(d));const J=d.scrollZoom=new zs(d,this);this._add("scrollZoom",J,["mousePan"]);const Q=d.keyboard=new dm;this._add("keyboard",Q);for(const H of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[H]&&d[H].enable(c[H])}_add(c,d,y){this._handlers.push({handlerName:c,handler:d,allowed:y}),this._handlersById[c]=d}stop(c){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ql(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,d,y){for(const b in c)if(b!==y&&(!d||d.indexOf(b)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const d=[];for(const y of c)this._el.contains(y.target)&&d.push(y);return d}handleEvent(c,d){this._updatingCamera=!0;const y=c.type==="renderFrame",b=y?void 0:c,E={needsRenderFrame:!1},C={},M={},k=c.touches?this._getMapTouches(c.touches):void 0,F=k?ot(this._el,k):y?void 0:me(this._el,c);for(const{handlerName:X,handler:Y,allowed:K}of this._handlers){if(!Y.isEnabled())continue;let J;this._blockedByActive(M,K,X)?Y.reset():Y[d||c.type]&&(J=Y[d||c.type](c,F,k),this.mergeHandlerResult(E,C,J,X,b),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||Y.isActive())&&(M[X]=Y)}const B={};for(const X in this._previousActiveHandlers)M[X]||(B[X]=b);this._previousActiveHandlers=M,(Object.keys(B).length||ic(E))&&(this._changes.push([E,C,B]),this._triggerRenderFrame()),(Object.keys(M).length||ic(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=E;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(c,d,y,b,E){if(!y)return;o.extend(c,y);const C={handlerName:b,originalEvent:y.originalEvent||E};y.zoomDelta!==void 0&&(d.zoom=C),y.panDelta!==void 0&&(d.drag=C),y.pitchDelta!==void 0&&(d.pitch=C),y.bearingDelta!==void 0&&(d.rotate=C)}_applyChanges(){const c={},d={},y={};for(const[b,E,C]of this._changes)b.panDelta&&(c.panDelta=(c.panDelta||new o.pointGeometry(0,0))._add(b.panDelta)),b.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(c.around=b.around),b.aroundCoord!==void 0&&(c.aroundCoord=b.aroundCoord),b.pinchAround!==void 0&&(c.pinchAround=b.pinchAround),b.noInertia&&(c.noInertia=b.noInertia),o.extend(d,E),o.extend(y,C);this._updateMapTransform(c,d,y),this._changes=[]}_updateMapTransform(c,d,y){const b=this._map,E=b.transform,C=le=>[le.x,le.y,le.z];if((le=>{const ae=this._eventsInProgress.drag;return ae&&!this._handlersById[ae.handlerName].isActive()})()&&!ic(c)){const le=E.zoom;E.cameraElevationReference="sea",E.recenterOnTerrain(),E.cameraElevationReference="ground",le!==E.zoom&&this._map._update(!0)}if(E._isCameraConstrained&&b._stop(!0),!ic(c))return void this._fireEvents(d,y,!0);let{panDelta:M,zoomDelta:k,bearingDelta:F,pitchDelta:B,around:U,aroundCoord:X,pinchAround:Y}=c;E._isCameraConstrained&&(k>0&&(k=0),E._isCameraConstrained=!1),Y!==void 0&&(U=Y),(k||(le=>d.drag&&!this._eventsInProgress.drag)())&&U&&(this._dragOrigin=C(E.pointCoordinate3D(U)),this._trackingEllipsoid.setup(E._camera.position,this._dragOrigin)),E.cameraElevationReference="sea",b._stop(!0),U=U||b.transform.centerPoint,F&&(E.bearing+=F),B&&(E.pitch+=B),E._updateCameraState();const K=[0,0,0];if(M)if(E.projection.name==="mercator"){const le=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(U).dir),ae=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(U.sub(M)).dir);K[0]=ae[0]-le[0],K[1]=ae[1]-le[1]}else{const le=E.pointCoordinate(U);if(E.projection.name==="globe"){M=M.rotate(-E.angle);const ae=E._pixelsPerMercatorPixel/E.worldSize;K[0]=-M.x*o.mercatorScale(o.latFromMercatorY(le.y))*ae,K[1]=-M.y*o.mercatorScale(E.center.lat)*ae}else{const ae=E.pointCoordinate(U.sub(M));le&&ae&&(K[0]=ae.x-le.x,K[1]=ae.y-le.y)}}const J=E.zoom,Q=[0,0,0];if(k){const le=C(X||E.pointCoordinate3D(U)),ae={dir:o.normalize([],o.sub([],le,E._camera.position))};if(ae.dir[2]<0){const ce=E.zoomDeltaToMovement(le,k);o.scale$2(Q,ae.dir,ce)}}const H=o.add(K,K,Q);E._translateCameraConstrained(H),k&&Math.abs(E.zoom-J)>1e-4&&E.recenterOnTerrain(),E.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(d,y,!0)}_fireEvents(c,d,y){const b=Ql(this._eventsInProgress),E=Ql(c),C={};for(const B in c){const{originalEvent:U}=c[B];this._eventsInProgress[B]||(C[`${B}start`]=U),this._eventsInProgress[B]=c[B]}!b&&E&&this._fireEvent("movestart",E.originalEvent);for(const B in C)this._fireEvent(B,C[B]);E&&this._fireEvent("move",E.originalEvent);for(const B in c){const{originalEvent:U}=c[B];this._fireEvent(B,U)}const M={};let k;for(const B in this._eventsInProgress){const{handlerName:U,originalEvent:X}=this._eventsInProgress[B];this._handlersById[U].isActive()||(delete this._eventsInProgress[B],k=d[U]||X,M[`${B}end`]=k)}for(const B in M)this._fireEvent(B,M[B]);const F=Ql(this._eventsInProgress);if(y&&(b||E)&&!F){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=X=>X!==0&&-this._bearingSnap<X&&X<this._bearingSnap;B?(U(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:k})):(this._map.fire(new o.Event("moveend",{originalEvent:k})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,d){this._map.fire(new o.Event(c,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new ec("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const kf="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ym extends o.Evented{constructor(c,d){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,d){return this.jumpTo({center:c},d)}panBy(c,d,y){return c=o.pointGeometry.convert(c).mult(-1),this.panTo(this.transform.center,o.extend({offset:c},d),y)}panTo(c,d,y){return this.easeTo(o.extend({center:c},d),y)}getZoom(){return this.transform.zoom}setZoom(c,d){return this.jumpTo({zoom:c},d),this}zoomTo(c,d,y){return this.easeTo(o.extend({zoom:c},d),y)}zoomIn(c,d){return this.zoomTo(this.getZoom()+1,c,d),this}zoomOut(c,d){return this.zoomTo(this.getZoom()-1,c,d),this}getBearing(){return this.transform.bearing}setBearing(c,d){return this.jumpTo({bearing:c},d),this}getPadding(){return this.transform.padding}setPadding(c,d){return this.jumpTo({padding:c},d),this}rotateTo(c,d,y){return this.easeTo(o.extend({bearing:c},d),y)}resetNorth(c,d){return this.rotateTo(0,o.extend({duration:1e3},c),d),this}resetNorthPitch(c,d){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},c),d),this}snapToNorth(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this}getPitch(){return this.transform.pitch}setPitch(c,d){return this.jumpTo({pitch:c},d),this}cameraForBounds(c,d){c=o.LngLatBounds.convert(c);const y=d&&d.bearing||0,b=d&&d.pitch||0,E=c.getNorthWest(),C=c.getSouthEast();return this._cameraForBounds(this.transform,E,C,y,b,d)}_extendCameraOptions(c){const d={top:0,bottom:0,right:0,left:0};if(typeof(c=o.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const y=c.padding;c.padding={top:y,bottom:y,right:y,left:y}}return c.padding=o.extend(d,c.padding),c}_minimumAABBFrustumDistance(c,d){const y=d.max[0]-d.min[0],b=d.max[1]-d.min[1];return y/b>c.aspect?y/(2*Math.tan(.5*c.fovX)*c.aspect):b/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,d,y,b,E,C){const M=c.clone(),k=this._extendCameraOptions(C);M.bearing=b,M.pitch=E;const F=o.LngLat.convert(d),B=o.LngLat.convert(y),U=.5*(F.lat+B.lat),X=.5*(F.lng+B.lng),Y=o.latLngToECEF(U,X),K=o.normalize([],Y),J=o.normalize([],o.cross([],K,[0,1,0])),Q=o.cross([],J,K),H=[J[0],J[1],J[2],0,Q[0],Q[1],Q[2],0,K[0],K[1],K[2],0,0,0,0,1],le=[Y,o.latLngToECEF(F.lat,F.lng),o.latLngToECEF(B.lat,F.lng),o.latLngToECEF(B.lat,B.lng),o.latLngToECEF(F.lat,B.lng),o.latLngToECEF(U,F.lng),o.latLngToECEF(U,B.lng),o.latLngToECEF(F.lat,X),o.latLngToECEF(B.lat,X)];let ae=o.Aabb.fromPoints(le.map(it=>[o.dot(J,it),o.dot(Q,it),o.dot(K,it)]));const ce=o.transformMat4([],ae.center,H);o.squaredLength(ce)===0&&o.set(ce,0,0,1),o.normalize(ce,ce),o.scale$2(ce,ce,o.GLOBE_RADIUS),M.center=o.ecefToLatLng(ce);const ve=M.getWorldToCameraMatrix(),_e=o.invert(new Float64Array(16),ve);ae=o.Aabb.applyTransform(ae,o.multiply([],ve,H)),o.transformMat4(ce,ce,ve);const Ee=.5*(ae.max[2]-ae.min[2]),Re=this._minimumAABBFrustumDistance(M,ae),ze=o.scale$2([],[0,0,1],Ee),je=o.add(ze,ce,ze),gt=Re+(M.pitch===0?0:o.distance(ce,je)),Le=M.globeCenterInViewSpace,Qe=o.sub([],ce,[Le[0],Le[1],Le[2]]);o.normalize(Qe,Qe),o.scale$2(Qe,Qe,gt);const qe=o.add([],ce,Qe);o.transformMat4(qe,qe,_e);const st=o.earthRadius/o.GLOBE_RADIUS,Ue=o.length(qe),Ce=o.mercatorZfromAltitude(Math.max(Ue*st-o.earthRadius,Number.EPSILON),0),$e=Math.min(M.zoomFromMercatorZAdjusted(Ce),k.maxZoom);return $e>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(M.setProjection({name:"mercator"}),M.zoom=$e,this._cameraForBounds(M,d,y,b,E,C)):{center:M.center,zoom:$e,bearing:b,pitch:E}}queryTerrainElevation(c,d){const y=this.transform.elevation;return y?(d=o.extend({},{exaggerated:!0},d),y.getAtPoint(o.MercatorCoordinate.fromLngLat(c),null,d.exaggerated)):null}_cameraForBounds(c,d,y,b,E,C){if(c.projection.name==="globe")return this._cameraForBoundsOnGlobe(c,d,y,b,E,C);const M=c.clone(),k=this._extendCameraOptions(C),F=M.padding;M.bearing=b,M.pitch=E;const B=o.LngLat.convert(d),U=o.LngLat.convert(y),X=new o.LngLat(B.lng,U.lat),Y=new o.LngLat(U.lng,B.lat),K=M.project(B),J=M.project(U),Q=this.queryTerrainElevation(B),H=this.queryTerrainElevation(U),le=this.queryTerrainElevation(X),ae=this.queryTerrainElevation(Y),ce=[[K.x,K.y,Math.min(Q||0,H||0,le||0,ae||0)],[J.x,J.y,Math.max(Q||0,H||0,le||0,ae||0)]];let ve=o.Aabb.fromPoints(ce);const _e=M.getWorldToCameraMatrix(),Ee=o.invert(new Float64Array(16),_e);ve=o.Aabb.applyTransform(ve,_e);const Re=o.sub([],ve.max,ve.min),ze=F.left||0,je=F.right||0,gt=F.bottom||0,Le=F.top||0,{left:Qe,right:qe,top:st,bottom:Ue}=k.padding,Ce=.5*(ze+je),$e=.5*(Le+gt),it=Math.min(M.scaleZoom(M.scale*Math.min((M.width-(ze+je+Qe+qe))/Re[0],(M.height-(gt+Le+Ue+st))/Re[1])),k.maxZoom),ct=M.scale/M.zoomScale(it);ve=new o.Aabb([ve.min[0]-(Qe+Ce)*ct,ve.min[1]-(Ue+$e)*ct,ve.min[2]],[ve.max[0]+(qe+Ce)*ct,ve.max[1]+(st+$e)*ct,ve.max[2]]);const Nt=.5*Re[2],si=this._minimumAABBFrustumDistance(M,ve),Lt=[0,0,1,0];o.transformMat4$1(Lt,Lt,_e),o.normalize$2(Lt,Lt);const Rt=o.scale$2([],Lt,si+Nt),zt=o.add([],ve.center,Rt),hi=(typeof k.offset.x=="number"&&typeof k.offset.y=="number"?new o.pointGeometry(k.offset.x,k.offset.y):o.pointGeometry.convert(k.offset)).rotate(-o.degToRad(b));ve.center[0]-=hi.x*ct,ve.center[1]+=hi.y*ct,o.transformMat4(ve.center,ve.center,Ee),o.transformMat4(zt,zt,Ee);const Wt=[ve.center[0],ve.center[1],zt[2]*M.pixelsPerMeter];o.scale$2(Wt,Wt,1/M.worldSize);const Mi=o.lngFromMercatorX(Wt[0]),Ri=o.latFromMercatorY(Wt[1]),Wi=Math.min(M._zoomFromMercatorZ(Wt[2]),k.maxZoom),Vi=new o.LngLat(Mi,Ri);return M.mercatorFromTransition&&Wi<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(M.setProjection({name:"globe"}),M.zoom=Wi,this._cameraForBounds(M,d,y,b,E,C)):{center:Vi,zoom:Wi,bearing:b,pitch:E}}fitBounds(c,d,y){const b=this.cameraForBounds(c,d);return this._fitInternal(b,d,y)}fitScreenCoordinates(c,d,y,b,E){const C=o.pointGeometry.convert(c),M=o.pointGeometry.convert(d),k=new o.pointGeometry(Math.min(C.x,M.x),Math.min(C.y,M.y)),F=new o.pointGeometry(Math.max(C.x,M.x),Math.max(C.y,M.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(C,M))return this;const B=this.transform.pointLocation3D(k),U=this.transform.pointLocation3D(F),X=this.transform.pointLocation3D(new o.pointGeometry(k.x,F.y)),Y=this.transform.pointLocation3D(new o.pointGeometry(F.x,k.y)),K=[Math.min(B.lng,U.lng,X.lng,Y.lng),Math.min(B.lat,U.lat,X.lat,Y.lat)],J=[Math.max(B.lng,U.lng,X.lng,Y.lng),Math.max(B.lat,U.lat,X.lat,Y.lat)],Q=b&&b.pitch?b.pitch:this.getPitch(),H=this._cameraForBounds(this.transform,K,J,y,Q,b);return this._fitInternal(H,b,E)}_fitInternal(c,d,y){return c?(delete(d=o.extend(c,d)).padding,d.linear?this.easeTo(d,y):this.flyTo(d,y)):this}jumpTo(c,d){this.stop();const y=c.preloadOnly?this.transform.clone():this.transform;let b=!1,E=!1,C=!1;return"zoom"in c&&y.zoom!==+c.zoom&&(b=!0,y.zoom=+c.zoom),c.center!==void 0&&(y.center=o.LngLat.convert(c.center)),"bearing"in c&&y.bearing!==+c.bearing&&(E=!0,y.bearing=+c.bearing),"pitch"in c&&y.pitch!==+c.pitch&&(C=!0,y.pitch=+c.pitch),c.padding==null||y.isPaddingEqual(c.padding)||(y.padding=c.padding),c.preloadOnly?(this._preloadTiles(y),this):(this.fire(new o.Event("movestart",d)).fire(new o.Event("move",d)),b&&this.fire(new o.Event("zoomstart",d)).fire(new o.Event("zoom",d)).fire(new o.Event("zoomend",d)),E&&this.fire(new o.Event("rotatestart",d)).fire(new o.Event("rotate",d)).fire(new o.Event("rotateend",d)),C&&this.fire(new o.Event("pitchstart",d)).fire(new o.Event("pitch",d)).fire(new o.Event("pitchend",d)),this.fire(new o.Event("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(kf),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,d){const y=this.transform;if(!y.projection.supportsFreeCamera)return o.warnOnce(kf),this;this.stop();const b=y.zoom,E=y.pitch,C=y.bearing;y.setFreeCameraOptions(c);const M=b!==y.zoom,k=E!==y.pitch,F=C!==y.bearing;return this.fire(new o.Event("movestart",d)).fire(new o.Event("move",d)),M&&this.fire(new o.Event("zoomstart",d)).fire(new o.Event("zoom",d)).fire(new o.Event("zoomend",d)),F&&this.fire(new o.Event("rotatestart",d)).fire(new o.Event("rotate",d)).fire(new o.Event("rotateend",d)),k&&this.fire(new o.Event("pitchstart",d)).fire(new o.Event("pitch",d)).fire(new o.Event("pitchend",d)),this.fire(new o.Event("moveend",d)),this}easeTo(c,d){this._stop(!1,c.easeId),((c=o.extend({offset:[0,0],duration:500,easing:o.ease},c)).animate===!1||!c.essential&&o.exported.prefersReducedMotion)&&(c.duration=0);const y=this.transform,b=this.getZoom(),E=this.getBearing(),C=this.getPitch(),M=this.getPadding(),k="zoom"in c?+c.zoom:b,F="bearing"in c?this._normalizeBearing(c.bearing,E):E,B="pitch"in c?+c.pitch:C,U="padding"in c?c.padding:y.padding,X=o.pointGeometry.convert(c.offset);let Y,K,J;if(y.projection.name==="globe"){const ze=o.MercatorCoordinate.fromLngLat(y.center),je=X.rotate(-y.angle);ze.x+=je.x/y.worldSize,ze.y+=je.y/y.worldSize;const gt=ze.toLngLat(),Le=o.LngLat.convert(c.center||gt);this._normalizeCenter(Le),Y=y.centerPoint.add(je),K=new o.pointGeometry(ze.x,ze.y).mult(y.worldSize),J=new o.pointGeometry(o.mercatorXfromLng(Le.lng),o.mercatorYfromLat(Le.lat)).mult(y.worldSize).sub(K)}else{Y=y.centerPoint.add(X);const ze=y.pointLocation(Y),je=o.LngLat.convert(c.center||ze);this._normalizeCenter(je),K=y.project(ze),J=y.project(je).sub(K)}const Q=y.zoomScale(k-b);let H,le;c.around&&(H=o.LngLat.convert(c.around),le=y.locationPoint(H));const ae=this._zooming||k!==b,ce=this._rotating||E!==F,ve=this._pitching||B!==C,_e=!y.isPaddingEqual(U),Ee=ze=>je=>{if(ae&&(ze.zoom=o.number(b,k,je)),ce&&(ze.bearing=o.number(E,F,je)),ve&&(ze.pitch=o.number(C,B,je)),_e&&(ze.interpolatePadding(M,U,je),Y=ze.centerPoint.add(X)),H)ze.setLocationAtPoint(H,le);else{const gt=ze.zoomScale(ze.zoom-b),Le=k>b?Math.min(2,Q):Math.max(.5,Q),Qe=Math.pow(Le,1-je),qe=ze.unproject(K.add(J.mult(je*Qe)).mult(gt));ze.setLocationAtPoint(ze.renderWorldCopies?qe.wrap():qe,Y)}return c.preloadOnly||this._fireMoveEvents(d),ze};if(c.preloadOnly){const ze=this._emulate(Ee,c.duration,y);return this._preloadTiles(ze),this}const Re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ae,this._rotating=ce,this._pitching=ve,this._padding=_e,this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,Re),this._ease(Ee(y),ze=>{y.recenterOnTerrain(),this._afterEase(d,ze)},c),this}_prepareEase(c,d,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||y.moving||this.fire(new o.Event("movestart",c)),this._zooming&&!y.zooming&&this.fire(new o.Event("zoomstart",c)),this._rotating&&!y.rotating&&this.fire(new o.Event("rotatestart",c)),this._pitching&&!y.pitching&&this.fire(new o.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new o.Event("move",c)),this._zooming&&this.fire(new o.Event("zoom",c)),this._rotating&&this.fire(new o.Event("rotate",c)),this._pitching&&this.fire(new o.Event("pitch",c))}_afterEase(c,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,b=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new o.Event("zoomend",c)),b&&this.fire(new o.Event("rotateend",c)),E&&this.fire(new o.Event("pitchend",c)),this.fire(new o.Event("moveend",c))}flyTo(c,d){if(!c.essential&&o.exported.prefersReducedMotion){const it=o.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(it,d)}this.stop(),c=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},c);const y=this.transform,b=this.getZoom(),E=this.getBearing(),C=this.getPitch(),M=this.getPadding(),k="zoom"in c?o.clamp(+c.zoom,y.minZoom,y.maxZoom):b,F="bearing"in c?this._normalizeBearing(c.bearing,E):E,B="pitch"in c?+c.pitch:C,U="padding"in c?c.padding:y.padding,X=y.zoomScale(k-b),Y=o.pointGeometry.convert(c.offset);let K=y.centerPoint.add(Y);const J=y.pointLocation(K),Q=o.LngLat.convert(c.center||J);this._normalizeCenter(Q);const H=y.project(J),le=y.project(Q).sub(H);let ae=c.curve;const ce=Math.max(y.width,y.height),ve=ce/X,_e=le.mag();if("minZoom"in c){const it=o.clamp(Math.min(c.minZoom,b,k),y.minZoom,y.maxZoom),ct=ce/y.zoomScale(it-b);ae=Math.sqrt(ct/_e*2)}const Ee=ae*ae;function Re(it){const ct=(ve*ve-ce*ce+(it?-1:1)*Ee*Ee*_e*_e)/(2*(it?ve:ce)*Ee*_e);return Math.log(Math.sqrt(ct*ct+1)-ct)}function ze(it){return(Math.exp(it)-Math.exp(-it))/2}function je(it){return(Math.exp(it)+Math.exp(-it))/2}const gt=Re(0);let Le=function(it){return je(gt)/je(gt+ae*it)},Qe=function(it){return ce*((je(gt)*(ze(ct=gt+ae*it)/je(ct))-ze(gt))/Ee)/_e;var ct},qe=(Re(1)-gt)/ae;if(Math.abs(_e)<1e-6||!isFinite(qe)){if(Math.abs(ce-ve)<1e-6)return this.easeTo(c,d);const it=ve<ce?-1:1;qe=Math.abs(Math.log(ve/ce))/ae,Qe=function(){return 0},Le=function(ct){return Math.exp(it*ae*ct)}}c.duration="duration"in c?+c.duration:1e3*qe/("screenSpeed"in c?+c.screenSpeed/ae:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const st=E!==F,Ue=B!==C,Ce=!y.isPaddingEqual(U),$e=it=>ct=>{const Nt=ct*qe,si=1/Le(Nt);it.zoom=ct===1?k:b+it.scaleZoom(si),st&&(it.bearing=o.number(E,F,ct)),Ue&&(it.pitch=o.number(C,B,ct)),Ce&&(it.interpolatePadding(M,U,ct),K=it.centerPoint.add(Y));const Lt=ct===1?Q:it.unproject(H.add(le.mult(Qe(Nt))).mult(si));return it.setLocationAtPoint(it.renderWorldCopies?Lt.wrap():Lt,K),it._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(d),it};if(c.preloadOnly){const it=this._emulate($e,c.duration,y);return this._preloadTiles(it),this}return this._zooming=!0,this._rotating=st,this._pitching=Ue,this._padding=Ce,this._prepareEase(d,!1),this._ease($e(y),()=>this._afterEase(d),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,d)}if(!c){const y=this.handlers;y&&y.stop(!1)}return this}_ease(c,d,y){y.animate===!1||y.duration===0?(c(1),d()):(this._easeStart=o.exported.now(),this._easeOptions=y,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,d){c=o.wrap(c,-180,180);const y=Math.abs(c-d);return Math.abs(c-360-d)<y&&(c-=360),Math.abs(c+360-d)<y&&(c+=360),c}_normalizeCenter(c){const d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;const y=c.lng-d.center.lng;c.lng+=y>180?-360:y<-180?360:0}_emulate(c,d,y){const b=Math.ceil(15*d/1e3),E=[],C=c(y.clone());for(let M=0;M<=b;M++){const k=C(M/b);E.push(k.clone())}return E}}class Df{constructor(c={}){this.options=c,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const d=this.options&&this.options.compact;return this._map=c,this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=L("button","mapboxgl-ctrl-attrib-button",this._container),L("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,d){const y=this._map._getUIString(`AttributionControl.${d}`);c.setAttribute("aria-label",y),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",y)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(c){const y=d.reduce((b,E,C)=>(E.value&&(b+=`${E.key}=${E.value}${C<d.length-1?"&":""}`),b),"?");c.href=`${o.config.FEEDBACK_URL}/${y}#${Af(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const d=this._map.style._sourceCaches;for(const b in d){const E=d[b];if(E.used){const C=E.getSource();C.attribution&&c.indexOf(C.attribution)<0&&c.push(C.attribution)}}c.sort((b,E)=>b.length-E.length),c=c.filter((b,E)=>{for(let C=E+1;C<c.length;C++)if(c[C].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const y=c.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,c.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Of{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=L("div","mapboxgl-ctrl");const d=L("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(Object.entries(c).length===0)return!0;for(const d in c){const y=c[d].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const d=c[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class nc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const d=++this._id;return this._queue.push({callback:c,id:d,cancelled:!1}),d}remove(c){const d=this._currentlyRunning,y=d?this._queue.concat(d):this._queue;for(const b of y)if(b.id===c)return void(b.cancelled=!0)}run(c=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const y of d)if(!y.cancelled&&(y.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Du(g,c,d){if(g=new o.LngLat(g.lng,g.lat),c){const y=new o.LngLat(g.lng-360,g.lat),b=new o.LngLat(g.lng+360,g.lat),E=360*Math.ceil(Math.abs(g.lng-d.center.lng)/360),C=d.locationPoint(g).distSqr(c),M=c.x<0||c.y<0||c.x>d.width||c.y>d.height;d.locationPoint(y).distSqr(c)<C&&(M||Math.abs(y.lng-d.center.lng)<E)?g=y:d.locationPoint(b).distSqr(c)<C&&(M||Math.abs(b.lng-d.center.lng)<E)&&(g=b)}for(;Math.abs(g.lng-d.center.lng)>180;){const y=d.locationPoint(g);if(y.x>=0&&y.y>=0&&y.x<=d.width&&y.y<=d.height)break;g.lng>d.center.lng?g.lng-=360:g.lng+=360}return g}const Ga={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ou extends o.Evented{constructor(c,d){if(super(),(c instanceof o.window.HTMLElement||d)&&(c=o.extend({element:c},d)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=o.pointGeometry.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=L("div");const b=41,E=27,C=j("svg",{display:"block",height:b*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${b}`},this._element),M=j("radialGradient",{id:"shadowGradient"},j("defs",{},C));j("stop",{offset:"10%","stop-opacity":.4},M),j("stop",{offset:"100%","stop-opacity":.05},M),j("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),j("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),j("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),j("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=o.pointGeometry.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const y=this._element.classList;for(const b in Ga)y.remove(`mapboxgl-marker-anchor-${b}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=o.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const d=c.code,y=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(c){const d=c.originalEvent.target,y=this._element;this._popup&&(d===y||y.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,d=this._pos;if(!c||!d)return!1;const y=c.unproject(d),b=c.getFreeCameraOptions();if(!b.position)return!1;const E=b.position.toLngLat();return E.distanceTo(y)<.9*E.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const d=this._pos;if(!d||d.x<0||d.x>c.transform.width||d.y<0||d.y>c.transform.height)return void this._clearFadeTimer();const y=c.unproject(d);let b;c._showingGlobe()&&o.isLngLatBehindGlobe(c.transform,this._lngLat)?b=0:(b=1-c._queryFogOpacity(y),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${c.x}px,${c.y}px)
            ${Ga[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${d.x}px,${d.y}px)
        `}_calculateXYTransform(){const c=this._pos,d=this._map,y=this.getPitchAlignment();if(!d||!c||y!=="map")return"";if(!d._showingGlobe()){const k=d.getPitch();return k?`rotateX(${k}deg)`:""}const b=o.radToDeg(o.globeTiltAtLngLat(d.transform,this._lngLat)),E=c.sub(o.globeCenterToScreenPoint(d.transform)),C=Math.abs(E.x)+Math.abs(E.y);if(C===0)return"";const M=b/C;return`rotateX(${-E.y*M}deg) rotateY(${E.x*M}deg)`}_calculateZTransform(){const c=this._pos,d=this._map;if(!d||!c)return"";let y=0;const b=this.getRotationAlignment();if(b==="map")if(d._showingGlobe()){const E=d.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),C=d.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(E);y=o.radToDeg(Math.atan2(C.y,C.x))-90}else y=-d.getBearing();else if(b==="horizon"){const E=o.smoothstep(4,6,d.getZoom()),C=o.globeCenterToScreenPoint(d.transform);C.y+=E*d.transform.height;const M=c.sub(C),k=o.radToDeg(Math.atan2(M.y,M.x));y=(k>90?k-270:k+90)*(1-E)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(c){o.window.cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Du(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),c===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=o.pointGeometry.convert(c),this._update(),this}_onMove(c){const d=this._map;if(!d)return;const y=this._pointerdownPos,b=this._positionDelta;if(y&&b){if(!this._isDragging){const E=this._clickTolerance||d._clickTolerance;if(c.point.dist(y)<E)return;this._isDragging=!0}this._pos=c.point.sub(b),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(c){const d=this._map,y=this._pos;d&&y&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(y),this._pointerdownPos=c.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const d=this._map;return d&&(c?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const xm={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},vm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Lf(g=new o.pointGeometry(0,0),c="bottom"){if(typeof g=="number"){const d=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(c){case"top":return new o.pointGeometry(0,g);case"top-left":return new o.pointGeometry(d,d);case"top-right":return new o.pointGeometry(-d,d);case"bottom":return new o.pointGeometry(0,-g);case"bottom-left":return new o.pointGeometry(d,-d);case"bottom-right":return new o.pointGeometry(-d,-d);case"left":return new o.pointGeometry(g,0);case"right":return new o.pointGeometry(-g,0)}return new o.pointGeometry(0,0)}return g instanceof o.pointGeometry||Array.isArray(g)?o.pointGeometry.convert(g):o.pointGeometry.convert(g[c]||[0,0])}class bm{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const d=o.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,d,y){this._start=this.getValue(d),this._end=c,this._startTime=d,this._endTime=d+y}}const wm={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Tm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Bf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Em{constructor(c,d,y=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new Mf({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,y&&(this.mousePitch=new Rf({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(c,d){this.mouseRotate.mousedown(c,d),this.mousePitch&&this.mousePitch.mousedown(c,d),be()}move(c,d){const y=this.map,b=this.mouseRotate.mousemoveWindow(c,d),E=b&&b.bearingDelta;if(E&&y.setBearing(y.getBearing()+E),this.mousePitch){const C=this.mousePitch.mousemoveWindow(c,d),M=C&&C.pitchDelta;M&&y.setPitch(y.getPitch()+M)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ue(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(o.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),me(this.element,c)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,me(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ot(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){c.targetTouches.length!==1?this.reset():(this._lastPos=ot(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Am={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Sm={maxWidth:100,unit:"metric"};function Im(g,c,d){const y=Lu(c),b=y/c,E={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[d];this._map._requestDomTask(()=>{this._container.style.width=g*b+"px",this._container.innerHTML=`${y}&nbsp;${E}`})}function Lu(g){const c=Math.pow(10,`${Math.floor(g)}`.length-1);let d=g/c;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:d>=1?1:function(y){const b=Math.pow(10,Math.ceil(-Math.log(y)/Math.LN10));return Math.round(y*b)/b}(d),c*d}const rc={version:o.version,supported:w,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends ym{constructor(g){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(g=o.extend({},Tm,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(g.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Mt(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._useWebGL2=g.useWebGL2,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._optimizeForTerrain=g.optimizeForTerrain,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new nc,this._domRenderTaskQueue=new nc,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},wm,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new bm(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,typeof g.container=="string"){if(this._container=o.window.document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new _m(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this._hash=g.hash&&new rm(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,o.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),g.attributionControl&&this.addControl(new Df({customAttribution:g.customAttribution})),this._logoControl=new Of,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new o.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new o.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(g,c){if(c===void 0&&(c=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=g.onAdd(this);this._controls.push(g);const y=this._controlPositions[c];return c.indexOf("bottom")!==-1?y.insertBefore(d,y.firstChild):y.appendChild(d),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(g);return c>-1&&this._controls.splice(c,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new o.Event("movestart",g)).fire(new o.Event("move",g)),this.fire(new o.Event("resize",g)),c&&this.fire(new o.Event("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(o.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?o.window.navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(c=>c==="auto"?o.window.navigator.language:c):g}setLanguage(g){const c=this._parseLanguage(g);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,c=g.projection.name;let d;c==="globe"&&g.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(g.setMercatorFromTransition(),d=!0):c==="mercator"&&g.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(g.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,c){return this._updateProjection(g||c||{name:"mercator"})}_updateProjection(g){let c;if(c=g.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const d in this.style._sourceCaches)this.style._sourceCaches[d].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(g){return this.transform.locationPoint3D(o.LngLat.convert(g))}unproject(g){return this.transform.pointLocation3D(o.pointGeometry.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,c,d){if(g==="mouseenter"||g==="mouseover"){let y=!1;const b=C=>{const M=c.filter(F=>this.getLayer(F)),k=M.length?this.queryRenderedFeatures(C.point,{layers:M}):[];k.length?y||(y=!0,d.call(this,new Un(g,this,C.originalEvent,{features:k}))):y=!1},E=()=>{y=!1};return{layers:new Set(c),listener:d,delegates:{mousemove:b,mouseout:E}}}if(g==="mouseleave"||g==="mouseout"){let y=!1;const b=C=>{const M=c.filter(k=>this.getLayer(k));(M.length?this.queryRenderedFeatures(C.point,{layers:M}):[]).length?y=!0:y&&(y=!1,d.call(this,new Un(g,this,C.originalEvent)))},E=C=>{y&&(y=!1,d.call(this,new Un(g,this,C.originalEvent)))};return{layers:new Set(c),listener:d,delegates:{mousemove:b,mouseout:E}}}{const y=b=>{const E=c.filter(M=>this.getLayer(M)),C=E.length?this.queryRenderedFeatures(b.point,{layers:E}):[];C.length&&(b.features=C,d.call(this,b),delete b.features)};return{layers:new Set(c),listener:d,delegates:{[g]:y}}}}on(g,c,d){if(d===void 0)return super.on(g,c);Array.isArray(c)||(c=[c]);const y=this._createDelegatedListener(g,c,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(y);for(const b in y.delegates)this.on(b,y.delegates[b]);return this}once(g,c,d){if(d===void 0)return super.once(g,c);Array.isArray(c)||(c=[c]);const y=this._createDelegatedListener(g,c,d);for(const b in y.delegates)this.once(b,y.delegates[b]);return this}off(g,c,d){if(d===void 0)return super.off(g,c);c=new Set(Array.isArray(c)?c:[c]);const y=(E,C)=>{if(E.size!==C.size)return!1;for(const M of E)if(!C.has(M))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[g]:void 0;return b&&(E=>{for(let C=0;C<E.length;C++){const M=E[C];if(M.listener===d&&y(M.layers,c)){for(const k in M.delegates)this.off(k,M.delegates[k]);return E.splice(C,1),this}}})(b),this}queryRenderedFeatures(g,c){return this.style?(c!==void 0||g===void 0||g instanceof o.pointGeometry||Array.isArray(g)||(c=g,g=void 0),this.style.queryRenderedFeatures(g=g||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(g,c){return this.style.querySourceFeatures(g,c)}setStyle(g,c){return(c=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff!==!1&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(g,c))}_getUIString(g){const c=this._locale[g];if(c==null)throw new Error(`Missing UI string '${g}'`);return c}_updateStyle(g,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new Hr(this,c||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Hr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,c){if(typeof g=="string"){const d=this._requestManager.normalizeStyleURL(g),y=this._requestManager.transformRequest(d,o.ResourceType.Style);o.getJSON(y,(b,E)=>{b?this.fire(new o.ErrorEvent(b)):E&&this._updateDiff(E,c)})}else typeof g=="object"&&this._updateDiff(g,c)}_updateDiff(g,c){try{this.style.setState(g)&&this._update(!0)}catch(d){o.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(g,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(g,c){return this._lazyInitEmptyStyle(),this.style.addSource(g,c),this._update(!0)}isSourceLoaded(g){return!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){const g=this.style&&this.style._sourceCaches;for(const c in g){const d=g[c]._tiles;for(const y in d){const b=d[y];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}addSourceType(g,c,d){this._lazyInitEmptyStyle(),this.style.addSourceType(g,c,d)}removeSource(g){return this.style.removeSource(g),this._updateTerrain(),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,c,{pixelRatio:d=1,sdf:y=!1,stretchX:b,stretchY:E,content:C}={}){if(this._lazyInitEmptyStyle(),c instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&c instanceof o.window.ImageBitmap){const{width:M,height:k,data:F}=o.exported.getImageData(c);this.style.addImage(g,{data:new o.RGBAImage({width:M,height:k},F),pixelRatio:d,stretchX:b,stretchY:E,content:C,sdf:y,version:0})}else if(c.width===void 0||c.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:k}=c,F=c;this.style.addImage(g,{data:new o.RGBAImage({width:M,height:k},new Uint8Array(F.data)),pixelRatio:d,stretchX:b,stretchY:E,content:C,sdf:y,version:0,userImage:F}),F.onAdd&&F.onAdd(this,g)}}updateImage(g,c){const d=this.style.getImage(g);if(!d)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=c instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&c instanceof o.window.ImageBitmap?o.exported.getImageData(c):c,{width:b,height:E}=y;b!==void 0&&E!==void 0?b===d.data.width&&E===d.data.height?(d.data.replace(y.data,!(c instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&c instanceof o.window.ImageBitmap)),this.style.updateImage(g,d)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${b}, ${E})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,c){o.getImage(this._requestManager.transformRequest(g,o.ResourceType.Image),(d,y)=>{c(d,y instanceof o.window.HTMLImageElement?o.exported.getImageData(y):y)})}listImages(){return this.style.listImages()}addLayer(g,c){return this._lazyInitEmptyStyle(),this.style.addLayer(g,c),this._update(!0)}moveLayer(g,c){return this.style.moveLayer(g,c),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,c,d){return this.style.setLayerZoomRange(g,c,d),this._update(!0)}setFilter(g,c,d={}){return this.style.setFilter(g,c,d),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,c,d,y={}){return this.style.setPaintProperty(g,c,d,y),this._update(!0)}getPaintProperty(g,c){return this.style.getPaintProperty(g,c)}setLayoutProperty(g,c,d,y={}){return this.style.setLayoutProperty(g,c,d,y),this._update(!0)}getLayoutProperty(g,c){return this.style.getLayoutProperty(g,c)}setLight(g,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(g),this.transform):0}setFeatureState(g,c){return this.style.setFeatureState(g,c),this._update()}removeFeatureState(g,c){return this.style.removeFeatureState(g,c),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let d,y,b,E=this._container;for(;E&&(!y||!b);){const C=o.window.getComputedStyle(E).transform;C&&C!=="none"&&(d=C.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&d[0]!=="0"&&d[0]!=="1"&&(y=d[0]),d[3]&&d[3]!=="0"&&d[3]!=="1"&&(b=d[3])),E=E.parentElement}this._containerWidth=y?Math.abs(g/y):g,this._containerHeight=b?Math.abs(c/b):c}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=L("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=L("div","mapboxgl-canvas-container",g);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=L("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=L("div","mapboxgl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{y[b]=L("div",`mapboxgl-ctrl-${b}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,c){const d=o.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(g),this._canvas.height=d*Math.ceil(c),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${c}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const c=this._markers.indexOf(g);c!==-1&&this._markers.splice(c,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const c=this._popups.indexOf(g);c!==-1&&this._popups.splice(c,1)}_setupPainter(){const g=o.extend({},w.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._useWebGL2&&this._canvas.getContext("webgl2",g),d=c||this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);d?(this._useWebGL2&&!c&&o.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),o.storeAuthState(d,!0),this.painter=new Xl(d,this.transform,!!c),this.on("data",y=>{y.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(d)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let c;const d=this.painter.context.extTimerQuery,y=o.exported.now();if(this.listens("gpu-timing-frame")&&(c=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,k=this.transform.pitch,F=o.exported.now(),B=new o.EvaluationParameters(M,{now:F,fadeDuration:b,pitch:k,transition:this.style.getTransition()});this.style.update(B)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(y),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(y),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const M=o.exported.now()-y;d.endQueryEXT(d.TIME_ELAPSED_EXT,c),setTimeout(()=>{const k=d.getQueryObjectEXT(c,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(c),this.fire(new o.Event("gpu-timing-frame",{cpuTime:M,gpuTime:k})),o.window.performance.mark("frame-gpu",{startTime:y,detail:{gpuTime:k}})},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(M);this.fire(new o.Event("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(M);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:k}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(C||this._repaint)this.triggerRepaint();else{const M=!this.isMoving()&&this.loaded();if(M&&(E=this._updateAverageElevation(y,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const c of this._markers)g&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!g||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(g,c=!1){const d=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&d(0);if((c||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const y=this.transform.averageElevation;let b=this.transform.sampleAverageElevation(),E=!1;this.transform.elevation&&(E=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=g;const C=Math.abs(y-b);if(C>1){if(this._isInitialLoad||E)return this._averageElevation.jumpTo(b),d(b);this._averageElevation.easeTo(b,g,300)}else if(C>1e-4)return this._averageElevation.jumpTo(b),d(b)}return!!this._averageElevation.isEasing(g)&&d(this._averageElevation.getValue(g))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===o.AUTH_ERR_MSG||g.status===401)){const c=this.painter.context.gl;o.storeAuthState(c,!1),this._logoControl instanceof Of&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const d=this.painter.context.gl,y=d.createFramebuffer();function b(E){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,E,0);const C=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,C),C}return d.bindFramebuffer(d.FRAMEBUFFER,y),this._canvasPixelComparison(b(g),c.canvasCopies.map(b),c.timeStamps)}_canvasPixelComparison(g,c,d){let y=d[1]-d[0];const b=g.length/4;for(let E=0;E<c.length;E++){const C=c[E];let M=0;for(let k=0;k<C.length;k+=4)C[k]===g[k]&&C[k+1]===g[k+1]&&C[k+2]===g[k+2]&&C[k+3]===g[k+3]&&(M+=1);y+=(d[E+2]-d[E+1])*(1-M/b)}return y}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=o.exported.frame(c=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(c)}))}_preloadTiles(g){const c=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(c,(d,y)=>d._preloadTiles(g,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,c){o.setCacheLimits(g,c)}get version(){return o.version}},NavigationControl:class{constructor(g){this.options=o.extend({},Bf,g),this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),L("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),L("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:c}):d.resetNorth({},{originalEvent:c}))}),this._compassIcon=L("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const c=g.getZoom(),d=c===g.getMaxZoom(),y=c===g.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Em(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,c){const d=L("button",g,this._container);return d.type="button",d.addEventListener("click",c),d}_setButtonTitle(g,c){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${c}`);g.setAttribute("aria-label",d),g.firstElementChild&&g.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends o.Evented{constructor(g){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},Am,g),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Xr(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const c=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,g(d)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(d=>c(d.state!=="denied")).catch(()=>c()):c()}_isOutOfMapMaxBounds(g){const c=this._map.getMaxBounds(),d=g.coords;return!!c&&(d.longitude<c.getWest()||d.longitude>c.getEast()||d.latitude<c.getSouth()||d.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",g)),this._finish()}}_updateCamera(g){const c=new o.LngLat(g.coords.longitude,g.coords.latitude),d=g.coords.accuracy,y=this._map.getBearing(),b=o.extend({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(d),b,{geolocateSource:!0})}_updateMarker(g){if(g){const c=new o.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,c=o.mercatorZfromAltitude(1,g._center.lat)*g.worldSize,d=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=L("button","mapboxgl-ctrl-geolocate",this._container),L("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L("div","mapboxgl-user-location"),this._dotElement.appendChild(L("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(L("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ou({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=L("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ou({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c.originalEvent&&c.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(c=>{c==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Df,ScaleControl:class{constructor(g){this.options=o.extend({},Sm,g),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Im.bind(this)),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,c=this._map,d=c._containerHeight/2,y=c._containerWidth/2-g/2,b=c.unproject([y,d]),E=c.unproject([y+g,d]),C=b.distanceTo(E);if(this.options.unit==="imperial"){const M=3.2808*C;M>5280?this._setScale(g,M/5280,"mile"):this._setScale(g,M,"foot")}else this.options.unit==="nautical"?this._setScale(g,C/1852,"nautical-mile"):C>=1e3?this._setScale(g,C/1e3,"kilometer"):this._setScale(g,C,"meter")}_setScale(g,c,d){const y=Lu(c),b=y/c;this._map._requestDomTask(()=>{this._container.style.width=g*b+"px",this._container.innerHTML=d!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:d}).format(y):`${y}&nbsp;nm`})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof o.window.HTMLElement?this._container=g.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=L("button","mapboxgl-ctrl-fullscreen",this._controlContainer);L("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(g){super(),this.options=o.extend(Object.create(xm),g),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=o.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(o.window.document.createTextNode(g))}setHTML(g){const c=o.window.document.createDocumentFragment(),d=o.window.document.createElement("body");let y;for(d.innerHTML=g;y=d.firstChild,y;)c.appendChild(y);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=L("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(g),this.options.closeButton){const d=this._closeButton=L("button","mapboxgl-popup-close-button",c);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let c;return this._classList.delete(g)?c=!1:(this._classList.add(g),c=!0),this._updateClassList(),c}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const c=this._map,d=this._container,y=this._pos;if(!c||!d||!y)return"bottom";const b=d.offsetWidth,E=d.offsetHeight,C=y.x<b/2,M=y.x>c.transform.width-b/2;if(y.y+g<E)return C?"top-left":M?"top-right":"top";if(y.y>c.transform.height-E){if(C)return"bottom-left";if(M)return"bottom-right"}return C?"left":M?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),g.className=c.join(" ")}_update(g){const c=this._map,d=this._content;if(!c||!this._lngLat&&!this._trackPointer||!d)return;let y=this._container;if(y||(y=this._container=L("div","mapboxgl-popup",c.getContainer()),this._tip=L("div","mapboxgl-popup-tip",y),y.appendChild(d)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Du(this._lngLat,this._pos,c.transform)),!this._trackPointer||g){const b=this._pos=this._trackPointer&&g?g:c.project(this._lngLat),E=Lf(this.options.offset),C=this._anchor=this._getAnchor(E.y),M=Lf(this.options.offset,C),k=b.add(M).round();c._requestDomTask(()=>{this._container&&C&&(this._container.style.transform=`${Ga[C]} translate(${k.x}px,${k.y}px)`)})}if(!this._marker&&c._showingGlobe()){const b=o.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(vm);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:Ou,Style:Hr,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:wu,Evented:o.Evented,config:o.config,prewarm:function(){Kt().acquire(Xt)},clearPrewarmedResources:function(){const g=jt;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(Xt),jt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(g){o.config.ACCESS_TOKEN=g},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(g){o.config.API_URL=g},get workerCount(){return $t.workerCount},set workerCount(g){$t.workerCount=g},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){o.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){o.clearTileCache(g)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return rc});var m=u;return m})}(Yg)),Yg.exports}var RU=MU();const Lh=IU(RU);function R_(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const x1=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),QA=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);QA&&parseFloat(QA[1]);const Ag=globalThis,nh=globalThis.process||{},PU=globalThis.navigator||{};function xM(t){var n,s;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((s=process.versions)!=null&&s.electron))return!0;const i=typeof navigator<"u"&&navigator.userAgent;return!!(i&&i.indexOf("Electron")>=0)}function Gc(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||xM()}function kU(t){return Gc()?xM()?"Electron":(PU.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const vM="4.1.0";function DU(t){try{const e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),e}catch{return null}}class OU{constructor(e,i,n="sessionStorage"){this.storage=DU(n),this.id=e,this.config=i,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const i=JSON.stringify(this.config);this.storage.setItem(this.id,i)}}_loadConfiguration(){let e={};if(this.storage){const i=this.storage.getItem(this.id);e=i?JSON.parse(i):{}}return Object.assign(this.config,e),this}}function LU(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function BU(t,e=8){const i=Math.max(e-t.length,0);return`${" ".repeat(i)}${t}`}var P_;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(P_||(P_={}));const FU=10;function eS(t){return typeof t!="string"?t:(t=t.toUpperCase(),P_[t]||P_.WHITE)}function NU(t,e,i){return!Gc&&typeof t=="string"&&(e&&(t=`\x1B[${eS(e)}m${t}\x1B[39m`),i&&(t=`\x1B[${eS(i)+FU}m${t}\x1B[49m`)),t}function zU(t,e=["constructor"]){const i=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(i),s=t;for(const u of n){const f=s[u];typeof f=="function"&&(e.find(m=>u===m)||(s[u]=f.bind(t)))}}function v1(t,e){if(!t)throw new Error("Assertion failed")}function rh(){var e,i,n;let t;if(Gc()&&Ag.performance)t=(i=(e=Ag==null?void 0:Ag.performance)==null?void 0:e.now)==null?void 0:i.call(e);else if("hrtime"in nh){const s=(n=nh==null?void 0:nh.hrtime)==null?void 0:n.call(nh);t=s[0]*1e3+s[1]/1e6}else t=Date.now();return t}const sh={debug:Gc()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},UU={enabled:!0,level:0};function oh(){}const tS={},iS={once:!0};class Ap{constructor({id:e}={id:""}){this.VERSION=vM,this._startTs=rh(),this._deltaTs=rh(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new OU(`__probe-${this.id}__`,UU),this.timeStamp(`${this.id} started`),zU(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((rh()-this._startTs).toPrecision(10))}getDelta(){return Number((rh()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,i){this._storage.setConfiguration({[e]:i})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,i){if(!e)throw new Error(i||"Assertion failed")}warn(e){return this._getLogFunction(0,e,sh.warn,arguments,iS)}error(e){return this._getLogFunction(0,e,sh.error,arguments)}deprecated(e,i){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${i}\` instead`)}removed(e,i){return this.error(`\`${e}\` has been removed. Use \`${i}\` instead`)}probe(e,i){return this._getLogFunction(e,i,sh.log,arguments,{time:!0,once:!0})}log(e,i){return this._getLogFunction(e,i,sh.debug,arguments)}info(e,i){return this._getLogFunction(e,i,console.info,arguments)}once(e,i){return this._getLogFunction(e,i,sh.debug||sh.info,arguments,iS)}table(e,i,n){return i?this._getLogFunction(e,i,console.table||oh,n&&[n],{tag:jU(i)}):oh}time(e,i){return this._getLogFunction(e,i,console.time?console.time:console.info)}timeEnd(e,i){return this._getLogFunction(e,i,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,i){return this._getLogFunction(e,i,console.timeStamp||oh)}group(e,i,n={collapsed:!1}){const s=nS({logLevel:e,message:i,opts:n}),{collapsed:u}=n;return s.method=(u?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,i,n={}){return this.group(e,i,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||oh)}withGroup(e,i,n){this.group(e,i)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=bM(e)}_getLogFunction(e,i,n,s,u){if(this._shouldLog(e)){u=nS({logLevel:e,message:i,args:s,opts:u}),n=n||u.method,v1(n),u.total=this.getTotal(),u.delta=this.getDelta(),this._deltaTs=rh();const f=u.tag||u.message;if(u.once&&f)if(!tS[f])tS[f]=rh();else return oh;return i=VU(this.id,u.message,u),n.bind(console,i,...u.args)}return oh}}Ap.VERSION=vM;function bM(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return v1(Number.isFinite(e)&&e>=0),e}function nS(t){const{logLevel:e,message:i}=t;t.logLevel=bM(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==i;);switch(typeof e){case"string":case"function":i!==void 0&&n.unshift(i),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return v1(s==="string"||s==="object"),Object.assign(t,{args:n},t.opts)}function VU(t,e,i){if(typeof e=="string"){const n=i.time?BU(LU(i.total)):"";e=i.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=NU(e,i.color,i.background)}return e}function jU(t){for(const e in t)for(const i in t[e])return i||"untitled";return"empty"}const Ex="4.3.2",$U=Ex[0]>="0"&&Ex[0]<="9"?`v${Ex}`:"";function WU(){const t=new Ap({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=$U,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const HU=WU();function XU(t,e){return wM(t||{},e)}function wM(t,e,i=0){if(i>3)return e;const n={...t};for(const[s,u]of Object.entries(e))u&&typeof u=="object"&&!Array.isArray(u)?n[s]=wM(n[s]||{},e[s],i+1):n[s]=e[s];return n}const qU="latest";function GU(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const ZU=GU();function El(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Rc=typeof process!="object"||String(process)!=="[object process]"||process.browser,YU=typeof window<"u"&&typeof window.orientation<"u",rS=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);rS&&parseFloat(rS[1]);class KU{constructor(e,i){q(this,"name");q(this,"workerThread");q(this,"isRunning",!0);q(this,"result");q(this,"_resolve",()=>{});q(this,"_reject",()=>{});this.name=e,this.workerThread=i,this.result=new Promise((n,s)=>{this._resolve=n,this._reject=s})}postMessage(e,i){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:i})}done(e){El(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){El(this.isRunning),this.isRunning=!1,this._reject(e)}}class Ax{terminate(){}}const Sx=new Map;function JU(t){El(t.source&&!t.url||!t.source&&t.url);let e=Sx.get(t.source||t.url);return e||(t.url&&(e=QU(t.url),Sx.set(t.url,e)),t.source&&(e=TM(t.source),Sx.set(t.source,e))),El(e),e}function QU(t){if(!t.startsWith("http"))return t;const e=e6(t);return TM(e)}function TM(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function e6(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function EM(t,e=!0,i){const n=i||new Set;if(t){if(sS(t))n.add(t);else if(sS(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const s in t)EM(t[s],e,n)}}return i===void 0?Array.from(n):[]}function sS(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Ix=()=>{};class Xv{constructor(e){q(this,"name");q(this,"source");q(this,"url");q(this,"terminated",!1);q(this,"worker");q(this,"onMessage");q(this,"onError");q(this,"_loadableURL","");const{name:i,source:n,url:s}=e;El(n||s),this.name=i,this.source=n,this.url=s,this.onMessage=Ix,this.onError=u=>console.log(u),this.worker=Rc?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Rc||typeof Ax<"u"&&!Rc}destroy(){this.onMessage=Ix,this.onError=Ix,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,i){i=i||EM(e),this.worker.postMessage(e,i)}_getErrorFromErrorEvent(e){let i="Failed to load ";return i+=`worker ${this.name} from ${this.url}. `,e.message&&(i+=`${e.message} in `),e.lineno&&(i+=`:${e.lineno}:${e.colno}`),new Error(i)}_createBrowserWorker(){this._loadableURL=JU({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=i=>{i.data?this.onMessage(i.data):this.onError(new Error("No data received"))},e.onerror=i=>{this.onError(this._getErrorFromErrorEvent(i)),this.terminated=!0},e.onmessageerror=i=>console.error(i),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Ax(n,{eval:!1})}else if(this.source)e=new Ax(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",i=>{this.onMessage(i)}),e.on("error",i=>{this.onError(i)}),e.on("exit",i=>{}),e}}class t6{constructor(e){q(this,"name","unnamed");q(this,"source");q(this,"url");q(this,"maxConcurrency",1);q(this,"maxMobileConcurrency",1);q(this,"onDebug",()=>{});q(this,"reuseWorkers",!0);q(this,"props",{});q(this,"jobQueue",[]);q(this,"idleQueue",[]);q(this,"count",0);q(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Xv.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,i=(s,u,f)=>s.done(f),n=(s,u)=>s.error(u)){const s=new Promise(u=>(this.jobQueue.push({name:e,onMessage:i,onError:n,onStart:u}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const i=this.jobQueue.shift();if(i){this.onDebug({message:"Starting job",name:i.name,workerThread:e,backlog:this.jobQueue.length});const n=new KU(i.name,e);e.onMessage=s=>i.onMessage(n,s.type,s.payload),e.onError=s=>i.onError(n,s),i.onStart(n);try{await n.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Rc||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Xv({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return YU?this.maxMobileConcurrency:this.maxConcurrency}}const i6={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},pl=class pl{constructor(e){q(this,"props");q(this,"workerPools",new Map);this.props={...i6},this.setProps(e),this.workerPools=new Map}static isSupported(){return Xv.isSupported()}static getWorkerFarm(e={}){return pl._workerFarm=pl._workerFarm||new pl({}),pl._workerFarm.setProps(e),pl._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const i of this.workerPools.values())i.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:i,source:n,url:s}=e;let u=this.workerPools.get(i);return u||(u=new t6({name:i,source:n,url:s}),u.setProps(this._getWorkerPoolProps()),this.workerPools.set(i,u)),u}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};q(pl,"_workerFarm");let k_=pl;function n6(t,e={}){const i=e[t.id]||{},n=Rc?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let s=i.workerUrl;if(!s&&t.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(Rc?s=`modules/${t.module}/dist/${n}`:s=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!s){let u=t.version;u==="latest"&&(u=qU);const f=u?`@${u}`:"";s=`https://unpkg.com/@loaders.gl/${t.module}${f}/dist/${n}`}return El(s),s}function r6(t,e=ZU){El(t,"no worker provided");const i=t.version;return!(!e||!i)}function s6(t,e){return!k_.isSupported()||!Rc&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function o6(t,e,i,n,s){const u=t.id,f=n6(t,i),o=k_.getWorkerFarm(i).getWorkerPool({name:u,url:f});i=JSON.parse(JSON.stringify(i)),n=JSON.parse(JSON.stringify(n||{}));const v=await o.startJob("process-on-worker",a6.bind(null,s));return v.postMessage("process",{input:e,options:i,context:n}),await(await v.result).result}async function a6(t,e,i,n){switch(i){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:s,input:u,options:f}=n;try{const m=await t(u,f);e.postMessage("done",{id:s,result:m})}catch(m){const o=m instanceof Error?m.message:"unknown error";e.postMessage("error",{id:s,error:o})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}function l6(t,e,i){if(i=i||t.byteLength,t.byteLength<i||e.byteLength<i)return!1;const n=new Uint8Array(t),s=new Uint8Array(e);for(let u=0;u<n.length;++u)if(n[u]!==s[u])return!1;return!0}function c6(...t){return u6(t)}function u6(t){const e=t.map(u=>u instanceof ArrayBuffer?new Uint8Array(u):u),i=e.reduce((u,f)=>u+f.byteLength,0),n=new Uint8Array(i);let s=0;for(const u of e)n.set(u,s),s+=u.byteLength;return n.buffer}async function h6(t){const e=[];for await(const i of t)e.push(i);return c6(...e)}function oS(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class aS{constructor(e,i){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=i,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=oS(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(oS()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class ky{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,i="count"){return this._getOrCreate({name:e,type:i})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const i of Object.values(this.stats))e(i)}getTable(){const e={};return this.forEach(i=>{e[i.name]={time:i.time||0,count:i.count||0,average:i.getAverageTime()||0,hz:i.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(i=>this._getOrCreate(i))}_getOrCreate(e){const{name:i,type:n}=e;let s=this.stats[i];return s||(e instanceof aS?s=e:s=new aS(i,n),this.stats[i]=s),s}}let f6="";const lS={};function d6(t){for(const e in lS)if(t.startsWith(e)){const i=lS[e];t=t.replace(e,i)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${f6}${t}`),t}function p6(t){return t&&typeof t=="object"&&t.isBuffer}function AM(t){if(p6(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function SM(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function m6(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const g6=t=>typeof t=="boolean",Hd=t=>typeof t=="function",Sp=t=>t!==null&&typeof t=="object",cS=t=>Sp(t)&&t.constructor==={}.constructor,_6=t=>!!t&&typeof t[Symbol.iterator]=="function",y6=t=>t&&typeof t[Symbol.asyncIterator]=="function",Zc=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Yc=t=>typeof Blob<"u"&&t instanceof Blob,x6=t=>t&&typeof t=="object"&&t.isBuffer,v6=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Sp(t)&&Hd(t.tee)&&Hd(t.cancel)&&Hd(t.getReader),b6=t=>Sp(t)&&Hd(t.read)&&Hd(t.pipe)&&g6(t.readable),IM=t=>v6(t)||b6(t);class w6 extends Error{constructor(i,n){super(i);q(this,"reason");q(this,"url");q(this,"response");this.reason=n.reason,this.url=n.url,this.response=n.response}}const T6=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,E6=/^([-\w.]+\/[-\w.+]+)/;function uS(t,e){return t.toLowerCase()===e.toLowerCase()}function A6(t){const e=E6.exec(t);return e?e[1]:t}function hS(t){const e=T6.exec(t);return e?e[1]:""}const CM=/\?.*/;function S6(t){const e=t.match(CM);return e&&e[0]}function b1(t){return t.replace(CM,"")}function I6(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Dy(t){return Zc(t)?t.url:Yc(t)?t.name||"":typeof t=="string"?t:""}function w1(t){if(Zc(t)){const e=t,i=e.headers.get("content-type")||"",n=b1(e.url);return A6(i)||hS(n)}return Yc(t)?t.type||"":typeof t=="string"?hS(t):""}function C6(t){return Zc(t)?t.headers["content-length"]||-1:Yc(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function MM(t){if(Zc(t))return t;const e={},i=C6(t);i>=0&&(e["content-length"]=String(i));const n=Dy(t),s=w1(t);s&&(e["content-type"]=s);const u=await P6(t);u&&(e["x-first-bytes"]=u),typeof t=="string"&&(t=new TextEncoder().encode(t));const f=new Response(t,{headers:e});return Object.defineProperty(f,"url",{value:n}),f}async function M6(t){if(!t.ok)throw await R6(t)}async function R6(t){const e=I6(t.url);let i=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;i=i.length>100?`${i.slice(0,100)}...`:i;const n={reason:t.statusText,url:t.url,response:t};try{const s=t.headers.get("Content-Type");n.reason=!t.bodyUsed&&(s!=null&&s.includes("application/json"))?await t.json():await t.text()}catch{}return new w6(i,n)}async function P6(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const i=t.slice(0,5);return await new Promise(n=>{const s=new FileReader;s.onload=u=>{var f;return n((f=u==null?void 0:u.target)==null?void 0:f.result)},s.readAsDataURL(i)})}if(t instanceof ArrayBuffer){const i=t.slice(0,5);return`data:base64,${k6(i)}`}return null}function k6(t){let e="";const i=new Uint8Array(t);for(let n=0;n<i.byteLength;n++)e+=String.fromCharCode(i[n]);return btoa(e)}function D6(t){return!O6(t)&&!L6(t)}function O6(t){return t.startsWith("http:")||t.startsWith("https:")}function L6(t){return t.startsWith("data:")}async function fS(t,e){var i,n;if(typeof t=="string"){const s=d6(t);return D6(s)&&(i=globalThis.loaders)!=null&&i.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(s,e):await fetch(s,e)}return await MM(t)}const dS=new Ap({id:"loaders.gl"});class B6{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class F6{constructor(){q(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const RM={fetch:null,mimeType:void 0,nothrow:!1,log:new F6,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:x1,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},N6={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function PM(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function kM(){const t=PM();return t.globalOptions=t.globalOptions||{...RM},t.globalOptions}function z6(t,e,i,n){return i=i||[],i=Array.isArray(i)?i:[i],U6(t,i),j6(e,t,n)}function U6(t,e){pS(t,null,RM,N6,e);for(const i of e){const n=t&&t[i.id]||{},s=i.options&&i.options[i.id]||{},u=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};pS(n,i.id,s,u,e)}}function pS(t,e,i,n,s){const u=e||"Top level",f=e?`${e}.`:"";for(const m in t){const o=!e&&Sp(t[m]),v=m==="baseUri"&&!e,w=m==="workerUrl"&&e;if(!(m in i)&&!v&&!w){if(m in n)dS.warn(`${u} loader option '${f}${m}' no longer supported, use '${n[m]}'`)();else if(!o){const S=V6(m,s);dS.warn(`${u} loader option '${f}${m}' not recognized. ${S}`)()}}}}function V6(t,e){const i=t.toLowerCase();let n="";for(const s of e)for(const u in s.options){if(t===u)return`Did you mean '${s.id}.${u}'?`;const f=u.toLowerCase();(i.startsWith(f)||f.startsWith(i))&&(n=n||`Did you mean '${s.id}.${u}'?`)}return n}function j6(t,e,i){const s={...t.options||{}};return $6(s,i),s.log===null&&(s.log=new B6),mS(s,kM()),mS(s,e),s}function mS(t,e){for(const i in e)if(i in e){const n=e[i];cS(n)&&cS(t[i])?t[i]={...t[i],...e[i]}:t[i]=e[i]}}function $6(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function T1(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function E1(t){R_(t,"null loader"),R_(T1(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const DM=()=>{const t=PM();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function W6(t){const e=DM();t=Array.isArray(t)?t:[t];for(const i of t){const n=E1(i);e.find(s=>n===s)||e.unshift(n)}}function H6(){return DM()}const X6=/\.([^.]+)$/;async function q6(t,e=[],i,n){if(!OM(t))return null;let s=gS(t,e,{...i,nothrow:!0},n);if(s)return s;if(Yc(t)&&(t=await t.slice(0,10).arrayBuffer(),s=gS(t,e,i,n)),!s&&!(i!=null&&i.nothrow))throw new Error(LM(t));return s}function gS(t,e=[],i,n){if(!OM(t))return null;if(e&&!Array.isArray(e))return E1(e);let s=[];e&&(s=s.concat(e)),i!=null&&i.ignoreRegisteredLoaders||s.push(...H6()),Z6(s);const u=G6(t,s,i,n);if(!u&&!(i!=null&&i.nothrow))throw new Error(LM(t));return u}function G6(t,e,i,n){const s=Dy(t),u=w1(t),f=b1(s)||(n==null?void 0:n.url);let m=null,o="";return i!=null&&i.mimeType&&(m=Cx(e,i==null?void 0:i.mimeType),o=`match forced by supplied MIME type ${i==null?void 0:i.mimeType}`),m=m||Y6(e,f),o=o||(m?`matched url ${f}`:""),m=m||Cx(e,u),o=o||(m?`matched MIME type ${u}`:""),m=m||J6(e,t),o=o||(m?`matched initial data ${BM(t)}`:""),i!=null&&i.fallbackMimeType&&(m=m||Cx(e,i==null?void 0:i.fallbackMimeType),o=o||(m?`matched fallback MIME type ${u}`:"")),o&&HU.log(1,`selectLoader selected ${m==null?void 0:m.name}: ${o}.`),m}function OM(t){return!(t instanceof Response&&t.status===204)}function LM(t){const e=Dy(t),i=w1(t);let n="No valid loader found (";n+=e?`${SM(e)}, `:"no url provided, ",n+=`MIME type: ${i?`"${i}"`:"not provided"}, `;const s=t?BM(t):"";return n+=s?` first bytes: "${s}"`:"first bytes: not available",n+=")",n}function Z6(t){for(const e of t)E1(e)}function Y6(t,e){const i=e&&X6.exec(e),n=i&&i[1];return n?K6(t,n):null}function K6(t,e){e=e.toLowerCase();for(const i of t)for(const n of i.extensions)if(n.toLowerCase()===e)return i;return null}function Cx(t,e){var i;for(const n of t)if((i=n.mimeTypes)!=null&&i.some(s=>uS(e,s))||uS(e,`application/x.${n.id}`))return n;return null}function J6(t,e){if(!e)return null;for(const i of t)if(typeof e=="string"){if(Q6(e,i))return i}else if(ArrayBuffer.isView(e)){if(_S(e.buffer,e.byteOffset,i))return i}else if(e instanceof ArrayBuffer&&_S(e,0,i))return i;return null}function Q6(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>t.startsWith(n))}function _S(t,e,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(s=>e5(t,e,i,s))}function e5(t,e,i,n){if(n instanceof ArrayBuffer)return l6(n,t,n.byteLength);switch(typeof n){case"function":return n(t);case"string":const s=qv(t,e,n.length);return n===s;default:return!1}}function BM(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?qv(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?qv(t,0,e):""}function qv(t,e,i){if(t.byteLength<e+i)return"";const n=new DataView(t);let s="";for(let u=0;u<i;u++)s+=String.fromCharCode(n.getUint8(e+u));return s}const t5=256*1024;function*i5(t,e){const i=(e==null?void 0:e.chunkSize)||t5;let n=0;const s=new TextEncoder;for(;n<t.length;){const u=Math.min(t.length-n,i),f=t.slice(n,n+u);n+=u,yield s.encode(f)}}const n5=256*1024;function*r5(t,e={}){const{chunkSize:i=n5}=e;let n=0;for(;n<t.byteLength;){const s=Math.min(t.byteLength-n,i),u=new ArrayBuffer(s),f=new Uint8Array(t,n,s);new Uint8Array(u).set(f),n+=s,yield u}}const s5=1024*1024;async function*o5(t,e){const i=(e==null?void 0:e.chunkSize)||s5;let n=0;for(;n<t.size;){const s=n+i,u=await t.slice(n,s).arrayBuffer();n=s,yield u}}function yS(t,e){return x1?a5(t,e):l5(t)}async function*a5(t,e){const i=t.getReader();let n;try{for(;;){const s=n||i.read();e!=null&&e._streamReadAhead&&(n=i.read());const{done:u,value:f}=await s;if(u)return;yield AM(f)}}catch{i.releaseLock()}}async function*l5(t,e){for await(const i of t)yield AM(i)}function c5(t,e){if(typeof t=="string")return i5(t,e);if(t instanceof ArrayBuffer)return r5(t,e);if(Yc(t))return o5(t,e);if(IM(t))return yS(t,e);if(Zc(t))return yS(t.body,e);throw new Error("makeIterator")}const FM="Cannot convert supplied data type";function u5(t,e,i){if(e.text&&typeof t=="string")return t;if(x6(t)&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const s=t.byteLength||t.length;return(t.byteOffset!==0||s!==n.byteLength)&&(n=n.slice(t.byteOffset,t.byteOffset+s)),n}throw new Error(FM)}async function h5(t,e,i){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||n)return u5(t,e);if(Yc(t)&&(t=await MM(t)),Zc(t)){const s=t;return await M6(s),e.binary?await s.arrayBuffer():await s.text()}if(IM(t)&&(t=c5(t,i)),_6(t)||y6(t))return h6(t);throw new Error(FM)}function NM(t,e){const i=kM(),n=t||i;return typeof n.fetch=="function"?n.fetch:Sp(n.fetch)?s=>fS(s,n.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:fS}function f5(t,e,i){if(i)return i;const n={fetch:NM(e,t),...t};if(n.url){const s=b1(n.url);n.baseUrl=s,n.queryString=S6(n.url),n.filename=SM(s),n.baseUrl=m6(s)}return Array.isArray(n.loaders)||(n.loaders=null),n}function d5(t,e){if(t&&!Array.isArray(t))return t;let i;if(t&&(i=Array.isArray(t)?t:[t]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];i=i?[...i,...n]:n}return i&&i.length?i:void 0}async function D_(t,e,i,n){e&&!Array.isArray(e)&&!T1(e)&&(n=void 0,i=e,e=void 0),t=await t,i=i||{};const s=Dy(t),f=d5(e,n),m=await q6(t,f,i);return m?(i=z6(i,m,f,s),n=f5({url:s,_parse:D_,loaders:f},i,n||null),await p5(m,t,i,n)):null}async function p5(t,e,i,n){if(r6(t),i=XU(t.options,i),Zc(e)){const u=e,{ok:f,redirected:m,status:o,statusText:v,type:w,url:S}=u,R=Object.fromEntries(u.headers.entries());n.response={headers:R,ok:f,redirected:m,status:o,statusText:v,type:w,url:S}}e=await h5(e,t,i);const s=t;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,i,n);if(s6(t,i))return await o6(t,e,i,n,D_);if(s.parseText&&typeof e=="string")return await s.parseText(e,i,n);if(s.parse)return await s.parse(e,i,n);throw El(!s.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function Gv(t,e,i,n){let s,u;!Array.isArray(e)&&!T1(e)?(s=[],u=e):(s=e,u=i);const f=NM(u);let m=t;return typeof t=="string"&&(m=await f(t)),Yc(t)&&(m=await f(t)),Array.isArray(s)?await D_(m,s,u):await D_(m,s,u)}const m5="4.3.2";var gI;const g5=(gI=globalThis.loaders)==null?void 0:gI.parseImageNode,Zv=typeof Image<"u",Yv=typeof ImageBitmap<"u",_5=!!g5,Kv=x1?!0:_5;function y5(t){switch(t){case"auto":return Yv||Zv||Kv;case"imagebitmap":return Yv;case"image":return Zv;case"data":return Kv;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function x5(){if(Yv)return"imagebitmap";if(Zv)return"image";if(Kv)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function v5(t){const e=w5(t);if(!e)throw new Error("Not an image");return e}function b5(t){switch(v5(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("getImageData");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function w5(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const T5=/^data:image\/svg\+xml/,E5=/\.svg((\?|#).*)?$/;function A1(t){return t&&(T5.test(t)||E5.test(t))}function A5(t,e){if(A1(e)){let n=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(u){throw new Error(u.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return zM(t,e)}function zM(t,e){if(A1(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function UM(t,e,i){const n=A5(t,i),s=self.URL||self.webkitURL,u=typeof n!="string"&&s.createObjectURL(n);try{return await S5(u||n,e)}finally{u&&s.revokeObjectURL(u)}}async function S5(t,e){const i=new Image;return i.src=t,e.image&&e.image.decode&&i.decode?(await i.decode(),i):await new Promise((n,s)=>{try{i.onload=()=>n(i),i.onerror=u=>{const f=u instanceof Error?u.message:"error";s(new Error(f))}}catch(u){s(u)}})}const I5={};let xS=!0;async function C5(t,e,i){let n;A1(i)?n=await UM(t,e,i):n=zM(t,i);const s=e&&e.imagebitmap;return await M5(n,s)}async function M5(t,e=null){if((R5(e)||!xS)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(i){console.warn(i),xS=!1}return await createImageBitmap(t)}function R5(t){for(const e in t||I5)return!1;return!0}function P5(t){return!L5(t,"ftyp",4)||(t[8]&96)===0?null:k5(t)}function k5(t){switch(D5(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function D5(t,e,i){return String.fromCharCode(...t.slice(e,i))}function O5(t){return[...t].map(e=>e.charCodeAt(0))}function L5(t,e,i=0){const n=O5(e);for(let s=0;s<n.length;++s)if(n[s]!==t[s+i])return!1;return!0}const Oo=!1,Xd=!0;function VM(t){const e=Ip(t);return F5(e)||U5(e)||N5(e)||z5(e)||B5(e)}function B5(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),i=P5(e);return i?{mimeType:i.mimeType,width:0,height:0}:null}function F5(t){const e=Ip(t);return e.byteLength>=24&&e.getUint32(0,Oo)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Oo),height:e.getUint32(20,Oo)}:null}function N5(t){const e=Ip(t);return e.byteLength>=10&&e.getUint32(0,Oo)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Xd),height:e.getUint16(8,Xd)}:null}function z5(t){const e=Ip(t);return e.byteLength>=14&&e.getUint16(0,Oo)===16973&&e.getUint32(2,Xd)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Xd),height:e.getUint32(22,Xd)}:null}function U5(t){const e=Ip(t);if(!(e.byteLength>=3&&e.getUint16(0,Oo)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:s}=V5();let u=2;for(;u+9<e.byteLength;){const f=e.getUint16(u,Oo);if(s.has(f))return{mimeType:"image/jpeg",height:e.getUint16(u+5,Oo),width:e.getUint16(u+7,Oo)};if(!n.has(f))return null;u+=2,u+=e.getUint16(u,Oo)}return null}function V5(){const t=new Set([65499,65476,65484,65501,65534]);for(let i=65504;i<65520;++i)t.add(i);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Ip(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function j5(t,e){var s;const{mimeType:i}=VM(t)||{},n=(s=globalThis.loaders)==null?void 0:s.parseImageNode;return R_(n),await n(t,i)}async function $5(t,e,i){e=e||{};const s=(e.image||{}).type||"auto",{url:u}=i||{},f=W5(s);let m;switch(f){case"imagebitmap":m=await C5(t,e,u);break;case"image":m=await UM(t,e,u);break;case"data":m=await j5(t);break;default:R_(!1)}return s==="data"&&(m=b5(m)),m}function W5(t){switch(t){case"auto":case"data":return x5();default:return y5(t),t}}const H5=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],X5=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],q5={image:{type:"auto",decode:!0}},G5={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:m5,mimeTypes:X5,extensions:H5,parse:$5,tests:[t=>!!VM(new DataView(t))],options:q5},Gi=new Ap({id:"deck"});let Jv={};function Z5(t){Jv=t}function Mr(t,e,i,n){Gi.level>0&&Jv[t]&&Jv[t].call(null,e,i,n)}function Y5(t){const e=t[0],i=t[t.length-1];return e==="{"&&i==="}"||e==="["&&i==="]"}const K5={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Y5,parseTextSync:JSON.parse};function J5(){const t="9.1.8",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(Gi.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Gi,_registerLoggers:Z5},W6([K5,[G5,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const Q5=J5();function S1(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Mx={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function eV(t){const e={};for(const[i,n]of Object.entries(t))e[i]=tV(n);return e}function tV(t){let e=vS(t);if(e!=="object")return{value:t,...Mx[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Mx[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=vS(t.value),{...t,...Mx[e],type:e}):{type:"object",value:null};throw new Error("props")}function vS(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const iV=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,nV=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,rV={vertex:iV,fragment:nV},bS=/void\s+main\s*\([^)]*\)\s*\{\n?/,wS=/}\n?[^{}]*$/,Rx=[],Kg="__LUMA_INJECT_DECLARATIONS__";function sV(t){const e={vertex:{},fragment:{}};for(const i in t){let n=t[i];const s=oV(i);typeof n=="string"&&(n={order:0,injection:n}),e[s][i]=n}return e}function oV(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function O_(t,e,i,n=!1){const s=e==="vertex";for(const u in i){const f=i[u];f.sort((o,v)=>o.order-v.order),Rx.length=f.length;for(let o=0,v=f.length;o<v;++o)Rx[o]=f[o].injection;const m=`${Rx.join(`
`)}
`;switch(u){case"vs:#decl":s&&(t=t.replace(Kg,m));break;case"vs:#main-start":s&&(t=t.replace(bS,o=>o+m));break;case"vs:#main-end":s&&(t=t.replace(wS,o=>m+o));break;case"fs:#decl":s||(t=t.replace(Kg,m));break;case"fs:#main-start":s||(t=t.replace(bS,o=>o+m));break;case"fs:#main-end":s||(t=t.replace(wS,o=>m+o));break;default:t=t.replace(u,o=>o+m)}}return t=t.replace(Kg,""),n&&(t=t.replace(/\}\s*$/,u=>u+rV[e])),t}function L_(t){t.map(e=>aV(e))}function aV(t){if(t.instance)return;L_(t.dependencies||[]);const{propTypes:e={},deprecations:i=[],inject:n={}}=t,s={normalizedInjections:sV(n),parsedDeprecations:lV(i)};e&&(s.propValidators=eV(e)),t.instance=s;let u={};e&&(u=Object.entries(e).reduce((f,[m,o])=>{const v=o==null?void 0:o.value;return v&&(f[m]=v),f},{})),t.defaultUniforms={...t.defaultUniforms,...u}}function jM(t,e,i){var n;(n=t.deprecations)==null||n.forEach(s=>{var u;(u=s.regex)!=null&&u.test(e)&&(s.deprecated?i.deprecated(s.old,s.new)():i.removed(s.old,s.new)())})}function lV(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function I1(t){L_(t);const e={},i={};$M({modules:t,level:0,moduleMap:e,moduleDepth:i});const n=Object.keys(i).sort((s,u)=>i[u]-i[s]).map(s=>e[s]);return L_(n),n}function $M(t){const{modules:e,level:i,moduleMap:n,moduleDepth:s}=t;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(const u of e)n[u.name]=u,(s[u.name]===void 0||s[u.name]<i)&&(s[u.name]=i);for(const u of e)u.dependencies&&$M({modules:u.dependencies,level:i+1,moduleMap:n,moduleDepth:s})}function cV(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function uV(t,e){var n;if(Number(((n=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:n[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=TS(t,hV),t;case"fragment":return t=TS(t,fV),t;default:throw new Error(e)}}const WM=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],hV=[...WM,[Qv("attribute"),"in $1"],[Qv("varying"),"out $1"]],fV=[...WM,[Qv("varying"),"in $1"]];function TS(t,e){for(const[i,n]of e)t=t.replace(i,n);return t}function Qv(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function HM(t,e){let i="";for(const n in t){const s=t[n];if(i+=`void ${s.signature} {
`,s.header&&(i+=`  ${s.header}`),e[n]){const u=e[n];u.sort((f,m)=>f.order-m.order);for(const f of u)i+=`  ${f.injection}
`}s.footer&&(i+=`  ${s.footer}`),i+=`}
`}return i}function XM(t){const e={vertex:{},fragment:{}};for(const i of t){let n,s;typeof i!="string"?(n=i,s=n.hook):(n={},s=i),s=s.trim();const[u,f]=s.split(":"),m=s.replace(/\(.+/,""),o=Object.assign(n,{signature:f});switch(u){case"vs":e.vertex[m]=o;break;case"fs":e.fragment[m]=o;break;default:throw new Error(u)}}return e}function dV(t,e){return{name:pV(t,e),language:"glsl",version:mV(t)}}function pV(t,e="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return n?n[1]:e}function mV(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const n=parseInt(i[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const qM=`

${Kg}
`,gV=`precision highp float;
`;function _V(t){const e=I1(t.modules||[]);return{source:xV(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:GM(e)}}function yV(t){const{vs:e,fs:i}=t,n=I1(t.modules||[]);return{vs:ES(t.platformInfo,{...t,source:e,stage:"vertex",modules:n}),fs:ES(t.platformInfo,{...t,source:i,stage:"fragment",modules:n}),getUniforms:GM(n)}}function xV(t,e){var Z;const{source:i,stage:n,modules:s,hookFunctions:u=[],inject:f={},log:m}=e;S1(typeof i=="string","shader source must be a string");const o=i;let v="";const w=XM(u),S={},R={},L={};for(const re in f){const xe=typeof f[re]=="string"?{injection:f[re],order:0}:f[re],be=/^(v|f)s:(#)?([\w-]+)$/.exec(re);if(be){const ue=be[2],oe=be[3];ue?oe==="decl"?R[re]=[xe]:L[re]=[xe]:S[re]=[xe]}else L[re]=[xe]}const j=s;for(const re of j){m&&jM(re,o,m);const xe=ZM(re,"wgsl");v+=xe;const be=((Z=re.injections)==null?void 0:Z[n])||{};for(const ue in be){const oe=/^(v|f)s:#([\w-]+)$/.exec(ue);if(oe){const me=oe[2]==="decl"?R:L;me[ue]=me[ue]||[],me[ue].push(be[ue])}else S[ue]=S[ue]||[],S[ue].push(be[ue])}}return v+=qM,v=O_(v,n,R),v+=HM(w[n],S),v+=o,v=O_(v,n,L),v}function ES(t,e){var ot;const{id:i,source:n,stage:s,language:u="glsl",modules:f,defines:m={},hookFunctions:o=[],inject:v={},prologue:w=!0,log:S}=e;S1(typeof n=="string","shader source must be a string");const R=u==="glsl"?dV(n).version:-1,L=t.shaderLanguageVersion,j=R===100?"#version 100":"#version 300 es",re=n.split(`
`).slice(1).join(`
`),xe={};f.forEach(lt=>{Object.assign(xe,lt.defines)}),Object.assign(xe,m);let be="";switch(u){case"wgsl":break;case"glsl":be=w?`${j}

// ----- PROLOGUE -------------------------
${vV({id:i,source:n,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}

${cV(t)}
${s==="fragment"?gV:""}

// ----- APPLICATION DEFINES -------------------------

${bV(xe)}

`:`${j}
`;break}const ue=XM(o),oe={},Ie={},me={};for(const lt in v){const _t=typeof v[lt]=="string"?{injection:v[lt],order:0}:v[lt],rt=/^(v|f)s:(#)?([\w-]+)$/.exec(lt);if(rt){const Ge=rt[2],Ut=rt[3];Ge?Ut==="decl"?Ie[lt]=[_t]:me[lt]=[_t]:oe[lt]=[_t]}else me[lt]=[_t]}for(const lt of f){S&&jM(lt,re,S);const _t=ZM(lt,s);be+=_t;const rt=((ot=lt.instance)==null?void 0:ot.normalizedInjections[s])||{};for(const Ge in rt){const Ut=/^(v|f)s:#([\w-]+)$/.exec(Ge);if(Ut){const Ot=Ut[2]==="decl"?Ie:me;Ot[Ge]=Ot[Ge]||[],Ot[Ge].push(rt[Ge])}else oe[Ge]=oe[Ge]||[],oe[Ge].push(rt[Ge])}}return be+="// ----- MAIN SHADER SOURCE -------------------------",be+=qM,be=O_(be,s,Ie),be+=HM(ue[s],oe),be+=re,be=O_(be,s,me),u==="glsl"&&R!==L&&(be=uV(be,s)),be.trim()}function GM(t){return function(i){var s;const n={};for(const u of t){const f=(s=u.getUniforms)==null?void 0:s.call(u,i,n);Object.assign(n,f)}return n}}function vV(t){const{id:e,source:i,stage:n}=t;return e&&i.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${n}`:""}function bV(t={}){let e="";for(const i in t){const n=t[i];(n||Number.isFinite(n))&&(e+=`#define ${i.toUpperCase()} ${t[i]}
`)}return e}function ZM(t,e){let i;switch(e){case"vertex":i=t.vs||"";break;case"fragment":i=t.fs||"";break;case"wgsl":i=t.source||"";break;default:S1(!1)}if(!t.name)throw new Error("Shader module must have a name");const n=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(s+=`#define MODULE_${n}
`),s+=`${i}
`,s}const wV=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,TV=/^\s*\#\s*endif\s*$/;function EV(t,e){var f;const i=t.split(`
`),n=[];let s=!0,u=null;for(const m of i){const o=m.match(wV),v=m.match(TV);o?(u=o[1],s=!!((f=e==null?void 0:e.defines)!=null&&f[u])):v?s=!0:s&&n.push(m)}return n.join(`
`)}const Ac=class Ac{constructor(){q(this,"_hookFunctions",[]);q(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Ac.defaultShaderAssembler=Ac.defaultShaderAssembler||new Ac,Ac.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(i=>i.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const i=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==i)}addShaderHook(e,i){i&&(e=Object.assign(i,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const i=this._getModuleList(e.modules),n=this._hookFunctions,{source:s,getUniforms:u}=_V({...e,source:e.source,modules:i,hookFunctions:n});return{source:e.platformInfo.shaderLanguage==="wgsl"?EV(s):s,getUniforms:u,modules:i}}assembleGLSLShaderPair(e){const i=this._getModuleList(e.modules),n=this._hookFunctions;return{...yV({...e,vs:e.vs,fs:e.fs,modules:i,hookFunctions:n}),modules:i}}_getModuleList(e=[]){const i=new Array(this._defaultModules.length+e.length),n={};let s=0;for(let u=0,f=this._defaultModules.length;u<f;++u){const m=this._defaultModules[u],o=m.name;i[s++]=m,n[o]=!0}for(let u=0,f=e.length;u<f;++u){const m=e[u],o=m.name;n[o]||(i[s++]=m,n[o]=!0)}return i.length=s,L_(i),i}};q(Ac,"defaultShaderAssembler");let B_=Ac;const AV=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,SV=`#version 300 es
${AV}`;function YM(t){const{input:e,inputChannels:i,output:n}=t||{};if(!e)return SV;if(!i)throw new Error("inputChannels");const s=IV(i),u=CV(e,i);return`#version 300 es
in ${s} ${e};
out vec4 ${n};
void main() {
  ${n} = ${u};
}`}function IV(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function CV(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class MV{constructor(){q(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new ky({id:e})),this.stats.get(e)}}const KM=new MV,Et=new Ap({id:"luma.gl"}),Px={};function Oy(t="id"){Px[t]=Px[t]||1;const e=Px[t]++;return`${t}-${e}`}var cv;let on=(cv=class{constructor(e,i,n){q(this,"id");q(this,"props");q(this,"userData",{});q(this,"_device");q(this,"destroyed",!1);q(this,"allocatedBytes",0);q(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=RV(i,n);const s=this.props.id!=="undefined"?this.props.id:Oy(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get(`${i}s Active`).decrementCount()}trackAllocatedMemory(e,i=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${i} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").subtractCount(this.allocatedBytes),i.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${i}s Created`).incrementCount(),e.get(`${i}s Active`).incrementCount()}},q(cv,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),cv);function RV(t,e){const i={...e};for(const n in t)t[n]!==void 0&&(i[n]=t[n]);return i}const pr=class pr extends on{constructor(i,n){const s={...n};(n.usage||0)&pr.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?s.indexType="uint32":n.data instanceof Uint16Array&&(s.indexType="uint16")),delete s.data;super(i,s,pr.defaultProps);q(this,"usage");q(this,"indexType");q(this,"updateTimestamp");q(this,"debugData",new ArrayBuffer(0));this.usage=s.usage||0,this.indexType=s.indexType,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(i){return this.device.createBuffer({...this.props,...i})}readSyncWebGL(i,n){throw new Error("not implemented")}_setDebugData(i,n,s){const u=ArrayBuffer.isView(i)?i.buffer:i,f=Math.min(i?i.byteLength:s,pr.DEBUG_DATA_MAX_LENGTH);u===null?this.debugData=new ArrayBuffer(f):n===0&&s===u.byteLength?this.debugData=u.slice(0,f):this.debugData=u.slice(n,n+f)}};q(pr,"defaultProps",{...on.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),q(pr,"MAP_READ",1),q(pr,"MAP_WRITE",2),q(pr,"COPY_SRC",4),q(pr,"COPY_DST",8),q(pr,"INDEX",16),q(pr,"VERTEX",32),q(pr,"UNIFORM",64),q(pr,"STORAGE",128),q(pr,"INDIRECT",256),q(pr,"QUERY_RESOLVE",512),q(pr,"DEBUG_DATA_MAX_LENGTH",32);let yn=pr;function JM(t){const e=AS[t],i=PV(e),n=t.includes("norm"),s=!n&&!t.startsWith("float"),u=t.startsWith("s");return{dataType:AS[t],byteLength:i,integer:s,signed:u,normalized:n}}function PV(t){return kV[t]}const AS={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},kV={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Sr="texture-compression-bc",sn="texture-compression-astc",Io="texture-compression-etc2",DV="texture-compression-etc1-webgl",Sg="texture-compression-pvrtc-webgl",kx="texture-compression-atc-webgl",Ig="float32-renderable-webgl",Dx="float16-renderable-webgl",OV="rgb9e5ufloat-renderable-webgl",Ox="snorm8-renderable-webgl",vd="norm16-renderable-webgl",Lx="snorm16-renderable-webgl",Cg="float32-filterable",SS="float16-filterable-webgl";function QM(t){const e=LV[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const LV={r8unorm:{},r8snorm:{render:Ox},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:Ox},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:Dx,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:vd},"r16snorm-webgl":{f:Lx},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:Ox},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:Dx,filter:SS},"rg16unorm-webgl":{render:vd},"rg16snorm-webgl":{render:Lx},r32uint:{},r32sint:{},r32float:{render:Ig,filter:Cg},rgb9e5ufloat:{channels:"rgb",packed:!0,render:OV},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Ig},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:vd},"rgb16snorm-webgl":{f:vd},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Cg},rgba16uint:{},rgba16sint:{},rgba16float:{render:Dx,filter:SS},"rgba16unorm-webgl":{render:vd},"rgba16snorm-webgl":{render:Lx},"rgb32float-webgl":{render:Ig,filter:Cg},rgba32uint:{},rgba32sint:{},rgba32float:{render:Ig,filter:Cg},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Sr},"bc1-rgb-unorm-srgb-webgl":{f:Sr},"bc1-rgba-unorm":{f:Sr},"bc1-rgba-unorm-srgb":{f:Sr},"bc2-rgba-unorm":{f:Sr},"bc2-rgba-unorm-srgb":{f:Sr},"bc3-rgba-unorm":{f:Sr},"bc3-rgba-unorm-srgb":{f:Sr},"bc4-r-unorm":{f:Sr},"bc4-r-snorm":{f:Sr},"bc5-rg-unorm":{f:Sr},"bc5-rg-snorm":{f:Sr},"bc6h-rgb-ufloat":{f:Sr},"bc6h-rgb-float":{f:Sr},"bc7-rgba-unorm":{f:Sr},"bc7-rgba-unorm-srgb":{f:Sr},"etc2-rgb8unorm":{f:Io},"etc2-rgb8unorm-srgb":{f:Io},"etc2-rgb8a1unorm":{f:Io},"etc2-rgb8a1unorm-srgb":{f:Io},"etc2-rgba8unorm":{f:Io},"etc2-rgba8unorm-srgb":{f:Io},"eac-r11unorm":{f:Io},"eac-r11snorm":{f:Io},"eac-rg11unorm":{f:Io},"eac-rg11snorm":{f:Io},"astc-4x4-unorm":{f:sn},"astc-4x4-unorm-srgb":{f:sn},"astc-5x4-unorm":{f:sn},"astc-5x4-unorm-srgb":{f:sn},"astc-5x5-unorm":{f:sn},"astc-5x5-unorm-srgb":{f:sn},"astc-6x5-unorm":{f:sn},"astc-6x5-unorm-srgb":{f:sn},"astc-6x6-unorm":{f:sn},"astc-6x6-unorm-srgb":{f:sn},"astc-8x5-unorm":{f:sn},"astc-8x5-unorm-srgb":{f:sn},"astc-8x6-unorm":{f:sn},"astc-8x6-unorm-srgb":{f:sn},"astc-8x8-unorm":{f:sn},"astc-8x8-unorm-srgb":{f:sn},"astc-10x5-unorm":{f:sn},"astc-10x5-unorm-srgb":{f:sn},"astc-10x6-unorm":{f:sn},"astc-10x6-unorm-srgb":{f:sn},"astc-10x8-unorm":{f:sn},"astc-10x8-unorm-srgb":{f:sn},"astc-10x10-unorm":{f:sn},"astc-10x10-unorm-srgb":{f:sn},"astc-12x10-unorm":{f:sn},"astc-12x10-unorm-srgb":{f:sn},"astc-12x12-unorm":{f:sn},"astc-12x12-unorm-srgb":{f:sn},"pvrtc-rgb4unorm-webgl":{f:Sg},"pvrtc-rgba4unorm-webgl":{f:Sg},"pvrtc-rbg2unorm-webgl":{f:Sg},"pvrtc-rgba2unorm-webgl":{f:Sg},"etc1-rbg-unorm-webgl":{f:DV},"atc-rgb-unorm-webgl":{f:kx},"atc-rgba-unorm-webgl":{f:kx},"atc-rgbai-unorm-webgl":{f:kx}},BV=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],FV=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function eR(t){return BV.some(e=>t.startsWith(e))}function C1(t){let e=NV(t);if(eR(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const n=zV(t);n&&(e.blockWidth=n.blockWidth,e.blockHeight=n.blockHeight)}const i=FV.exec(t);if(i){const[,n,s,u,f,m]=i,o=`${u}${s}`,v=JM(o),w=v.byteLength*8,S=n.length,R=[w,S>=2?w:0,S>=3?w:0,S>=4?w:0];e={format:t,attachment:e.attachment,dataType:v.dataType,components:S,channels:n,integer:v.integer,signed:v.signed,normalized:v.normalized,bitsPerChannel:R,bytesPerPixel:v.byteLength*n.length,packed:e.packed,srgb:e.srgb},m==="-webgl"&&(e.webgl=!0),f==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function NV(t){var u;const e=QM(t),i=e.bytesPerPixel||1,n=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((u=e.channels)==null?void 0:u.length)||1,bytesPerPixel:i,bitsPerChannel:n,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function zV(t){const i=/.*-(\d+)x(\d+)-.*/.exec(t);if(i){const[,n,s]=i;return{blockWidth:Number(n),blockHeight:Number(s)}}return null}function UV(t){const e=QM(t),i={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},n=C1(t),s=t.startsWith("depth")||t.startsWith("stencil"),u=n==null?void 0:n.signed,f=n==null?void 0:n.integer,m=n==null?void 0:n.webgl;return i.render&&(i.render=!u),i.filter&&(i.filter=!s&&!u&&!f&&!m),i}class VV{}class jV{constructor(e=[],i){q(this,"features");q(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=i||{}}*[Symbol.iterator](){yield*this.features}has(e){var i;return!((i=this.disabledFeatures)!=null&&i[e])&&this.features.has(e)}}const sy=class sy{constructor(e){q(this,"id");q(this,"props");q(this,"userData",{});q(this,"statsManager",KM);q(this,"timestamp",0);q(this,"_reused",!1);q(this,"_lumaData",{});this.props={...sy.defaultProps,...e},this.id=this.props.id||Oy(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const i=UV(e),n=f=>(typeof f=="string"?this.features.has(f):f)??!0,s=n(i.create),u={format:e,create:s,render:s&&n(i.render),filter:s&&n(i.filter),blend:s&&n(i.blend),store:s&&n(i.store)};return this._getDeviceSpecificTextureFormatCapabilities(u)}isTextureFormatSupported(e,i){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return eR(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,i){throw new Error("not implemented")}readPixelsToBufferWebGL(e,i){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,i){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const i={...e};return(e.usage||0)&yn.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?i.indexType="uint32":e.data instanceof Uint16Array?i.indexType="uint16":Et.warn("indices buffer content must be of integer type")()),i}};q(sy,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>Et.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:Et.get("debug")||void 0,debugShaders:Et.get("debug-shaders")||void 0,debugFramebuffers:!!Et.get("debug-framebuffers"),debugWebGL:!!Et.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let vl=sy;const $V=Gc()&&typeof document<"u",WV=()=>$V&&document.readyState==="complete",HV="set luma.log.level=1 (or higher) to trace rendering",IS="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",ml=class ml{constructor(){q(this,"stats",KM);q(this,"log",Et);q(this,"VERSION","9.1.7");q(this,"spector");q(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Et.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Et.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Et.error("This version of luma.gl has already been initialized")()}Et.log(1,`${this.VERSION} - ${HV}`)(),globalThis.luma=this}registerAdapters(e){for(const i of e)this.preregisteredAdapters.set(i.type,i)}getSupportedAdapters(e=[]){const i=this.getAdapterMap(e);return Array.from(i).map(([,n])=>n).filter(n=>{var s;return(s=n.isSupported)==null?void 0:s.call(n)}).map(n=>n.type)}getBestAvailableAdapter(e=[]){var n,s,u,f;const i=this.getAdapterMap(e);return(s=(n=i.get("webgpu"))==null?void 0:n.isSupported)!=null&&s.call(n)?"webgpu":(f=(u=i.get("webgl"))==null?void 0:u.isSupported)!=null&&f.call(u)?"webgl":null}setDefaultDeviceProps(e){Object.assign(ml.defaultProps,e)}async createDevice(e={}){var m;e={...ml.defaultProps,...e},e.waitForPageLoad&&await ml.pageLoaded;const i=this.getAdapterMap(e.adapters);let n=e.type||"";n==="best-available"&&(n=this.getBestAvailableAdapter(e.adapters)||n);const u=(this.getAdapterMap(e.adapters)||i).get(n),f=await((m=u==null?void 0:u.create)==null?void 0:m.call(u,e));if(f)return f;throw new Error(IS)}async attachDevice(e){var f;const i=this.getAdapterMap(e.adapters);let n="";e.handle instanceof WebGL2RenderingContext&&(n="webgl"),e.createCanvasContext&&await ml.pageLoaded,e.handle===null&&(n="unknown");const s=i.get(n),u=await((f=s==null?void 0:s.attach)==null?void 0:f.call(s,null));if(u)return u;throw new Error(IS)}enforceWebGL2(e=!0,i=[]){var u;const s=this.getAdapterMap(i).get("webgl");s||Et.warn("enforceWebGL2: webgl adapter not found")(),(u=s==null?void 0:s.enforceWebGL2)==null||u.call(s,e)}getAdapterMap(e=[]){const i=new Map(this.preregisteredAdapters);for(const n of e)i.set(n.type,n);return i}registerDevices(e){Et.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const i of e){const n=i.adapter;n&&this.preregisteredAdapters.set(n.type,n)}}};q(ml,"defaultProps",{...vl.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),q(ml,"pageLoaded",XV().then(()=>{Et.probe(2,"DOM is loaded")()}));let eb=ml;const tb=new eb;function XV(){return WV()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class qV{}const oy=class oy{constructor(e){q(this,"id");q(this,"props");q(this,"canvas");q(this,"htmlCanvas");q(this,"offscreenCanvas");q(this,"type");q(this,"width",1);q(this,"height",1);q(this,"resizeObserver");q(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...oy.defaultProps,...e},e=this.props,!Gc()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=ZV(e.canvas):this.canvas=e.canvas;else{const i=YV(e),n=GV((e==null?void 0:e.container)||null);n.insertBefore(i,n.firstChild),this.canvas=i,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(i=>{for(const n of i)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),i=this.canvas;return i.parentElement?[i.clientWidth*e,i.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,i]=this.getPixelSize();return e/i}cssToDeviceRatio(){var e;try{const[i]=this.getDrawingBufferSize(),n=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return n?i/n:1}catch{return 1}}cssToDevicePixels(e,i=!0){const n=this.cssToDeviceRatio(),[s,u]=this.getDrawingBufferSize();return KV(e,n,s,u,i)}setDevicePixelRatio(e,i={}){if(!this.htmlCanvas)return;let n="width"in i?i.width:this.htmlCanvas.clientWidth,s="height"in i?i.height:this.htmlCanvas.clientHeight;(!n||!s)&&(Et.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const u=this._canvasSizeInfo;if(u.clientWidth!==n||u.clientHeight!==s||u.devicePixelRatio!==e){let f=e;const m=Math.floor(n*f),o=Math.floor(s*f);if(this.htmlCanvas.width=m,this.htmlCanvas.height=o,this.device.gl){const[w,S]=this.getDrawingBufferSize();(w!==m||S!==o)&&(f=Math.min(w/n,S/s),this.htmlCanvas.width=Math.floor(n*f),this.htmlCanvas.height=Math.floor(s*f),Et.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var i;((i=this.htmlCanvas)==null?void 0:i.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};q(oy,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let ib=oy;function GV(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function ZV(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function YV(t){const{width:e,height:i}=t,n=document.createElement("canvas");return n.id=Oy("lumagl-auto-created-canvas"),n.width=e||1,n.height=i||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(i)?`${i}px`:"100%",n}function KV(t,e,i,n,s){const u=t,f=CS(u[0],e,i);let m=MS(u[1],e,n,s),o=CS(u[0]+1,e,i);const v=o===i-1?o:o-1;o=MS(u[1]+1,e,n,s);let w;return s?(o=o===0?o:o+1,w=m,m=o):w=o===n-1?o:o-1,{x:f,y:m,width:Math.max(v-f+1,1),height:Math.max(w-m+1,1)}}function CS(t,e,i){return Math.min(Math.round(t*e),i-1)}function MS(t,e,i,n){return n?Math.max(0,i-1-Math.round(t*e)):Math.min(Math.round(t*e),i-1)}const mr=class mr extends on{constructor(i,n){n=mr.normalizeProps(i,n);super(i,n,mr.defaultProps);q(this,"dimension");q(this,"format");q(this,"width");q(this,"height");q(this,"depth");q(this,"mipLevels");q(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const s=mr.getTextureDataSize(this.props.data);this.width=(s==null?void 0:s.width)||1,this.height=(s==null?void 0:s.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?mr.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(i){return this.device.createTexture({...this.props,...i})}static isExternalImage(i){return typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement||typeof VideoFrame<"u"&&i instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas}static getExternalImageSize(i){if(typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height};if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement)return{width:i.naturalWidth,height:i.naturalHeight};if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement)return{width:i.videoWidth,height:i.videoHeight};if(typeof VideoFrame<"u"&&i instanceof VideoFrame)return{width:i.displayWidth,height:i.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(i){const n=i==null?void 0:i.data;return ArrayBuffer.isView(n)}static getTextureDataSize(i){if(!i||ArrayBuffer.isView(i))return null;if(Array.isArray(i))return mr.getTextureDataSize(i[0]);if(mr.isExternalImage(i))return mr.getExternalImageSize(i);if(i&&typeof i=="object"&&i.constructor===Object){const s=Object.values(i)[0];return{width:s.width,height:s.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(i,n){let s;return ArrayBuffer.isView(i)?s=[{data:i,width:n.width,height:n.height}]:Array.isArray(i)?s=i:s=[i],s}static getMipLevelCount(i,n){return Math.floor(Math.log2(Math.max(i,n)))+1}static getCubeFaceDepth(i){switch(i){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(i)}}static normalizeProps(i,n){var o,v;const s={...n},u=((v=(o=i==null?void 0:i.props)==null?void 0:o._resourceDefaults)==null?void 0:v.texture)||{};Object.assign(s,u);const{width:f,height:m}=s;return typeof f=="number"&&(s.width=Math.max(1,Math.ceil(f))),typeof m=="number"&&(s.height=Math.max(1,Math.ceil(m))),s}};q(mr,"COPY_SRC",1),q(mr,"COPY_DST",2),q(mr,"TEXTURE",4),q(mr,"STORAGE",8),q(mr,"RENDER_ATTACHMENT",16),q(mr,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),q(mr,"defaultProps",{...on.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),q(mr,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let kn=mr;const ay=class ay extends on{get[Symbol.toStringTag](){return"TextureView"}constructor(e,i){super(e,i,ay.defaultProps)}};q(ay,"defaultProps",{...on.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let F_=ay;function JV(t,e,i){let n="";const s=e.split(/\r?\n/),u=t.slice().sort((f,m)=>f.lineNum-m.lineNum);switch((i==null?void 0:i.showSourceCode)||"no"){case"all":let f=0;for(let m=1;m<=s.length;m++)for(n+=tR(s[m-1],m,i);u.length>f&&u[f].lineNum===m;){const o=u[f++];n+=RS(o,s,o.lineNum,{...i,inlineSource:!1})}return n;case"issues":case"no":for(const m of t)n+=RS(m,s,m.lineNum,{inlineSource:(i==null?void 0:i.showSourceCode)!=="no"});return n}}function RS(t,e,i,n){if(n!=null&&n.inlineSource){const u=QV(e,i),f=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${u}${f}${t.type.toUpperCase()}: ${t.message}

`}const s=t.type==="error"?"red":"#8B4000";return n!=null&&n.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function QV(t,e,i){let n="";for(let s=e-2;s<=e;s++){const u=t[s-1];u!==void 0&&(n+=tR(u,e,i))}return n}function tR(t,e,i){const n=i!=null&&i.html?t8(t):t;return`${e8(String(e),4)}: ${n}${i!=null&&i.html?"<br/>":`
`}`}function e8(t,e){let i="";for(let n=t.length;n<e;++n)i+=" ";return i+t}function t8(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const ly=class ly extends on{constructor(i,n){n={...n,debugShaders:n.debugShaders||i.props.debugShaders||"errors"};super(i,{id:i8(n),...n},ly.defaultProps);q(this,"stage");q(this,"source");q(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const i=this.props.debugShaders;switch(i){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const n=await this.getCompilationInfo();i==="warnings"&&(n==null?void 0:n.length)===0||this._displayShaderLog(n)}_displayShaderLog(i){var v;if(typeof document>"u"||!(document!=null&&document.createElement))return;const n=iR(this.source),s=`${this.stage} ${n}`;let u=JV(i,this.source,{showSourceCode:"all",html:!0});const f=this.getTranslatedSource();f&&(u+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${f}</pre></code>`);const m=document.createElement("Button");m.innerHTML=`
<h1>Shader Compilation Error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${u}
</pre></code>`,m.style.top="10px",m.style.left="10px",m.style.position="absolute",m.style.zIndex="9999",m.style.width="100%",m.style.textAlign="left",document.body.appendChild(m),(v=document.getElementsByClassName("luma-compiler-log-error")[0])==null||v.scrollIntoView(),m.onclick=()=>{const w=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(w)}}};q(ly,"defaultProps",{...on.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let N_=ly;function i8(t){return iR(t.source)||t.id||Oy(`unnamed ${t.stage}-shader`)}function iR(t,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return n?n[1]:e}const Qd=class Qd extends on{get[Symbol.toStringTag](){return"Sampler"}constructor(e,i){i=Qd.normalizeProps(e,i),super(e,i,Qd.defaultProps)}static normalizeProps(e,i){var u,f;const n=((f=(u=e==null?void 0:e.props)==null?void 0:u._resourceDefaults)==null?void 0:f.sampler)||{};return{...i,...n}}};q(Qd,"defaultProps",{...on.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let z_=Qd;const cy=class cy extends on{constructor(i,n={}){super(i,n,cy.defaultProps);q(this,"width");q(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(i){const n=this.colorAttachments.map(u=>u.texture.clone(i)),s=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(i);return this.device.createFramebuffer({...this.props,colorAttachments:n,depthStencilAttachment:s})}resize(i){let n=!i;if(i){const[s,u]=Array.isArray(i)?i:[i.width,i.height];n=n||u!==this.height||s!==this.width,this.width=s,this.height=u}n&&(Et.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((n,s)=>{if(typeof n=="string"){const u=this.createColorTexture(n,s);return this.attachResource(u),u.view}return n instanceof kn?n.view:n});const i=this.props.depthStencilAttachment;if(i)if(typeof i=="string"){const n=this.createDepthStencilTexture(i);this.attachResource(n),this.depthStencilAttachment=n.view}else i instanceof kn?this.depthStencilAttachment=i.view:this.depthStencilAttachment=i}createColorTexture(i,n){return this.device.createTexture({id:`${this.id}-color-attachment-${n}`,usage:kn.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(i){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:kn.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(i,n){for(let s=0;s<this.colorAttachments.length;++s)if(this.colorAttachments[s]){const u=this.colorAttachments[s].texture.clone({width:i,height:n});this.destroyAttachedResource(this.colorAttachments[s]),this.colorAttachments[s]=u.view,this.attachResource(u.view)}if(this.depthStencilAttachment){const s=this.depthStencilAttachment.texture.clone({width:i,height:n});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=s.view,this.attachResource(s)}this.updateAttachments()}};q(cy,"defaultProps",{...on.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let U_=cy;const uy=class uy extends on{constructor(i,n){super(i,n,uy.defaultProps);q(this,"shaderLayout");q(this,"bufferLayout");q(this,"linkStatus","pending");q(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(i){throw new Error("Use uniform blocks")}};q(uy,"defaultProps",{...on.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Bh=uy;const Ks=class Ks extends on{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,i){i=Ks.normalizeProps(e,i),super(e,i,Ks.defaultProps)}static normalizeProps(e,i){var u;return{...(u=e.props._resourceDefaults)==null?void 0:u.renderPass,...i}}};q(Ks,"defaultClearColor",[0,0,0,1]),q(Ks,"defaultClearDepth",1),q(Ks,"defaultClearStencil",0),q(Ks,"defaultProps",{...on.defaultProps,framebuffer:null,parameters:void 0,clearColor:Ks.defaultClearColor,clearColors:void 0,clearDepth:Ks.defaultClearDepth,clearStencil:Ks.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let nb=Ks;const hy=class hy extends on{constructor(i,n){super(i,n,hy.defaultProps);q(this,"hash","");q(this,"shaderLayout");this.shaderLayout=n.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};q(hy,"defaultProps",{...on.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let V_=hy;const fy=class fy extends on{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,i){super(e,i,fy.defaultProps)}};q(fy,"defaultProps",{...on.defaultProps,measureExecutionTime:void 0});let rb=fy;const dy=class dy extends on{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,i){super(e,i,dy.defaultProps)}};q(dy,"defaultProps",{...on.defaultProps});let sb=dy;function n8(t){const[e,i]=s8[t],n=e==="i32"||e==="u32",s=e!=="u32",u=o8[e]*i,f=r8(e,i);return{dataType:e,components:i,defaultVertexFormat:f,byteLength:u,integer:n,signed:s}}function r8(t,e){let i;switch(t){case"f32":i="float32";break;case"i32":i="sint32";break;case"u32":i="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?i:`${i}x${e}`}const s8={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},o8={f32:4,f16:2,i32:4,u32:4};function nR(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[i,n]=t.split("x"),s=i,u=n?parseInt(n):1,f=JM(s),m={type:s,components:u,byteLength:f.byteLength*u,integer:f.integer,signed:f.signed,normalized:f.normalized};return e&&(m.webglOnly=!0),m}function rR(t,e){const i={};for(const n of t.attributes){const s=l8(t,e,n.name);s&&(i[n.name]=s)}return i}function a8(t,e,i=16){const n=rR(t,e),s=new Array(i).fill(null);for(const u of Object.values(n))s[u.location]=u;return s}function l8(t,e,i){const n=c8(t,i),s=u8(e,i);if(!n)return null;const u=n8(n.type),f=(s==null?void 0:s.vertexFormat)||u.defaultVertexFormat,m=nR(f);return{attributeName:(s==null?void 0:s.attributeName)||n.name,bufferName:(s==null?void 0:s.bufferName)||n.name,location:n.location,shaderType:n.type,shaderDataType:u.dataType,shaderComponents:u.components,vertexFormat:f,bufferDataType:m.type,bufferComponents:m.components,normalized:m.normalized,integer:u.integer,stepMode:(s==null?void 0:s.stepMode)||n.stepMode||"vertex",byteOffset:(s==null?void 0:s.byteOffset)||0,byteStride:(s==null?void 0:s.byteStride)||0}}function c8(t,e){const i=t.attributes.find(n=>n.name===e);return i||Et.warn(`shader layout attribute "${e}" not present in shader`),i||null}function u8(t,e){h8(t);let i=f8(t,e);return i||(i=d8(t,e),i)?i:(Et.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function h8(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Et.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function f8(t,e){for(const i of t)if(i.format&&i.name===e)return{attributeName:i.name,bufferName:e,stepMode:i.stepMode,vertexFormat:i.format,byteOffset:0,byteStride:i.byteStride||0};return null}function d8(t,e){var i;for(const n of t){let s=n.byteStride;if(typeof n.byteStride!="number")for(const f of n.attributes||[]){const m=nR(f.format);s+=m.byteLength}const u=(i=n.attributes)==null?void 0:i.find(f=>f.attribute===e);if(u)return{attributeName:u.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:u.format,byteOffset:u.byteOffset,byteStride:s}}return null}const py=class py extends on{constructor(i,n){super(i,n,py.defaultProps);q(this,"maxVertexAttributes");q(this,"attributeInfos");q(this,"indexBuffer",null);q(this,"attributes");this.maxVertexAttributes=i.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:s,bufferLayout:u}=n.renderPipeline||{};if(!s||!u)throw new Error("VertexArray");this.attributeInfos=a8(s,u,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(i,n){this.device.reportError(new Error("constant attributes not supported"))}};q(py,"defaultProps",{...on.defaultProps,renderPipeline:null});let ob=py;const my=class my extends on{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,i){super(e,i,my.defaultProps)}};q(my,"defaultProps",{...on.defaultProps,layout:void 0,buffers:{}});let ab=my;const gy=class gy extends on{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,i){super(e,i,gy.defaultProps)}};q(gy,"defaultProps",{...on.defaultProps,type:void 0,count:void 0});let lb=gy;const p8={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function m8(t){return p8[t]}function g8(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let Mg;function sR(t){return(!Mg||Mg.byteLength<t)&&(Mg=new ArrayBuffer(t)),Mg}function _8(t,e){const i=sR(t.BYTES_PER_ELEMENT*e);return new t(i,0,e)}function y8(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function j_(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":y8(t)}const PS=1024;class x8{constructor(e){q(this,"layout",{});q(this,"byteLength");let i=0;for(const[s,u]of Object.entries(e)){const f=m8(u),{type:m,components:o}=f;i=g8(i,o);const v=i;i+=o,this.layout[s]={type:m,size:o,offset:v}}i+=(4-i%4)%4;const n=i*4;this.byteLength=Math.max(n,PS)}getData(e){const i=Math.max(this.byteLength,PS),n=sR(i),s={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[u,f]of Object.entries(e)){const m=this.layout[u];if(!m){Et.warn(`Supplied uniform value ${u} not present in uniform block layout`)();continue}const{type:o,size:v,offset:w}=m,S=s[o];if(v===1){if(typeof f!="number"&&typeof f!="boolean"){Et.warn(`Supplied value for single component uniform ${u} is not a number: ${f}`)();continue}S[w]=Number(f)}else{if(!j_(f)){Et.warn(`Supplied value for multi component / array uniform ${u} is not a numeric array: ${f}`)();continue}S.set(f,w)}}return new Uint8Array(n)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function v8(t,e,i=16){if(t!==e)return!1;const n=t,s=e;if(!j_(n))return!1;if(j_(s)&&n.length===s.length){for(let u=0;u<n.length;++u)if(s[u]!==n[u])return!1}return!0}function b8(t){return j_(t)?t.slice():t}class w8{constructor(e){q(this,"name");q(this,"uniforms",{});q(this,"modifiedUniforms",{});q(this,"modified",!0);q(this,"bindingLayout",{});q(this,"needsRedraw","initialized");var i;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const n=(i=e==null?void 0:e.shaderLayout.bindings)==null?void 0:i.find(u=>u.type==="uniform"&&u.name===(e==null?void 0:e.name));if(!n)throw new Error(e==null?void 0:e.name);const s=n;for(const u of s.uniforms||[])this.bindingLayout[u.name]=u}}setUniforms(e){for(const[i,n]of Object.entries(e))this._setUniform(i,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${i}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,i){v8(this.uniforms[e],i)||(this.uniforms[e]=b8(i),this.modifiedUniforms[e]=!0,this.modified=!0)}}class T8{constructor(e){q(this,"uniformBlocks",new Map);q(this,"uniformBufferLayouts",new Map);q(this,"uniformBuffers",new Map);for(const[i,n]of Object.entries(e)){const s=i,u=new x8(n.uniformTypes||{});this.uniformBufferLayouts.set(s,u);const f=new w8({name:i});f.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(s,f)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var i;for(const[n,s]of Object.entries(e))(i=this.uniformBlocks.get(n))==null||i.setUniforms(s);this.updateUniformBuffers()}getUniformBufferByteLength(e){var i;return((i=this.uniformBufferLayouts.get(e))==null?void 0:i.byteLength)||0}getUniformBufferData(e){var n,s;const i=((n=this.uniformBlocks.get(e))==null?void 0:n.getAllUniforms())||{};return(s=this.uniformBufferLayouts.get(e))==null?void 0:s.getData(i)}createUniformBuffer(e,i,n){n&&this.setUniforms(n);const s=this.getUniformBufferByteLength(i),u=e.createBuffer({usage:yn.UNIFORM|yn.COPY_DST,byteLength:s}),f=this.getUniformBufferData(i);return u.write(f),u}getManagedUniformBuffer(e,i){if(!this.uniformBuffers.get(i)){const n=this.getUniformBufferByteLength(i),s=e.createBuffer({usage:yn.UNIFORM|yn.COPY_DST,byteLength:n});this.uniformBuffers.set(i,s)}return this.uniformBuffers.get(i)}updateUniformBuffers(){let e=!1;for(const i of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(i);e||(e=n)}return e&&Et.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var u;const i=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),s=!1;if(n&&(i!=null&&i.needsRedraw)){s||(s=i.needsRedraw);const f=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n==null||n.write(f);const m=(u=this.uniformBlocks.get(e))==null?void 0:u.getAllUniforms();Et.log(4,`Writing to uniform buffer ${String(e)}`,f,m)()}return s}}function oR(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function aR(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function E8(t,e,i){if(!e||e>4)throw new Error(`size ${e}`);const n=e;let s=oR(t);if(s==="uint8"&&i&&n===1)return"unorm8-webgl";if(s==="uint8"&&i&&n===3)return"unorm8x3-webgl";if(s==="uint8"||s==="sint8"){if(n===1||n===3)throw new Error(`size: ${e}`);return i&&(s=s.replace("int","norm")),`${s}x${n}`}if(s==="uint16"||s==="sint16"){if(n===1||n===3)throw new Error(`size: ${e}`);return i&&(s=s.replace("int","norm")),`${s}x${n}`}return n===1?s:`${s}x${n}`}class Bx{constructor(e){q(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(i=>i.name===e)||null}getAttributeNamesForBuffer(e){var i;return e.attributes?(i=e.attributes)==null?void 0:i.map(n=>n.attribute):[e.name]}mergeBufferLayouts(e,i){const n=[...e];for(const s of i){const u=n.findIndex(f=>f.name===s.name);u<0?n.push(s):n[u]=s}return n}}class Ms{constructor(e,i){this.name=e,this.attributes=i,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}getTypeName(){return this.name}}class kS{constructor(e,i,n){this.name=e,this.type=i,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class _l extends Ms{constructor(e,i){super(e,i),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class bl extends Ms{constructor(e,i){super(e,i),this.count=0,this.stride=0}get isArray(){return!0}}class Uc extends Ms{constructor(e,i,n,s){super(e,n),this.format=i,this.access=s}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var dl;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(dl||(dl={}));class Rg{constructor(e,i,n,s,u,f,m){this.name=e,this.type=i,this.group=n,this.binding=s,this.attributes=u,this.resourceType=f,this.access=m}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class A8{constructor(e,i){this.name=e,this.type=i}}class S8{constructor(e,i,n,s){this.name=e,this.type=i,this.locationType=n,this.location=s,this.interpolation=null}}class DS{constructor(e,i,n,s){this.name=e,this.type=i,this.locationType=n,this.location=s}}class I8{constructor(e,i,n,s){this.name=e,this.type=i,this.attributes=n,this.id=s}}class C8{constructor(e,i,n){this.name=e,this.type=i,this.attributes=n}}class M8{constructor(e,i=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=i,this.attributes=n}}class R8{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const lR=new Float32Array(1),P8=new Int32Array(lR.buffer),Ir=new Uint16Array(1);function k8(t){lR[0]=t;const e=P8[0],i=e>>31&1;let n=e>>23&255,s=8388607&e;if(n===255)return Ir[0]=i<<15|31744|(s!==0?512:0),Ir[0];if(n===0){if(s===0)return Ir[0]=i<<15,Ir[0];s|=8388608;let u=113;for(;!(8388608&s);)s<<=1,u--;return n=127-u,s&=8388607,n>0?(s=(s>>126-n)+(s>>127-n&1),Ir[0]=i<<15|n<<10|s>>13,Ir[0]):(Ir[0]=i<<15,Ir[0])}return n=n-127+15,n>=31?(Ir[0]=i<<15|31744,Ir[0]):n<=0?n<-10?(Ir[0]=i<<15,Ir[0]):(s=(8388608|s)>>1-n,Ir[0]=i<<15|s>>13,Ir[0]):(s>>=13,Ir[0]=i<<15|n<<10|s,Ir[0])}const M1=new Uint32Array(1),cR=new Float32Array(M1.buffer,0,1);function OS(t){const e=112+(t>>6&31)<<23|(63&t)<<17;return M1[0]=e,cR[0]}function D8(t,e,i,n,s,u,f,m,o){const v=n*(f>>=s)*(u>>=s)+i*f+e*m;switch(o){case"r8unorm":return[qi(t,v,"8unorm",1)[0]];case"r8snorm":return[qi(t,v,"8snorm",1)[0]];case"r8uint":return[qi(t,v,"8uint",1)[0]];case"r8sint":return[qi(t,v,"8sint",1)[0]];case"rg8unorm":{const w=qi(t,v,"8unorm",2);return[w[0],w[1]]}case"rg8snorm":{const w=qi(t,v,"8snorm",2);return[w[0],w[1]]}case"rg8uint":{const w=qi(t,v,"8uint",2);return[w[0],w[1]]}case"rg8sint":{const w=qi(t,v,"8sint",2);return[w[0],w[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const w=qi(t,v,"8unorm",4);return[w[0],w[1],w[2],w[3]]}case"rgba8snorm":{const w=qi(t,v,"8snorm",4);return[w[0],w[1],w[2],w[3]]}case"rgba8uint":{const w=qi(t,v,"8uint",4);return[w[0],w[1],w[2],w[3]]}case"rgba8sint":{const w=qi(t,v,"8sint",4);return[w[0],w[1],w[2],w[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const w=qi(t,v,"8unorm",4);return[w[2],w[1],w[0],w[3]]}case"r16uint":return[qi(t,v,"16uint",1)[0]];case"r16sint":return[qi(t,v,"16sint",1)[0]];case"r16float":return[qi(t,v,"16float",1)[0]];case"rg16uint":{const w=qi(t,v,"16uint",2);return[w[0],w[1]]}case"rg16sint":{const w=qi(t,v,"16sint",2);return[w[0],w[1]]}case"rg16float":{const w=qi(t,v,"16float",2);return[w[0],w[1]]}case"rgba16uint":{const w=qi(t,v,"16uint",4);return[w[0],w[1],w[2],w[3]]}case"rgba16sint":{const w=qi(t,v,"16sint",4);return[w[0],w[1],w[2],w[3]]}case"rgba16float":{const w=qi(t,v,"16float",4);return[w[0],w[1],w[2],w[3]]}case"r32uint":return[qi(t,v,"32uint",1)[0]];case"r32sint":return[qi(t,v,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[qi(t,v,"32float",1)[0]];case"rg32uint":{const w=qi(t,v,"32uint",2);return[w[0],w[1]]}case"rg32sint":{const w=qi(t,v,"32sint",2);return[w[0],w[1]]}case"rg32float":{const w=qi(t,v,"32float",2);return[w[0],w[1]]}case"rgba32uint":{const w=qi(t,v,"32uint",4);return[w[0],w[1],w[2],w[3]]}case"rgba32sint":{const w=qi(t,v,"32sint",4);return[w[0],w[1],w[2],w[3]]}case"rgba32float":{const w=qi(t,v,"32float",4);return[w[0],w[1],w[2],w[3]]}case"rg11b10ufloat":{const w=new Uint32Array(t.buffer,v,1)[0],S=(4192256&w)>>11,R=(4290772992&w)>>22;return[OS(2047&w),OS(S),function(L){const j=112+(L>>5&31)<<23|(31&L)<<18;return M1[0]=j,cR[0]}(R),1]}}return null}function qi(t,e,i,n){const s=[0,0,0,0];for(let v=0;v<n;++v)switch(i){case"8unorm":s[v]=t[e]/255,e++;break;case"8snorm":s[v]=t[e]/255*2-1,e++;break;case"8uint":s[v]=t[e],e++;break;case"8sint":s[v]=t[e]-127,e++;break;case"16uint":s[v]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":s[v]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":s[v]=(u=t[e]|t[e+1]<<8,f=void 0,m=void 0,o=void 0,f=(32768&u)>>15,o=1023&u,(m=(31744&u)>>10)==0?(f?-1:1)*Math.pow(2,-14)*(o/Math.pow(2,10)):m==31?o?NaN:1/0*(f?-1:1):(f?-1:1)*Math.pow(2,m-15)*(1+o/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":s[v]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":s[v]=new Float32Array(t.buffer,e,1)[0],e+=4}var u,f,m,o;return s}function Ji(t,e,i,n,s){for(let u=0;u<n;++u)switch(i){case"8unorm":t[e]=255*s[u],e++;break;case"8snorm":t[e]=.5*(s[u]+1)*255,e++;break;case"8uint":t[e]=s[u],e++;break;case"8sint":t[e]=s[u]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=s[u],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=s[u],e+=2;break;case"16float":{const f=k8(s[u]);new Uint16Array(t.buffer,e,1)[0]=f,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=s[u],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=s[u],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=s[u],e+=4}return s}const Fx={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Ds{constructor(){this.id=Ds._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,i){if(e){i($_.instance);for(const n of e)n instanceof Array?this.searchBlock(n,i):n.search(i);i(W_.instance)}}constEvaluate(e,i){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Ds._id=0;class $_ extends Ds{}$_.instance=new $_;class W_ extends Ds{}W_.instance=new W_;const uR=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class xn extends Ds{constructor(){super()}}class dp extends xn{constructor(e,i,n,s,u,f){super(),this.calls=new Set,this.name=e,this.args=i,this.returnType=n,this.body=s,this.startLine=u,this.endLine=f}get astNodeType(){return"function"}search(e){if(this.attributes)for(const i of this.attributes)e(i);e(this);for(const i of this.args)e(i);this.searchBlock(this.body,e)}}class O8 extends xn{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class hR extends xn{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class cb extends xn{constructor(e,i){super(),this.body=e,this.loopId=i}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class fR extends xn{constructor(e,i,n,s){super(),this.init=e,this.condition=i,this.increment=n,this.body=s}get astNodeType(){return"for"}search(e){var i,n,s;(i=this.init)===null||i===void 0||i.search(e),(n=this.condition)===null||n===void 0||n.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}class wa extends xn{constructor(e,i,n,s,u){super(),this.attributes=null,this.name=e,this.type=i,this.storage=n,this.access=s,this.value=u}get astNodeType(){return"var"}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}class R1 extends xn{constructor(e,i,n){super(),this.attributes=null,this.name=e,this.type=i,this.value=n}get astNodeType(){return"override"}search(e){var i;(i=this.value)===null||i===void 0||i.search(e)}}class qd extends xn{constructor(e,i,n,s,u){super(),this.attributes=null,this.name=e,this.type=i,this.storage=n,this.access=s,this.value=u}get astNodeType(){return"let"}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}class Jg extends xn{constructor(e,i,n,s,u){super(),this.attributes=null,this.name=e,this.type=i,this.storage=n,this.access=s,this.value=u}get astNodeType(){return"const"}constEvaluate(e,i){return this.value.constEvaluate(e,i)}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}var ph,kd,We,Pe;(t=>{t.increment="++",t.decrement="--"})(ph||(ph={})),(t=>{t.parse=function(e){const i=e;if(i=="parse")throw new Error("Invalid value for IncrementOperator");return t[i]}})(ph||(ph={}));class dR extends xn{constructor(e,i){super(),this.operator=e,this.variable=i}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(kd||(kd={})),(t=>{t.parse=function(e){const i=e;if(i=="parse")throw new Error("Invalid value for AssignOperator");return i}})(kd||(kd={}));class pR extends xn{constructor(e,i,n){super(),this.operator=e,this.variable=i,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class P1 extends xn{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"call"}isBuiltin(){return uR.has(this.name)}search(e){for(const i of this.args)i.search(e);e(this)}}class mR extends xn{constructor(e,i){super(),this.body=e,this.continuing=i}get astNodeType(){return"loop"}}class gR extends xn{constructor(e,i){super(),this.condition=e,this.cases=i}get astNodeType(){return"switch"}}class _R extends xn{constructor(e,i,n,s){super(),this.condition=e,this.body=i,this.elseif=n,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class yR extends xn{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var i;(i=this.value)===null||i===void 0||i.search(e)}}class L8 extends xn{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class B8 extends xn{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class xR extends xn{constructor(e,i){super(),this.severity=e,this.rule=i}get astNodeType(){return"diagnostic"}}class k1 extends xn{constructor(e,i){super(),this.name=e,this.type=i}get astNodeType(){return"alias"}}class F8 extends xn{constructor(){super()}get astNodeType(){return"discard"}}class vR extends xn{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class bR extends xn{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class ut extends xn{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let i=e[0];if(i.name==="f32")return i;for(let n=1;n<e.length;++n){const s=ut._priority.get(i.name);ut._priority.get(e[n].name)<s&&(i=e[n])}return i.name==="x32"?ut.i32:i}getTypeName(){return this.name}}ut.x32=new ut("x32"),ut.f32=new ut("f32"),ut.i32=new ut("i32"),ut.u32=new ut("u32"),ut.f16=new ut("f16"),ut.bool=new ut("bool"),ut.void=new ut("void"),ut._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class LS extends ut{constructor(e){super(e)}}class ya extends ut{constructor(e,i,n,s){super(e),this.members=i,this.startLine=n,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let i=0;i<this.members.length;i++)if(this.members[i].name==e)return i;return-1}search(e){for(const i of this.members)e(i)}}class Be extends ut{constructor(e,i,n){super(e),this.format=i,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}Be.vec2f=new Be("vec2",ut.f32,null),Be.vec3f=new Be("vec3",ut.f32,null),Be.vec4f=new Be("vec4",ut.f32,null),Be.vec2i=new Be("vec2",ut.i32,null),Be.vec3i=new Be("vec3",ut.i32,null),Be.vec4i=new Be("vec4",ut.i32,null),Be.vec2u=new Be("vec2",ut.u32,null),Be.vec3u=new Be("vec3",ut.u32,null),Be.vec4u=new Be("vec4",ut.u32,null),Be.vec2h=new Be("vec2",ut.f16,null),Be.vec3h=new Be("vec3",ut.f16,null),Be.vec4h=new Be("vec4",ut.f16,null),Be.vec2b=new Be("vec2",ut.bool,null),Be.vec3b=new Be("vec3",ut.bool,null),Be.vec4b=new Be("vec4",ut.bool,null),Be.mat2x2f=new Be("mat2x2",ut.f32,null),Be.mat2x3f=new Be("mat2x3",ut.f32,null),Be.mat2x4f=new Be("mat2x4",ut.f32,null),Be.mat3x2f=new Be("mat3x2",ut.f32,null),Be.mat3x3f=new Be("mat3x3",ut.f32,null),Be.mat3x4f=new Be("mat3x4",ut.f32,null),Be.mat4x2f=new Be("mat4x2",ut.f32,null),Be.mat4x3f=new Be("mat4x3",ut.f32,null),Be.mat4x4f=new Be("mat4x4",ut.f32,null),Be.mat2x2h=new Be("mat2x2",ut.f16,null),Be.mat2x3h=new Be("mat2x3",ut.f16,null),Be.mat2x4h=new Be("mat2x4",ut.f16,null),Be.mat3x2h=new Be("mat3x2",ut.f16,null),Be.mat3x3h=new Be("mat3x3",ut.f16,null),Be.mat3x4h=new Be("mat3x4",ut.f16,null),Be.mat4x2h=new Be("mat4x2",ut.f16,null),Be.mat4x3h=new Be("mat4x3",ut.f16,null),Be.mat4x4h=new Be("mat4x4",ut.f16,null),Be.mat2x2i=new Be("mat2x2",ut.i32,null),Be.mat2x3i=new Be("mat2x3",ut.i32,null),Be.mat2x4i=new Be("mat2x4",ut.i32,null),Be.mat3x2i=new Be("mat3x2",ut.i32,null),Be.mat3x3i=new Be("mat3x3",ut.i32,null),Be.mat3x4i=new Be("mat3x4",ut.i32,null),Be.mat4x2i=new Be("mat4x2",ut.i32,null),Be.mat4x3i=new Be("mat4x3",ut.i32,null),Be.mat4x4i=new Be("mat4x4",ut.i32,null),Be.mat2x2u=new Be("mat2x2",ut.u32,null),Be.mat2x3u=new Be("mat2x3",ut.u32,null),Be.mat2x4u=new Be("mat2x4",ut.u32,null),Be.mat3x2u=new Be("mat3x2",ut.u32,null),Be.mat3x3u=new Be("mat3x3",ut.u32,null),Be.mat3x4u=new Be("mat3x4",ut.u32,null),Be.mat4x2u=new Be("mat4x2",ut.u32,null),Be.mat4x3u=new Be("mat4x3",ut.u32,null),Be.mat4x4u=new Be("mat4x4",ut.u32,null);class Nx extends ut{constructor(e,i,n,s){super(e),this.storage=i,this.type=n,this.access=s}get astNodeType(){return"pointer"}}class Gd extends ut{constructor(e,i,n,s){super(e),this.attributes=i,this.format=n,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class Dd extends ut{constructor(e,i,n){super(e),this.format=i,this.access=n}get astNodeType(){return"sampler"}}class Xo extends Ds{constructor(){super(),this.postfix=null}}class Vc extends Xo{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Ro extends Xo{constructor(e,i){super(),this.type=e,this.args=i}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const i of this.args)i.search(e)}constEvaluate(e,i){return i&&(i[0]=this.type),e.evalExpression(this,e.context)}}class D1 extends Xo{constructor(e,i){super(),this.cachedReturnValue=null,this.name=e,this.args=i}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return uR.has(this.name)}constEvaluate(e,i){return e.evalExpression(this,e.context)}search(e){for(const i of this.args)i.search(e);e(this)}}class ps extends Xo{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,i){return e.evalExpression(this,e.context)}}class wR extends Xo{constructor(e,i){super(),this.name=e,this.initializer=i}get astNodeType(){return"constExpr"}constEvaluate(e,i){if(this.initializer){const n=e.evalExpression(this.initializer,e.context);return n!==null&&this.postfix?n.getSubData(e,this.postfix,e.context):n}return null}search(e){this.initializer.search(e)}}class Qn extends Xo{constructor(e,i){super(),this.value=e,this.type=i}get astNodeType(){return"literalExpr"}constEvaluate(e,i){return i!==void 0&&(i[0]=this.type),this.value}get isScalar(){return this.value instanceof Me}get isVector(){return this.value instanceof he||this.value instanceof ri}get scalarValue(){return this.value instanceof Me?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof he||this.value instanceof ri?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class TR extends Xo{constructor(e,i){super(),this.type=e,this.value=i}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Fh extends Xo{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class ER extends Xo{constructor(){super()}}class jn extends ER{constructor(e,i){super(),this.operator=e,this.right=i}get astNodeType(){return"unaryOp"}constEvaluate(e,i){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Ys extends ER{constructor(e,i,n){super(),this.operator=e,this.left=i,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,i){return e.name===i.name?e:e.name==="f32"||i.name==="f32"?ut.f32:e.name==="u32"||i.name==="u32"?ut.u32:ut.i32}constEvaluate(e,i){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class AR extends Ds{constructor(e){super(),this.body=e}}class Qg extends Xo{constructor(){super()}get astNodeType(){return"default"}}class SR extends AR{constructor(e,i){super(i),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class IR extends AR{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class BS extends Ds{constructor(e,i,n){super(),this.name=e,this.type=i,this.attributes=n}get astNodeType(){return"argument"}}class N8 extends Ds{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class FS extends Ds{constructor(e,i,n){super(),this.name=e,this.type=i,this.attributes=n}get astNodeType(){return"member"}}class CR extends Ds{constructor(e,i){super(),this.name=e,this.value=i}get astNodeType(){return"attribute"}}class ks{constructor(e,i){this.parent=null,this.typeInfo=e,this.parent=i,this.id=ks._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,i,n,s){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,i,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.name}>`}}ks._id=0;class ub extends ks{constructor(){super(new Ms("void",null),null)}toString(){return"void"}}ub.void=new ub;class ah extends ks{constructor(e){super(new Ms("pointer",null),null),this.reference=e}clone(){return this}setDataValue(e,i,n,s){this.reference.setDataValue(e,i,n,s)}getSubData(e,i,n){return i?this.reference.getSubData(e,i,n):this}}class Me extends ks{constructor(e,i,n=null){super(i,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",i)}clone(){if(this.data instanceof Float32Array)return new Me(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Me(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Me(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,i,n,s){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(i instanceof Me))return void console.error("SetDataValue: Invalid value",i);let u=i.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?u=Math.floor(u):this.typeInfo.name==="bool"&&(u=u?1:0),this.data[0]=u}getSubData(e,i,n){return i?(console.error("getSubData: Scalar data does not support postfix",i),null):this}toString(){return`${this.value}`}}function z8(t,e,i){const n=e.length;return n===2?i==="f32"?new he(new Float32Array(e),t.getTypeInfo("vec2f")):i==="i32"||i==="bool"?new he(new Int32Array(e),t.getTypeInfo("vec2i")):i==="u32"?new he(new Uint32Array(e),t.getTypeInfo("vec2u")):i==="f16"?new he(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${i}`),null):n===3?i==="f32"?new he(new Float32Array(e),t.getTypeInfo("vec3f")):i==="i32"||i==="bool"?new he(new Int32Array(e),t.getTypeInfo("vec3i")):i==="u32"?new he(new Uint32Array(e),t.getTypeInfo("vec3u")):i==="f16"?new he(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${i}`),null):n===4?i==="f32"?new he(new Float32Array(e),t.getTypeInfo("vec4f")):i==="i32"||i==="bool"?new he(new Int32Array(e),t.getTypeInfo("vec4i")):i==="u32"?new he(new Uint32Array(e),t.getTypeInfo("vec4u")):i==="f16"?new he(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${i}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class he extends ks{constructor(e,i,n=null){if(super(i,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?this.data=new Float32Array(e):s==="vec2i"||s==="vec3i"||s==="vec4i"?this.data=new Int32Array(e):s==="vec2u"||s==="vec3u"||s==="vec4u"?this.data=new Uint32Array(e):s==="vec2h"||s==="vec3h"||s==="vec4h"?this.data=new Float32Array(e):s==="vec2b"||s==="vec3b"||s==="vec4b"?this.data=new Int32Array(e):s==="vec2"||s==="vec3"||s==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${s}`)}}clone(){if(this.data instanceof Float32Array)return new he(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new he(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new he(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,i,n,s){n instanceof Vc?console.error("TODO: Set vector postfix"):i instanceof he?this.data=i.data:console.error("SetDataValue: Invalid value",i)}getSubData(e,i,n){if(i===null)return this;let s=e.getTypeInfo("f32");if(this.typeInfo instanceof Uc)s=this.typeInfo.format||s;else{const f=this.typeInfo.name;f==="vec2f"||f==="vec3f"||f==="vec4f"?s=e.getTypeInfo("f32"):f==="vec2i"||f==="vec3i"||f==="vec4i"?s=e.getTypeInfo("i32"):f==="vec2b"||f==="vec3b"||f==="vec4b"?s=e.getTypeInfo("bool"):f==="vec2u"||f==="vec3u"||f==="vec4u"?s=e.getTypeInfo("u32"):f==="vec2h"||f==="vec3h"||f==="vec4h"?s=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${f}`)}let u=this;for(;i!==null&&u!==null;){if(i instanceof Fh){const f=i.index;let m=-1;if(f instanceof Qn){if(!(f.value instanceof Me))return console.error(`GetSubData: Invalid array index ${f.value}`),null;m=f.value.value}else{const o=e.evalExpression(f,n);if(!(o instanceof Me))return console.error("GetSubData: Unknown index type",f),null;m=o.value}if(m<0||m>=u.data.length)return console.error("GetSubData: Index out of range",m),null;if(u.data instanceof Float32Array){const o=new Float32Array(u.data.buffer,u.data.byteOffset+4*m,1);return new Me(o,s)}if(u.data instanceof Int32Array){const o=new Int32Array(u.data.buffer,u.data.byteOffset+4*m,1);return new Me(o,s)}if(u.data instanceof Uint32Array){const o=new Uint32Array(u.data.buffer,u.data.byteOffset+4*m,1);return new Me(o,s)}throw"GetSubData: Invalid data type"}if(!(i instanceof Vc))return console.error("GetSubData: Unknown postfix",i),null;{const f=i.value.toLowerCase();if(f.length===1){let o=0;if(f==="x"||f==="r")o=0;else if(f==="y"||f==="g")o=1;else if(f==="z"||f==="b")o=2;else{if(f!=="w"&&f!=="a")return console.error(`GetSubData: Unknown member ${f}`),null;o=3}if(this.data instanceof Float32Array){let v=new Float32Array(this.data.buffer,this.data.byteOffset+4*o,1);return new Me(v,s,this)}if(this.data instanceof Int32Array){let v=new Int32Array(this.data.buffer,this.data.byteOffset+4*o,1);return new Me(v,s,this)}if(this.data instanceof Uint32Array){let v=new Uint32Array(this.data.buffer,this.data.byteOffset+4*o,1);return new Me(v,s,this)}}const m=[];for(const o of f)o==="x"||o==="r"?m.push(this.data[0]):o==="y"||o==="g"?m.push(this.data[1]):o==="z"||o==="b"?m.push(this.data[2]):o==="w"||o==="a"?m.push(this.data[3]):console.error(`GetDataValue: Unknown member ${o}`);u=z8(e,m,s.name)}i=i.postfix}return u}toString(){let e=`${this.data[0]}`;for(let i=1;i<this.data.length;++i)e+=`, ${this.data[i]}`;return e}}class ri extends ks{constructor(e,i,n=null){super(i,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new ri(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,i,n,s){n instanceof Vc?console.error("TODO: Set matrix postfix"):i instanceof ri?this.data=i.data:console.error("SetDataValue: Invalid value",i)}getSubData(e,i,n){if(i===null)return this;const s=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Uc)this.typeInfo.format;else if(s.endsWith("f"))e.getTypeInfo("f32");else if(s.endsWith("i"))e.getTypeInfo("i32");else if(s.endsWith("u"))e.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;e.getTypeInfo("f16")}if(i instanceof Fh){const u=i.index;let f=-1;if(u instanceof Qn){if(!(u.value instanceof Me))return console.error(`GetDataValue: Invalid array index ${u.value}`),null;f=u.value.value}else{const v=e.evalExpression(u,n);if(!(v instanceof Me))return console.error("GetDataValue: Unknown index type",u),null;f=v.value}if(f<0||f>=this.data.length)return console.error("GetDataValue: Index out of range",f),null;const m=s.endsWith("h")?"h":"f";let o;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h"||s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")o=new he(new Float32Array(this.data.buffer,this.data.byteOffset+2*f*4,2),e.getTypeInfo(`vec2${m}`));else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h"||s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")o=new he(new Float32Array(this.data.buffer,this.data.byteOffset+3*f*4,3),e.getTypeInfo(`vec3${m}`));else{if(s!=="mat2x4"&&s!=="mat2x4f"&&s!=="mat2x4h"&&s!=="mat3x4"&&s!=="mat3x4f"&&s!=="mat3x4h"&&s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;o=new he(new Float32Array(this.data.buffer,this.data.byteOffset+4*f*4,4),e.getTypeInfo(`vec4${m}`))}return i.postfix?o.getSubData(e,i.postfix,n):o}return console.error("GetDataValue: Invalid postfix",i),null}toString(){let e=`${this.data[0]}`;for(let i=1;i<this.data.length;++i)e+=`, ${this.data[i]}`;return e}}class Dn extends ks{constructor(e,i,n=0,s=null){super(i,s),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Dn(e.buffer,this.typeInfo,0,null)}setDataValue(e,i,n,s){if(i===null)return void console.log("setDataValue: NULL data.");let u=this.offset,f=this.typeInfo;for(;n;){if(n instanceof Fh)if(f instanceof bl){const m=n.index;if(m instanceof Qn){if(!(m.value instanceof Me))return void console.error(`SetDataValue: Invalid index type ${m.value}`);u+=m.value.value*f.stride}else{const o=e.evalExpression(m,s);if(!(o instanceof Me))return void console.error("SetDataValue: Unknown index type",m);u+=o.value*f.stride}f=f.format}else console.error(`SetDataValue: Type ${f.getTypeName()} is not an array`);else{if(!(n instanceof Vc))return void console.error("SetDataValue: Unknown postfix type",n);{const m=n.value;if(f instanceof _l){let o=!1;for(const v of f.members)if(v.name===m){u+=v.offset,f=v.type,o=!0;break}if(!o)return void console.error(`SetDataValue: Member ${m} not found`)}else if(f instanceof Ms){const o=f.getTypeName();let v=0;if(m==="x"||m==="r")v=0;else if(m==="y"||m==="g")v=1;else if(m==="z"||m==="b")v=2;else{if(m!=="w"&&m!=="a")return void console.error(`SetDataValue: Unknown member ${m}`);v=3}if(!(i instanceof Me))return void console.error("SetDataValue: Invalid value",i);const w=i.value;return o==="vec2f"?void(new Float32Array(this.buffer,u,2)[v]=w):o==="vec3f"?void(new Float32Array(this.buffer,u,3)[v]=w):o==="vec4f"?void(new Float32Array(this.buffer,u,4)[v]=w):o==="vec2i"?void(new Int32Array(this.buffer,u,2)[v]=w):o==="vec3i"?void(new Int32Array(this.buffer,u,3)[v]=w):o==="vec4i"?void(new Int32Array(this.buffer,u,4)[v]=w):o==="vec2u"?void(new Uint32Array(this.buffer,u,2)[v]=w):o==="vec3u"?void(new Uint32Array(this.buffer,u,3)[v]=w):o==="vec4u"?void(new Uint32Array(this.buffer,u,4)[v]=w):void console.error(`SetDataValue: Type ${o} is not a struct`)}}}n=n.postfix}this.setData(e,i,f,u,s)}setData(e,i,n,s,u){const f=n.getTypeName();if(f!=="f32"&&f!=="f16")if(f!=="i32"&&f!=="atomic<i32>"&&f!=="x32")if(f!=="u32"&&f!=="atomic<u32>")if(f!=="bool")if(f!=="vec2f"&&f!=="vec2h")if(f!=="vec3f"&&f!=="vec3h")if(f!=="vec4f"&&f!=="vec4h")if(f!=="vec2i")if(f!=="vec3i")if(f!=="vec4i")if(f!=="vec2u")if(f!=="vec3u")if(f!=="vec4u")if(f!=="vec2b")if(f!=="vec3b")if(f!=="vec4b")if(f!=="mat2x2f"&&f!=="mat2x2h")if(f!=="mat2x3f"&&f!=="mat2x3h")if(f!=="mat2x4f"&&f!=="mat2x4h")if(f!=="mat3x2f"&&f!=="mat3x2h")if(f!=="mat3x3f"&&f!=="mat3x3h")if(f!=="mat3x4f"&&f!=="mat3x4h")if(f!=="mat4x2f"&&f!=="mat4x2h")if(f!=="mat4x3f"&&f!=="mat4x3h")if(f!=="mat4x4f"&&f!=="mat4x4h")if(i instanceof Dn){if(n===i.typeInfo)return void new Uint8Array(this.buffer,s,i.buffer.byteLength).set(new Uint8Array(i.buffer));console.error("SetDataValue: Type mismatch",f,i.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${f}`);else{const m=new Float32Array(this.buffer,s,16);i instanceof ri?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2],m[3]=i.data[3],m[4]=i.data[4],m[5]=i.data[5],m[6]=i.data[6],m[7]=i.data[7],m[8]=i.data[8],m[9]=i.data[9],m[10]=i.data[10],m[11]=i.data[11],m[12]=i.data[12],m[13]=i.data[13],m[14]=i.data[14],m[15]=i.data[15]):(m[0]=i[0],m[1]=i[1],m[2]=i[2],m[3]=i[3],m[4]=i[4],m[5]=i[5],m[6]=i[6],m[7]=i[7],m[8]=i[8],m[9]=i[9],m[10]=i[10],m[11]=i[11],m[12]=i[12],m[13]=i[13],m[14]=i[14],m[15]=i[15])}else{const m=new Float32Array(this.buffer,s,12);i instanceof ri?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2],m[3]=i.data[3],m[4]=i.data[4],m[5]=i.data[5],m[6]=i.data[6],m[7]=i.data[7],m[8]=i.data[8],m[9]=i.data[9],m[10]=i.data[10],m[11]=i.data[11]):(m[0]=i[0],m[1]=i[1],m[2]=i[2],m[3]=i[3],m[4]=i[4],m[5]=i[5],m[6]=i[6],m[7]=i[7],m[8]=i[8],m[9]=i[9],m[10]=i[10],m[11]=i[11])}else{const m=new Float32Array(this.buffer,s,8);i instanceof ri?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2],m[3]=i.data[3],m[4]=i.data[4],m[5]=i.data[5],m[6]=i.data[6],m[7]=i.data[7]):(m[0]=i[0],m[1]=i[1],m[2]=i[2],m[3]=i[3],m[4]=i[4],m[5]=i[5],m[6]=i[6],m[7]=i[7])}else{const m=new Float32Array(this.buffer,s,12);i instanceof ri?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2],m[3]=i.data[3],m[4]=i.data[4],m[5]=i.data[5],m[6]=i.data[6],m[7]=i.data[7],m[8]=i.data[8],m[9]=i.data[9],m[10]=i.data[10],m[11]=i.data[11]):(m[0]=i[0],m[1]=i[1],m[2]=i[2],m[3]=i[3],m[4]=i[4],m[5]=i[5],m[6]=i[6],m[7]=i[7],m[8]=i[8],m[9]=i[9],m[10]=i[10],m[11]=i[11])}else{const m=new Float32Array(this.buffer,s,9);i instanceof ri?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2],m[3]=i.data[3],m[4]=i.data[4],m[5]=i.data[5],m[6]=i.data[6],m[7]=i.data[7],m[8]=i.data[8]):(m[0]=i[0],m[1]=i[1],m[2]=i[2],m[3]=i[3],m[4]=i[4],m[5]=i[5],m[6]=i[6],m[7]=i[7],m[8]=i[8])}else{const m=new Float32Array(this.buffer,s,6);i instanceof ri?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2],m[3]=i.data[3],m[4]=i.data[4],m[5]=i.data[5]):(m[0]=i[0],m[1]=i[1],m[2]=i[2],m[3]=i[3],m[4]=i[4],m[5]=i[5])}else{const m=new Float32Array(this.buffer,s,8);i instanceof ri?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2],m[3]=i.data[3],m[4]=i.data[4],m[5]=i.data[5],m[6]=i.data[6],m[7]=i.data[7]):(m[0]=i[0],m[1]=i[1],m[2]=i[2],m[3]=i[3],m[4]=i[4],m[5]=i[5],m[6]=i[6],m[7]=i[7])}else{const m=new Float32Array(this.buffer,s,6);i instanceof ri?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2],m[3]=i.data[3],m[4]=i.data[4],m[5]=i.data[5]):(m[0]=i[0],m[1]=i[1],m[2]=i[2],m[3]=i[3],m[4]=i[4],m[5]=i[5])}else{const m=new Float32Array(this.buffer,s,4);i instanceof ri?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2],m[3]=i.data[3]):(m[0]=i[0],m[1]=i[1],m[2]=i[2],m[3]=i[3])}else{const m=new Uint32Array(this.buffer,s,4);i instanceof he?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2],m[3]=i.data[3]):(m[0]=i[0],m[1]=i[1],m[2]=i[2],m[3]=i[3])}else{const m=new Uint32Array(this.buffer,s,3);i instanceof he?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2]):(m[0]=i[0],m[1]=i[1],m[2]=i[2])}else{const m=new Uint32Array(this.buffer,s,2);i instanceof he?(m[0]=i.data[0],m[1]=i.data[1]):(m[0]=i[0],m[1]=i[1])}else{const m=new Uint32Array(this.buffer,s,4);i instanceof he?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2],m[3]=i.data[3]):(m[0]=i[0],m[1]=i[1],m[2]=i[2],m[3]=i[3])}else{const m=new Uint32Array(this.buffer,s,3);i instanceof he?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2]):(m[0]=i[0],m[1]=i[1],m[2]=i[2])}else{const m=new Uint32Array(this.buffer,s,2);i instanceof he?(m[0]=i.data[0],m[1]=i.data[1]):(m[0]=i[0],m[1]=i[1])}else{const m=new Int32Array(this.buffer,s,4);i instanceof he?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2],m[3]=i.data[3]):(m[0]=i[0],m[1]=i[1],m[2]=i[2],m[3]=i[3])}else{const m=new Int32Array(this.buffer,s,3);i instanceof he?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2]):(m[0]=i[0],m[1]=i[1],m[2]=i[2])}else{const m=new Int32Array(this.buffer,s,2);i instanceof he?(m[0]=i.data[0],m[1]=i.data[1]):(m[0]=i[0],m[1]=i[1])}else{const m=new Float32Array(this.buffer,s,4);i instanceof he?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2],m[3]=i.data[3]):(m[0]=i[0],m[1]=i[1],m[2]=i[2],m[3]=i[3])}else{const m=new Float32Array(this.buffer,s,3);i instanceof he?(m[0]=i.data[0],m[1]=i.data[1],m[2]=i.data[2]):(m[0]=i[0],m[1]=i[1],m[2]=i[2])}else{const m=new Float32Array(this.buffer,s,2);i instanceof he?(m[0]=i.data[0],m[1]=i.data[1]):(m[0]=i[0],m[1]=i[1])}else i instanceof Me&&(new Int32Array(this.buffer,s,1)[0]=i.value);else i instanceof Me&&(new Uint32Array(this.buffer,s,1)[0]=i.value);else i instanceof Me&&(new Int32Array(this.buffer,s,1)[0]=i.value);else i instanceof Me&&(new Float32Array(this.buffer,s,1)[0]=i.value)}getSubData(e,i,n){var s,u,f;if(i===null)return this;let m=this.offset,o=this.typeInfo;for(;i;){if(i instanceof Fh){const w=i.index,S=e.evalExpression(w,n);let R=0;if(S instanceof Me?R=S.value:console.error("GetDataValue: Invalid index type",w),o instanceof bl)m+=R*o.stride,o=o.format;else{const L=o.getTypeName();L==="mat4x4"||L==="mat4x4f"||L==="mat4x4h"?(m+=16*R,o=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${o.getTypeName()} is not an array`)}}else{if(!(i instanceof Vc))return console.error("GetDataValue: Unknown postfix type",i),null;{const w=i.value;if(o instanceof _l){let S=!1;for(const R of o.members)if(R.name===w){m+=R.offset,o=R.type,S=!0;break}if(!S)return console.error(`GetDataValue: Member ${w} not found`),null}else if(o instanceof Ms){const S=o.getTypeName();if(S==="vec2f"||S==="vec3f"||S==="vec4f"||S==="vec2i"||S==="vec3i"||S==="vec4i"||S==="vec2u"||S==="vec3u"||S==="vec4u"||S==="vec2b"||S==="vec3b"||S==="vec4b"||S==="vec2h"||S==="vec3h"||S==="vec4h"||S==="vec2"||S==="vec3"||S==="vec4"){if(w.length>0&&w.length<5){let R="f";const L=[];for(let j=0;j<w.length;++j){const Z=w[j].toLowerCase();let re=0;if(Z==="x"||Z==="r")re=0;else if(Z==="y"||Z==="g")re=1;else if(Z==="z"||Z==="b")re=2;else{if(Z!=="w"&&Z!=="a")return console.error(`Unknown member ${w}`),null;re=3}if(w.length===1){if(S.endsWith("f"))return this.buffer.byteLength<m+4*re+4?(console.log("Insufficient buffer data"),null):new Me(new Float32Array(this.buffer,m+4*re,1),e.getTypeInfo("f32"),this);if(S.endsWith("h"))return new Me(new Float32Array(this.buffer,m+4*re,1),e.getTypeInfo("f16"),this);if(S.endsWith("i"))return new Me(new Int32Array(this.buffer,m+4*re,1),e.getTypeInfo("i32"),this);if(S.endsWith("b"))return new Me(new Int32Array(this.buffer,m+4*re,1),e.getTypeInfo("bool"),this);if(S.endsWith("u"))return new Me(new Uint32Array(this.buffer,m+4*re,1),e.getTypeInfo("i32"),this)}if(S==="vec2f")L.push(new Float32Array(this.buffer,m,2)[re]);else if(S==="vec3f"){if(m+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const xe=new Float32Array(this.buffer,m,3);L.push(xe[re])}else if(S==="vec4f")L.push(new Float32Array(this.buffer,m,4)[re]);else if(S==="vec2i")R="i",L.push(new Int32Array(this.buffer,m,2)[re]);else if(S==="vec3i")R="i",L.push(new Int32Array(this.buffer,m,3)[re]);else if(S==="vec4i")R="i",L.push(new Int32Array(this.buffer,m,4)[re]);else if(S==="vec2u"){R="u";const xe=new Uint32Array(this.buffer,m,2);L.push(xe[re])}else S==="vec3u"?(R="u",L.push(new Uint32Array(this.buffer,m,3)[re])):S==="vec4u"&&(R="u",L.push(new Uint32Array(this.buffer,m,4)[re]))}return L.length===2?o=e.getTypeInfo(`vec2${R}`):L.length===3?o=e.getTypeInfo(`vec3${R}`):L.length===4?o=e.getTypeInfo(`vec4${R}`):console.error(`GetDataValue: Invalid vector length ${L.length}`),new he(L,o,null)}return console.error(`GetDataValue: Unknown member ${w}`),null}return console.error(`GetDataValue: Type ${S} is not a struct`),null}}}i=i.postfix}const v=o.getTypeName();return v==="f32"?new Me(new Float32Array(this.buffer,m,1),o,this):v==="i32"?new Me(new Int32Array(this.buffer,m,1),o,this):v==="u32"?new Me(new Uint32Array(this.buffer,m,1),o,this):v==="vec2f"?new he(new Float32Array(this.buffer,m,2),o,this):v==="vec3f"?new he(new Float32Array(this.buffer,m,3),o,this):v==="vec4f"?new he(new Float32Array(this.buffer,m,4),o,this):v==="vec2i"?new he(new Int32Array(this.buffer,m,2),o,this):v==="vec3i"?new he(new Int32Array(this.buffer,m,3),o,this):v==="vec4i"?new he(new Int32Array(this.buffer,m,4),o,this):v==="vec2u"?new he(new Uint32Array(this.buffer,m,2),o,this):v==="vec3u"?new he(new Uint32Array(this.buffer,m,3),o,this):v==="vec4u"?new he(new Uint32Array(this.buffer,m,4),o,this):o instanceof Uc&&o.name==="atomic"?((s=o.format)===null||s===void 0?void 0:s.name)==="u32"?new Me(new Uint32Array(this.buffer,m,1)[0],o.format,this):((u=o.format)===null||u===void 0?void 0:u.name)==="i32"?new Me(new Int32Array(this.buffer,m,1)[0],o.format,this):(console.error(`GetDataValue: Invalid atomic format ${(f=o.format)===null||f===void 0?void 0:f.name}`),null):new Dn(this.buffer,o,m,this)}toString(){let e="";if(this.typeInfo instanceof bl)if(this.typeInfo.format.name==="f32"){const i=new Float32Array(this.buffer,this.offset);e=`[${i[0]}`;for(let n=1;n<i.length;++n)e+=`, ${i[n]}`}else if(this.typeInfo.format.name==="i32"){const i=new Int32Array(this.buffer,this.offset);e=`[${i[0]}`;for(let n=1;n<i.length;++n)e+=`, ${i[n]}`}else if(this.typeInfo.format.name==="u32"){const i=new Uint32Array(this.buffer,this.offset);e=`[${i[0]}`;for(let n=1;n<i.length;++n)e+=`, ${i[n]}`}else if(this.typeInfo.format.name==="vec2f"){const i=new Float32Array(this.buffer,this.offset);e=`[${i[0]}, ${i[1]}]`;for(let n=1;n<i.length/2;++n)e+=`, [${i[2*n]}, ${i[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const i=new Float32Array(this.buffer,this.offset);e=`[${i[0]}, ${i[1]}, ${i[2]}]`;for(let n=4;n<i.length;n+=4)e+=`, [${i[n]}, ${i[n+1]}, ${i[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const i=new Float32Array(this.buffer,this.offset);e=`[${i[0]}, ${i[1]}, ${i[2]}, ${i[3]}]`;for(let n=4;n<i.length;n+=4)e+=`, [${i[n]}, ${i[n+1]}, ${i[n+2]}, ${i[n+3]}]`}else e="[...]";else this.typeInfo instanceof _l?e+="{...}":e="[...]";return e}}class xa extends ks{constructor(e,i,n,s){super(i,null),this.data=e,this.descriptor=n,this.view=s}clone(){return new xa(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,i;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(e=n[0])!==null&&e!==void 0?e:0:n instanceof Object&&(i=n.width)!==null&&i!==void 0?i:0}get height(){var e,i;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(e=n[1])!==null&&e!==void 0?e:0:n instanceof Object&&(i=n.height)!==null&&i!==void 0?i:0}get depthOrArrayLayers(){var e,i;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(e=n[2])!==null&&e!==void 0?e:0:n instanceof Object&&(i=n.depthOrArrayLayers)!==null&&i!==void 0?i:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const i=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<i.length;++n)i[n]=Math.max(1,i[n]>>e);return i}get texelByteSize(){const e=this.format,i=Fx[e];return i?i.isDepthStencil?4:i.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,i=Fx[e];return!!i&&i.isDepthStencil}getGpuSize(){const e=this.format,i=Fx[e],n=this.width;if(!e||n<=0||!i)return-1;const s=this.height,u=this.depthOrArrayLayers,f=this.dimension;return n/i.blockWidth*(f==="1d"?1:s/i.blockHeight)*i.bytesPerBlock*u}getPixel(e,i,n=0,s=0){const u=this.texelByteSize,f=this.bytesPerRow,m=this.height,o=this.data[s];return D8(new Uint8Array(o),e,i,n,s,m,f,u,this.format)}setPixel(e,i,n,s,u){const f=this.texelByteSize,m=this.bytesPerRow,o=this.height,v=this.data[s];(function(w,S,R,L,j,Z,re,xe,be,ue){const oe=L*(re>>=j)*(Z>>=j)+R*re+S*xe;switch(be){case"r8unorm":return void Ji(w,oe,"8unorm",1,ue);case"r8snorm":return void Ji(w,oe,"8snorm",1,ue);case"r8uint":return void Ji(w,oe,"8uint",1,ue);case"r8sint":return void Ji(w,oe,"8sint",1,ue);case"rg8unorm":return void Ji(w,oe,"8unorm",2,ue);case"rg8snorm":return void Ji(w,oe,"8snorm",2,ue);case"rg8uint":return void Ji(w,oe,"8uint",2,ue);case"rg8sint":return void Ji(w,oe,"8sint",2,ue);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Ji(w,oe,"8unorm",4,ue);case"rgba8snorm":return void Ji(w,oe,"8snorm",4,ue);case"rgba8uint":return void Ji(w,oe,"8uint",4,ue);case"rgba8sint":return void Ji(w,oe,"8sint",4,ue);case"r16uint":return void Ji(w,oe,"16uint",1,ue);case"r16sint":return void Ji(w,oe,"16sint",1,ue);case"r16float":return void Ji(w,oe,"16float",1,ue);case"rg16uint":return void Ji(w,oe,"16uint",2,ue);case"rg16sint":return void Ji(w,oe,"16sint",2,ue);case"rg16float":return void Ji(w,oe,"16float",2,ue);case"rgba16uint":return void Ji(w,oe,"16uint",4,ue);case"rgba16sint":return void Ji(w,oe,"16sint",4,ue);case"rgba16float":return void Ji(w,oe,"16float",4,ue);case"r32uint":return void Ji(w,oe,"32uint",1,ue);case"r32sint":return void Ji(w,oe,"32sint",1,ue);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Ji(w,oe,"32float",1,ue);case"rg32uint":return void Ji(w,oe,"32uint",2,ue);case"rg32sint":return void Ji(w,oe,"32sint",2,ue);case"rg32float":return void Ji(w,oe,"32float",2,ue);case"rgba32uint":return void Ji(w,oe,"32uint",4,ue);case"rgba32sint":return void Ji(w,oe,"32sint",4,ue);case"rgba32float":return void Ji(w,oe,"32float",4,ue);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(v),e,i,n,s,o,m,f,this.format,u)}}(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(Pe||(Pe={}));class De{constructor(e,i,n){this.name=e,this.type=i,this.rule=n}toString(){return this.name}}class ie{}We=ie,ie.none=new De("",Pe.reserved,""),ie.eof=new De("EOF",Pe.token,""),ie.reserved={asm:new De("asm",Pe.reserved,"asm"),bf16:new De("bf16",Pe.reserved,"bf16"),do:new De("do",Pe.reserved,"do"),enum:new De("enum",Pe.reserved,"enum"),f16:new De("f16",Pe.reserved,"f16"),f64:new De("f64",Pe.reserved,"f64"),handle:new De("handle",Pe.reserved,"handle"),i8:new De("i8",Pe.reserved,"i8"),i16:new De("i16",Pe.reserved,"i16"),i64:new De("i64",Pe.reserved,"i64"),mat:new De("mat",Pe.reserved,"mat"),premerge:new De("premerge",Pe.reserved,"premerge"),regardless:new De("regardless",Pe.reserved,"regardless"),typedef:new De("typedef",Pe.reserved,"typedef"),u8:new De("u8",Pe.reserved,"u8"),u16:new De("u16",Pe.reserved,"u16"),u64:new De("u64",Pe.reserved,"u64"),unless:new De("unless",Pe.reserved,"unless"),using:new De("using",Pe.reserved,"using"),vec:new De("vec",Pe.reserved,"vec"),void:new De("void",Pe.reserved,"void")},ie.keywords={array:new De("array",Pe.keyword,"array"),atomic:new De("atomic",Pe.keyword,"atomic"),bool:new De("bool",Pe.keyword,"bool"),f32:new De("f32",Pe.keyword,"f32"),i32:new De("i32",Pe.keyword,"i32"),mat2x2:new De("mat2x2",Pe.keyword,"mat2x2"),mat2x3:new De("mat2x3",Pe.keyword,"mat2x3"),mat2x4:new De("mat2x4",Pe.keyword,"mat2x4"),mat3x2:new De("mat3x2",Pe.keyword,"mat3x2"),mat3x3:new De("mat3x3",Pe.keyword,"mat3x3"),mat3x4:new De("mat3x4",Pe.keyword,"mat3x4"),mat4x2:new De("mat4x2",Pe.keyword,"mat4x2"),mat4x3:new De("mat4x3",Pe.keyword,"mat4x3"),mat4x4:new De("mat4x4",Pe.keyword,"mat4x4"),ptr:new De("ptr",Pe.keyword,"ptr"),sampler:new De("sampler",Pe.keyword,"sampler"),sampler_comparison:new De("sampler_comparison",Pe.keyword,"sampler_comparison"),struct:new De("struct",Pe.keyword,"struct"),texture_1d:new De("texture_1d",Pe.keyword,"texture_1d"),texture_2d:new De("texture_2d",Pe.keyword,"texture_2d"),texture_2d_array:new De("texture_2d_array",Pe.keyword,"texture_2d_array"),texture_3d:new De("texture_3d",Pe.keyword,"texture_3d"),texture_cube:new De("texture_cube",Pe.keyword,"texture_cube"),texture_cube_array:new De("texture_cube_array",Pe.keyword,"texture_cube_array"),texture_multisampled_2d:new De("texture_multisampled_2d",Pe.keyword,"texture_multisampled_2d"),texture_storage_1d:new De("texture_storage_1d",Pe.keyword,"texture_storage_1d"),texture_storage_2d:new De("texture_storage_2d",Pe.keyword,"texture_storage_2d"),texture_storage_2d_array:new De("texture_storage_2d_array",Pe.keyword,"texture_storage_2d_array"),texture_storage_3d:new De("texture_storage_3d",Pe.keyword,"texture_storage_3d"),texture_depth_2d:new De("texture_depth_2d",Pe.keyword,"texture_depth_2d"),texture_depth_2d_array:new De("texture_depth_2d_array",Pe.keyword,"texture_depth_2d_array"),texture_depth_cube:new De("texture_depth_cube",Pe.keyword,"texture_depth_cube"),texture_depth_cube_array:new De("texture_depth_cube_array",Pe.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new De("texture_depth_multisampled_2d",Pe.keyword,"texture_depth_multisampled_2d"),texture_external:new De("texture_external",Pe.keyword,"texture_external"),u32:new De("u32",Pe.keyword,"u32"),vec2:new De("vec2",Pe.keyword,"vec2"),vec3:new De("vec3",Pe.keyword,"vec3"),vec4:new De("vec4",Pe.keyword,"vec4"),bitcast:new De("bitcast",Pe.keyword,"bitcast"),block:new De("block",Pe.keyword,"block"),break:new De("break",Pe.keyword,"break"),case:new De("case",Pe.keyword,"case"),continue:new De("continue",Pe.keyword,"continue"),continuing:new De("continuing",Pe.keyword,"continuing"),default:new De("default",Pe.keyword,"default"),diagnostic:new De("diagnostic",Pe.keyword,"diagnostic"),discard:new De("discard",Pe.keyword,"discard"),else:new De("else",Pe.keyword,"else"),enable:new De("enable",Pe.keyword,"enable"),fallthrough:new De("fallthrough",Pe.keyword,"fallthrough"),false:new De("false",Pe.keyword,"false"),fn:new De("fn",Pe.keyword,"fn"),for:new De("for",Pe.keyword,"for"),function:new De("function",Pe.keyword,"function"),if:new De("if",Pe.keyword,"if"),let:new De("let",Pe.keyword,"let"),const:new De("const",Pe.keyword,"const"),loop:new De("loop",Pe.keyword,"loop"),while:new De("while",Pe.keyword,"while"),private:new De("private",Pe.keyword,"private"),read:new De("read",Pe.keyword,"read"),read_write:new De("read_write",Pe.keyword,"read_write"),return:new De("return",Pe.keyword,"return"),requires:new De("requires",Pe.keyword,"requires"),storage:new De("storage",Pe.keyword,"storage"),switch:new De("switch",Pe.keyword,"switch"),true:new De("true",Pe.keyword,"true"),alias:new De("alias",Pe.keyword,"alias"),type:new De("type",Pe.keyword,"type"),uniform:new De("uniform",Pe.keyword,"uniform"),var:new De("var",Pe.keyword,"var"),override:new De("override",Pe.keyword,"override"),workgroup:new De("workgroup",Pe.keyword,"workgroup"),write:new De("write",Pe.keyword,"write"),r8unorm:new De("r8unorm",Pe.keyword,"r8unorm"),r8snorm:new De("r8snorm",Pe.keyword,"r8snorm"),r8uint:new De("r8uint",Pe.keyword,"r8uint"),r8sint:new De("r8sint",Pe.keyword,"r8sint"),r16uint:new De("r16uint",Pe.keyword,"r16uint"),r16sint:new De("r16sint",Pe.keyword,"r16sint"),r16float:new De("r16float",Pe.keyword,"r16float"),rg8unorm:new De("rg8unorm",Pe.keyword,"rg8unorm"),rg8snorm:new De("rg8snorm",Pe.keyword,"rg8snorm"),rg8uint:new De("rg8uint",Pe.keyword,"rg8uint"),rg8sint:new De("rg8sint",Pe.keyword,"rg8sint"),r32uint:new De("r32uint",Pe.keyword,"r32uint"),r32sint:new De("r32sint",Pe.keyword,"r32sint"),r32float:new De("r32float",Pe.keyword,"r32float"),rg16uint:new De("rg16uint",Pe.keyword,"rg16uint"),rg16sint:new De("rg16sint",Pe.keyword,"rg16sint"),rg16float:new De("rg16float",Pe.keyword,"rg16float"),rgba8unorm:new De("rgba8unorm",Pe.keyword,"rgba8unorm"),rgba8unorm_srgb:new De("rgba8unorm_srgb",Pe.keyword,"rgba8unorm_srgb"),rgba8snorm:new De("rgba8snorm",Pe.keyword,"rgba8snorm"),rgba8uint:new De("rgba8uint",Pe.keyword,"rgba8uint"),rgba8sint:new De("rgba8sint",Pe.keyword,"rgba8sint"),bgra8unorm:new De("bgra8unorm",Pe.keyword,"bgra8unorm"),bgra8unorm_srgb:new De("bgra8unorm_srgb",Pe.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new De("rgb10a2unorm",Pe.keyword,"rgb10a2unorm"),rg11b10float:new De("rg11b10float",Pe.keyword,"rg11b10float"),rg32uint:new De("rg32uint",Pe.keyword,"rg32uint"),rg32sint:new De("rg32sint",Pe.keyword,"rg32sint"),rg32float:new De("rg32float",Pe.keyword,"rg32float"),rgba16uint:new De("rgba16uint",Pe.keyword,"rgba16uint"),rgba16sint:new De("rgba16sint",Pe.keyword,"rgba16sint"),rgba16float:new De("rgba16float",Pe.keyword,"rgba16float"),rgba32uint:new De("rgba32uint",Pe.keyword,"rgba32uint"),rgba32sint:new De("rgba32sint",Pe.keyword,"rgba32sint"),rgba32float:new De("rgba32float",Pe.keyword,"rgba32float"),static_assert:new De("static_assert",Pe.keyword,"static_assert")},ie.tokens={decimal_float_literal:new De("decimal_float_literal",Pe.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new De("hex_float_literal",Pe.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new De("int_literal",Pe.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new De("uint_literal",Pe.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new De("name",Pe.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new De("ident",Pe.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new De("and",Pe.token,"&"),and_and:new De("and_and",Pe.token,"&&"),arrow:new De("arrow ",Pe.token,"->"),attr:new De("attr",Pe.token,"@"),forward_slash:new De("forward_slash",Pe.token,"/"),bang:new De("bang",Pe.token,"!"),bracket_left:new De("bracket_left",Pe.token,"["),bracket_right:new De("bracket_right",Pe.token,"]"),brace_left:new De("brace_left",Pe.token,"{"),brace_right:new De("brace_right",Pe.token,"}"),colon:new De("colon",Pe.token,":"),comma:new De("comma",Pe.token,","),equal:new De("equal",Pe.token,"="),equal_equal:new De("equal_equal",Pe.token,"=="),not_equal:new De("not_equal",Pe.token,"!="),greater_than:new De("greater_than",Pe.token,">"),greater_than_equal:new De("greater_than_equal",Pe.token,">="),shift_right:new De("shift_right",Pe.token,">>"),less_than:new De("less_than",Pe.token,"<"),less_than_equal:new De("less_than_equal",Pe.token,"<="),shift_left:new De("shift_left",Pe.token,"<<"),modulo:new De("modulo",Pe.token,"%"),minus:new De("minus",Pe.token,"-"),minus_minus:new De("minus_minus",Pe.token,"--"),period:new De("period",Pe.token,"."),plus:new De("plus",Pe.token,"+"),plus_plus:new De("plus_plus",Pe.token,"++"),or:new De("or",Pe.token,"|"),or_or:new De("or_or",Pe.token,"||"),paren_left:new De("paren_left",Pe.token,"("),paren_right:new De("paren_right",Pe.token,")"),semicolon:new De("semicolon",Pe.token,";"),star:new De("star",Pe.token,"*"),tilde:new De("tilde",Pe.token,"~"),underscore:new De("underscore",Pe.token,"_"),xor:new De("xor",Pe.token,"^"),plus_equal:new De("plus_equal",Pe.token,"+="),minus_equal:new De("minus_equal",Pe.token,"-="),times_equal:new De("times_equal",Pe.token,"*="),division_equal:new De("division_equal",Pe.token,"/="),modulo_equal:new De("modulo_equal",Pe.token,"%="),and_equal:new De("and_equal",Pe.token,"&="),or_equal:new De("or_equal",Pe.token,"|="),xor_equal:new De("xor_equal",Pe.token,"^="),shift_right_equal:new De("shift_right_equal",Pe.token,">>="),shift_left_equal:new De("shift_left_equal",Pe.token,"<<=")},ie.simpleTokens={"@":We.tokens.attr,"{":We.tokens.brace_left,"}":We.tokens.brace_right,":":We.tokens.colon,",":We.tokens.comma,"(":We.tokens.paren_left,")":We.tokens.paren_right,";":We.tokens.semicolon},ie.literalTokens={"&":We.tokens.and,"&&":We.tokens.and_and,"->":We.tokens.arrow,"/":We.tokens.forward_slash,"!":We.tokens.bang,"[":We.tokens.bracket_left,"]":We.tokens.bracket_right,"=":We.tokens.equal,"==":We.tokens.equal_equal,"!=":We.tokens.not_equal,">":We.tokens.greater_than,">=":We.tokens.greater_than_equal,">>":We.tokens.shift_right,"<":We.tokens.less_than,"<=":We.tokens.less_than_equal,"<<":We.tokens.shift_left,"%":We.tokens.modulo,"-":We.tokens.minus,"--":We.tokens.minus_minus,".":We.tokens.period,"+":We.tokens.plus,"++":We.tokens.plus_plus,"|":We.tokens.or,"||":We.tokens.or_or,"*":We.tokens.star,"~":We.tokens.tilde,_:We.tokens.underscore,"^":We.tokens.xor,"+=":We.tokens.plus_equal,"-=":We.tokens.minus_equal,"*=":We.tokens.times_equal,"/=":We.tokens.division_equal,"%=":We.tokens.modulo_equal,"&=":We.tokens.and_equal,"|=":We.tokens.or_equal,"^=":We.tokens.xor_equal,">>=":We.tokens.shift_right_equal,"<<=":We.tokens.shift_left_equal},ie.regexTokens={decimal_float_literal:We.tokens.decimal_float_literal,hex_float_literal:We.tokens.hex_float_literal,int_literal:We.tokens.int_literal,uint_literal:We.tokens.uint_literal,ident:We.tokens.ident},ie.storage_class=[We.keywords.function,We.keywords.private,We.keywords.workgroup,We.keywords.uniform,We.keywords.storage],ie.access_mode=[We.keywords.read,We.keywords.write,We.keywords.read_write],ie.sampler_type=[We.keywords.sampler,We.keywords.sampler_comparison],ie.sampled_texture_type=[We.keywords.texture_1d,We.keywords.texture_2d,We.keywords.texture_2d_array,We.keywords.texture_3d,We.keywords.texture_cube,We.keywords.texture_cube_array],ie.multisampled_texture_type=[We.keywords.texture_multisampled_2d],ie.storage_texture_type=[We.keywords.texture_storage_1d,We.keywords.texture_storage_2d,We.keywords.texture_storage_2d_array,We.keywords.texture_storage_3d],ie.depth_texture_type=[We.keywords.texture_depth_2d,We.keywords.texture_depth_2d_array,We.keywords.texture_depth_cube,We.keywords.texture_depth_cube_array,We.keywords.texture_depth_multisampled_2d],ie.texture_external_type=[We.keywords.texture_external],ie.any_texture_type=[...We.sampled_texture_type,...We.multisampled_texture_type,...We.storage_texture_type,...We.depth_texture_type,...We.texture_external_type],ie.texel_format=[We.keywords.r8unorm,We.keywords.r8snorm,We.keywords.r8uint,We.keywords.r8sint,We.keywords.r16uint,We.keywords.r16sint,We.keywords.r16float,We.keywords.rg8unorm,We.keywords.rg8snorm,We.keywords.rg8uint,We.keywords.rg8sint,We.keywords.r32uint,We.keywords.r32sint,We.keywords.r32float,We.keywords.rg16uint,We.keywords.rg16sint,We.keywords.rg16float,We.keywords.rgba8unorm,We.keywords.rgba8unorm_srgb,We.keywords.rgba8snorm,We.keywords.rgba8uint,We.keywords.rgba8sint,We.keywords.bgra8unorm,We.keywords.bgra8unorm_srgb,We.keywords.rgb10a2unorm,We.keywords.rg11b10float,We.keywords.rg32uint,We.keywords.rg32sint,We.keywords.rg32float,We.keywords.rgba16uint,We.keywords.rgba16sint,We.keywords.rgba16float,We.keywords.rgba32uint,We.keywords.rgba32sint,We.keywords.rgba32float],ie.const_literal=[We.tokens.int_literal,We.tokens.uint_literal,We.tokens.decimal_float_literal,We.tokens.hex_float_literal,We.keywords.true,We.keywords.false],ie.literal_or_ident=[We.tokens.ident,We.tokens.int_literal,We.tokens.uint_literal,We.tokens.decimal_float_literal,We.tokens.hex_float_literal,We.tokens.name],ie.element_count_expression=[We.tokens.int_literal,We.tokens.uint_literal,We.tokens.ident],ie.template_types=[We.keywords.vec2,We.keywords.vec3,We.keywords.vec4,We.keywords.mat2x2,We.keywords.mat2x3,We.keywords.mat2x4,We.keywords.mat3x2,We.keywords.mat3x3,We.keywords.mat3x4,We.keywords.mat4x2,We.keywords.mat4x3,We.keywords.mat4x4,We.keywords.atomic,We.keywords.bitcast,...We.any_texture_type],ie.attribute_name=[We.tokens.ident,We.keywords.block,We.keywords.diagnostic],ie.assignment_operators=[We.tokens.equal,We.tokens.plus_equal,We.tokens.minus_equal,We.tokens.times_equal,We.tokens.division_equal,We.tokens.modulo_equal,We.tokens.and_equal,We.tokens.or_equal,We.tokens.xor_equal,We.tokens.shift_right_equal,We.tokens.shift_left_equal],ie.increment_operators=[We.tokens.plus_plus,We.tokens.minus_minus];class NS{constructor(e,i,n,s,u){this.type=e,this.lexeme=i,this.line=n,this.start=s,this.end=u}toString(){return this.lexeme}isTemplateType(){return ie.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==ie.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class U8{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new NS(ie.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let f=1;for(;f>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),f--,f==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),f++)}return!0}}const i=ie.simpleTokens[e];if(i)return this._addToken(i),!0;let n=ie.none;const s=this._isAlpha(e),u=e==="_";if(this._isAlphaNumeric(e)){let f=this._peekAhead();for(;this._isAlphaNumeric(f);)e+=this._advance(),f=this._peekAhead()}if(s){const f=ie.keywords[e];if(f)return this._addToken(f),!0}if(s||u)return this._addToken(ie.tokens.ident),!0;for(;;){let f=this._findType(e);const m=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(m=="=")return this._current++,e+=m,this._addToken(ie.tokens.minus_equal),!0;if(m=="-")return this._current++,e+=m,this._addToken(ie.tokens.minus_minus),!0;const o=this._tokens.length-1;if((ie.literal_or_ident.indexOf(this._tokens[o].type)!=-1||this._tokens[o].type==ie.tokens.paren_right)&&m!=">")return this._addToken(f),!0}if(e==">"&&(m==">"||m=="=")){let o=!1,v=this._tokens.length-1;for(let w=0;w<5&&v>=0&&ie.assignment_operators.indexOf(this._tokens[v].type)===-1;++w,--v)if(this._tokens[v].type===ie.tokens.less_than){v>0&&this._tokens[v-1].isArrayOrTemplateType()&&(o=!0);break}if(o)return this._addToken(f),!0}if(f===ie.none){let o=e,v=0;const w=2;for(let S=0;S<w;++S)if(o+=this._peekAhead(S),f=this._findType(o),f!==ie.none){v=S;break}if(f===ie.none)return n!==ie.none&&(this._current--,this._addToken(n),!0);e=o,this._current+=v+1}if(n=f,this._isAtEnd())break;e+=this._advance()}return n!==ie.none&&(this._addToken(n),!0)}_findType(e){for(const n in ie.regexTokens){const s=ie.regexTokens[n];if(this._match(e,s.rule))return s}return ie.literalTokens[e]||ie.none}_match(e,i){const n=i.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let i=this._source[this._current];return e=e||0,e++,this._current+=e,i}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const i=this._source.substring(this._start,this._current);this._tokens.push(new NS(e,i,this._line,this._start,this._current))}}function Bt(t){return Array.isArray(t)||(t==null?void 0:t.buffer)instanceof ArrayBuffer}const H_=new Float32Array(1),V8=new Uint32Array(H_.buffer),j8=new Uint32Array(H_.buffer),X_=new Int32Array(1),$8=new Float32Array(X_.buffer),W8=new Uint32Array(X_.buffer),q_=new Uint32Array(1),H8=new Float32Array(q_.buffer),X8=new Int32Array(q_.buffer);function zS(t,e,i){if(e===i)return t;if(e==="f32"){if(i==="i32"||i==="x32")return H_[0]=t,V8[0];if(i==="u32")return H_[0]=t,j8[0]}else if(e==="i32"||e==="x32"){if(i==="f32")return X_[0]=t,$8[0];if(i==="u32")return X_[0]=t,W8[0]}else if(e==="u32"){if(i==="f32")return q_[0]=t,H8[0];if(i==="i32"||i==="x32")return q_[0]=t,X8[0]}return console.error(`Unsupported cast from ${e} to ${i}`),t}class q8{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Pg{constructor(e,i){this.align=e,this.size=i}}class Fo{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new R8,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const i of e)i instanceof dp&&this._functions.set(i.name,new q8(i));for(const i of e)if(i instanceof ya){const n=this.getTypeInfo(i,null);n instanceof _l&&this.structs.push(n)}for(const i of e)if(i instanceof k1)this.aliases.push(this._getAliasInfo(i));else if(i instanceof R1){const n=i,s=this._getAttributeNum(n.attributes,"id",0),u=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new I8(n.name,u,n.attributes,s))}else if(this._isUniformVar(i)){const n=i,s=this._getAttributeNum(n.attributes,"group",0),u=this._getAttributeNum(n.attributes,"binding",0),f=this.getTypeInfo(n.type,n.attributes),m=new Rg(n.name,f,s,u,n.attributes,dl.Uniform,n.access);m.access||(m.access="read"),this.uniforms.push(m)}else if(this._isStorageVar(i)){const n=i,s=this._getAttributeNum(n.attributes,"group",0),u=this._getAttributeNum(n.attributes,"binding",0),f=this.getTypeInfo(n.type,n.attributes),m=this._isStorageTexture(f),o=new Rg(n.name,f,s,u,n.attributes,m?dl.StorageTexture:dl.Storage,n.access);o.access||(o.access="read"),this.storage.push(o)}else if(this._isTextureVar(i)){const n=i,s=this._getAttributeNum(n.attributes,"group",0),u=this._getAttributeNum(n.attributes,"binding",0),f=this.getTypeInfo(n.type,n.attributes),m=this._isStorageTexture(f),o=new Rg(n.name,f,s,u,n.attributes,m?dl.StorageTexture:dl.Texture,n.access);o.access||(o.access="read"),m?this.storage.push(o):this.textures.push(o)}else if(this._isSamplerVar(i)){const n=i,s=this._getAttributeNum(n.attributes,"group",0),u=this._getAttributeNum(n.attributes,"binding",0),f=this.getTypeInfo(n.type,n.attributes),m=new Rg(n.name,f,s,u,n.attributes,dl.Sampler,n.access);this.samplers.push(m)}else if(i instanceof dp){const n=this._getAttribute(i,"vertex"),s=this._getAttribute(i,"fragment"),u=this._getAttribute(i,"compute"),f=n||s||u,m=new M8(i.name,f==null?void 0:f.name,i.attributes);m.attributes=i.attributes,m.startLine=i.startLine,m.endLine=i.endLine,this.functions.push(m),this._functions.get(i.name).info=m,f&&(this._functions.get(i.name).inUse=!0,m.inUse=!0,m.resources=this._findResources(i,!!f),m.inputs=this._getInputs(i.args),m.outputs=this._getOutputs(i.returnType),this.entry[f.name].push(m)),m.arguments=i.args.map(o=>new C8(o.name,this.getTypeInfo(o.type,o.attributes),o.attributes)),m.returnType=i.returnType?this.getTypeInfo(i.returnType,i.attributes):null}for(const i of this._functions.values())i.info&&(i.info.inUse=i.inUse,this._addCalls(i.node,i.info.calls));for(const i of this._functions.values())i.node.search(n=>{var s,u,f;if(n instanceof CR){if(n.value)if(Bt(n.value))for(const m of n.value)for(const o of this.overrides)m===o.name&&((s=i.info)===null||s===void 0||s.overrides.push(o));else for(const m of this.overrides)n.value===m.name&&((u=i.info)===null||u===void 0||u.overrides.push(m))}else if(n instanceof ps)for(const m of this.overrides)n.name===m.name&&((f=i.info)===null||f===void 0||f.overrides.push(m))});for(const i of this.uniforms)this._markStructsInUse(i.type);for(const i of this.storage)this._markStructsInUse(i.type)}getStructInfo(e){for(const i of this.structs)if(i.name==e)return i;return null}getOverrideInfo(e){for(const i of this.overrides)if(i.name==e)return i;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const i of e.members)this._markStructsInUse(i.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const i=this._getAlias(e.name);i&&this._markStructsInUse(i)}}_addCalls(e,i){var n;for(const s of e.calls){const u=(n=this._functions.get(s.name))===null||n===void 0?void 0:n.info;u&&i.add(u)}}findResource(e,i,n){if(n){for(const s of this.entry.compute)if(s.name===n){for(const u of s.resources)if(u.group==e&&u.binding==i)return u}for(const s of this.entry.vertex)if(s.name===n){for(const u of s.resources)if(u.group==e&&u.binding==i)return u}for(const s of this.entry.fragment)if(s.name===n){for(const u of s.resources)if(u.group==e&&u.binding==i)return u}}for(const s of this.uniforms)if(s.group==e&&s.binding==i)return s;for(const s of this.storage)if(s.group==e&&s.binding==i)return s;for(const s of this.textures)if(s.group==e&&s.binding==i)return s;for(const s of this.samplers)if(s.group==e&&s.binding==i)return s;return null}_findResource(e){for(const i of this.uniforms)if(i.name==e)return i;for(const i of this.storage)if(i.name==e)return i;for(const i of this.textures)if(i.name==e)return i;for(const i of this.samplers)if(i.name==e)return i;return null}_markStructsFromAST(e){const i=this.getTypeInfo(e,null);this._markStructsInUse(i)}_findResources(e,i){const n=[],s=this,u=[];return e.search(f=>{if(f instanceof $_)u.push({});else if(f instanceof W_)u.pop();else if(f instanceof wa){const m=f;i&&m.type!==null&&this._markStructsFromAST(m.type),u.length>0&&(u[u.length-1][m.name]=m)}else if(f instanceof Ro){const m=f;i&&m.type!==null&&this._markStructsFromAST(m.type)}else if(f instanceof qd){const m=f;i&&m.type!==null&&this._markStructsFromAST(m.type),u.length>0&&(u[u.length-1][m.name]=m)}else if(f instanceof ps){const m=f;if(u.length>0&&u[u.length-1][m.name])return;const o=s._findResource(m.name);o&&n.push(o)}else if(f instanceof D1){const m=f,o=s._functions.get(m.name);o&&(i&&(o.inUse=!0),e.calls.add(o.node),o.resources===null&&(o.resources=s._findResources(o.node,i)),n.push(...o.resources))}else if(f instanceof P1){const m=f,o=s._functions.get(m.name);o&&(i&&(o.inUse=!0),e.calls.add(o.node),o.resources===null&&(o.resources=s._findResources(o.node,i)),n.push(...o.resources))}}),[...new Map(n.map(f=>[f.name,f])).values()]}getBindGroups(){const e=[];function i(n,s){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),s>=e[n].length&&(e[n].length=s+1)}for(const n of this.uniforms)i(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)i(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)i(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)i(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,i=void 0){if(i===void 0&&(i=[]),e instanceof ya)this._getStructOutputs(e,i);else{const n=this._getOutputInfo(e);n!==null&&i.push(n)}return i}_getStructOutputs(e,i){for(const n of e.members)if(n.type instanceof ya)this._getStructOutputs(n.type,i);else{const s=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(s!==null){const u=this.getTypeInfo(n.type,n.type.attributes),f=this._parseInt(s.value),m=new DS(n.name,u,s.name,f);i.push(m)}}}_getOutputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const n=this.getTypeInfo(e,e.attributes),s=this._parseInt(i.value);return new DS("",n,i.name,s)}return null}_getInputs(e,i=void 0){i===void 0&&(i=[]);for(const n of e)if(n.type instanceof ya)this._getStructInputs(n.type,i);else{const s=this._getInputInfo(n);s!==null&&i.push(s)}return i}_getStructInputs(e,i){for(const n of e.members)if(n.type instanceof ya)this._getStructInputs(n.type,i);else{const s=this._getInputInfo(n);s!==null&&i.push(s)}}_getInputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const n=this._getAttribute(e,"interpolation"),s=this.getTypeInfo(e.type,e.attributes),u=this._parseInt(i.value),f=new S8(e.name,s,i.name,u);return n!==null&&(f.interpolation=this._parseString(n.value)),f}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const i=parseInt(e);return isNaN(i)?e:i}_getAlias(e){for(const i of this.aliases)if(i.name==e)return i.type;return null}_getAliasInfo(e){return new A8(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const i of this.structs)if(i.name==e)return i;for(const i of this.aliases)if(i.name==e)return i.type;return null}getTypeInfo(e,i=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Gd){const s=e,u=s.format?this.getTypeInfo(s.format,s.attributes):null,f=new bl(s.name,i);return f.format=u,f.count=s.count,this._types.set(e,f),this._updateTypeInfo(f),f}if(e instanceof ya){const s=e,u=new _l(s.name,i);u.startLine=s.startLine,u.endLine=s.endLine;for(const f of s.members){const m=this.getTypeInfo(f.type,f.attributes);u.members.push(new kS(f.name,m,f.attributes))}return this._types.set(e,u),this._updateTypeInfo(u),u}if(e instanceof Dd){const s=e,u=s.format instanceof ut,f=s.format?u?this.getTypeInfo(s.format,null):new Ms(s.format,null):null,m=new Uc(s.name,f,i,s.access);return this._types.set(e,m),this._updateTypeInfo(m),m}if(e instanceof Be){const s=e,u=s.format?this.getTypeInfo(s.format,null):null,f=new Uc(s.name,u,i,s.access);return this._types.set(e,f),this._updateTypeInfo(f),f}const n=new Ms(e.name,i);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var i,n,s;const u=this._getTypeSize(e);if(e.size=(i=u==null?void 0:u.size)!==null&&i!==void 0?i:0,e instanceof bl&&e.format){const f=this._getTypeSize(e.format);e.stride=Math.max((n=f==null?void 0:f.size)!==null&&n!==void 0?n:0,(s=f==null?void 0:f.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(e.format)}e instanceof _l&&this._updateStructInfo(e)}_updateStructInfo(e){var i;let n=0,s=0,u=0,f=0;for(let m=0,o=e.members.length;m<o;++m){const v=e.members[m],w=this._getTypeSize(v);if(!w)continue;(i=this._getAlias(v.type.name))!==null&&i!==void 0||v.type;const S=w.align,R=w.size;n=this._roundUp(S,n+s),s=R,u=n,f=Math.max(f,S),v.offset=n,v.size=R,this._updateTypeInfo(v.type)}e.size=this._roundUp(f,u+s),e.align=f}_getTypeSize(e){var i,n;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),u=this._getAttributeNum(e.attributes,"align",0);if(e instanceof kS&&(e=e.type),e instanceof Ms){const f=this._getAlias(e.name);f!==null&&(e=f)}{const f=Fo._typeInfo[e.name];if(f!==void 0){const m=((i=e.format)===null||i===void 0?void 0:i.name)==="f16"?2:1;return new Pg(Math.max(u,f.align/m),Math.max(s,f.size/m))}}{const f=Fo._typeInfo[e.name.substring(0,e.name.length-1)];if(f){const m=e.name[e.name.length-1]==="h"?2:1;return new Pg(Math.max(u,f.align/m),Math.max(s,f.size/m))}}if(e instanceof bl){let f=e,m=8,o=8;const v=this._getTypeSize(f.format);return v!==null&&(o=v.size,m=v.align),o=f.count*this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(m,o)),s&&(o=s),new Pg(Math.max(u,m),Math.max(s,o))}if(e instanceof _l){let f=0,m=0,o=0,v=0,w=0;for(const S of e.members){const R=this._getTypeSize(S.type);R!==null&&(f=Math.max(R.align,f),o=this._roundUp(R.align,o+v),v=R.size,w=o)}return m=this._roundUp(f,w+v),new Pg(Math.max(u,f),Math.max(s,m))}return null}_isUniformVar(e){return e instanceof wa&&e.storage=="uniform"}_isStorageVar(e){return e instanceof wa&&e.storage=="storage"}_isTextureVar(e){return e instanceof wa&&e.type!==null&&Fo._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof wa&&e.type!==null&&Fo._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,i){const n=e;if(!n||!n.attributes)return null;const s=n.attributes;for(let u of s)if(u.name==i)return u;return null}_getAttributeNum(e,i,n){if(e===null)return n;for(let s of e)if(s.name==i){let u=s!==null&&s.value!==null?s.value:n;return u instanceof Array&&(u=u[0]),typeof u=="number"?u:typeof u=="string"?parseInt(u):n}return n}_roundUp(e,i){return Math.ceil(i/e)*e}}Fo._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Fo._textureTypes=ie.any_texture_type.map(t=>t.name),Fo._samplerTypes=ie.sampler_type.map(t=>t.name);class O1{constructor(e,i,n){this.name=e,this.value=i,this.node=n}clone(){return new O1(this.name,this.value,this.node)}}class L1{constructor(e){this.name=e.name,this.node=e}clone(){return new L1(this.node)}}class B1{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var i;return this.variables.has(e)?(i=this.variables.get(e))!==null&&i!==void 0?i:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var i;return this.functions.has(e)?(i=this.functions.get(e))!==null&&i!==void 0?i:null:this.parent?this.parent.getFunction(e):null}createVariable(e,i,n){this.variables.set(e,new O1(e,i,n??null))}setVariable(e,i,n){const s=this.getVariable(e);s!==null?s.value=i:this.createVariable(e,i,n)}getVariableValue(e){var i;const n=this.getVariable(e);return(i=n==null?void 0:n.value)!==null&&i!==void 0?i:null}clone(){return new B1(this)}}class G8{evalExpression(e,i){return null}getTypeInfo(e){return null}getVariableName(e,i){return""}}class Z8{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,i){const n=this.exec.evalExpression(e.args[0],i);let s=!0;if(n instanceof he)return n.data.forEach(u=>{u||(s=!1)}),new Me(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he){const s=n.data.some(u=>u);return new Me(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,i){const n=this.exec.evalExpression(e.args[2],i);if(!(n instanceof Me))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],i):this.exec.evalExpression(e.args[0],i)}ArrayLength(e,i){let n=e.args[0];n instanceof jn&&(n=n.right);const s=this.exec.evalExpression(n,i);if(s instanceof Dn&&s.typeInfo.size===0){const u=s.typeInfo,f=s.buffer.byteLength/u.stride;return new Me(f,this.getTypeInfo("u32"))}return new Me(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.abs(u)),n.typeInfo);const s=n;return new Me(Math.abs(s.value),s.typeInfo)}Acos(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.acos(u)),n.typeInfo);const s=n;return new Me(Math.acos(s.value),n.typeInfo)}Acosh(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.acosh(u)),n.typeInfo);const s=n;return new Me(Math.acosh(s.value),n.typeInfo)}Asin(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.asin(u)),n.typeInfo);const s=n;return new Me(Math.asin(s.value),n.typeInfo)}Asinh(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.asinh(u)),n.typeInfo);const s=n;return new Me(Math.asinh(s.value),n.typeInfo)}Atan(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.atan(u)),n.typeInfo);const s=n;return new Me(Math.atan(s.value),n.typeInfo)}Atanh(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.atanh(u)),n.typeInfo);const s=n;return new Me(Math.atanh(s.value),n.typeInfo)}Atan2(e,i){const n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i);if(n instanceof he&&s instanceof he)return new he(n.data.map((m,o)=>Math.atan2(m,s.data[o])),n.typeInfo);const u=n,f=s;return new Me(Math.atan2(u.value,f.value),n.typeInfo)}Ceil(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.ceil(u)),n.typeInfo);const s=n;return new Me(Math.ceil(s.value),n.typeInfo)}_clamp(e,i,n){return Math.min(Math.max(e,i),n)}Clamp(e,i){const n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i),u=this.exec.evalExpression(e.args[2],i);if(n instanceof he&&s instanceof he&&u instanceof he)return new he(n.data.map((v,w)=>this._clamp(v,s.data[w],u.data[w])),n.typeInfo);const f=n,m=s,o=u;return new Me(this._clamp(f.value,m.value,o.value),n.typeInfo)}Cos(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.cos(u)),n.typeInfo);const s=n;return new Me(Math.cos(s.value),n.typeInfo)}Cosh(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.cosh(u)),n.typeInfo);const s=n;return new Me(Math.cos(s.value),n.typeInfo)}CountLeadingZeros(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.clz32(u)),n.typeInfo);const s=n;return new Me(Math.clz32(s.value),n.typeInfo)}_countOneBits(e){let i=0;for(;e!==0;)1&e&&i++,e>>=1;return i}CountOneBits(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>this._countOneBits(u)),n.typeInfo);const s=n;return new Me(this._countOneBits(s.value),n.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let i=0;for(;!(1&e);)e>>=1,i++;return i}CountTrailingZeros(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>this._countTrailingZeros(u)),n.typeInfo);const s=n;return new Me(this._countTrailingZeros(s.value),n.typeInfo)}Cross(e,i){const n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i);if(n instanceof he&&s instanceof he){if(n.data.length!==3||s.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const u=n.data,f=s.data;return new he([u[1]*f[2]-f[1]*u[2],u[2]*f[0]-f[2]*u[0],u[0]*f[1]-f[0]*u[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,i){const n=this.exec.evalExpression(e.args[0],i),s=180/Math.PI;return n instanceof he?new he(n.data.map(u=>u*s),n.typeInfo):new Me(n.value*s,this.getTypeInfo("f32"))}Determinant(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof ri){const s=n.data,u=n.typeInfo.getTypeName(),f=u.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(u==="mat2x2"||u==="mat2x2f"||u==="mat2x2h")return new Me(s[0]*s[3]-s[1]*s[2],f);if(u==="mat2x3"||u==="mat2x3f"||u==="mat2x3h")return new Me(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),f);if(u==="mat2x4"||u==="mat2x4f"||u==="mat2x4h")console.error(`TODO: Determinant for ${u}`);else if(u==="mat3x2"||u==="mat3x2f"||u==="mat3x2h")console.error(`TODO: Determinant for ${u}`);else{if(u==="mat3x3"||u==="mat3x3f"||u==="mat3x3h")return new Me(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),f);u==="mat3x4"||u==="mat3x4f"||u==="mat3x4h"||u==="mat4x2"||u==="mat4x2f"||u==="mat4x2h"||u==="mat4x3"||u==="mat4x3f"||u==="mat4x3h"?console.error(`TODO: Determinant for ${u}`):u!=="mat4x4"&&u!=="mat4x4f"&&u!=="mat4x4h"||console.error(`TODO: Determinant for ${u}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,i){const n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i);if(n instanceof he&&s instanceof he){let m=0;for(let o=0;o<n.data.length;++o)m+=(n.data[o]-s.data[o])*(n.data[o]-s.data[o]);return new Me(Math.sqrt(m),this.getTypeInfo("f32"))}const u=n,f=s;return new Me(Math.abs(u.value-f.value),n.typeInfo)}_dot(e,i){let n=0;for(let s=0;s<e.length;++s)n+=i[s]*e[s];return n}Dot(e,i){const n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i);return n instanceof he&&s instanceof he?new Me(this._dot(n.data,s.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,i){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,i){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.exp(u)),n.typeInfo);const s=n;return new Me(Math.exp(s.value),n.typeInfo)}Exp2(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.pow(2,u)),n.typeInfo);const s=n;return new Me(Math.pow(2,s.value),n.typeInfo)}ExtractBits(e,i){const n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i),u=this.exec.evalExpression(e.args[2],i);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(u.typeInfo.name!=="u32"&&u.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const f=s.value,m=u.value;if(n instanceof he)return new he(n.data.map(v=>v>>f&(1<<m)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const o=n.value;return new Me(o>>f&(1<<m)-1,this.getTypeInfo("i32"))}FaceForward(e,i){const n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i),u=this.exec.evalExpression(e.args[2],i);if(n instanceof he&&s instanceof he&&u instanceof he){const f=this._dot(s.data,u.data);return new he(f<0?Array.from(n.data):n.data.map(m=>-m),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>this._firstLeadingBit(u)),n.typeInfo);const s=n;return new Me(this._firstLeadingBit(s.value),n.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>this._firstTrailingBit(u)),n.typeInfo);const s=n;return new Me(this._firstTrailingBit(s.value),n.typeInfo)}Floor(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.floor(u)),n.typeInfo);const s=n;return new Me(Math.floor(s.value),n.typeInfo)}Fma(e,i){const n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i),u=this.exec.evalExpression(e.args[2],i);if(n instanceof he&&s instanceof he&&u instanceof he)return n.data.length!==s.data.length||n.data.length!==u.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new he(n.data.map((v,w)=>v*s.data[w]+u.data[w]),n.typeInfo);const f=n,m=s,o=u;return new Me(f.value*m.value+o.value,f.typeInfo)}Fract(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>u-Math.floor(u)),n.typeInfo);const s=n;return new Me(s.value-Math.floor(s.value),n.typeInfo)}Frexp(e,i){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,i){const n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i),u=this.exec.evalExpression(e.args[2],i),f=this.exec.evalExpression(e.args[3],i);if(u.typeInfo.name!=="u32"&&u.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const m=u.value,o=(1<<f.value)-1<<m,v=~o;if(n instanceof he&&s instanceof he)return new he(n.data.map((R,L)=>R&v|s.data[L]<<m&o),n.typeInfo);const w=n.value,S=s.value;return new Me(w&v|S<<m&o,n.typeInfo)}InverseSqrt(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>1/Math.sqrt(u)),n.typeInfo);const s=n;return new Me(1/Math.sqrt(s.value),n.typeInfo)}Ldexp(e,i){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he){let u=0;return n.data.forEach(f=>{u+=f*f}),new Me(Math.sqrt(u),this.getTypeInfo("f32"))}const s=n;return new Me(Math.abs(s.value),n.typeInfo)}Log(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.log(u)),n.typeInfo);const s=n;return new Me(Math.log(s.value),n.typeInfo)}Log2(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.log2(u)),n.typeInfo);const s=n;return new Me(Math.log2(s.value),n.typeInfo)}Max(e,i){const n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i);if(n instanceof he&&s instanceof he)return new he(n.data.map((m,o)=>Math.max(m,s.data[o])),n.typeInfo);const u=n,f=s;return new Me(Math.max(u.value,f.value),n.typeInfo)}Min(e,i){const n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i);if(n instanceof he&&s instanceof he)return new he(n.data.map((m,o)=>Math.min(m,s.data[o])),n.typeInfo);const u=n,f=s;return new Me(Math.min(u.value,f.value),n.typeInfo)}Mix(e,i){const n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i),u=this.exec.evalExpression(e.args[2],i);if(n instanceof he&&s instanceof he&&u instanceof he)return new he(n.data.map((o,v)=>n.data[v]*(1-u.data[v])+s.data[v]*u.data[v]),n.typeInfo);const f=s,m=u;return new Me(n.value*(1-m.value)+f.value*m.value,n.typeInfo)}Modf(e,i){const n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i);if(n instanceof he&&s instanceof he)return new he(n.data.map((f,m)=>f%s.data[m]),n.typeInfo);const u=s;return new Me(n.value%u.value,n.typeInfo)}Normalize(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he){const s=this.Length(e,i).value;return new he(n.data.map(u=>u/s),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,i){const n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i);if(n instanceof he&&s instanceof he)return new he(n.data.map((m,o)=>Math.pow(m,s.data[o])),n.typeInfo);const u=n,f=s;return new Me(Math.pow(u.value,f.value),n.typeInfo)}QuantizeToF16(e,i){const n=this.exec.evalExpression(e.args[0],i);return n instanceof he?new he(n.data.map(s=>s),n.typeInfo):new Me(n.value,n.typeInfo)}Radians(e,i){const n=this.exec.evalExpression(e.args[0],i);return n instanceof he?new he(n.data.map(s=>s*Math.PI/180),n.typeInfo):new Me(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,i){let n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i);if(n instanceof he&&s instanceof he){const u=this._dot(n.data,s.data);return new he(n.data.map((f,m)=>f-2*u*s.data[m]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,i){let n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i),u=this.exec.evalExpression(e.args[2],i);if(n instanceof he&&s instanceof he&&u instanceof Me){const f=this._dot(s.data,n.data);return new he(n.data.map((m,o)=>{const v=1-u.value*u.value*(1-f*f);if(v<0)return 0;const w=Math.sqrt(v);return u.value*m-(u.value*f+w)*s.data[o]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,i){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.round(u)),n.typeInfo);const s=n;return new Me(Math.round(s.value),n.typeInfo)}Saturate(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.min(Math.max(u,0),1)),n.typeInfo);const s=n;return new Me(Math.min(Math.max(s.value,0),1),n.typeInfo)}Sign(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.sign(u)),n.typeInfo);const s=n;return new Me(Math.sign(s.value),n.typeInfo)}Sin(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.sin(u)),n.typeInfo);const s=n;return new Me(Math.sin(s.value),n.typeInfo)}Sinh(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.sinh(u)),n.typeInfo);const s=n;return new Me(Math.sinh(s.value),n.typeInfo)}_smoothstep(e,i,n){const s=Math.min(Math.max((n-e)/(i-e),0),1);return s*s*(3-2*s)}SmoothStep(e,i){const n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i),u=this.exec.evalExpression(e.args[2],i);if(u instanceof he&&n instanceof he&&s instanceof he)return new he(u.data.map((v,w)=>this._smoothstep(n.data[w],s.data[w],v)),u.typeInfo);const f=n,m=s,o=u;return new Me(this._smoothstep(f.value,m.value,o.value),u.typeInfo)}Sqrt(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.sqrt(u)),n.typeInfo);const s=n;return new Me(Math.sqrt(s.value),n.typeInfo)}Step(e,i){const n=this.exec.evalExpression(e.args[0],i),s=this.exec.evalExpression(e.args[1],i);if(s instanceof he&&n instanceof he)return new he(s.data.map((f,m)=>f<n.data[m]?0:1),s.typeInfo);const u=n;return new Me(s.value<u.value?0:1,u.typeInfo)}Tan(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.tan(u)),n.typeInfo);const s=n;return new Me(Math.tan(s.value),n.typeInfo)}Tanh(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.tanh(u)),n.typeInfo);const s=n;return new Me(Math.tanh(s.value),n.typeInfo)}_getTransposeType(e){const i=e.getTypeName();return i==="mat2x2f"||i==="mat2x2h"?e:i==="mat2x3f"?this.getTypeInfo("mat3x2f"):i==="mat2x3h"?this.getTypeInfo("mat3x2h"):i==="mat2x4f"?this.getTypeInfo("mat4x2f"):i==="mat2x4h"?this.getTypeInfo("mat4x2h"):i==="mat3x2f"?this.getTypeInfo("mat2x3f"):i==="mat3x2h"?this.getTypeInfo("mat2x3h"):i==="mat3x3f"||i==="mat3x3h"?e:i==="mat3x4f"?this.getTypeInfo("mat4x3f"):i==="mat3x4h"?this.getTypeInfo("mat4x3h"):i==="mat4x2f"?this.getTypeInfo("mat2x4f"):i==="mat4x2h"?this.getTypeInfo("mat2x4h"):i==="mat4x3f"?this.getTypeInfo("mat3x4f"):i==="mat4x3h"?this.getTypeInfo("mat3x4h"):(i==="mat4x4f"||i==="mat4x4h"||console.error(`Invalid matrix type ${i}`),e)}Transpose(e,i){const n=this.exec.evalExpression(e.args[0],i);if(!(n instanceof ri))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const s=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const u=n.data;return new ri([u[0],u[2],u[1],u[3]],s)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const u=n.data;return new ri([u[0],u[3],u[6],u[1],u[4],u[7]],s)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const u=n.data;return new ri([u[0],u[4],u[8],u[12],u[1],u[5],u[9],u[13]],s)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const u=n.data;return new ri([u[0],u[3],u[1],u[4],u[2],u[5]],s)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const u=n.data;return new ri([u[0],u[3],u[6],u[1],u[4],u[7],u[2],u[5],u[8]],s)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const u=n.data;return new ri([u[0],u[4],u[8],u[12],u[1],u[5],u[9],u[13],u[2],u[6],u[10],u[14]],s)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const u=n.data;return new ri([u[0],u[4],u[1],u[5],u[2],u[6]],s)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const u=n.data;return new ri([u[0],u[4],u[8],u[1],u[5],u[9],u[2],u[6],u[10]],s)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const u=n.data;return new ri([u[0],u[4],u[8],u[12],u[1],u[5],u[9],u[13],u[2],u[6],u[10],u[14],u[3],u[7],u[11],u[15]],s)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,i){const n=this.exec.evalExpression(e.args[0],i);if(n instanceof he)return new he(n.data.map(u=>Math.trunc(u)),n.typeInfo);const s=n;return new Me(Math.trunc(s.value),n.typeInfo)}Dpdx(e,i){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,i){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,i){return console.error("TODO: dpdxFine"),null}Dpdy(e,i){return console.error("TODO: dpdy"),null}DpdyCoarse(e,i){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,i){return console.error("TODO: dpdyFine"),null}Fwidth(e,i){return console.error("TODO: fwidth"),null}FwidthCoarse(e,i){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,i){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,i){const n=e.args[0],s=e.args.length>1?this.exec.evalExpression(e.args[1],i).value:0;if(n instanceof ps){const u=n.name,f=i.getVariableValue(u);if(f instanceof xa){if(s<0||s>=f.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const m=f.getMipLevelSize(s),o=f.dimension;return o==="1d"?new Me(m[0],this.getTypeInfo("u32")):o==="3d"?new he(m,this.getTypeInfo("vec3u")):o==="2d"?new he(m.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${o} not found. Line ${e.line}`),null)}return console.error(`Texture ${u} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,i){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,i){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,i){const n=e.args[0],s=this.exec.evalExpression(e.args[1],i),u=e.args.length>2?this.exec.evalExpression(e.args[2],i).value:0;if(!(s instanceof he)||s.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof ps){const f=n.name,m=i.getVariableValue(f);if(m instanceof xa){const o=Math.floor(s.data[0]),v=Math.floor(s.data[1]);if(o<0||o>=m.width||v<0||v>=m.height)return console.error(`Texture ${f} out of bounds. Line ${e.line}`),null;const w=m.getPixel(o,v,0,u);return w===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new he(w,this.getTypeInfo("vec4f"))}return console.error(`Texture ${f} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,i){const n=e.args[0];if(n instanceof ps){const s=n.name,u=i.getVariableValue(s);return u instanceof xa?new Me(u.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,i){const n=e.args[0];if(n instanceof ps){const s=n.name,u=i.getVariableValue(s);return u instanceof xa?new Me(u.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,i){const n=e.args[0];if(n instanceof ps){const s=n.name,u=i.getVariableValue(s);return u instanceof xa?new Me(u.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,i){return console.error("TODO: textureSample"),null}TextureSampleBias(e,i){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,i){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,i){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,i){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,i){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,i){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,i){const n=e.args[0],s=this.exec.evalExpression(e.args[1],i),u=e.args.length===4?this.exec.evalExpression(e.args[2],i).value:0,f=e.args.length===4?this.exec.evalExpression(e.args[3],i).data:this.exec.evalExpression(e.args[2],i).data;if(f.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(s instanceof he)||s.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof ps){const m=n.name,o=i.getVariableValue(m);if(o instanceof xa){const v=o.getMipLevelSize(0),w=Math.floor(s.data[0]),S=Math.floor(s.data[1]);return w<0||w>=v[0]||S<0||S>=v[1]?(console.error(`Texture ${m} out of bounds. Line ${e.line}`),null):(o.setPixel(w,S,0,u,Array.from(f)),null)}return console.error(`Texture ${m} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,i){let n=e.args[0];n instanceof jn&&(n=n.right);const s=this.exec.getVariableName(n,i);return i.getVariable(s).value.getSubData(this.exec,n.postfix,i)}AtomicStore(e,i){let n=e.args[0];n instanceof jn&&(n=n.right);const s=this.exec.getVariableName(n,i),u=i.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,i),o=u.value.getSubData(this.exec,n.postfix,i);return o instanceof Me&&m instanceof Me&&(o.value=m.value),u.value instanceof Dn&&u.value.setDataValue(this.exec,o,n.postfix,i),null}AtomicAdd(e,i){let n=e.args[0];n instanceof jn&&(n=n.right);const s=this.exec.getVariableName(n,i),u=i.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,i),o=u.value.getSubData(this.exec,n.postfix,i),v=new Me(o.value,o.typeInfo);return o instanceof Me&&m instanceof Me&&(o.value+=m.value),u.value instanceof Dn&&u.value.setDataValue(this.exec,o,n.postfix,i),v}AtomicSub(e,i){let n=e.args[0];n instanceof jn&&(n=n.right);const s=this.exec.getVariableName(n,i),u=i.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,i),o=u.value.getSubData(this.exec,n.postfix,i),v=new Me(o.value,o.typeInfo);return o instanceof Me&&m instanceof Me&&(o.value-=m.value),u.value instanceof Dn&&u.value.setDataValue(this.exec,o,n.postfix,i),v}AtomicMax(e,i){let n=e.args[0];n instanceof jn&&(n=n.right);const s=this.exec.getVariableName(n,i),u=i.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,i),o=u.value.getSubData(this.exec,n.postfix,i),v=new Me(o.value,o.typeInfo);return o instanceof Me&&m instanceof Me&&(o.value=Math.max(o.value,m.value)),u.value instanceof Dn&&u.value.setDataValue(this.exec,o,n.postfix,i),v}AtomicMin(e,i){let n=e.args[0];n instanceof jn&&(n=n.right);const s=this.exec.getVariableName(n,i),u=i.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,i),o=u.value.getSubData(this.exec,n.postfix,i),v=new Me(o.value,o.typeInfo);return o instanceof Me&&m instanceof Me&&(o.value=Math.min(o.value,m.value)),u.value instanceof Dn&&u.value.setDataValue(this.exec,o,n.postfix,i),v}AtomicAnd(e,i){let n=e.args[0];n instanceof jn&&(n=n.right);const s=this.exec.getVariableName(n,i),u=i.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,i),o=u.value.getSubData(this.exec,n.postfix,i),v=new Me(o.value,o.typeInfo);return o instanceof Me&&m instanceof Me&&(o.value=o.value&m.value),u.value instanceof Dn&&u.value.setDataValue(this.exec,o,n.postfix,i),v}AtomicOr(e,i){let n=e.args[0];n instanceof jn&&(n=n.right);const s=this.exec.getVariableName(n,i),u=i.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,i),o=u.value.getSubData(this.exec,n.postfix,i),v=new Me(o.value,o.typeInfo);return o instanceof Me&&m instanceof Me&&(o.value=o.value|m.value),u.value instanceof Dn&&u.value.setDataValue(this.exec,o,n.postfix,i),v}AtomicXor(e,i){let n=e.args[0];n instanceof jn&&(n=n.right);const s=this.exec.getVariableName(n,i),u=i.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,i),o=u.value.getSubData(this.exec,n.postfix,i),v=new Me(o.value,o.typeInfo);return o instanceof Me&&m instanceof Me&&(o.value=o.value^m.value),u.value instanceof Dn&&u.value.setDataValue(this.exec,o,n.postfix,i),v}AtomicExchange(e,i){let n=e.args[0];n instanceof jn&&(n=n.right);const s=this.exec.getVariableName(n,i),u=i.getVariable(s);let f=e.args[1];const m=this.exec.evalExpression(f,i),o=u.value.getSubData(this.exec,n.postfix,i),v=new Me(o.value,o.typeInfo);return o instanceof Me&&m instanceof Me&&(o.value=m.value),u.value instanceof Dn&&u.value.setDataValue(this.exec,o,n.postfix,i),v}AtomicCompareExchangeWeak(e,i){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,i){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,i){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,i){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,i){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,i){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,i){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,i){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,i){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,i){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,i){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,i){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,i){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,i){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,i){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,i){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,i){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,i){return null}TextureBarrier(e,i){return null}WorkgroupBarrier(e,i){return null}WorkgroupUniformLoad(e,i){return null}SubgroupAdd(e,i){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,i){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,i){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,i){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,i){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,i){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,i){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,i){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,i){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,i){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,i){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,i){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,i){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,i){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,i){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,i){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,i){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,i){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,i){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,i){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,i){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,i){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,i){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,i){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,i){return console.error("TODO: quadSwapY"),null}}const zx={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Fr={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Cr extends G8{constructor(e,i){var n;super(),this.ast=e??[],this.reflection=new Fo,this.reflection.updateAST(this.ast),this.context=(n=i==null?void 0:i.clone())!==null&&n!==void 0?n:new B1,this.builtins=new Z8(this),this.typeInfo={bool:this.getTypeInfo(ut.bool),i32:this.getTypeInfo(ut.i32),u32:this.getTypeInfo(ut.u32),f32:this.getTypeInfo(ut.f32),f16:this.getTypeInfo(ut.f16),vec2f:this.getTypeInfo(Be.vec2f),vec2u:this.getTypeInfo(Be.vec2u),vec2i:this.getTypeInfo(Be.vec2i),vec2h:this.getTypeInfo(Be.vec2h),vec3f:this.getTypeInfo(Be.vec3f),vec3u:this.getTypeInfo(Be.vec3u),vec3i:this.getTypeInfo(Be.vec3i),vec3h:this.getTypeInfo(Be.vec3h),vec4f:this.getTypeInfo(Be.vec4f),vec4u:this.getTypeInfo(Be.vec4u),vec4i:this.getTypeInfo(Be.vec4i),vec4h:this.getTypeInfo(Be.vec4h),mat2x2f:this.getTypeInfo(Be.mat2x2f),mat2x3f:this.getTypeInfo(Be.mat2x3f),mat2x4f:this.getTypeInfo(Be.mat2x4f),mat3x2f:this.getTypeInfo(Be.mat3x2f),mat3x3f:this.getTypeInfo(Be.mat3x3f),mat3x4f:this.getTypeInfo(Be.mat3x4f),mat4x2f:this.getTypeInfo(Be.mat4x2f),mat4x3f:this.getTypeInfo(Be.mat4x3f),mat4x4f:this.getTypeInfo(Be.mat4x4f)}}getVariableValue(e){var i,n;const s=(n=(i=this.context.getVariable(e))===null||i===void 0?void 0:i.value)!==null&&n!==void 0?n:null;if(s===null)return null;if(s instanceof Me)return s.value;if(s instanceof he||s instanceof ri)return Array.from(s.data);if(s instanceof Dn&&s.typeInfo instanceof bl){if(s.typeInfo.format.name==="u32")return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="i32")return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="f32")return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return console.error(`Unsupported return variable type ${s.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,i,n,s){const u=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,u),this._execStatements(this.ast,u);const f=u.getFunction(e);if(!f)return void console.error(`Function ${e} not found`);if(typeof i=="number")i=[i,1,1];else{if(i.length===0)return void console.error("Invalid dispatch count");i.length===1?i=[i[0],1,1]:i.length===2?i=[i[0],i[1],1]:i.length>3&&(i=[i[0],i[1],i[2]])}const m=i[0],o=i[1],v=i[2],w=this.getTypeInfo("vec3u");u.setVariable("@num_workgroups",new he(i,w));for(const S in n)for(const R in n[S]){const L=n[S][R];u.variables.forEach(j=>{var Z;const re=j.node;if(re!=null&&re.attributes){let xe=null,be=null;for(const ue of re.attributes)ue.name==="binding"?xe=ue.value:ue.name==="group"&&(be=ue.value);if(R==xe&&S==be)if(L.texture!==void 0&&L.descriptor!==void 0){const ue=new xa(L.texture,this.getTypeInfo(re.type),L.descriptor,(Z=L.texture.view)!==null&&Z!==void 0?Z:null);j.value=ue}else L.uniform!==void 0?j.value=new Dn(L.uniform,this.getTypeInfo(re.type)):j.value=new Dn(L,this.getTypeInfo(re.type))}})}for(let S=0;S<v;++S)for(let R=0;R<o;++R)for(let L=0;L<m;++L)u.setVariable("@workgroup_id",new he([L,R,S],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(f,[L,R,S],u)}execStatement(e,i){if(e instanceof yR)return this.evalExpression(e.value,i);if(e instanceof vR){if(e.condition){const n=this.evalExpression(e.condition,i);if(!(n instanceof Me))throw new Error("Invalid break-if condition");if(!n.value)return null}return Cr._breakObj}if(e instanceof bR)return Cr._continueObj;if(e instanceof qd)this._let(e,i);else if(e instanceof wa)this._var(e,i);else if(e instanceof Jg)this._const(e,i);else if(e instanceof dp)this._function(e,i);else{if(e instanceof _R)return this._if(e,i);if(e instanceof gR)return this._switch(e,i);if(e instanceof fR)return this._for(e,i);if(e instanceof hR)return this._while(e,i);if(e instanceof mR)return this._loop(e,i);if(e instanceof cb){const n=i.clone();return n.currentFunctionName=i.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof pR)this._assign(e,i);else if(e instanceof dR)this._increment(e,i);else{if(e instanceof ya)return null;if(e instanceof R1){const n=e.name;i.getVariable(n)===null&&i.setVariable(n,new Me(0,this.getTypeInfo("u32")))}else if(e instanceof P1)this._call(e,i);else{if(e instanceof xR||e instanceof k1)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,i){return e instanceof Ys?this._evalBinaryOp(e,i):e instanceof Qn?this._evalLiteral(e,i):e instanceof ps?this._evalVariable(e,i):e instanceof D1?this._evalCall(e,i):e instanceof Ro?this._evalCreate(e,i):e instanceof wR?this._evalConst(e,i):e instanceof TR?this._evalBitcast(e,i):e instanceof jn?this._evalUnaryOp(e,i):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var i;if(e instanceof ut){const s=this.reflection.getTypeInfo(e);if(s!==null)return s}let n=(i=this.typeInfo[e])!==null&&i!==void 0?i:null;return n!==null||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,i){for(const n in e){const s=e[n],u=this.reflection.getOverrideInfo(n);u!==null?(u.type===null&&(u.type=this.getTypeInfo("u32")),u.type.name==="u32"||u.type.name==="i32"||u.type.name==="f32"||u.type.name==="f16"?i.setVariable(n,new Me(s,u.type)):u.type.name==="bool"?i.setVariable(n,new Me(s?1:0,u.type)):u.type.name==="vec2"||u.type.name==="vec3"||u.type.name==="vec4"||u.type.name==="vec2f"||u.type.name==="vec3f"||u.type.name==="vec4f"||u.type.name==="vec2i"||u.type.name==="vec3i"||u.type.name==="vec4i"||u.type.name==="vec2u"||u.type.name==="vec3u"||u.type.name==="vec4u"||u.type.name==="vec2h"||u.type.name==="vec3h"||u.type.name==="vec4h"?i.setVariable(n,new he(s,u.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,i,n){const s=[1,1,1];for(const w of e.node.attributes)if(w.name==="workgroup_size"){if(w.value.length>0){const S=n.getVariableValue(w.value[0]);s[0]=S instanceof Me?S.value:parseInt(w.value[0])}if(w.value.length>1){const S=n.getVariableValue(w.value[1]);s[1]=S instanceof Me?S.value:parseInt(w.value[1])}if(w.value.length>2){const S=n.getVariableValue(w.value[2]);s[2]=S instanceof Me?S.value:parseInt(w.value[2])}}const u=this.getTypeInfo("vec3u"),f=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new he(s,u));const m=s[0],o=s[1],v=s[2];for(let w=0,S=0;w<v;++w)for(let R=0;R<o;++R)for(let L=0;L<m;++L,++S){const j=[L,R,w],Z=[L+i[0]*s[0],R+i[1]*s[1],w+i[2]*s[2]];n.setVariable("@local_invocation_id",new he(j,u)),n.setVariable("@global_invocation_id",new he(Z,u)),n.setVariable("@local_invocation_index",new Me(S,f)),this._dispatchExec(e,n)}}_dispatchExec(e,i){for(const n of e.node.args)for(const s of n.attributes)if(s.name==="builtin"){const u=`@${s.value}`,f=i.getVariable(u);f!==void 0&&i.variables.set(n.name,f)}this._execStatements(e.node.body,i)}getVariableName(e,i){for(;e instanceof jn;)e=e.right;return e instanceof ps?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,i){for(const n of e){if(n instanceof Array){const u=i.clone(),f=this._execStatements(n,u);if(f)return f;continue}const s=this.execStatement(n,i);if(s)return s}return null}_call(e,i){const n=i.clone();n.currentFunctionName=e.name;const s=i.getFunction(e.name);if(s){for(let u=0;u<s.node.args.length;++u){const f=s.node.args[u],m=this.evalExpression(e.args[u],n);n.setVariable(f.name,m,f)}this._execStatements(s.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,i)}_increment(e,i){const n=this.getVariableName(e.variable,i),s=i.getVariable(n);s?e.operator==="++"?s.value instanceof Me?s.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):e.operator==="--"?s.value instanceof Me?s.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_getVariableData(e,i){if(e instanceof ps){const n=this.getVariableName(e,i),s=i.getVariable(n);return s===null?(console.error(`Variable ${n} not found. Line ${e.line}`),null):s.value.getSubData(this,e.postfix,i)}if(e instanceof jn){if(e.operator==="*"){const n=this._getVariableData(e.right,i);return n instanceof ah?n.reference.getSubData(this,e.postfix,i):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const n=this._getVariableData(e.right,i);return new ah(n)}}return null}_assign(e,i){let n=null,s="<var>",u=null;if(e.variable instanceof jn){const o=this._getVariableData(e.variable,i),v=this.evalExpression(e.value,i),w=e.operator;if(w==="="){if(o instanceof Me||o instanceof he||o instanceof ri){if(v instanceof Me||v instanceof he||v instanceof ri&&o.data.length===v.data.length)return void o.data.set(v.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(o instanceof Dn&&v instanceof Dn&&o.buffer.byteLength-o.offset>=v.buffer.byteLength-v.offset)return void(o.buffer.byteLength%4==0?new Uint32Array(o.buffer,o.offset,o.typeInfo.size/4).set(new Uint32Array(v.buffer,v.offset,v.typeInfo.size/4)):new Uint8Array(o.buffer,o.offset,o.typeInfo.size).set(new Uint8Array(v.buffer,v.offset,v.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(w==="+=")return o instanceof Me||o instanceof he||o instanceof ri?v instanceof Me||v instanceof he||v instanceof ri?void o.data.set(v.data.map((S,R)=>o.data[R]+S)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(w==="-=")return(o instanceof Me||o instanceof he||o instanceof ri)&&(v instanceof Me||v instanceof he||v instanceof ri)?void o.data.set(v.data.map((S,R)=>o.data[R]-S)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof jn){if(e.variable.operator==="*"){s=this.getVariableName(e.variable.right,i);const o=i.getVariable(s);if(!(o&&o.value instanceof ah))return void console.error(`Variable ${s} is not a pointer. Line ${e.line}`);n=o.value.reference;let v=e.variable.postfix;if(!v){let w=e.variable.right;for(;w instanceof jn;){if(w.postfix){v=w.postfix;break}w=w.right}}v&&(n=n.getSubData(this,v,i))}}else{u=e.variable.postfix,s=this.getVariableName(e.variable,i);const o=i.getVariable(s);if(o===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);n=o.value}if(n instanceof ah&&(n=n.reference),n===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);const f=this.evalExpression(e.value,i),m=e.operator;if(m==="=")if(n instanceof Dn)n.setDataValue(this,f,u,i);else if(u){if(!(n instanceof he||n instanceof ri))return void console.error(`Variable ${s} is not a vector or matrix. Line ${e.line}`);if(u instanceof Fh){const o=this.evalExpression(u.index,i).value;if(n instanceof he){if(!(f instanceof Me))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[o]=f.value}else{if(!(n instanceof ri))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const v=this.evalExpression(u.index,i).value;if(v<0)return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(f instanceof he))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const w=n.typeInfo.getTypeName();if(w==="mat2x2"||w==="mat2x2f"||w==="mat2x2h"){if(!(v<2&&f.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[2*v]=f.data[0],n.data[2*v+1]=f.data[1]}else if(w==="mat2x3"||w==="mat2x3f"||w==="mat2x3h"){if(!(v<2&&f.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[3*v]=f.data[0],n.data[3*v+1]=f.data[1],n.data[3*v+2]=f.data[2]}else if(w==="mat2x4"||w==="mat2x4f"||w==="mat2x4h"){if(!(v<2&&f.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[4*v]=f.data[0],n.data[4*v+1]=f.data[1],n.data[4*v+2]=f.data[2],n.data[4*v+3]=f.data[3]}else if(w==="mat3x2"||w==="mat3x2f"||w==="mat3x2h"){if(!(v<3&&f.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[2*v]=f.data[0],n.data[2*v+1]=f.data[1]}else if(w==="mat3x3"||w==="mat3x3f"||w==="mat3x3h"){if(!(v<3&&f.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[3*v]=f.data[0],n.data[3*v+1]=f.data[1],n.data[3*v+2]=f.data[2]}else if(w==="mat3x4"||w==="mat3x4f"||w==="mat3x4h"){if(!(v<3&&f.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[4*v]=f.data[0],n.data[4*v+1]=f.data[1],n.data[4*v+2]=f.data[2],n.data[4*v+3]=f.data[3]}else if(w==="mat4x2"||w==="mat4x2f"||w==="mat4x2h"){if(!(v<4&&f.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[2*v]=f.data[0],n.data[2*v+1]=f.data[1]}else if(w==="mat4x3"||w==="mat4x3f"||w==="mat4x3h"){if(!(v<4&&f.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[3*v]=f.data[0],n.data[3*v+1]=f.data[1],n.data[3*v+2]=f.data[2]}else{if(w!=="mat4x4"&&w!=="mat4x4f"&&w!=="mat4x4h")return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(v<4&&f.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[4*v]=f.data[0],n.data[4*v+1]=f.data[1],n.data[4*v+2]=f.data[2],n.data[4*v+3]=f.data[3]}}}}}else if(u instanceof Vc){const o=u.value;if(!(n instanceof he))return void console.error(`Invalid assignment to ${o}. Variable ${s} is not a vector. Line ${e.line}`);if(f instanceof Me){if(o.length>1)return void console.error(`Invalid assignment to ${o} for variable ${s}. Line ${e.line}`);if(o==="x")n.data[0]=f.value;else if(o==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${o} for variable ${s}. Line ${e.line}`);n.data[1]=f.value}else if(o==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${o} for variable ${s}. Line ${e.line}`);n.data[2]=f.value}else if(o==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${o} for variable ${s}. Line ${e.line}`);n.data[3]=f.value}}else{if(!(f instanceof he))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(o.length!==f.data.length)return void console.error(`Invalid assignment to ${o} for variable ${s}. Line ${e.line}`);for(let v=0;v<o.length;++v){const w=o[v];if(w==="x"||w==="r")n.data[0]=f.data[v];else if(w==="y"||w==="g"){if(f.data.length<2)return void console.error(`Invalid assignment to ${w} for variable ${s}. Line ${e.line}`);n.data[1]=f.data[v]}else if(w==="z"||w==="b"){if(f.data.length<3)return void console.error(`Invalid assignment to ${w} for variable ${s}. Line ${e.line}`);n.data[2]=f.data[v]}else{if(w!=="w"&&w!=="a")return void console.error(`Invalid assignment to ${w} for variable ${s}. Line ${e.line}`);if(f.data.length<4)return void console.error(`Invalid assignment to ${w} for variable ${s}. Line ${e.line}`);n.data[3]=f.data[v]}}}}}else n instanceof Me&&f instanceof Me?n.value=f.value:n instanceof he&&f instanceof he||n instanceof ri&&f instanceof ri?n.data.set(f.data):console.error(`Invalid assignment to ${s}. Line ${e.line}`);else{const o=n.getSubData(this,u,i);if(o instanceof he&&f instanceof Me){const v=o.data,w=f.value;if(m==="+=")for(let S=0;S<v.length;++S)v[S]+=w;else if(m==="-=")for(let S=0;S<v.length;++S)v[S]-=w;else if(m==="*=")for(let S=0;S<v.length;++S)v[S]*=w;else if(m==="/=")for(let S=0;S<v.length;++S)v[S]/=w;else if(m==="%=")for(let S=0;S<v.length;++S)v[S]%=w;else if(m==="&=")for(let S=0;S<v.length;++S)v[S]&=w;else if(m==="|=")for(let S=0;S<v.length;++S)v[S]|=w;else if(m==="^=")for(let S=0;S<v.length;++S)v[S]^=w;else if(m==="<<=")for(let S=0;S<v.length;++S)v[S]<<=w;else if(m===">>=")for(let S=0;S<v.length;++S)v[S]>>=w;else console.error(`Invalid operator ${m}. Line ${e.line}`)}else if(o instanceof he&&f instanceof he){const v=o.data,w=f.data;if(v.length!==w.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(m==="+=")for(let S=0;S<v.length;++S)v[S]+=w[S];else if(m==="-=")for(let S=0;S<v.length;++S)v[S]-=w[S];else if(m==="*=")for(let S=0;S<v.length;++S)v[S]*=w[S];else if(m==="/=")for(let S=0;S<v.length;++S)v[S]/=w[S];else if(m==="%=")for(let S=0;S<v.length;++S)v[S]%=w[S];else if(m==="&=")for(let S=0;S<v.length;++S)v[S]&=w[S];else if(m==="|=")for(let S=0;S<v.length;++S)v[S]|=w[S];else if(m==="^=")for(let S=0;S<v.length;++S)v[S]^=w[S];else if(m==="<<=")for(let S=0;S<v.length;++S)v[S]<<=w[S];else if(m===">>=")for(let S=0;S<v.length;++S)v[S]>>=w[S];else console.error(`Invalid operator ${m}. Line ${e.line}`)}else{if(!(o instanceof Me&&f instanceof Me))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);m==="+="?o.value+=f.value:m==="-="?o.value-=f.value:m==="*="?o.value*=f.value:m==="/="?o.value/=f.value:m==="%="?o.value%=f.value:m==="&="?o.value&=f.value:m==="|="?o.value|=f.value:m==="^="?o.value^=f.value:m==="<<="?o.value<<=f.value:m===">>="?o.value>>=f.value:console.error(`Invalid operator ${m}. Line ${e.line}`)}n instanceof Dn&&n.setDataValue(this,o,u,i)}}_function(e,i){const n=new L1(e);i.functions.set(e.name,n)}_const(e,i){let n=null;e.value!==null&&(n=this.evalExpression(e.value,i)),i.createVariable(e.name,n,e)}_let(e,i){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,i),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof jn||(n=n.clone())}else{const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||s==="array"){const u=new Ro(e.type,[]);n=this._evalCreate(u,i)}}i.createVariable(e.name,n,e)}_var(e,i){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,i),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof jn||(n=n.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||e.type instanceof Gd||e.type instanceof ya||e.type instanceof Be){const u=new Ro(e.type,[]);n=this._evalCreate(u,i)}}i.createVariable(e.name,n,e)}_switch(e,i){i=i.clone();const n=this.evalExpression(e.condition,i);if(!(n instanceof Me))return console.error(`Invalid if condition. Line ${e.line}`),null;let s=null;for(const u of e.cases)if(u instanceof SR)for(const f of u.selectors){if(f instanceof Qg){s=u;continue}const m=this.evalExpression(f,i);if(!(m instanceof Me))return console.error(`Invalid case selector. Line ${e.line}`),null;if(m.value===n.value)return this._execStatements(u.body,i)}else u instanceof IR&&(s=u);return s?this._execStatements(s.body,i):null}_if(e,i){i=i.clone();const n=this.evalExpression(e.condition,i);if(!(n instanceof Me))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,i);for(const s of e.elseif){const u=this.evalExpression(s.condition,i);if(!(u instanceof Me))return console.error(`Invalid if condition. Line ${e.line}`),null;if(u.value)return this._execStatements(s.body,i)}return e.else?this._execStatements(e.else,i):null}_getScalarValue(e){return e instanceof Me?e.value:(console.error("Expected scalar value.",e),0)}_for(e,i){for(i=i.clone(),this.execStatement(e.init,i);this._getScalarValue(this.evalExpression(e.condition,i));){const n=this._execStatements(e.body,i);if(n===Cr._breakObj)break;if(n!==null&&n!==Cr._continueObj)return n;this.execStatement(e.increment,i)}return null}_loop(e,i){for(i=i.clone();;){const n=this._execStatements(e.body,i);if(n===Cr._breakObj)break;if(n===Cr._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,i)===Cr._breakObj)break}else if(n!==null)return n}return null}_while(e,i){for(i=i.clone();this._getScalarValue(this.evalExpression(e.condition,i));){const n=this._execStatements(e.body,i);if(n===Cr._breakObj)break;if(n!==Cr._continueObj&&n!==null)return n}return null}_evalBitcast(e,i){const n=this.evalExpression(e.value,i),s=e.type;if(n instanceof Me){const u=zS(n.value,n.typeInfo.name,s.name);return new Me(u,this.getTypeInfo(s))}if(n instanceof he){const u=n.typeInfo.getTypeName();let f="";if(u.endsWith("f"))f="f32";else if(u.endsWith("i"))f="i32";else if(u.endsWith("u"))f="u32";else if(u.endsWith("b"))f="bool";else{if(!u.endsWith("h"))return console.error(`Unknown vector type ${u}. Line ${e.line}`),null;f="f16"}const m=s.getTypeName();let o="";if(m.endsWith("f"))o="f32";else if(m.endsWith("i"))o="i32";else if(m.endsWith("u"))o="u32";else if(m.endsWith("b"))o="bool";else{if(!m.endsWith("h"))return console.error(`Unknown vector type ${o}. Line ${e.line}`),null;o="f16"}const v=function(w,S,R){if(S===R)return w;const L=new Array(w.length);for(let j=0;j<w.length;j++)L[j]=zS(w[j],S,R);return L}(Array.from(n.data),f,o);return new he(v,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,i){return i.getVariableValue(e.name).clone().getSubData(this,e.postfix,i)}_evalCreate(e,i){var n;if(e instanceof Ro){if(e.type===null)return ub.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,i);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,i);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,i)}}const s=e instanceof Ro?e.type.name:e.name,u=e instanceof Ro?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(u===null)return console.error(`Unknown type ${s}. Line ${e.line}`),null;if(u.size===0)return null;const f=new Dn(new ArrayBuffer(u.size),u,0);if(u instanceof _l){if(e.args)for(let m=0;m<e.args.length;++m){const o=u.members[m],v=e.args[m],w=this.evalExpression(v,i);f.setData(this,w,o.type,o.offset,i)}}else if(u instanceof bl){let m=0;if(e.args)for(let o=0;o<e.args.length;++o){const v=e.args[o],w=this.evalExpression(v,i);u.format===null&&(((n=w.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?u.format=this.getTypeInfo("i32"):u.format=w.typeInfo),f.setData(this,w,u.format,m,i),m+=u.stride}}else console.error(`Unknown type "${s}". Line ${e.line}`);return e instanceof Ro?f.getSubData(this,e.postfix,i):f}_evalLiteral(e,i){const n=this.getTypeInfo(e.type),s=n.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new Me(e.scalarValue,n):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(e,i):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(e,i):e.value}_evalVariable(e,i){const n=i.getVariableValue(e.name);return n===null?n:n.getSubData(this,e.postfix,i)}_maxFormatTypeInfo(e){let i=e[0];if(i.name==="f32")return i;for(let n=1;n<e.length;++n){const s=Cr._priority.get(i.name);Cr._priority.get(e[n].name)<s&&(i=e[n])}return i.name==="x32"?this.getTypeInfo("i32"):i}_evalUnaryOp(e,i){const n=this.evalExpression(e.right,i);if(e.operator==="&")return new ah(n);if(e.operator==="*")return n instanceof ah?n.reference.getSubData(this,e.postfix,i):(console.error(`Invalid dereference. Line ${e.line}`),null);const s=n instanceof Me?n.value:n instanceof he?Array.from(n.data):null;switch(e.operator){case"+":{if(Bt(s)){const m=s.map((o,v)=>+o);return new he(m,n.typeInfo)}const u=s,f=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Me(+u,f)}case"-":{if(Bt(s)){const m=s.map((o,v)=>-o);return new he(m,n.typeInfo)}const u=s,f=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Me(-u,f)}case"!":{if(Bt(s)){const m=s.map((o,v)=>o?0:1);return new he(m,n.typeInfo)}const u=s,f=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Me(u?0:1,f)}case"~":{if(Bt(s)){const m=s.map((o,v)=>~o);return new he(m,n.typeInfo)}const u=s,f=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Me(~u,f)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,i){const n=this.evalExpression(e.left,i),s=this.evalExpression(e.right,i),u=n instanceof Me?n.value:n instanceof he||n instanceof ri?Array.from(n.data):null,f=s instanceof Me?s.value:s instanceof he||s instanceof ri?Array.from(s.data):null;switch(e.operator){case"+":{if(Bt(u)&&Bt(f)){const w=u,S=f;if(w.length!==S.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const R=w.map((L,j)=>L+S[j]);return new he(R,n.typeInfo)}if(Bt(u)){const w=f,S=u.map((R,L)=>R+w);return new he(S,n.typeInfo)}if(Bt(f)){const w=u,S=f.map((R,L)=>w+R);return new he(S,s.typeInfo)}const m=u,o=f,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Me(m+o,v)}case"-":{if(Bt(u)&&Bt(f)){const w=u,S=f;if(w.length!==S.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const R=w.map((L,j)=>L-S[j]);return new he(R,n.typeInfo)}if(Bt(u)){const w=f,S=u.map((R,L)=>R-w);return new he(S,n.typeInfo)}if(Bt(f)){const w=u,S=f.map((R,L)=>w-R);return new he(S,s.typeInfo)}const m=u,o=f,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Me(m-o,v)}case"*":{if(Bt(u)&&Bt(f)){const w=u,S=f;if(n instanceof ri&&s instanceof ri){const R=function(re,xe,be,ue){if(Fr[xe.name]===void 0||Fr[ue.name]===void 0)return null;const oe=Fr[xe.name][0],Ie=Fr[xe.name][1],me=Fr[ue.name][0];if(oe!==Fr[ue.name][1])return null;const ot=new Array(me*Ie);for(let lt=0;lt<Ie;lt++)for(let _t=0;_t<me;_t++){let rt=0;for(let Ge=0;Ge<oe;Ge++)rt+=re[Ge*Ie+lt]*be[_t*oe+Ge];ot[lt*me+_t]=rt}return ot}(w,n.typeInfo,S,s.typeInfo);if(R===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const L=Fr[s.typeInfo.name][0],j=Fr[n.typeInfo.name][1],Z=this.getTypeInfo(`mat${L}x${j}f`);return new ri(R,Z)}if(n instanceof ri&&s instanceof he){const R=function(L,j,Z,re){if(Fr[j.name]===void 0||zx[re.name]===void 0)return null;const xe=Fr[j.name][0],be=Fr[j.name][1];if(xe!==Z.length)return null;const ue=new Array(be);for(let oe=0;oe<be;oe++){let Ie=0;for(let me=0;me<xe;me++)Ie+=L[me*be+oe]*Z[me];ue[oe]=Ie}return ue}(w,n.typeInfo,S,s.typeInfo);return R===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new he(R,s.typeInfo)}if(n instanceof he&&s instanceof ri){const R=function(L,j,Z,re){if(zx[j.name]===void 0||Fr[re.name]===void 0)return null;const xe=Fr[re.name][0],be=Fr[re.name][1];if(be!==L.length)return null;const ue=[];for(let oe=0;oe<xe;oe++){let Ie=0;for(let me=0;me<be;me++)Ie+=L[me]*Z[me*xe+oe];ue[oe]=Ie}return ue}(w,n.typeInfo,S,s.typeInfo);return R===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new he(R,n.typeInfo)}{if(w.length!==S.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const R=w.map((L,j)=>L*S[j]);return new he(R,n.typeInfo)}}if(Bt(u)){const w=f,S=u.map((R,L)=>R*w);return n instanceof ri?new ri(S,n.typeInfo):new he(S,n.typeInfo)}if(Bt(f)){const w=u,S=f.map((R,L)=>w*R);return s instanceof ri?new ri(S,s.typeInfo):new he(S,s.typeInfo)}const m=u,o=f,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Me(m*o,v)}case"%":{if(Bt(u)&&Bt(f)){const w=u,S=f;if(w.length!==S.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const R=w.map((L,j)=>L%S[j]);return new he(R,n.typeInfo)}if(Bt(u)){const w=f,S=u.map((R,L)=>R%w);return new he(S,n.typeInfo)}if(Bt(f)){const w=u,S=f.map((R,L)=>w%R);return new he(S,s.typeInfo)}const m=u,o=f,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Me(m%o,v)}case"/":{if(Bt(u)&&Bt(f)){const w=u,S=f;if(w.length!==S.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const R=w.map((L,j)=>L/S[j]);return new he(R,n.typeInfo)}if(Bt(u)){const w=f,S=u.map((R,L)=>R/w);return new he(S,n.typeInfo)}if(Bt(f)){const w=u,S=f.map((R,L)=>w/R);return new he(S,s.typeInfo)}const m=u,o=f,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Me(m/o,v)}case"&":{if(Bt(u)&&Bt(f)){const w=u,S=f;if(w.length!==S.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const R=w.map((L,j)=>L&S[j]);return new he(R,n.typeInfo)}if(Bt(u)){const w=f,S=u.map((R,L)=>R&w);return new he(S,n.typeInfo)}if(Bt(f)){const w=u,S=f.map((R,L)=>w&R);return new he(S,s.typeInfo)}const m=u,o=f,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Me(m&o,v)}case"|":{if(Bt(u)&&Bt(f)){const w=u,S=f;if(w.length!==S.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const R=w.map((L,j)=>L|S[j]);return new he(R,n.typeInfo)}if(Bt(u)){const w=f,S=u.map((R,L)=>R|w);return new he(S,n.typeInfo)}if(Bt(f)){const w=u,S=f.map((R,L)=>w|R);return new he(S,s.typeInfo)}const m=u,o=f,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Me(m|o,v)}case"^":{if(Bt(u)&&Bt(f)){const w=u,S=f;if(w.length!==S.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const R=w.map((L,j)=>L^S[j]);return new he(R,n.typeInfo)}if(Bt(u)){const w=f,S=u.map((R,L)=>R^w);return new he(S,n.typeInfo)}if(Bt(f)){const w=u,S=f.map((R,L)=>w^R);return new he(S,s.typeInfo)}const m=u,o=f,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Me(m^o,v)}case"<<":{if(Bt(u)&&Bt(f)){const w=u,S=f;if(w.length!==S.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const R=w.map((L,j)=>L<<S[j]);return new he(R,n.typeInfo)}if(Bt(u)){const w=f,S=u.map((R,L)=>R<<w);return new he(S,n.typeInfo)}if(Bt(f)){const w=u,S=f.map((R,L)=>w<<R);return new he(S,s.typeInfo)}const m=u,o=f,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Me(m<<o,v)}case">>":{if(Bt(u)&&Bt(f)){const w=u,S=f;if(w.length!==S.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const R=w.map((L,j)=>L>>S[j]);return new he(R,n.typeInfo)}if(Bt(u)){const w=f,S=u.map((R,L)=>R>>w);return new he(S,n.typeInfo)}if(Bt(f)){const w=u,S=f.map((R,L)=>w>>R);return new he(S,s.typeInfo)}const m=u,o=f,v=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new Me(m>>o,v)}case">":if(Bt(u)&&Bt(f)){const m=u,o=f;if(m.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=m.map((w,S)=>w>o[S]?1:0);return new he(v,n.typeInfo)}if(Bt(u)){const m=f,o=u.map((v,w)=>v>m?1:0);return new he(o,n.typeInfo)}if(Bt(f)){const m=u,o=f.map((v,w)=>m>v?1:0);return new he(o,s.typeInfo)}return new Me(u>f?1:0,this.getTypeInfo("bool"));case"<":if(Bt(u)&&Bt(f)){const m=u,o=f;if(m.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=m.map((w,S)=>w<o[S]?1:0);return new he(v,n.typeInfo)}if(Bt(u)){const m=f,o=u.map((v,w)=>v<m?1:0);return new he(o,n.typeInfo)}if(Bt(f)){const m=u,o=f.map((v,w)=>m<v?1:0);return new he(o,s.typeInfo)}return new Me(u<f?1:0,this.getTypeInfo("bool"));case"==":if(Bt(u)&&Bt(f)){const m=u,o=f;if(m.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=m.map((w,S)=>w===o[S]?1:0);return new he(v,n.typeInfo)}if(Bt(u)){const m=f,o=u.map((v,w)=>v==m?1:0);return new he(o,n.typeInfo)}if(Bt(f)){const m=u,o=f.map((v,w)=>m==v?1:0);return new he(o,s.typeInfo)}return new Me(u===f?1:0,this.getTypeInfo("bool"));case"!=":if(Bt(u)&&Bt(f)){const m=u,o=f;if(m.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=m.map((w,S)=>w!==o[S]?1:0);return new he(v,n.typeInfo)}if(Bt(u)){const m=f,o=u.map((v,w)=>v!==m?1:0);return new he(o,n.typeInfo)}if(Bt(f)){const m=u,o=f.map((v,w)=>m!==v?1:0);return new he(o,s.typeInfo)}return new Me(u!==f?1:0,this.getTypeInfo("bool"));case">=":if(Bt(u)&&Bt(f)){const m=u,o=f;if(m.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=m.map((w,S)=>w>=o[S]?1:0);return new he(v,n.typeInfo)}if(Bt(u)){const m=f,o=u.map((v,w)=>v>=m?1:0);return new he(o,n.typeInfo)}if(Bt(f)){const m=u,o=f.map((v,w)=>m>=v?1:0);return new he(o,s.typeInfo)}return new Me(u>=f?1:0,this.getTypeInfo("bool"));case"<=":if(Bt(u)&&Bt(f)){const m=u,o=f;if(m.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=m.map((w,S)=>w<=o[S]?1:0);return new he(v,n.typeInfo)}if(Bt(u)){const m=f,o=u.map((v,w)=>v<=m?1:0);return new he(o,n.typeInfo)}if(Bt(f)){const m=u,o=f.map((v,w)=>m<=v?1:0);return new he(o,s.typeInfo)}return new Me(u<=f?1:0,this.getTypeInfo("bool"));case"&&":if(Bt(u)&&Bt(f)){const m=u,o=f;if(m.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=m.map((w,S)=>w&&o[S]?1:0);return new he(v,n.typeInfo)}if(Bt(u)){const m=f,o=u.map((v,w)=>v&&m?1:0);return new he(o,n.typeInfo)}if(Bt(f)){const m=u,o=f.map((v,w)=>m&&v?1:0);return new he(o,s.typeInfo)}return new Me(u&&f?1:0,this.getTypeInfo("bool"));case"||":if(Bt(u)&&Bt(f)){const m=u,o=f;if(m.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=m.map((w,S)=>w||o[S]?1:0);return new he(v,n.typeInfo)}if(Bt(u)){const m=f,o=u.map((v,w)=>v||m?1:0);return new he(o,n.typeInfo)}if(Bt(f)){const m=u,o=f.map((v,w)=>m||v?1:0);return new he(o,s.typeInfo)}return new Me(u||f?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,i){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const n=i.clone();n.currentFunctionName=e.name;const s=i.getFunction(e.name);if(!s)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,i):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let u=0;u<s.node.args.length;++u){const f=s.node.args[u],m=this.evalExpression(e.args[u],n);n.createVariable(f.name,m,f)}return this._execStatements(s.node.body,n)}_callBuiltinFunction(e,i){switch(e.name){case"all":return this.builtins.All(e,i);case"any":return this.builtins.Any(e,i);case"select":return this.builtins.Select(e,i);case"arrayLength":return this.builtins.ArrayLength(e,i);case"abs":return this.builtins.Abs(e,i);case"acos":return this.builtins.Acos(e,i);case"acosh":return this.builtins.Acosh(e,i);case"asin":return this.builtins.Asin(e,i);case"asinh":return this.builtins.Asinh(e,i);case"atan":return this.builtins.Atan(e,i);case"atanh":return this.builtins.Atanh(e,i);case"atan2":return this.builtins.Atan2(e,i);case"ceil":return this.builtins.Ceil(e,i);case"clamp":return this.builtins.Clamp(e,i);case"cos":return this.builtins.Cos(e,i);case"cosh":return this.builtins.Cosh(e,i);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,i);case"countOneBits":return this.builtins.CountOneBits(e,i);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,i);case"cross":return this.builtins.Cross(e,i);case"degrees":return this.builtins.Degrees(e,i);case"determinant":return this.builtins.Determinant(e,i);case"distance":return this.builtins.Distance(e,i);case"dot":return this.builtins.Dot(e,i);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,i);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,i);case"exp":return this.builtins.Exp(e,i);case"exp2":return this.builtins.Exp2(e,i);case"extractBits":return this.builtins.ExtractBits(e,i);case"faceForward":return this.builtins.FaceForward(e,i);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,i);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,i);case"floor":return this.builtins.Floor(e,i);case"fma":return this.builtins.Fma(e,i);case"fract":return this.builtins.Fract(e,i);case"frexp":return this.builtins.Frexp(e,i);case"insertBits":return this.builtins.InsertBits(e,i);case"inverseSqrt":return this.builtins.InverseSqrt(e,i);case"ldexp":return this.builtins.Ldexp(e,i);case"length":return this.builtins.Length(e,i);case"log":return this.builtins.Log(e,i);case"log2":return this.builtins.Log2(e,i);case"max":return this.builtins.Max(e,i);case"min":return this.builtins.Min(e,i);case"mix":return this.builtins.Mix(e,i);case"modf":return this.builtins.Modf(e,i);case"normalize":return this.builtins.Normalize(e,i);case"pow":return this.builtins.Pow(e,i);case"quantizeToF16":return this.builtins.QuantizeToF16(e,i);case"radians":return this.builtins.Radians(e,i);case"reflect":return this.builtins.Reflect(e,i);case"refract":return this.builtins.Refract(e,i);case"reverseBits":return this.builtins.ReverseBits(e,i);case"round":return this.builtins.Round(e,i);case"saturate":return this.builtins.Saturate(e,i);case"sign":return this.builtins.Sign(e,i);case"sin":return this.builtins.Sin(e,i);case"sinh":return this.builtins.Sinh(e,i);case"smoothStep":return this.builtins.SmoothStep(e,i);case"sqrt":return this.builtins.Sqrt(e,i);case"step":return this.builtins.Step(e,i);case"tan":return this.builtins.Tan(e,i);case"tanh":return this.builtins.Tanh(e,i);case"transpose":return this.builtins.Transpose(e,i);case"trunc":return this.builtins.Trunc(e,i);case"dpdx":return this.builtins.Dpdx(e,i);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,i);case"dpdxFine":return this.builtins.DpdxFine(e,i);case"dpdy":return this.builtins.Dpdy(e,i);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,i);case"dpdyFine":return this.builtins.DpdyFine(e,i);case"fwidth":return this.builtins.Fwidth(e,i);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,i);case"fwidthFine":return this.builtins.FwidthFine(e,i);case"textureDimensions":return this.builtins.TextureDimensions(e,i);case"textureGather":return this.builtins.TextureGather(e,i);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,i);case"textureLoad":return this.builtins.TextureLoad(e,i);case"textureNumLayers":return this.builtins.TextureNumLayers(e,i);case"textureNumLevels":return this.builtins.TextureNumLevels(e,i);case"textureNumSamples":return this.builtins.TextureNumSamples(e,i);case"textureSample":return this.builtins.TextureSample(e,i);case"textureSampleBias":return this.builtins.TextureSampleBias(e,i);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,i);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,i);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,i);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,i);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,i);case"textureStore":return this.builtins.TextureStore(e,i);case"atomicLoad":return this.builtins.AtomicLoad(e,i);case"atomicStore":return this.builtins.AtomicStore(e,i);case"atomicAdd":return this.builtins.AtomicAdd(e,i);case"atomicSub":return this.builtins.AtomicSub(e,i);case"atomicMax":return this.builtins.AtomicMax(e,i);case"atomicMin":return this.builtins.AtomicMin(e,i);case"atomicAnd":return this.builtins.AtomicAnd(e,i);case"atomicOr":return this.builtins.AtomicOr(e,i);case"atomicXor":return this.builtins.AtomicXor(e,i);case"atomicExchange":return this.builtins.AtomicExchange(e,i);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,i);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,i);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,i);case"pack4xI8":return this.builtins.Pack4xI8(e,i);case"pack4xU8":return this.builtins.Pack4xU8(e,i);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,i);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,i);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,i);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,i);case"pack2x16float":return this.builtins.Pack2x16float(e,i);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,i);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,i);case"unpack4xI8":return this.builtins.Unpack4xI8(e,i);case"unpack4xU8":return this.builtins.Unpack4xU8(e,i);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,i);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,i);case"unpack2x16float":return this.builtins.Unpack2x16float(e,i);case"storageBarrier":return this.builtins.StorageBarrier(e,i);case"textureBarrier":return this.builtins.TextureBarrier(e,i);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,i);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,i);case"subgroupAdd":return this.builtins.SubgroupAdd(e,i);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,i);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,i);case"subgroupAll":return this.builtins.SubgroupAll(e,i);case"subgroupAnd":return this.builtins.SubgroupAnd(e,i);case"subgroupAny":return this.builtins.SubgroupAny(e,i);case"subgroupBallot":return this.builtins.SubgroupBallot(e,i);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,i);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,i);case"subgroupElect":return this.builtins.SubgroupElect(e,i);case"subgroupMax":return this.builtins.SubgroupMax(e,i);case"subgroupMin":return this.builtins.SubgroupMin(e,i);case"subgroupMul":return this.builtins.SubgroupMul(e,i);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,i);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,i);case"subgroupOr":return this.builtins.SubgroupOr(e,i);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,i);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,i);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,i);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,i);case"subgroupXor":return this.builtins.SubgroupXor(e,i);case"quadBroadcast":return this.builtins.QuadBroadcast(e,i);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,i);case"quadSwapX":return this.builtins.QuadSwapX(e,i);case"quadSwapY":return this.builtins.QuadSwapY(e,i)}const n=i.getFunction(e.name);if(n){const s=i.clone();for(let u=0;u<n.node.args.length;++u){const f=n.node.args[u],m=this.evalExpression(e.args[u],s);s.setVariable(f.name,m,f)}return this._execStatements(n.node.body,s)}return null}_callConstructorValue(e,i){if(!e.args||e.args.length===0)return new Me(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],i);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,i).clone()}_callConstructorVec(e,i){const n=this.getTypeInfo(e.type),s=e.type.getTypeName(),u=zx[s];if(u===void 0)return console.error(`Invalid vec constructor ${s}. Line ${e.line}`),null;const f=[];if(e instanceof Qn)if(e.isVector){const m=e.vectorValue;for(const o of m)f.push(o)}else f.push(e.scalarValue);else if(e.args)for(const m of e.args){const o=this.evalExpression(m,i);if(o instanceof he){const v=o.data;for(let w=0;w<v.length;++w){let S=v[w];f.push(S)}}else if(o instanceof Me){let v=o.value;f.push(v)}}if(e.type instanceof Be&&e.type.format===null&&(e.type.format=Be.f32),f.length===0){const m=new Array(u).fill(0);return new he(m,n).getSubData(this,e.postfix,i)}if(f.length===1)for(;f.length<u;)f.push(f[0]);return f.length<u?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new he(f.length>u?f.slice(0,u):f,n).getSubData(this,e.postfix,i)}_callConstructorMatrix(e,i){const n=this.getTypeInfo(e.type),s=e.type.getTypeName(),u=Fr[s];if(u===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${e.line}`),null;const f=[];if(e instanceof Qn)if(e.isVector){const m=e.vectorValue;for(const o of m)f.push(o)}else f.push(e.scalarValue);else if(e.args)for(const m of e.args){const o=this.evalExpression(m,i);o instanceof he?f.push(...o.data):o instanceof Me?f.push(o.value):o instanceof ri&&f.push(...o.data)}if(n instanceof Uc&&n.format===null&&(n.format=this.getTypeInfo("f32")),f.length===0){const m=new Array(u[2]).fill(0);return new ri(m,n).getSubData(this,e.postfix,i)}return f.length!==u[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new ri(f,n).getSubData(this,e.postfix,i)}}Cr._breakObj=new ks(new Ms("BREAK",null),null),Cr._continueObj=new ks(new Ms("CONTINUE",null),null),Cr._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Y8{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class K8{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new Y8,this._exec=new Cr,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const i=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;i.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const s=n.arrayType,u=n.countNode;if(u instanceof ps){const f=u.name,m=this._context.constants.get(f);if(m)try{const o=m.constEvaluate(this._exec);s.count=o}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of i)n.search(s=>{s instanceof FS||s instanceof Nx?s.type=this._forwardType(s.type):s instanceof Gd?s.format=this._forwardType(s.format):s instanceof wa||s instanceof qd||s instanceof Jg?s.type=this._forwardType(s.type):s instanceof dp?s.returnType=this._forwardType(s.returnType):s instanceof BS&&(s.type=this._forwardType(s.type))});return i}_forwardType(e){if(e instanceof LS){const i=this._getType(e.name);if(i)return i}else e instanceof Nx?e.type=this._forwardType(e.type):e instanceof Gd&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const i=new U8(e);this._tokens=i.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,i){return e.line=i??this._currentLine,e}_error(e,i){return{token:e,message:i,toString:()=>`${i}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ie.eof}_match(e){if(e instanceof De)return!!this._check(e)&&(this._advance(),!0);for(let i=0,n=e.length;i<n;++i){const s=e[i];if(this._check(s))return this._advance(),!0}return!1}_consume(e,i){if(this._check(e))return this._advance();throw this._error(this._peek(),`${i}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const i=this._peek();if(e instanceof Array){const n=i.type;let s=!1;for(const u of e){if(n===u)return!0;u===ie.tokens.name&&(s=!0)}if(s){const u=ie.tokens.name.rule.exec(i.lexeme);if(u&&u.index==0&&u[0]==i.lexeme)return!0}return!1}if(i.type===e)return!0;if(e===ie.tokens.name){const n=ie.tokens.name.rule.exec(i.lexeme);return n&&n.index==0&&n[0]==i.lexeme}return!1}_advance(){var e,i;return this._currentLine=(i=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&i!==void 0?i:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ie.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ie.keywords.alias)){const i=this._type_alias();return this._consume(ie.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([i]),i}if(this._match(ie.keywords.diagnostic)){const i=this._diagnostic();return this._consume(ie.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([i]),i}if(this._match(ie.keywords.requires)){const i=this._requires_directive();return this._consume(ie.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([i]),i}if(this._match(ie.keywords.enable)){const i=this._enable_directive();return this._consume(ie.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([i]),i}const e=this._attribute();if(this._check(ie.keywords.var)){const i=this._global_variable_decl();return i!=null&&(i.attributes=e),this._consume(ie.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([i]),i}if(this._check(ie.keywords.override)){const i=this._override_variable_decl();return i!=null&&(i.attributes=e),this._consume(ie.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([i]),i}if(this._check(ie.keywords.let)){const i=this._global_let_decl();return i!=null&&(i.attributes=e),this._consume(ie.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([i]),i}if(this._check(ie.keywords.const)){const i=this._global_const_decl();return i!=null&&(i.attributes=e),this._consume(ie.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([i]),i}if(this._check(ie.keywords.struct)){const i=this._struct_decl();return i!=null&&(i.attributes=e),this._exec.reflection.updateAST([i]),i}if(this._check(ie.keywords.fn)){const i=this._function_decl();return i!=null&&(i.attributes=e),this._exec.reflection.updateAST([i]),i}return null}_function_decl(){if(!this._match(ie.keywords.fn))return null;const e=this._currentLine,i=this._consume(ie.tokens.ident,"Expected function name.").toString();this._consume(ie.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(ie.tokens.paren_right))do{if(this._check(ie.tokens.paren_right))break;const m=this._attribute(),o=this._consume(ie.tokens.name,"Expected argument name.").toString();this._consume(ie.tokens.colon,"Expected ':' for argument type.");const v=this._attribute(),w=this._type_decl();w!=null&&(w.attributes=v,n.push(this._updateNode(new BS(o,w,m))))}while(this._match(ie.tokens.comma));this._consume(ie.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(ie.tokens.arrow)){const m=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=m)}const u=this._compound_statement(),f=this._currentLine;return this._updateNode(new dp(i,n,s,u,e,f),e)}_compound_statement(){const e=[];for(this._consume(ie.tokens.brace_left,"Expected '{' for block.");!this._check(ie.tokens.brace_right);){const i=this._statement();i!==null&&e.push(i)}return this._consume(ie.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(ie.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ie.tokens.attr)&&this._attribute(),this._check(ie.keywords.if))return this._if_statement();if(this._check(ie.keywords.switch))return this._switch_statement();if(this._check(ie.keywords.loop))return this._loop_statement();if(this._check(ie.keywords.for))return this._for_statement();if(this._check(ie.keywords.while))return this._while_statement();if(this._check(ie.keywords.continuing))return this._continuing_statement();if(this._check(ie.keywords.static_assert))return this._static_assert_statement();if(this._check(ie.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(ie.keywords.return))e=this._return_statement();else if(this._check([ie.keywords.var,ie.keywords.let,ie.keywords.const]))e=this._variable_statement();else if(this._match(ie.keywords.discard))e=this._updateNode(new F8);else if(this._match(ie.keywords.break)){const i=this._updateNode(new vR);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];i.loopId=n.id}e=i,this._check(ie.keywords.if)&&(this._advance(),i.condition=this._optional_paren_expression())}else if(this._match(ie.keywords.continue)){const i=this._updateNode(new bR);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${i.line}`);{const n=this._currentLoop[this._currentLoop.length-1];i.loopId=n.id}e=i}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(ie.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(ie.keywords.static_assert))return null;const e=this._currentLine,i=this._optional_paren_expression();return this._updateNode(new O8(i),e)}_while_statement(){if(!this._match(ie.keywords.while))return null;const e=this._updateNode(new hR(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ie.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(ie.keywords.continuing))return null;const i=this._currentLine,n=this._compound_statement();return this._updateNode(new cb(n,e),i)}_for_statement(){if(!this._match(ie.keywords.for))return null;this._consume(ie.tokens.paren_left,"Expected '('.");const e=this._updateNode(new fR(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(ie.tokens.semicolon)?null:this._for_init(),this._consume(ie.tokens.semicolon,"Expected ';'."),e.condition=this._check(ie.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(ie.tokens.semicolon,"Expected ';'."),e.increment=this._check(ie.tokens.paren_right)?null:this._for_increment(),this._consume(ie.tokens.paren_right,"Expected ')'."),this._check(ie.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ie.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let i=null;return this._match(ie.tokens.equal)&&(i=this._short_circuit_or_expression()),this._updateNode(new wa(e.name,e.type,e.storage,e.access,i),e.line)}if(this._match(ie.keywords.let)){const e=this._currentLine,i=this._consume(ie.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(ie.tokens.colon)){const u=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=u)}this._consume(ie.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new qd(i,n,null,null,s),e)}if(this._match(ie.keywords.const)){const e=this._currentLine,i=this._consume(ie.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(ie.tokens.colon)){const u=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=u)}this._consume(ie.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return n===null&&s instanceof Qn&&(n=s.type),this._updateNode(new Jg(i,n,null,null,s),e)}return null}_increment_decrement_statement(){const e=this._current,i=this._unary_expression();if(i==null)return null;if(!this._check(ie.increment_operators))return this._current=e,null;const n=this._consume(ie.increment_operators,"Expected increment operator");return this._updateNode(new dR(n.type===ie.tokens.plus_plus?ph.increment:ph.decrement,i))}_assignment_statement(){let e=null;const i=this._currentLine;if(this._check(ie.tokens.brace_right))return null;let n=this._match(ie.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const s=this._consume(ie.assignment_operators,"Expected assignment operator."),u=this._short_circuit_or_expression();return this._updateNode(new pR(kd.parse(s.lexeme),e,u),i)}_func_call_statement(){if(!this._check(ie.tokens.ident))return null;const e=this._currentLine,i=this._current,n=this._consume(ie.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=i,null):this._updateNode(new P1(n.lexeme,s),e)}_loop_statement(){if(!this._match(ie.keywords.loop))return null;this._check(ie.tokens.attr)&&this._attribute(),this._consume(ie.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new mR([],null));this._currentLoop.push(e);let i=this._statement();for(;i!==null;){if(Array.isArray(i))for(let n of i)e.body.push(n);else e.body.push(i);if(i instanceof cb){e.continuing=i;break}i=this._statement()}return this._currentLoop.pop(),this._consume(ie.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(ie.keywords.switch))return null;const e=this._updateNode(new gR(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ie.tokens.attr)&&this._attribute(),this._consume(ie.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ie.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let i=!1;for(;this._check([ie.keywords.default,ie.keywords.case]);){if(this._match(ie.keywords.case)){const n=this._case_selectors();for(const u of n)if(u instanceof Qg){if(i)throw this._error(this._previous(),"Multiple default cases in switch statement.");i=!0;break}this._match(ie.tokens.colon),this._check(ie.tokens.attr)&&this._attribute(),this._consume(ie.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(ie.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new SR(n,s)))}if(this._match(ie.keywords.default)){if(i)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(ie.tokens.colon),this._check(ie.tokens.attr)&&this._attribute(),this._consume(ie.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(ie.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new IR(n)))}}return e}_case_selectors(){const e=[];for(this._match(ie.keywords.default)?e.push(this._updateNode(new Qg)):e.push(this._shift_expression());this._match(ie.tokens.comma);)this._match(ie.keywords.default)?e.push(this._updateNode(new Qg)):e.push(this._shift_expression());return e}_case_body(){if(this._match(ie.keywords.fallthrough))return this._consume(ie.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const i=this._case_body();return i.length==0?e:[...e,i[0]]}_if_statement(){if(!this._match(ie.keywords.if))return null;const e=this._currentLine,i=this._optional_paren_expression();this._check(ie.tokens.attr)&&this._attribute();const n=this._compound_statement();let s=[];this._match_elseif()&&(this._check(ie.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let u=null;return this._match(ie.keywords.else)&&(this._check(ie.tokens.attr)&&this._attribute(),u=this._compound_statement()),this._updateNode(new _R(i,n,s,u),e)}_match_elseif(){return this._tokens[this._current].type===ie.keywords.else&&this._tokens[this._current+1].type===ie.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const i=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new N8(i,n))),this._match_elseif()&&(this._check(ie.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(ie.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new yR(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(ie.tokens.or_or);)e=this._updateNode(new Ys(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(ie.tokens.and_and);)e=this._updateNode(new Ys(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(ie.tokens.or);)e=this._updateNode(new Ys(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(ie.tokens.xor);)e=this._updateNode(new Ys(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(ie.tokens.and);)e=this._updateNode(new Ys(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([ie.tokens.equal_equal,ie.tokens.not_equal])?this._updateNode(new Ys(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([ie.tokens.less_than,ie.tokens.greater_than,ie.tokens.less_than_equal,ie.tokens.greater_than_equal]);)e=this._updateNode(new Ys(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([ie.tokens.shift_left,ie.tokens.shift_right]);)e=this._updateNode(new Ys(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([ie.tokens.plus,ie.tokens.minus]);)e=this._updateNode(new Ys(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([ie.tokens.star,ie.tokens.forward_slash,ie.tokens.modulo]);)e=this._updateNode(new Ys(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([ie.tokens.minus,ie.tokens.bang,ie.tokens.tilde,ie.tokens.star,ie.tokens.and])?this._updateNode(new jn(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),i=this._postfix_expression();return i&&(e.postfix=i),e}_postfix_expression(){if(this._match(ie.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(ie.tokens.bracket_right,"Expected ']'.");const i=this._updateNode(new Fh(e)),n=this._postfix_expression();return n&&(i.postfix=n),i}if(this._match(ie.tokens.period)){const e=this._consume(ie.tokens.name,"Expected member name."),i=this._postfix_expression(),n=this._updateNode(new Vc(e.lexeme));return i&&(n.postfix=i),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const i=this._getStruct(e);if(i!==null)return i;switch(e){case"void":return ut.void;case"bool":return ut.bool;case"i32":return ut.i32;case"u32":return ut.u32;case"f32":return ut.f32;case"f16":return ut.f16;case"vec2f":return Be.vec2f;case"vec3f":return Be.vec3f;case"vec4f":return Be.vec4f;case"vec2i":return Be.vec2i;case"vec3i":return Be.vec3i;case"vec4i":return Be.vec4i;case"vec2u":return Be.vec2u;case"vec3u":return Be.vec3u;case"vec4u":return Be.vec4u;case"vec2h":return Be.vec2h;case"vec3h":return Be.vec3h;case"vec4h":return Be.vec4h;case"mat2x2f":return Be.mat2x2f;case"mat2x3f":return Be.mat2x3f;case"mat2x4f":return Be.mat2x4f;case"mat3x2f":return Be.mat3x2f;case"mat3x3f":return Be.mat3x3f;case"mat3x4f":return Be.mat3x4f;case"mat4x2f":return Be.mat4x2f;case"mat4x3f":return Be.mat4x3f;case"mat4x4f":return Be.mat4x4f;case"mat2x2h":return Be.mat2x2h;case"mat2x3h":return Be.mat2x3h;case"mat2x4h":return Be.mat2x4h;case"mat3x2h":return Be.mat3x2h;case"mat3x3h":return Be.mat3x3h;case"mat3x4h":return Be.mat3x4h;case"mat4x2h":return Be.mat4x2h;case"mat4x3h":return Be.mat4x3h;case"mat4x4h":return Be.mat4x4h;case"mat2x2i":return Be.mat2x2i;case"mat2x3i":return Be.mat2x3i;case"mat2x4i":return Be.mat2x4i;case"mat3x2i":return Be.mat3x2i;case"mat3x3i":return Be.mat3x3i;case"mat3x4i":return Be.mat3x4i;case"mat4x2i":return Be.mat4x2i;case"mat4x3i":return Be.mat4x3i;case"mat4x4i":return Be.mat4x4i;case"mat2x2u":return Be.mat2x2u;case"mat2x3u":return Be.mat2x3u;case"mat2x4u":return Be.mat2x4u;case"mat3x2u":return Be.mat3x2u;case"mat3x3u":return Be.mat3x3u;case"mat3x4u":return Be.mat3x4u;case"mat4x2u":return Be.mat4x2u;case"mat4x3u":return Be.mat4x3u;case"mat4x4u":return Be.mat4x4u}return null}_validateTypeRange(e,i){if(i.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(i.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(ie.tokens.ident)){const n=this._previous().toString();if(this._check(ie.tokens.paren_left)){const s=this._argument_expression_list(),u=this._getType(n);return u!==null?this._updateNode(new Ro(u,s)):this._updateNode(new D1(n,s))}if(this._context.constants.has(n)){const s=this._context.constants.get(n);return this._updateNode(new wR(n,s.value))}return this._updateNode(new ps(n))}if(this._match(ie.tokens.int_literal)){const n=this._previous().toString();let s=n.endsWith("i")||n.endsWith("i")?ut.i32:n.endsWith("u")||n.endsWith("U")?ut.u32:ut.x32;const u=parseInt(n);return this._validateTypeRange(u,s),this._updateNode(new Qn(new Me(u,this._exec.getTypeInfo(s)),s))}if(this._match(ie.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,ut.u32),this._updateNode(new Qn(new Me(n,this._exec.getTypeInfo(ut.u32)),ut.u32))}if(this._match([ie.tokens.decimal_float_literal,ie.tokens.hex_float_literal])){let n=this._previous().toString(),s=n.endsWith("h");s&&(n=n.substring(0,n.length-1));const u=parseFloat(n);this._validateTypeRange(u,s?ut.f16:ut.f32);const f=s?ut.f16:ut.f32;return this._updateNode(new Qn(new Me(u,this._exec.getTypeInfo(f)),f))}if(this._match([ie.keywords.true,ie.keywords.false])){let n=this._previous().toString()===ie.keywords.true.rule;return this._updateNode(new Qn(new Me(n?1:0,this._exec.getTypeInfo(ut.bool)),ut.bool))}if(this._check(ie.tokens.paren_left))return this._paren_expression();if(this._match(ie.keywords.bitcast)){this._consume(ie.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(ie.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new TR(n,s))}const e=this._type_decl(),i=this._argument_expression_list();return this._updateNode(new Ro(e,i))}_argument_expression_list(){if(!this._match(ie.tokens.paren_left))return null;const e=[];do{if(this._check(ie.tokens.paren_right))break;const i=this._short_circuit_or_expression();e.push(i)}while(this._match(ie.tokens.comma));return this._consume(ie.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(ie.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(ie.tokens.paren_right),e}_paren_expression(){this._consume(ie.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(ie.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(ie.keywords.struct))return null;const e=this._currentLine,i=this._consume(ie.tokens.ident,"Expected name for struct.").toString();this._consume(ie.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(ie.tokens.brace_right);){const f=this._attribute(),m=this._consume(ie.tokens.name,"Expected variable name.").toString();this._consume(ie.tokens.colon,"Expected ':' for struct member type.");const o=this._attribute(),v=this._type_decl();v!=null&&(v.attributes=o),this._check(ie.tokens.brace_right)?this._match(ie.tokens.comma):this._consume(ie.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new FS(m,v,f)))}this._consume(ie.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,u=this._updateNode(new ya(i,n,e,s),e);return this._context.structs.set(i,u),u}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(ie.tokens.equal)){const i=this._const_expression();e.value=i}if(e.type!==null&&e.value instanceof Qn){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Qn&&(e.type=e.value.type.name==="x32"?ut.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(ie.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(ie.keywords.const))return null;const i=this._consume(ie.tokens.name,"Expected variable name"),n=this._currentLine;let s=null;if(this._match(ie.tokens.colon)){const o=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=o)}let u=null;this._consume(ie.tokens.equal,"const declarations require an assignment");const f=this._short_circuit_or_expression();try{let o=[ut.f32],v=f.constEvaluate(this._exec,o);v instanceof Me&&this._validateTypeRange(v.value,o[0]),o[0]instanceof Be&&o[0].format===null&&v.typeInfo instanceof Uc&&v.typeInfo.format!==null&&(v.typeInfo.format.name==="f16"?o[0].format=ut.f16:v.typeInfo.format.name==="f32"?o[0].format=ut.f32:v.typeInfo.format.name==="i32"?o[0].format=ut.i32:v.typeInfo.format.name==="u32"?o[0].format=ut.u32:v.typeInfo.format.name==="bool"?o[0].format=ut.bool:console.error(`TODO: impelement template format type ${v.typeInfo.format.name}`)),u=this._updateNode(new Qn(v,o[0])),this._exec.context.setVariable(i.toString(),v)}catch{u=f}if(s!==null&&u instanceof Qn){if(u.type.name!=="x32"&&s.getTypeName()!==u.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${u.type.name} to ${s.name}. Line:${this._currentLine}`);u.type=s,u.isScalar&&this._validateTypeRange(u.scalarValue,u.type)}else s===null&&u instanceof Qn&&(s=(e=u==null?void 0:u.type)!==null&&e!==void 0?e:ut.f32,s===ut.x32&&(s=ut.i32));const m=this._updateNode(new Jg(i.toString(),s,"","",u),n);return this._context.constants.set(m.name,m),m}_global_let_decl(){if(!this._match(ie.keywords.let))return null;const e=this._currentLine,i=this._consume(ie.tokens.name,"Expected variable name");let n=null;if(this._match(ie.tokens.colon)){const u=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=u)}let s=null;if(this._match(ie.tokens.equal)&&(s=this._const_expression()),n!==null&&s instanceof Qn){if(s.type.name!=="x32"&&n.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${n.name}. Line:${this._currentLine}`);s.type=n}else n===null&&s instanceof Qn&&(n=s.type.name==="x32"?ut.i32:s.type);return s instanceof Qn&&s.isScalar&&this._validateTypeRange(s.scalarValue,n),this._updateNode(new qd(i.toString(),n,"","",s),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(ie.keywords.var))return null;const e=this._currentLine;let i="",n="";this._match(ie.tokens.less_than)&&(i=this._consume(ie.storage_class,"Expected storage_class.").toString(),this._match(ie.tokens.comma)&&(n=this._consume(ie.access_mode,"Expected access_mode.").toString()),this._consume(ie.tokens.greater_than,"Expected '>'."));const s=this._consume(ie.tokens.name,"Expected variable name");let u=null;if(this._match(ie.tokens.colon)){const f=this._attribute();u=this._type_decl(),u!=null&&(u.attributes=f)}return this._updateNode(new wa(s.toString(),u,i,n,null),e)}_override_decl(){if(!this._match(ie.keywords.override))return null;const e=this._consume(ie.tokens.name,"Expected variable name");let i=null;if(this._match(ie.tokens.colon)){const n=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=n)}return this._updateNode(new R1(e.toString(),i,null))}_diagnostic(){this._consume(ie.tokens.paren_left,"Expected '('");const e=this._consume(ie.tokens.ident,"Expected severity control name.");this._consume(ie.tokens.comma,"Expected ','");let i=this._consume(ie.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(ie.tokens.period)&&(i+=`.${this._consume(ie.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(ie.tokens.paren_right,"Expected ')'"),this._updateNode(new xR(e.toString(),i))}_enable_directive(){const e=this._consume(ie.tokens.ident,"identity expected.");return this._updateNode(new L8(e.toString()))}_requires_directive(){const e=[this._consume(ie.tokens.ident,"identity expected.").toString()];for(;this._match(ie.tokens.comma);){const i=this._consume(ie.tokens.ident,"identity expected.");e.push(i.toString())}return this._updateNode(new B8(e))}_type_alias(){const e=this._consume(ie.tokens.ident,"identity expected.");this._consume(ie.tokens.equal,"Expected '=' for type alias.");let i=this._type_decl();if(i===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);const n=this._updateNode(new k1(e.toString(),i));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([ie.tokens.ident,...ie.texel_format,ie.keywords.bool,ie.keywords.f32,ie.keywords.i32,ie.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const s=this._updateNode(new LS(n));return this._forwardTypeCount++,s}return this._updateNode(new ut(n))}let e=this._texture_sampler_types();if(e)return e;if(this._check(ie.template_types)){let n=this._advance().toString(),s=null,u=null;return this._match(ie.tokens.less_than)&&(s=this._type_decl(),u=null,this._match(ie.tokens.comma)&&(u=this._consume(ie.access_mode,"Expected access_mode for pointer").toString()),this._consume(ie.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new Be(n,s,u))}if(this._match(ie.keywords.ptr)){let n=this._previous().toString();this._consume(ie.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(ie.storage_class,"Expected storage_class for pointer");this._consume(ie.tokens.comma,"Expected ',' for pointer.");const u=this._type_decl();let f=null;return this._match(ie.tokens.comma)&&(f=this._consume(ie.access_mode,"Expected access_mode for pointer").toString()),this._consume(ie.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Nx(n,s.toString(),u,f))}const i=this._attribute();if(this._match(ie.keywords.array)){let n=null,s=-1;const u=this._previous();let f=null;if(this._match(ie.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let o="";if(this._match(ie.tokens.comma)){f=this._shift_expression();try{o=f.constEvaluate(this._exec).toString(),f=null}catch{o="1"}}this._consume(ie.tokens.greater_than,"Expected '>' for array."),s=o?parseInt(o):0}const m=this._updateNode(new Gd(u.toString(),i,n,s));return f&&this._deferArrayCountEval.push({arrayType:m,countNode:f}),m}return null}_texture_sampler_types(){if(this._match(ie.sampler_type))return this._updateNode(new Dd(this._previous().toString(),null,null));if(this._match(ie.depth_texture_type))return this._updateNode(new Dd(this._previous().toString(),null,null));if(this._match(ie.sampled_texture_type)||this._match(ie.multisampled_texture_type)){const e=this._previous();this._consume(ie.tokens.less_than,"Expected '<' for sampler type.");const i=this._type_decl();return this._consume(ie.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Dd(e.toString(),i,null))}if(this._match(ie.storage_texture_type)){const e=this._previous();this._consume(ie.tokens.less_than,"Expected '<' for sampler type.");const i=this._consume(ie.texel_format,"Invalid texel format.").toString();this._consume(ie.tokens.comma,"Expected ',' after texel format.");const n=this._consume(ie.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ie.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Dd(e.toString(),i,n))}return null}_attribute(){let e=[];for(;this._match(ie.tokens.attr);){const i=this._consume(ie.attribute_name,"Expected attribute name"),n=this._updateNode(new CR(i.toString(),null));if(this._match(ie.tokens.paren_left)){if(n.value=this._consume(ie.literal_or_ident,"Expected attribute value").toString(),this._check(ie.tokens.comma)){this._advance();do{const s=this._consume(ie.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(s)}while(this._match(ie.tokens.comma))}this._consume(ie.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class J8 extends Fo{constructor(e){super(),e&&this.update(e)}update(e){const i=new K8().parse(e);this.updateAST(i)}}function Q8(t){var u;const e={attributes:[],bindings:[]};let i;try{i=ej(t)}catch(f){return Et.error(f.message)(),e}for(const f of i.uniforms){const m=[];for(const o of((u=f.type)==null?void 0:u.members)||[])m.push({name:o.name,type:US(o.type)});e.bindings.push({type:"uniform",name:f.name,group:f.group,location:f.binding,members:m})}for(const f of i.textures)e.bindings.push({type:"texture",name:f.name,group:f.group,location:f.binding});for(const f of i.samplers)e.bindings.push({type:"sampler",name:f.name,group:f.group,location:f.binding});const n=i.entry.vertex[0],s=(n==null?void 0:n.inputs.length)||0;for(let f=0;f<s;f++){const m=n.inputs[f];if(m.locationType==="location"){const o=US(m.type);e.attributes.push({name:m.name,location:Number(m.location),type:o})}}return e}function US(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function ej(t){try{return new J8(t)}catch(e){if(e instanceof Error)throw e;let i="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(i+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(i+=e.token.line||""),new Error(i,{cause:e})}}const tj={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...tj}};const Rs=globalThis.mathgl.config;function ij(t,{precision:e=Rs.precision}={}){return t=nj(t),`${parseFloat(t.toPrecision(e))}`}function Nh(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function No(t,e,i){return sj(t,n=>Math.max(e,Math.min(i,n)))}function G_(t,e,i){return Nh(t)?t.map((n,s)=>G_(n,e[s],i)):i*e+(1-i)*t}function pp(t,e,i){const n=Rs.EPSILON;try{if(t===e)return!0;if(Nh(t)&&Nh(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!pp(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Rs.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Rs.EPSILON=n}}function nj(t){return Math.round(t/Rs.EPSILON)*Rs.EPSILON}function rj(t){return t.clone?t.clone():new Array(t.length)}function sj(t,e,i){if(Nh(t)){const n=t;i=i||rj(n);for(let s=0;s<i.length&&s<n.length;++s){const u=typeof t=="number"?t:t[s];i[s]=e(u,s,i)}return i}return e(t)}class MR extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,i=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+i];return this.check()}toArray(e=[],i=0){for(let n=0;n<this.ELEMENTS;++n)e[i+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Nh(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Rs)}formatString(e){let i="";for(let n=0;n<this.ELEMENTS;++n)i+=(n>0?", ":"")+ij(this[n],e);return`${e.printTypes?this.constructor.name:""}[${i}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(!pp(this[i],e[i]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(this[i]!==e[i])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,i,n){if(n===void 0)return this.lerp(this,e,i);for(let s=0;s<this.ELEMENTS;++s){const u=e[s],f=typeof i=="number"?i:i[s];this[s]=u+n*(f-u)}return this.check()}min(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(e[i],this[i]);return this.check()}max(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.max(e[i],this[i]);return this.check()}clamp(e,i){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),i[n]);return this.check()}add(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=i[n];return this.check()}subtract(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=i[n];return this.check()}scale(e){if(typeof e=="number")for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;else for(let i=0;i<this.ELEMENTS&&i<e.length;++i)this[i]*=e[i];return this.check()}multiplyByScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}check(){if(Rs.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let i=0;i<this.ELEMENTS;++i)e=e&&Number.isFinite(this[i]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=e;return this.check()}addScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,i){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),i);return this.check()}get elements(){return this}}function oj(t,e){if(t.length!==e)return!1;for(let i=0;i<t.length;++i)if(!Number.isFinite(t[i]))return!1;return!0}function ds(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Ux(t,e,i=""){if(Rs.debug&&!oj(t,e))throw new Error(`math.gl: ${i} some fields set to invalid numbers'`);return t}function VS(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class aj extends MR{get x(){return this[0]}set x(e){this[0]=ds(e)}get y(){return this[1]}set y(e){this[1]=ds(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*this[i];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let i=0;for(let n=0;n<this.ELEMENTS;++n){const s=this[n]-e[n];i+=s*s}return ds(i)}dot(e){let i=0;for(let n=0;n<this.ELEMENTS;++n)i+=this[n]*e[n];return ds(i)}normalize(){const e=this.magnitude();if(e!==0)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e;return this.check()}multiply(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=i[n];return this.check()}divide(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=i[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return VS(e>=0&&e<this.ELEMENTS,"index is out of range"),ds(this[e])}setComponent(e,i){return VS(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=i,this.check()}addVectors(e,i){return this.copy(e).add(i)}subVectors(e,i){return this.copy(e).subtract(i)}multiplyVectors(e,i){return this.copy(e).multiply(i)}addScaledVector(e,i){return this.add(new this.constructor(e).multiplyScalar(i))}}const e_=1e-6;let zh=typeof Float32Array<"u"?Float32Array:Array;function lj(){const t=new zh(2);return zh!=Float32Array&&(t[0]=0,t[1]=0),t}function jS(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function cj(t,e){return t[0]=-e[0],t[1]=-e[1],t}function RR(t,e,i,n){const s=e[0],u=e[1];return t[0]=s+n*(i[0]-s),t[1]=u+n*(i[1]-u),t}function uj(t,e,i){const n=e[0],s=e[1];return t[0]=i[0]*n+i[4]*s+i[12],t[1]=i[1]*n+i[5]*s+i[13],t}(function(){const t=lj();return function(e,i,n,s,u,f){let m,o;for(i||(i=2),n||(n=0),s?o=Math.min(s*i+n,e.length):o=e.length,m=n;m<o;m+=i)t[0]=e[m],t[1]=e[m+1],u(t,t,f),e[m]=t[0],e[m+1]=t[1];return e}})();function hj(t,e,i){const n=e[0],s=e[1],u=i[3]*n+i[7]*s||1;return t[0]=(i[0]*n+i[4]*s)/u,t[1]=(i[1]*n+i[5]*s)/u,t}function PR(t,e,i){const n=e[0],s=e[1],u=e[2],f=i[3]*n+i[7]*s+i[11]*u||1;return t[0]=(i[0]*n+i[4]*s+i[8]*u)/f,t[1]=(i[1]*n+i[5]*s+i[9]*u)/f,t[2]=(i[2]*n+i[6]*s+i[10]*u)/f,t}function fj(t,e,i){const n=e[0],s=e[1];return t[0]=i[0]*n+i[2]*s,t[1]=i[1]*n+i[3]*s,t[2]=e[2],t}function dj(){const t=new zh(3);return zh!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function pj(t){const e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)}function mj(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function gj(t){const e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n}function _j(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function yj(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function xj(t,e,i){const n=e[0],s=e[1],u=e[2],f=i[0],m=i[1],o=i[2];return t[0]=s*o-u*m,t[1]=u*f-n*o,t[2]=n*m-s*f,t}function vj(t,e,i,n){const s=e[0],u=e[1],f=e[2];return t[0]=s+n*(i[0]-s),t[1]=u+n*(i[1]-u),t[2]=f+n*(i[2]-f),t}function kR(t,e,i){const n=e[0],s=e[1],u=e[2];let f=i[3]*n+i[7]*s+i[11]*u+i[15];return f=f||1,t[0]=(i[0]*n+i[4]*s+i[8]*u+i[12])/f,t[1]=(i[1]*n+i[5]*s+i[9]*u+i[13])/f,t[2]=(i[2]*n+i[6]*s+i[10]*u+i[14])/f,t}function bj(t,e,i){const n=e[0],s=e[1],u=e[2];return t[0]=n*i[0]+s*i[3]+u*i[6],t[1]=n*i[1]+s*i[4]+u*i[7],t[2]=n*i[2]+s*i[5]+u*i[8],t}function wj(t,e,i){const n=i[0],s=i[1],u=i[2],f=i[3],m=e[0],o=e[1],v=e[2];let w=s*v-u*o,S=u*m-n*v,R=n*o-s*m,L=s*R-u*S,j=u*w-n*R,Z=n*S-s*w;const re=f*2;return w*=re,S*=re,R*=re,L*=2,j*=2,Z*=2,t[0]=m+w+L,t[1]=o+S+j,t[2]=v+R+Z,t}function Tj(t,e,i,n){const s=[],u=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],u[0]=s[0],u[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),u[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t}function Ej(t,e,i,n){const s=[],u=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],u[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),u[1]=s[1],u[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t}function Aj(t,e,i,n){const s=[],u=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],u[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),u[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),u[2]=s[2],t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t}function Sj(t,e){const i=t[0],n=t[1],s=t[2],u=e[0],f=e[1],m=e[2],o=Math.sqrt((i*i+n*n+s*s)*(u*u+f*f+m*m)),v=o&&yj(t,e)/o;return Math.acos(Math.min(Math.max(v,-1),1))}const DR=mj,Ij=pj,Vx=gj;(function(){const t=dj();return function(e,i,n,s,u,f){let m,o;for(i||(i=3),n||(n=0),s?o=Math.min(s*i+n,e.length):o=e.length,m=n;m<o;m+=i)t[0]=e[m],t[1]=e[m+1],t[2]=e[m+2],u(t,t,f),e[m]=t[0],e[m+1]=t[1],e[m+2]=t[2];return e}})();const jx=[0,0,0];let kg;class $o extends aj{static get ZERO(){return kg||(kg=new $o(0,0,0),Object.freeze(kg)),kg}constructor(e=0,i=0,n=0){super(-0,-0,-0),arguments.length===1&&Nh(e)?this.copy(e):(Rs.debug&&(ds(e),ds(i),ds(n)),this[0]=e,this[1]=i,this[2]=n)}set(e,i,n){return this[0]=e,this[1]=i,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Rs.debug&&(ds(e.x),ds(e.y),ds(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ds(e)}angle(e){return Sj(this,e)}cross(e){return xj(this,this,e),this.check()}rotateX({radians:e,origin:i=jx}){return Tj(this,this,i,e),this.check()}rotateY({radians:e,origin:i=jx}){return Ej(this,this,i,e),this.check()}rotateZ({radians:e,origin:i=jx}){return Aj(this,this,i,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return kR(this,this,e),this.check()}transformAsVector(e){return PR(this,this,e),this.check()}transformByMatrix3(e){return bj(this,this,e),this.check()}transformByMatrix2(e){return fj(this,this,e),this.check()}transformByQuaternion(e){return wj(this,this,e),this.check()}}class Cj extends MR{toString(){let e="[";if(Rs.printRowMajor){e+="row-major:";for(let i=0;i<this.RANK;++i)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+i]}`}else{e+="column-major:";for(let i=0;i<this.ELEMENTS;++i)e+=` ${this[i]}`}return e+="]",e}getElementIndex(e,i){return i*this.RANK+e}getElement(e,i){return this[i*this.RANK+e]}setElement(e,i,n){return this[i*this.RANK+e]=ds(n),this}getColumn(e,i=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let s=0;s<this.RANK;++s)i[s]=this[n+s];return i}setColumn(e,i){const n=e*this.RANK;for(let s=0;s<this.RANK;++s)this[n+s]=i[s];return this}}function Mj(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Rj(t,e){if(t===e){const i=e[1],n=e[2],s=e[3],u=e[6],f=e[7],m=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=u,t[11]=e[14],t[12]=s,t[13]=f,t[14]=m}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function hb(t,e){const i=e[0],n=e[1],s=e[2],u=e[3],f=e[4],m=e[5],o=e[6],v=e[7],w=e[8],S=e[9],R=e[10],L=e[11],j=e[12],Z=e[13],re=e[14],xe=e[15],be=i*m-n*f,ue=i*o-s*f,oe=i*v-u*f,Ie=n*o-s*m,me=n*v-u*m,ot=s*v-u*o,lt=w*Z-S*j,_t=w*re-R*j,rt=w*xe-L*j,Ge=S*re-R*Z,Ut=S*xe-L*Z,Vt=R*xe-L*re;let Ot=be*Vt-ue*Ut+oe*Ge+Ie*rt-me*_t+ot*lt;return Ot?(Ot=1/Ot,t[0]=(m*Vt-o*Ut+v*Ge)*Ot,t[1]=(s*Ut-n*Vt-u*Ge)*Ot,t[2]=(Z*ot-re*me+xe*Ie)*Ot,t[3]=(R*me-S*ot-L*Ie)*Ot,t[4]=(o*rt-f*Vt-v*_t)*Ot,t[5]=(i*Vt-s*rt+u*_t)*Ot,t[6]=(re*oe-j*ot-xe*ue)*Ot,t[7]=(w*ot-R*oe+L*ue)*Ot,t[8]=(f*Ut-m*rt+v*lt)*Ot,t[9]=(n*rt-i*Ut-u*lt)*Ot,t[10]=(j*me-Z*oe+xe*be)*Ot,t[11]=(S*oe-w*me-L*be)*Ot,t[12]=(m*_t-f*Ge-o*lt)*Ot,t[13]=(i*Ge-n*_t+s*lt)*Ot,t[14]=(Z*ue-j*Ie-re*be)*Ot,t[15]=(w*Ie-S*ue+R*be)*Ot,t):null}function Pj(t){const e=t[0],i=t[1],n=t[2],s=t[3],u=t[4],f=t[5],m=t[6],o=t[7],v=t[8],w=t[9],S=t[10],R=t[11],L=t[12],j=t[13],Z=t[14],re=t[15],xe=e*f-i*u,be=e*m-n*u,ue=i*m-n*f,oe=v*j-w*L,Ie=v*Z-S*L,me=w*Z-S*j,ot=e*me-i*Ie+n*oe,lt=u*me-f*Ie+m*oe,_t=v*ue-w*be+S*xe,rt=L*ue-j*be+Z*xe;return o*ot-s*lt+re*_t-R*rt}function Pc(t,e,i){const n=e[0],s=e[1],u=e[2],f=e[3],m=e[4],o=e[5],v=e[6],w=e[7],S=e[8],R=e[9],L=e[10],j=e[11],Z=e[12],re=e[13],xe=e[14],be=e[15];let ue=i[0],oe=i[1],Ie=i[2],me=i[3];return t[0]=ue*n+oe*m+Ie*S+me*Z,t[1]=ue*s+oe*o+Ie*R+me*re,t[2]=ue*u+oe*v+Ie*L+me*xe,t[3]=ue*f+oe*w+Ie*j+me*be,ue=i[4],oe=i[5],Ie=i[6],me=i[7],t[4]=ue*n+oe*m+Ie*S+me*Z,t[5]=ue*s+oe*o+Ie*R+me*re,t[6]=ue*u+oe*v+Ie*L+me*xe,t[7]=ue*f+oe*w+Ie*j+me*be,ue=i[8],oe=i[9],Ie=i[10],me=i[11],t[8]=ue*n+oe*m+Ie*S+me*Z,t[9]=ue*s+oe*o+Ie*R+me*re,t[10]=ue*u+oe*v+Ie*L+me*xe,t[11]=ue*f+oe*w+Ie*j+me*be,ue=i[12],oe=i[13],Ie=i[14],me=i[15],t[12]=ue*n+oe*m+Ie*S+me*Z,t[13]=ue*s+oe*o+Ie*R+me*re,t[14]=ue*u+oe*v+Ie*L+me*xe,t[15]=ue*f+oe*w+Ie*j+me*be,t}function Z_(t,e,i){const n=i[0],s=i[1],u=i[2];let f,m,o,v,w,S,R,L,j,Z,re,xe;return e===t?(t[12]=e[0]*n+e[4]*s+e[8]*u+e[12],t[13]=e[1]*n+e[5]*s+e[9]*u+e[13],t[14]=e[2]*n+e[6]*s+e[10]*u+e[14],t[15]=e[3]*n+e[7]*s+e[11]*u+e[15]):(f=e[0],m=e[1],o=e[2],v=e[3],w=e[4],S=e[5],R=e[6],L=e[7],j=e[8],Z=e[9],re=e[10],xe=e[11],t[0]=f,t[1]=m,t[2]=o,t[3]=v,t[4]=w,t[5]=S,t[6]=R,t[7]=L,t[8]=j,t[9]=Z,t[10]=re,t[11]=xe,t[12]=f*n+w*s+j*u+e[12],t[13]=m*n+S*s+Z*u+e[13],t[14]=o*n+R*s+re*u+e[14],t[15]=v*n+L*s+xe*u+e[15]),t}function F1(t,e,i){const n=i[0],s=i[1],u=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function kj(t,e,i,n){let s=n[0],u=n[1],f=n[2],m=Math.sqrt(s*s+u*u+f*f),o,v,w,S,R,L,j,Z,re,xe,be,ue,oe,Ie,me,ot,lt,_t,rt,Ge,Ut,Vt,Ot,mt;return m<e_?null:(m=1/m,s*=m,u*=m,f*=m,v=Math.sin(i),o=Math.cos(i),w=1-o,S=e[0],R=e[1],L=e[2],j=e[3],Z=e[4],re=e[5],xe=e[6],be=e[7],ue=e[8],oe=e[9],Ie=e[10],me=e[11],ot=s*s*w+o,lt=u*s*w+f*v,_t=f*s*w-u*v,rt=s*u*w-f*v,Ge=u*u*w+o,Ut=f*u*w+s*v,Vt=s*f*w+u*v,Ot=u*f*w-s*v,mt=f*f*w+o,t[0]=S*ot+Z*lt+ue*_t,t[1]=R*ot+re*lt+oe*_t,t[2]=L*ot+xe*lt+Ie*_t,t[3]=j*ot+be*lt+me*_t,t[4]=S*rt+Z*Ge+ue*Ut,t[5]=R*rt+re*Ge+oe*Ut,t[6]=L*rt+xe*Ge+Ie*Ut,t[7]=j*rt+be*Ge+me*Ut,t[8]=S*Vt+Z*Ot+ue*mt,t[9]=R*Vt+re*Ot+oe*mt,t[10]=L*Vt+xe*Ot+Ie*mt,t[11]=j*Vt+be*Ot+me*mt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function OR(t,e,i){const n=Math.sin(i),s=Math.cos(i),u=e[4],f=e[5],m=e[6],o=e[7],v=e[8],w=e[9],S=e[10],R=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*s+v*n,t[5]=f*s+w*n,t[6]=m*s+S*n,t[7]=o*s+R*n,t[8]=v*s-u*n,t[9]=w*s-f*n,t[10]=S*s-m*n,t[11]=R*s-o*n,t}function Dj(t,e,i){const n=Math.sin(i),s=Math.cos(i),u=e[0],f=e[1],m=e[2],o=e[3],v=e[8],w=e[9],S=e[10],R=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*s-v*n,t[1]=f*s-w*n,t[2]=m*s-S*n,t[3]=o*s-R*n,t[8]=u*n+v*s,t[9]=f*n+w*s,t[10]=m*n+S*s,t[11]=o*n+R*s,t}function LR(t,e,i){const n=Math.sin(i),s=Math.cos(i),u=e[0],f=e[1],m=e[2],o=e[3],v=e[4],w=e[5],S=e[6],R=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*s+v*n,t[1]=f*s+w*n,t[2]=m*s+S*n,t[3]=o*s+R*n,t[4]=v*s-u*n,t[5]=w*s-f*n,t[6]=S*s-m*n,t[7]=R*s-o*n,t}function Oj(t,e){const i=e[0],n=e[1],s=e[2],u=e[3],f=i+i,m=n+n,o=s+s,v=i*f,w=n*f,S=n*m,R=s*f,L=s*m,j=s*o,Z=u*f,re=u*m,xe=u*o;return t[0]=1-S-j,t[1]=w+xe,t[2]=R-re,t[3]=0,t[4]=w-xe,t[5]=1-v-j,t[6]=L+Z,t[7]=0,t[8]=R+re,t[9]=L-Z,t[10]=1-v-S,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Lj(t,e,i,n,s,u,f){const m=1/(i-e),o=1/(s-n),v=1/(u-f);return t[0]=u*2*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u*2*o,t[6]=0,t[7]=0,t[8]=(i+e)*m,t[9]=(s+n)*o,t[10]=(f+u)*v,t[11]=-1,t[12]=0,t[13]=0,t[14]=f*u*2*v,t[15]=0,t}function Bj(t,e,i,n,s){const u=1/Math.tan(e/2);if(t[0]=u/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0){const f=1/(n-s);t[10]=(s+n)*f,t[14]=2*s*n*f}else t[10]=-1,t[14]=-2*n;return t}const Fj=Bj;function Nj(t,e,i,n,s,u,f){const m=1/(e-i),o=1/(n-s),v=1/(u-f);return t[0]=-2*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*v,t[11]=0,t[12]=(e+i)*m,t[13]=(s+n)*o,t[14]=(f+u)*v,t[15]=1,t}const zj=Nj;function Uj(t,e,i,n){let s,u,f,m,o,v,w,S,R,L;const j=e[0],Z=e[1],re=e[2],xe=n[0],be=n[1],ue=n[2],oe=i[0],Ie=i[1],me=i[2];return Math.abs(j-oe)<e_&&Math.abs(Z-Ie)<e_&&Math.abs(re-me)<e_?Mj(t):(S=j-oe,R=Z-Ie,L=re-me,s=1/Math.sqrt(S*S+R*R+L*L),S*=s,R*=s,L*=s,u=be*L-ue*R,f=ue*S-xe*L,m=xe*R-be*S,s=Math.sqrt(u*u+f*f+m*m),s?(s=1/s,u*=s,f*=s,m*=s):(u=0,f=0,m=0),o=R*m-L*f,v=L*u-S*m,w=S*f-R*u,s=Math.sqrt(o*o+v*v+w*w),s?(s=1/s,o*=s,v*=s,w*=s):(o=0,v=0,w=0),t[0]=u,t[1]=o,t[2]=S,t[3]=0,t[4]=f,t[5]=v,t[6]=R,t[7]=0,t[8]=m,t[9]=w,t[10]=L,t[11]=0,t[12]=-(u*j+f*Z+m*re),t[13]=-(o*j+v*Z+w*re),t[14]=-(S*j+R*Z+L*re),t[15]=1,t)}function Vj(){const t=new zh(4);return zh!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function BR(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Xh(t,e,i){const n=e[0],s=e[1],u=e[2],f=e[3];return t[0]=i[0]*n+i[4]*s+i[8]*u+i[12]*f,t[1]=i[1]*n+i[5]*s+i[9]*u+i[13]*f,t[2]=i[2]*n+i[6]*s+i[10]*u+i[14]*f,t[3]=i[3]*n+i[7]*s+i[11]*u+i[15]*f,t}(function(){const t=Vj();return function(e,i,n,s,u,f){let m,o;for(i||(i=4),n||(n=0),s?o=Math.min(s*i+n,e.length):o=e.length,m=n;m<o;m+=i)t[0]=e[m],t[1]=e[m+1],t[2]=e[m+2],t[3]=e[m+3],u(t,t,f),e[m]=t[0],e[m+1]=t[1],e[m+2]=t[2],e[m+3]=t[3];return e}})();var fb;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(fb||(fb={}));const jj=45*Math.PI/180,$j=1,$x=.1,Wx=500,Wj=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ro extends Cj{static get IDENTITY(){return Xj()}static get ZERO(){return Hj()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return fb}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,i,n,s,u,f,m,o,v,w,S,R,L,j,Z,re){return this[0]=e,this[1]=i,this[2]=n,this[3]=s,this[4]=u,this[5]=f,this[6]=m,this[7]=o,this[8]=v,this[9]=w,this[10]=S,this[11]=R,this[12]=L,this[13]=j,this[14]=Z,this[15]=re,this.check()}setRowMajor(e,i,n,s,u,f,m,o,v,w,S,R,L,j,Z,re){return this[0]=e,this[1]=u,this[2]=v,this[3]=L,this[4]=i,this[5]=f,this[6]=w,this[7]=j,this[8]=n,this[9]=m,this[10]=S,this[11]=Z,this[12]=s,this[13]=o,this[14]=R,this[15]=re,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Wj)}fromObject(e){return this.check()}fromQuaternion(e){return Oj(this,e),this.check()}frustum(e){const{left:i,right:n,bottom:s,top:u,near:f=$x,far:m=Wx}=e;return m===1/0?qj(this,i,n,s,u,f):Lj(this,i,n,s,u,f,m),this.check()}lookAt(e){const{eye:i,center:n=[0,0,0],up:s=[0,1,0]}=e;return Uj(this,i,n,s),this.check()}ortho(e){const{left:i,right:n,bottom:s,top:u,near:f=$x,far:m=Wx}=e;return zj(this,i,n,s,u,f,m),this.check()}orthographic(e){const{fovy:i=jj,aspect:n=$j,focalDistance:s=1,near:u=$x,far:f=Wx}=e;$S(i);const m=i/2,o=s*Math.tan(m),v=o*n;return this.ortho({left:-v,right:v,bottom:-o,top:o,near:u,far:f})}perspective(e){const{fovy:i=45*Math.PI/180,aspect:n=1,near:s=.1,far:u=500}=e;return $S(i),Fj(this,i,n,s,u),this.check()}determinant(){return Pj(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const n=this.getScale(i),s=1/n[0],u=1/n[1],f=1/n[2];return e[0]=this[0]*s,e[1]=this[1]*u,e[2]=this[2]*f,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*u,e[6]=this[6]*f,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*u,e[10]=this[10]*f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const n=this.getScale(i),s=1/n[0],u=1/n[1],f=1/n[2];return e[0]=this[0]*s,e[1]=this[1]*u,e[2]=this[2]*f,e[3]=this[4]*s,e[4]=this[5]*u,e[5]=this[6]*f,e[6]=this[8]*s,e[7]=this[9]*u,e[8]=this[10]*f,e}transpose(){return Rj(this,this),this.check()}invert(){return hb(this,this),this.check()}multiplyLeft(e){return Pc(this,e,this),this.check()}multiplyRight(e){return Pc(this,this,e),this.check()}rotateX(e){return OR(this,this,e),this.check()}rotateY(e){return Dj(this,this,e),this.check()}rotateZ(e){return LR(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,i){return kj(this,this,e,i),this.check()}scale(e){return F1(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Z_(this,this,e),this.check()}transform(e,i){return e.length===4?(i=Xh(i||[-0,-0,-0,-0],e,this),Ux(i,4),i):this.transformAsPoint(e,i)}transformAsPoint(e,i){const{length:n}=e;let s;switch(n){case 2:s=uj(i||[-0,-0],e,this);break;case 3:s=kR(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ux(s,e.length),s}transformAsVector(e,i){let n;switch(e.length){case 2:n=hj(i||[-0,-0],e,this);break;case 3:n=PR(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Ux(n,e.length),n}transformPoint(e,i){return this.transformAsPoint(e,i)}transformVector(e,i){return this.transformAsPoint(e,i)}transformDirection(e,i){return this.transformAsVector(e,i)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,i,n){return this.identity().translate([e,i,n])}}let Dg,Og;function Hj(){return Dg||(Dg=new ro([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Dg)),Dg}function Xj(){return Og||(Og=new ro,Object.freeze(Og)),Og}function $S(t){if(t>Math.PI*2)throw Error("expected radians")}function qj(t,e,i,n,s,u){const f=2*u/(i-e),m=2*u/(s-n),o=(i+e)/(i-e),v=(s+n)/(s-n),w=-1,S=-1,R=-2*u;return t[0]=f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=m,t[6]=0,t[7]=0,t[8]=o,t[9]=v,t[10]=w,t[11]=S,t[12]=0,t[13]=0,t[14]=R,t[15]=0,t}function FR(t,e=[],i=0){const n=Math.fround(t),s=t-n;return e[i]=n,e[i+1]=s,e}function Gj(t){return t-Math.fround(t)}function Zj(t){const e=new Float32Array(32);for(let i=0;i<4;++i)for(let n=0;n<4;++n){const s=i*4+n;FR(t[n*4+i],e,s*2)}return e}const Yj=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,Kj={name:"fp32",vs:Yj},Jj=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,Qj={ONE:1},e$={name:"fp64arithmetic",vs:Jj,defaultUniforms:Qj,uniformTypes:{ONE:"f32"},fp64ify:FR,fp64LowPart:Gj,fp64ifyMatrix4:Zj},t$=[0,1,1,1],i$=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,n$=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,WS={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:t$},vs:i$,fs:n$,getUniforms:r$};function r$(t={},e){const i={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)i.isHighlightActive=!1;else{i.isHighlightActive=!0;const n=t.highlightedObjectColor.slice(0,3);i.highlightedObjectColor=n}if(t.highlightColor){const n=Array.from(t.highlightColor,s=>s/255);Number.isFinite(n[3])||(n[3]=1),i.highlightColor=n}return t.isActive!==void 0&&(i.isActive=!!t.isActive,i.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(i.useFloatColors=!!t.useFloatColors),i}const HS=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,s$=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,NR=3,o$=255;var mp;(function(t){t[t.POINT=0]="POINT",t[t.DIRECTIONAL=1]="DIRECTIONAL"})(mp||(mp={}));const Zd={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:NR},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:mp.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:s$,vs:HS,fs:HS,getUniforms:a$};function a$(t,e={}){if(t=t&&{...t},!t)return{...Zd.defaultUniforms};t.lights&&(t={...t,...c$(t.lights),lights:void 0});const{ambientLight:i,pointLights:n,directionalLights:s}=t||{};if(!(i||n&&n.length>0||s&&s.length>0))return{...Zd.defaultUniforms,enabled:0};const f={...Zd.defaultUniforms,...e,...l$({ambientLight:i,pointLights:n,directionalLights:s})};return t.enabled!==void 0&&(f.enabled=t.enabled?1:0),f}function l$({ambientLight:t,pointLights:e=[],directionalLights:i=[]}){const n={};n.ambientLightColor=Hx(t);let s=0;for(const u of e){n.lightType=mp.POINT;const f=s;n[`lightColor${f}`]=Hx(u),n[`lightPosition${f}`]=u.position,n[`lightAttenuation${f}`]=u.attenuation||[1,0,0],s++}for(const u of i){n.lightType=mp.DIRECTIONAL;const f=s;n[`lightColor${f}`]=Hx(u),n[`lightDirection${f}`]=u.direction,s++}return s>NR&&Et.warn("MAX_LIGHTS exceeded")(),n.directionalLightCount=i.length,n.pointLightCount=e.length,n}function c$(t){var i,n;const e={pointLights:[],directionalLights:[]};for(const s of t||[])switch(s.type){case"ambient":e.ambientLight=s;break;case"directional":(i=e.directionalLights)==null||i.push(s);break;case"point":(n=e.pointLights)==null||n.push(s);break}return e}function Hx(t={}){const{color:e=[0,0,0],intensity:i=1}=t;return e.map(n=>n*i/o$)}const zR=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,UR=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,VR=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,jR={props:{},name:"gouraudMaterial",vs:UR.replace("phongMaterial","gouraudMaterial"),fs:zR.replace("phongMaterial","gouraudMaterial"),source:VR.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[Zd],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(i=>i/255)),{...jR.defaultUniforms,...e}}},$R={name:"phongMaterial",dependencies:[Zd],source:VR,vs:zR,fs:UR,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(i=>i/255)),{...$R.defaultUniforms,...e}}},XS=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,u$={name:"layer",vs:XS,fs:XS,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},h$=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,WR="#define SMOOTH_EDGE_RADIUS 0.5",f$=`${WR}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,d$=`${WR}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,HR={name:"geometry",source:h$,vs:f$,fs:d$},p$=25;var Wn;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(Wn||(Wn={}));var er;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(er||(er={}));var gi;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(gi||(gi={}));const m$="compute",g$="auto",db="manipulation",t_="none",pb="pan-x",mb="pan-y";function _$(t){if(t.includes(t_))return t_;const e=t.includes(pb),i=t.includes(mb);return e&&i?t_:e||i?e?pb:mb:t.includes(db)?db:g$}class y${constructor(e,i){this.actions="",this.manager=e,this.set(i)}set(e){e===m$&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const i of this.manager.recognizers)i.options.enable&&(e=e.concat(i.getTouchAction()));return _$(e.join(" "))}}function Y_(t){return t.trim().split(/\s+/g)}function Xx(t,e,i){if(t)for(const n of Y_(e))t.addEventListener(n,i,!1)}function qx(t,e,i){if(t)for(const n of Y_(e))t.removeEventListener(n,i,!1)}function qS(t){return(t.ownerDocument||t).defaultView}function x$(t,e){let i=t;for(;i;){if(i===e)return!0;i=i.parentNode}return!1}function XR(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let i=0,n=0,s=0;for(;s<e;)i+=t[s].clientX,n+=t[s].clientY,s++;return{x:Math.round(i/e),y:Math.round(n/e)}}function GS(t){const e=[];let i=0;for(;i<t.pointers.length;)e[i]={clientX:Math.round(t.pointers[i].clientX),clientY:Math.round(t.pointers[i].clientY)},i++;return{timeStamp:Date.now(),pointers:e,center:XR(e),deltaX:t.deltaX,deltaY:t.deltaY}}function qR(t,e){const i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)}function ZS(t,e){const i=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(i*i+n*n)}function v$(t,e){const i=e.x-t.x,n=e.y-t.y;return Math.atan2(n,i)*180/Math.PI}function YS(t,e){const i=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.atan2(n,i)*180/Math.PI}function GR(t,e){return t===e?er.None:Math.abs(t)>=Math.abs(e)?t<0?er.Left:er.Right:e<0?er.Up:er.Down}function b$(t,e){const i=e.center;let n=t.offsetDelta,s=t.prevDelta;const u=t.prevInput;return(e.eventType===Wn.Start||(u==null?void 0:u.eventType)===Wn.End)&&(s=t.prevDelta={x:(u==null?void 0:u.deltaX)||0,y:(u==null?void 0:u.deltaY)||0},n=t.offsetDelta={x:i.x,y:i.y}),{deltaX:s.x+(i.x-n.x),deltaY:s.y+(i.y-n.y)}}function ZR(t,e,i){return{x:e/t||0,y:i/t||0}}function w$(t,e){return ZS(e[0],e[1])/ZS(t[0],t[1])}function T$(t,e){return YS(e[1],e[0])-YS(t[1],t[0])}function E$(t,e){const i=t.lastInterval||e,n=e.timeStamp-i.timeStamp;let s,u,f,m;if(e.eventType!==Wn.Cancel&&(n>p$||i.velocity===void 0)){const o=e.deltaX-i.deltaX,v=e.deltaY-i.deltaY,w=ZR(n,o,v);u=w.x,f=w.y,s=Math.abs(w.x)>Math.abs(w.y)?w.x:w.y,m=GR(o,v),t.lastInterval=e}else s=i.velocity,u=i.velocityX,f=i.velocityY,m=i.direction;e.velocity=s,e.velocityX=u,e.velocityY=f,e.direction=m}function A$(t,e){const{session:i}=t,{pointers:n}=e,{length:s}=n;i.firstInput||(i.firstInput=GS(e)),s>1&&!i.firstMultiple?i.firstMultiple=GS(e):s===1&&(i.firstMultiple=!1);const{firstInput:u,firstMultiple:f}=i,m=f?f.center:u.center,o=e.center=XR(n);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-u.timeStamp,e.angle=v$(m,o),e.distance=qR(m,o);const{deltaX:v,deltaY:w}=b$(i,e);e.deltaX=v,e.deltaY=w,e.offsetDirection=GR(e.deltaX,e.deltaY);const S=ZR(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=S.x,e.overallVelocityY=S.y,e.overallVelocity=Math.abs(S.x)>Math.abs(S.y)?S.x:S.y,e.scale=f?w$(f.pointers,n):1,e.rotation=f?T$(f.pointers,n):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length;let R=t.element;return x$(e.srcEvent.target,R)&&(R=e.srcEvent.target),e.target=R,E$(i,e),e}function S$(t,e,i){const n=i.pointers.length,s=i.changedPointers.length,u=e&Wn.Start&&n-s===0,f=e&(Wn.End|Wn.Cancel)&&n-s===0;i.isFirst=!!u,i.isFinal=!!f,u&&(t.session={}),i.eventType=e;const m=A$(t,i);t.emit("hammer.input",m),t.recognize(m),t.session.prevInput=m}let I$=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=i=>{this.manager.options.enable&&this.handler(i)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,i){S$(this.manager,e,i)}init(){Xx(this.element,this.evEl,this.domHandler),Xx(this.target,this.evTarget,this.domHandler),Xx(qS(this.element),this.evWin,this.domHandler)}destroy(){qx(this.element,this.evEl,this.domHandler),qx(this.target,this.evTarget,this.domHandler),qx(qS(this.element),this.evWin,this.domHandler)}};const C$={pointerdown:Wn.Start,pointermove:Wn.Move,pointerup:Wn.End,pointercancel:Wn.Cancel,pointerout:Wn.Cancel},M$="pointerdown",R$="pointermove pointerup pointercancel";class P$ extends I${constructor(e){super(e),this.evEl=M$,this.evWin=R$,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:i}=this;let n=!1;const s=C$[e.type],u=e.pointerType,f=u==="touch";let m=i.findIndex(o=>o.pointerId===e.pointerId);s&Wn.Start&&(e.buttons||f)?m<0&&(i.push(e),m=i.length-1):s&(Wn.End|Wn.Cancel)&&(n=!0),!(m<0)&&(i[m]=e,this.callback(s,{pointers:i,changedPointers:[e],eventType:s,pointerType:u,srcEvent:e}),n&&i.splice(m,1))}}const k$=["","webkit","Moz","MS","ms","o"];function D$(t,e){const i=e[0].toUpperCase()+e.slice(1);for(const n of k$){const s=n?n+i:e;if(s in t)return s}}const O$=1,KS=2,JS={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class L${constructor(e,i){this.options={...JS,...i,cssProps:{...JS.cssProps,...i.cssProps},inputTarget:i.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new P$(this),this.touchAction=new y$(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?KS:O$}recognize(e){const{session:i}=this;if(i.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let n;const{recognizers:s}=this;let{curRecognizer:u}=i;(!u||u&&u.state&gi.Recognized)&&(u=i.curRecognizer=null);let f=0;for(;f<s.length;)n=s[f],i.stopped!==KS&&(!u||n===u||n.canRecognizeWith(u))?n.recognize(e):n.reset(),!u&&n.state&(gi.Began|gi.Changed|gi.Ended)&&(u=i.curRecognizer=n),f++}get(e){const{recognizers:i}=this;for(let n=0;n<i.length;n++)if(i[n].options.event===e)return i[n];return null}add(e){if(Array.isArray(e)){for(const n of e)this.add(n);return this}const i=this.get(e.options.event);return i&&this.remove(i),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const n of e)this.remove(n);return this}const i=typeof e=="string"?this.get(e):e;if(i){const{recognizers:n}=this,s=n.indexOf(i);s!==-1&&(n.splice(s,1),this.touchAction.update())}return this}on(e,i){if(!e||!i)return;const{handlers:n}=this;for(const s of Y_(e))n[s]=n[s]||[],n[s].push(i)}off(e,i){if(!e)return;const{handlers:n}=this;for(const s of Y_(e))i?n[s]&&n[s].splice(n[s].indexOf(i),1):delete n[s]}emit(e,i){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const s=i;s.type=e,s.preventDefault=function(){i.srcEvent.preventDefault()};let u=0;for(;u<n.length;)n[u](s),u++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:i}=this;if(i){for(const[n,s]of Object.entries(this.options.cssProps)){const u=D$(i.style,n);e?(this.oldCssProps[u]=i.style[u],i.style[u]=s):i.style[u]=this.oldCssProps[u]||""}e||(this.oldCssProps={})}}}let B$=1;function F$(){return B$++}function QS(t){return t&gi.Cancelled?"cancel":t&gi.Ended?"end":t&gi.Changed?"move":t&gi.Began?"start":""}class YR{constructor(e){this.options=e,this.id=F$(),this.state=gi.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const s of e)this.recognizeWith(s);return this}let i;if(typeof e=="string"){if(i=this.manager.get(e),!i)throw new Error(`Cannot find recognizer ${e}`)}else i=e;const{simultaneous:n}=this;return n[i.id]||(n[i.id]=i,i.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const n of e)this.dropRecognizeWith(n);return this}let i;return typeof e=="string"?i=this.manager.get(e):i=e,i&&delete this.simultaneous[i.id],this}requireFailure(e){if(Array.isArray(e)){for(const s of e)this.requireFailure(s);return this}let i;if(typeof e=="string"){if(i=this.manager.get(e),!i)throw new Error(`Cannot find recognizer ${e}`)}else i=e;const{requireFail:n}=this;return n.indexOf(i)===-1&&(n.push(i),i.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const n of e)this.dropRequireFailure(n);return this}let i;if(typeof e=="string"?i=this.manager.get(e):i=e,i){const n=this.requireFail.indexOf(i);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:i}=this;i<gi.Ended&&this.manager.emit(this.options.event+QS(i),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),i>=gi.Ended&&this.manager.emit(this.options.event+QS(i),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=gi.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(gi.Failed|gi.Possible)))return!1;e++}return!0}recognize(e){const i={...e};if(!this.options.enable){this.reset(),this.state=gi.Failed;return}this.state&(gi.Recognized|gi.Cancelled|gi.Failed)&&(this.state=gi.Possible),this.state=this.process(i),this.state&(gi.Began|gi.Changed|gi.Ended|gi.Cancelled)&&this.tryEmit(i)}getEventNames(){return[this.options.event]}reset(){}}class KR extends YR{attrTest(e){const i=this.options.pointers;return i===0||e.pointers.length===i}process(e){const{state:i}=this,{eventType:n}=e,s=i&(gi.Began|gi.Changed),u=this.attrTest(e);return s&&(n&Wn.Cancel||!u)?i|gi.Cancelled:s||u?n&Wn.End?i|gi.Ended:i&gi.Began?i|gi.Changed:gi.Began:gi.Failed}}class e3 extends YR{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[db]}process(e){const{options:i}=this,n=e.pointers.length===i.pointers,s=e.distance<i.threshold,u=e.deltaTime<i.time;if(this.reset(),e.eventType&Wn.Start&&this.count===0)return this.failTimeout();if(s&&u&&n){if(e.eventType!==Wn.End)return this.failTimeout();const f=this.pTime?e.timeStamp-this.pTime<i.interval:!0,m=!this.pCenter||qR(this.pCenter,e.center)<i.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!m||!f?this.count=1:this.count+=1,this._input=e,this.count%i.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=gi.Recognized,this.tryEmit(this._input)},i.interval),gi.Began):gi.Recognized}return gi.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=gi.Failed},this.options.interval),gi.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===gi.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const N$=["","start","move","end","cancel","up","down","left","right"];class t3 extends KR{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:er.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,i=[];return e&er.Horizontal&&i.push(mb),e&er.Vertical&&i.push(pb),i}getEventNames(){return N$.map(e=>this.options.event+e)}directionTest(e){const{options:i}=this;let n=!0,{distance:s}=e,{direction:u}=e;const f=e.deltaX,m=e.deltaY;return u&i.direction||(i.direction&er.Horizontal?(u=f===0?er.None:f<0?er.Left:er.Right,n=f!==this.pX,s=Math.abs(e.deltaX)):(u=m===0?er.None:m<0?er.Up:er.Down,n=m!==this.pY,s=Math.abs(e.deltaY))),e.direction=u,n&&s>i.threshold&&!!(u&i.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&gi.Began)||!(this.state&gi.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const i=er[e.direction].toLowerCase();i&&(e.additionalEvent=this.options.event+i),super.emit(e)}}const z$=["","start","move","end","cancel","in","out"];class U$ extends KR{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[t_]}getEventNames(){return z$.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&gi.Began))}emit(e){if(e.scale!==1){const i=e.scale<1?"in":"out";e.additionalEvent=this.options.event+i}super.emit(e)}}class Ly{constructor(e,i,n){this.element=e,this.callback=i,this.options=n}}const V$=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",j$=V$.indexOf("firefox")!==-1,i3=4.000244140625,$$=40,W$=.25;class H$ extends Ly{constructor(e,i,n){super(e,i,{enable:!0,...n}),this.handleEvent=s=>{if(!this.options.enable)return;let u=s.deltaY;globalThis.WheelEvent&&(j$&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(u/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(u*=$$)),u!==0&&u%i3===0&&(u=Math.floor(u/i3)),s.shiftKey&&u&&(u=u*W$),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-u,srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,i){e==="wheel"&&(this.options.enable=i)}}const n3=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class X$ extends Ly{constructor(e,i,n){super(e,i,{enable:!0,...n}),this.handleEvent=u=>{this.handleOverEvent(u),this.handleOutEvent(u),this.handleEnterEvent(u),this.handleLeaveEvent(u),this.handleMoveEvent(u)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,n3.forEach(u=>e.addEventListener(u,this.handleEvent))}destroy(){n3.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){switch(e){case"pointermove":this.enableMoveEvent=i;break;case"pointerover":this.enableOverEvent=i;break;case"pointerout":this.enableOutEvent=i;break;case"pointerenter":this.enableEnterEvent=i;break;case"pointerleave":this.enableLeaveEvent=i;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,i){this.callback({type:e,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})}}const r3=["keydown","keyup"];class q$ extends Ly{constructor(e,i,n){super(e,i,{enable:!0,tabIndex:0,...n}),this.handleEvent=s=>{const u=s.target||s.srcElement;u.tagName==="INPUT"&&u.type==="text"||u.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",r3.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){r3.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e==="keydown"&&(this.enableDownEvent=i),e==="keyup"&&(this.enableUpEvent=i)}}class G$ extends Ly{constructor(e,i,n){super(e,i,n),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,i){e==="contextmenu"&&(this.options.enable=i)}}const s3=1,gb=2,o3=4,Z$={pointerdown:s3,pointermove:gb,pointerup:o3,mousedown:s3,mousemove:gb,mouseup:o3},Y$=0,K$=1,J$=2,Q$=1,eW=2,tW=4;function iW(t){const e=Z$[t.srcEvent.type];if(!e)return null;const{buttons:i,button:n}=t.srcEvent;let s=!1,u=!1,f=!1;return e===gb?(s=!!(i&Q$),u=!!(i&tW),f=!!(i&eW)):(s=n===Y$,u=n===K$,f=n===J$),{leftButton:s,middleButton:u,rightButton:f}}function nW(t,e){const i=t.center;if(!i)return null;const n=e.getBoundingClientRect(),s=n.width/e.offsetWidth||1,u=n.height/e.offsetHeight||1,f={x:(i.x-n.left-e.clientLeft)/s,y:(i.y-n.top-e.clientTop)/u};return{center:i,offsetCenter:f}}const rW={srcElement:"root",priority:0};class sW{constructor(e,i){this.handleEvent=n=>{if(this.isEmpty())return;const s=this._normalizeEvent(n);let u=n.srcEvent.target;for(;u&&u!==s.rootElement;){if(this._emit(s,u),s.handled)return;u=u.parentNode}this._emit(s,"root")},this.eventManager=e,this.recognizerName=i,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,i,n,s=!1,u=!1){const{handlers:f,handlersByElement:m}=this,o={...rW,...n};let v=m.get(o.srcElement);v||(v=[],m.set(o.srcElement,v));const w={type:e,handler:i,srcElement:o.srcElement,priority:o.priority};s&&(w.once=!0),u&&(w.passive=!0),f.push(w),this._active=this._active||!w.passive;let S=v.length-1;for(;S>=0&&!(v[S].priority>=w.priority);)S--;v.splice(S+1,0,w)}remove(e,i){const{handlers:n,handlersByElement:s}=this;for(let u=n.length-1;u>=0;u--){const f=n[u];if(f.type===e&&f.handler===i){n.splice(u,1);const m=s.get(f.srcElement);m.splice(m.indexOf(f),1),m.length===0&&s.delete(f.srcElement)}}this._active=n.some(u=>!u.passive)}_emit(e,i){const n=this.handlersByElement.get(i);if(n){let s=!1;const u=()=>{e.handled=!0},f=()=>{e.handled=!0,s=!0},m=[];for(let o=0;o<n.length;o++){const{type:v,handler:w,once:S}=n[o];if(w({...e,type:v,stopPropagation:u,stopImmediatePropagation:f}),S&&m.push(n[o]),s)break}for(let o=0;o<m.length;o++){const{type:v,handler:w}=m[o];this.remove(v,w)}}}_normalizeEvent(e){const i=this.eventManager.getElement();return{...e,...iW(e),...nW(e,i),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:i}}}function oW(t){if("recognizer"in t)return t;let e;const i=Array.isArray(t)?[...t]:[t];if(typeof i[0]=="function"){const n=i.shift(),s=i.shift()||{};e=new n(s)}else e=i.shift();return{recognizer:e,recognizeWith:typeof i[0]=="string"?[i[0]]:i[0],requireFailure:typeof i[1]=="string"?[i[1]]:i[1]}}class aW{constructor(e=null,i={}){if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...i},this.events=new Map,this.element=e,!!e){this.manager=new L$(e,this.options);for(const n of this.options.recognizers){const{recognizer:s,recognizeWith:u,requireFailure:f}=oW(n);this.manager.add(s),u&&s.recognizeWith(u),f&&s.requireFailure(f)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new H$(e,this._onOtherEvent,{enable:!1}),this.moveInput=new X$(e,this._onOtherEvent,{enable:!1}),this.keyInput=new q$(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new G$(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,i,n){this._addEventHandler(e,i,n,!1)}once(e,i,n){this._addEventHandler(e,i,n,!0)}watch(e,i,n){this._addEventHandler(e,i,n,!1,!0)}off(e,i){this._removeEventHandler(e,i)}_toggleRecognizer(e,i){var u,f,m,o;const{manager:n}=this;if(!n)return;const s=n.get(e);s&&(s.set({enable:i}),n.touchAction.update()),(u=this.wheelInput)==null||u.enableEventType(e,i),(f=this.moveInput)==null||f.enableEventType(e,i),(m=this.keyInput)==null||m.enableEventType(e,i),(o=this.contextmenuInput)==null||o.enableEventType(e,i)}_addEventHandler(e,i,n,s,u){if(typeof e!="string"){n=i;for(const[v,w]of Object.entries(e))this._addEventHandler(v,w,n,s,u);return}const{manager:f,events:m}=this;if(!f)return;let o=m.get(e);if(!o){const v=this._getRecognizerName(e)||e;o=new sW(this,v),m.set(e,o),f&&f.on(e,o.handleEvent)}o.add(e,i,n,s,u),o.isEmpty()||this._toggleRecognizer(o.recognizerName,!0)}_removeEventHandler(e,i){if(typeof e!="string"){for(const[u,f]of Object.entries(e))this._removeEventHandler(u,f);return}const{events:n}=this,s=n.get(e);if(s&&(s.remove(e,i),s.isEmpty())){const{recognizerName:u}=s;let f=!1;for(const m of n.values())if(m.recognizerName===u&&!m.isEmpty()){f=!0;break}f||this._toggleRecognizer(u,!1)}}_getRecognizerName(e){var i;return(i=this.manager.recognizers.find(n=>n.getEventNames().includes(e)))==null?void 0:i.options.event}}const Pi={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Pi,"IDENTITY",{get:()=>(Gi.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const gs={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Al={common:0,meters:1,pixels:2},_b={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},a3={multipan:[t3,{threshold:10,direction:er.Vertical,pointers:2}],pinch:[U$,{},null,["multipan"]],pan:[t3,{threshold:1},["pinch"],["multipan"]],dblclick:[e3,{event:"dblclick",taps:2}],click:[e3,{event:"click"},null,["dblclick"]]};function lW(t,e){if(t===e)return!0;if(Array.isArray(t)){const i=t.length;if(!e||e.length!==i)return!1;for(let n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}return!1}function Cp(t){let e={},i;return n=>{for(const s in n)if(!lW(n[s],e[s])){i=t(n),e=n;break}return i}}const l3=[0,0,0,0],cW=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],JR=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],uW=[0,0,0],QR=[0,0,0],hW=Cp(pW);function eP(t,e,i=QR){i.length<3&&(i=[i[0],i[1],0]);let n=i,s,u=!0;switch(e===Pi.LNGLAT_OFFSETS||e===Pi.METER_OFFSETS?s=i:s=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case gs.WEB_MERCATOR:(e===Pi.LNGLAT||e===Pi.CARTESIAN)&&(s=[0,0,0],u=!1);break;case gs.WEB_MERCATOR_AUTO_OFFSET:e===Pi.LNGLAT?n=s:e===Pi.CARTESIAN&&(n=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],s=t.unprojectPosition(n),n[0]-=i[0],n[1]-=i[1],n[2]-=i[2]);break;case gs.IDENTITY:n=t.position.map(Math.fround),n[2]=n[2]||0;break;case gs.GLOBE:u=!1,s=null;break;default:u=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:n,offsetMode:u}}function fW(t,e,i){const{viewMatrixUncentered:n,projectionMatrix:s}=t;let{viewMatrix:u,viewProjectionMatrix:f}=t,m=l3,o=l3,v=t.cameraPosition;const{geospatialOrigin:w,shaderCoordinateOrigin:S,offsetMode:R}=eP(t,e,i);return R&&(o=t.projectPosition(w||S),v=[v[0]-o[0],v[1]-o[1],v[2]-o[2]],o[3]=1,m=Xh([],o,f),u=n||u,f=Pc([],s,u),f=Pc([],f,cW)),{viewMatrix:u,viewProjectionMatrix:f,projectionCenter:m,originCommon:o,cameraPosCommon:v,shaderCoordinateOrigin:S,geospatialOrigin:w}}function dW({viewport:t,devicePixelRatio:e=1,modelMatrix:i=null,coordinateSystem:n=Pi.DEFAULT,coordinateOrigin:s=QR,autoWrapLongitude:u=!1}){n===Pi.DEFAULT&&(n=t.isGeospatial?Pi.LNGLAT:Pi.CARTESIAN);const f=hW({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:s});return f.wrapLongitude=u,f.modelMatrix=i||JR,f}function pW({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:n}){const{projectionCenter:s,viewProjectionMatrix:u,originCommon:f,cameraPosCommon:m,shaderCoordinateOrigin:o,geospatialOrigin:v}=fW(t,i,n),w=t.getDistanceScales(),S=[t.width*e,t.height*e],R=Xh([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,L={coordinateSystem:i,projectionMode:t.projectionMode,coordinateOrigin:o,commonOrigin:f.slice(0,3),center:s,pseudoMeters:!!t._pseudoMeters,viewportSize:S,devicePixelRatio:e,focalDistance:R,commonUnitsPerMeter:w.unitsPerMeter,commonUnitsPerWorldUnit:w.unitsPerMeter,commonUnitsPerWorldUnit2:uW,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:u,modelMatrix:JR,cameraPosition:m};if(v){const j=t.getDistanceScales(v);switch(i){case Pi.METER_OFFSETS:L.commonUnitsPerWorldUnit=j.unitsPerMeter,L.commonUnitsPerWorldUnit2=j.unitsPerMeter2;break;case Pi.LNGLAT:case Pi.LNGLAT_OFFSETS:t._pseudoMeters||(L.commonUnitsPerMeter=j.unitsPerMeter),L.commonUnitsPerWorldUnit=j.unitsPerDegree,L.commonUnitsPerWorldUnit2=j.unitsPerDegree2;break;case Pi.CARTESIAN:L.commonUnitsPerWorldUnit=[1,1,j.unitsPerMeter[2]],L.commonUnitsPerWorldUnit2=[0,0,j.unitsPerMeter2[2]];break}}return L}const mW=Object.keys(Pi).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${Pi[t]};`).join(""),gW=Object.keys(gs).map(t=>`const PROJECTION_MODE_${t}: i32 = ${gs[t]};`).join(""),_W=Object.keys(Al).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${Al[t]};`).join(""),yW=`${mW}
${gW}
${_W}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,xW=`${yW}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,vW=Object.keys(Pi).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Pi[t]};`).join(""),bW=Object.keys(gs).map(t=>`const int PROJECTION_MODE_${t} = ${gs[t]};`).join(""),wW=Object.keys(Al).map(t=>`const int UNIT_${t.toUpperCase()} = ${Al[t]};`).join(""),TW=`${vW}
${bW}
${wW}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,EW={};function AW(t=EW){return"viewport"in t?dW(t):{}}const N1={name:"project",dependencies:[Kj,HR],source:xW,vs:TW,getUniforms:AW,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},SW=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,IW=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Mp={name:"project32",dependencies:[N1],source:SW,vs:IW};function CW(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ah(t,e){const i=Xh([],e,t);return BR(i,i,1/i[3]),i}function c3(t,e){const i=t%e;return i<0?e+i:i}function yb(t,e,i){return t<e?e:t>i?i:t}function MW(t){return Math.log(t)*Math.LOG2E}const z1=Math.log2||MW;function Aa(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const eo=Math.PI,tP=eo/4,Ps=eo/180,xb=180/eo,Uh=512,K_=4003e4,J_=85.051129,RW=1.5;function PW(t){return z1(t)}function gp(t){const[e,i]=t;Aa(Number.isFinite(e)),Aa(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const n=e*Ps,s=i*Ps,u=Uh*(n+eo)/(2*eo),f=Uh*(eo+Math.log(Math.tan(tP+s*.5)))/(2*eo);return[u,f]}function Vh(t){const[e,i]=t,n=e/Uh*(2*eo)-eo,s=2*(Math.atan(Math.exp(i/Uh*(2*eo)-eo))-tP);return[n*xb,s*xb]}function kW(t){const{latitude:e}=t;Aa(Number.isFinite(e));const i=Math.cos(e*Ps);return PW(K_*i)-9}function i_(t){const e=Math.cos(t*Ps);return Uh/K_/e}function vb(t){const{latitude:e,longitude:i,highPrecision:n=!1}=t;Aa(Number.isFinite(e)&&Number.isFinite(i));const s=Uh,u=Math.cos(e*Ps),f=s/360,m=f/u,o=s/K_/u,v={unitsPerMeter:[o,o,o],metersPerUnit:[1/o,1/o,1/o],unitsPerDegree:[f,m,o],degreesPerUnit:[1/f,1/m,1/o]};if(n){const w=Ps*Math.tan(e*Ps)/u,S=f*w/2,R=s/K_*w,L=R/m*o;v.unitsPerDegree2=[0,S,R],v.unitsPerMeter2=[L,0,L]}return v}function iP(t,e){const[i,n,s]=t,[u,f,m]=e,{unitsPerMeter:o,unitsPerMeter2:v}=vb({longitude:i,latitude:n,highPrecision:!0}),w=gp(t);w[0]+=u*(o[0]+v[0]*f),w[1]+=f*(o[1]+v[1]*f);const S=Vh(w),R=(s||0)+(m||0);return Number.isFinite(s)||Number.isFinite(m)?[S[0],S[1],R]:S}function DW(t){const{height:e,pitch:i,bearing:n,altitude:s,scale:u,center:f}=t,m=CW();Z_(m,m,[0,0,-s]),OR(m,m,-i*Ps),LR(m,m,n*Ps);const o=u/e;return F1(m,m,[o,o,o]),f&&Z_(m,m,_j([],f)),m}function OW(t){const{width:e,height:i,altitude:n,pitch:s=0,offset:u,center:f,scale:m,nearZMultiplier:o=1,farZMultiplier:v=1}=t;let{fovy:w=_p(RW)}=t;n!==void 0&&(w=_p(n));const S=w*Ps,R=s*Ps,L=U1(w);let j=L;f&&(j+=f[2]*m/Math.cos(R)/i);const Z=S*(.5+(u?u[1]:0)/i),re=Math.sin(Z)*j/Math.sin(yb(Math.PI/2-R-Z,.01,Math.PI-.01)),xe=Math.sin(R)*re+j,be=j*10,ue=Math.min(xe*v,be);return{fov:S,aspect:e/i,focalDistance:L,near:o,far:ue}}function _p(t){return 2*Math.atan(.5/t)*xb}function U1(t){return .5/Math.tan(.5*t*Ps)}function nP(t,e){const[i,n,s=0]=t;return Aa(Number.isFinite(i)&&Number.isFinite(n)&&Number.isFinite(s)),Ah(e,[i,n,s,1])}function V1(t,e,i=0){const[n,s,u]=t;if(Aa(Number.isFinite(n)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(u))return Ah(e,[n,s,u,1]);const f=Ah(e,[n,s,0,1]),m=Ah(e,[n,s,1,1]),o=f[2],v=m[2],w=o===v?0:((i||0)-o)/(v-o);return RR([],f,m,w)}function LW(t){const{width:e,height:i,bounds:n,minExtent:s=0,maxZoom:u=24,offset:f=[0,0]}=t,[[m,o],[v,w]]=n,S=BW(t.padding),R=gp([m,yb(w,-85.051129,J_)]),L=gp([v,yb(o,-85.051129,J_)]),j=[Math.max(Math.abs(L[0]-R[0]),s),Math.max(Math.abs(L[1]-R[1]),s)],Z=[e-S.left-S.right-Math.abs(f[0])*2,i-S.top-S.bottom-Math.abs(f[1])*2];Aa(Z[0]>0&&Z[1]>0);const re=Z[0]/j[0],xe=Z[1]/j[1],be=(S.right-S.left)/2/re,ue=(S.top-S.bottom)/2/xe,oe=[(L[0]+R[0])/2+be,(L[1]+R[1])/2+ue],Ie=Vh(oe),me=Math.min(u,z1(Math.abs(Math.min(re,xe))));return Aa(Number.isFinite(me)),{longitude:Ie[0],latitude:Ie[1],zoom:me}}function BW(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Aa(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const u3=Math.PI/180;function FW(t,e=0){const{width:i,height:n,unproject:s}=t,u={targetZ:e},f=s([0,n],u),m=s([i,n],u);let o,v;const w=t.fovy?.5*t.fovy*u3:Math.atan(.5/t.altitude),S=(90-t.pitch)*u3;return w>S-.01?(o=h3(t,0,e),v=h3(t,i,e)):(o=s([0,0],u),v=s([i,0],u)),[f,m,v,o]}function h3(t,e,i){const{pixelUnprojectionMatrix:n}=t,s=Ah(n,[e,0,1,1]),u=Ah(n,[e,t.height,1,1]),m=(i*t.distanceScales.unitsPerMeter[2]-s[2])/(u[2]-s[2]),o=RR([],s,u,m),v=Vh(o);return v.push(i),v}const f3=512;function NW(t){const{width:e,height:i,pitch:n=0}=t;let{longitude:s,latitude:u,zoom:f,bearing:m=0}=t;(s<-180||s>180)&&(s=c3(s+180,360)-180),(m<-180||m>180)&&(m=c3(m+180,360)-180);const o=z1(i/f3);if(f<=o)f=o,u=0;else{const v=i/2/Math.pow(2,f),w=Vh([0,v])[1];if(u<w)u=w;else{const S=Vh([0,f3-v])[1];u>S&&(u=S)}}return{width:e,height:i,longitude:s,latitude:u,zoom:f,pitch:n,bearing:m}}const rP=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,zW=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,UW=`
${rP}
${zW}
`,VW=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,jW=`
${rP}
${VW}
`,$W=Cp(GW),WW=Cp(ZW),HW=[0,0,0,1],XW=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function qW(t,e){const[i,n,s]=t,u=V1([i,n,s],e);return Number.isFinite(s)?u:[u[0],u[1],0]}function GW({viewport:t,center:e}){return new ro(t.viewProjectionMatrix).invert().transform(e)}function ZW({viewport:t,shadowMatrices:e}){const i=[],n=t.pixelUnprojectionMatrix,s=t.isGeospatial?void 0:1,u=[[0,0,s],[t.width,0,s],[0,t.height,s],[t.width,t.height,s],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(f=>qW(f,n));for(const f of e){const m=f.clone().translate(new $o(t.center).negate()),o=u.map(w=>m.transform(w)),v=new ro().ortho({left:Math.min(...o.map(w=>w[0])),right:Math.max(...o.map(w=>w[0])),bottom:Math.min(...o.map(w=>w[1])),top:Math.max(...o.map(w=>w[1])),near:Math.min(...o.map(w=>-w[2])),far:Math.max(...o.map(w=>-w[2]))});i.push(v.multiplyRight(f))}return i}function YW(t){const{shadowEnabled:e=!0,project:i}=t;if(!e||!i||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const n=N1.getUniforms(i),s=$W({viewport:i.viewport,center:n.center}),u=[],f=WW({shadowMatrices:t.shadowMatrices,viewport:i.viewport}).slice();for(let o=0;o<t.shadowMatrices.length;o++){const v=f[o],w=v.clone().translate(new $o(i.viewport.center).negate());n.coordinateSystem===Pi.LNGLAT&&n.projectionMode===gs.WEB_MERCATOR?(f[o]=w,u[o]=s):(f[o]=v.clone().multiplyRight(XW),u[o]=w.transform(s))}const m={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||HW,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let o=0;o<f.length;o++)m[`viewProjectionMatrix${o}`]=f[o],m[`projectCenter${o}`]=u[o];for(let o=0;o<2;o++)m[`shadow_uShadowMap${o}`]=t.shadowMaps&&t.shadowMaps[o]||t.dummyShadowMap;return m}const d3={name:"shadow",dependencies:[N1],vs:UW,fs:jW,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:YW,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},sP={...WS,defaultUniforms:{...WS.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},KW=[HR],JW=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],QW=[];function e9(t){const e=B_.getDefaultShaderAssembler();for(const n of KW)e.addDefaultModule(n);const i=t==="glsl"?JW:QW;for(const n of i)e.addShaderHook(n);return e}const t9=[255,255,255],i9=1;let n9=0;class r9{constructor(e={}){this.type="ambient";const{color:i=t9}=e,{intensity:n=i9}=e;this.id=e.id||`ambient-${n9++}`,this.color=i,this.intensity=n}}const s9=[255,255,255],o9=1,a9=[0,0,-1];let l9=0;class p3{constructor(e={}){this.type="directional";const{color:i=s9}=e,{intensity:n=o9}=e,{direction:s=a9}=e,{_shadow:u=!1}=e;this.id=e.id||`directional-${l9++}`,this.color=i,this.intensity=n,this.type="directional",this.direction=new $o(s).normalize().toArray(),this.shadow=u}getProjectedLight(e){return this}}class c9{constructor(e,i={id:"pass"}){const{id:n}=i;this.id=n,this.device=e,this.props={...i}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class j1 extends c9{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[i,n]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,u=e.clearColor??(s?[0,0,0,0]:!1),f=s?1:!1,m=s?0:!1,o=e.colorMask??15,v={viewport:[0,0,i,n]};e.colorMask&&(v.colorMask=o),e.scissorRect&&(v.scissorRect=e.scissorRect);const w=this.device.beginRenderPass({framebuffer:e.target,parameters:v,clearColor:u,clearDepth:f,clearStencil:m});try{return this._drawLayers(w,e)}finally{w.end(),this.device.submit()}}_drawLayers(e,i){const{target:n,shaderModuleProps:s,viewports:u,views:f,onViewportActive:m,clearStack:o=!0}=i;i.pass=i.pass||"unknown",o&&(this._lastRenderIndex=-1);const v=[];for(const w of u){const S=f&&f[w.id];m==null||m(w);const R=this._getDrawLayerParams(w,i),L=w.subViewports||[w];for(const j of L){const Z=this._drawLayersInViewport(e,{target:n,shaderModuleProps:s,viewport:j,view:S,pass:i.pass,layers:i.layers},R);v.push(Z)}}return v}_getDrawLayerParams(e,{layers:i,pass:n,isPicking:s=!1,layerFilter:u,cullRect:f,effects:m,shaderModuleProps:o},v=!1){var j;const w=[],S=oP(this._lastRenderIndex+1),R={layer:i[0],viewport:e,isPicking:s,renderPass:n,cullRect:f},L={};for(let Z=0;Z<i.length;Z++){const re=i[Z],xe=this._shouldDrawLayer(re,R,u,L),be={shouldDrawLayer:xe};xe&&!v&&(be.shouldDrawLayer=!0,be.layerRenderIndex=S(re,xe),be.shaderModuleProps=this._getShaderModuleProps(re,m,n,o),be.layerParameters={...(j=re.context.deck)==null?void 0:j.props.parameters,...this.getLayerParameters(re,Z,e)}),w[Z]=be}return w}_drawLayersInViewport(e,{layers:i,shaderModuleProps:n,pass:s,target:u,viewport:f,view:m},o){const v=u9(this.device,{shaderModuleProps:n,target:u,viewport:f});if(m&&m.props.clear){const S=m.props.clear===!0?{color:!0,depth:!0}:m.props.clear;this.device.beginRenderPass({framebuffer:u,parameters:{viewport:v,scissorRect:v},clearColor:S.color?[0,0,0,0]:!1,clearDepth:S.depth?1:!1}).end()}const w={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:v});for(let S=0;S<i.length;S++){const R=i[S],L=o[S],{shouldDrawLayer:j}=L;if(j&&R.props.pickable&&w.pickableCount++,R.isComposite&&w.compositeCount++,R.isDrawable&&L.shouldDrawLayer){const{layerRenderIndex:Z,shaderModuleProps:re,layerParameters:xe}=L;w.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,Z),re.project&&(re.project.viewport=f),R.context.renderPass=e;try{R._drawLayer({renderPass:e,shaderModuleProps:re,uniforms:{layerIndex:Z},parameters:xe})}catch(be){R.raiseError(be,`drawing ${R} to ${s}`)}}}return w}shouldDrawLayer(e){return!0}getShaderModuleProps(e,i,n){return null}getLayerParameters(e,i,n){return e.props.parameters}_shouldDrawLayer(e,i,n,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;i.layer=e;let f=e.parent;for(;f;){if(!f.props.visible||!f.filterSubLayer(i))return!1;i.layer=f,f=f.parent}if(n){const m=i.layer.id;if(m in s||(s[m]=n(i)),!s[m])return!1}return e.activateViewport(i.viewport),!0}_getShaderModuleProps(e,i,n,s){var o,v;const u=this.device.canvasContext.cssToDeviceRatio(),f=((o=e.internalState)==null?void 0:o.propsInTransition)||e.props,m={layer:f,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:u,modelMatrix:f.modelMatrix,coordinateSystem:f.coordinateSystem,coordinateOrigin:f.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(i)for(const w of i)m3(m,(v=w.getShaderModuleProps)==null?void 0:v.call(w,e,m));return m3(m,this.getShaderModuleProps(e,i,m),s)}}function oP(t=0,e={}){const i={},n=(s,u)=>{const f=s.props._offset,m=s.id,o=s.parent&&s.parent.id;let v;if(o&&!(o in e)&&n(s.parent,!1),o in i){const w=i[o]=i[o]||oP(e[o],e);v=w(s,u),i[m]=w}else Number.isFinite(f)?(v=f+(e[o]||0),i[m]=null):v=t;return u&&v>=t&&(t=v+1),e[m]=v,v};return n}function u9(t,{shaderModuleProps:e,target:i,viewport:n}){var o;const s=((o=e==null?void 0:e.project)==null?void 0:o.devicePixelRatio)??t.canvasContext.cssToDeviceRatio(),[,u]=t.canvasContext.getDrawingBufferSize(),f=i?i.height:u,m=n;return[m.x*s,f-(m.y+m.height)*s,m.width*s,m.height*s]}function m3(t,...e){for(const i of e)if(i)for(const n in i)t[n]?Object.assign(t[n],i[n]):t[n]=i[n];return t}class h9 extends j1{constructor(e,i){super(e,i);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),s=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const i=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],u=s.width*n,f=s.height*n,m=[1,1,1,1];(u!==i.width||f!==i.height)&&i.resize({width:u,height:f}),super.render({...e,clearColor:m,target:i,pass:"shadow"})}getLayerParameters(e,i,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,i,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const f9={color:[255,255,255],intensity:1},g3=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],d9=[0,0,0,200/255];class aP{constructor(e={}){this.id="lighting-effect",this.shadowColor=d9,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:i,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(i),n._addDefaultShaderModule(d3),this.dummyShadowMap=i.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const i in e){const n=e[i];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(i=>i.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:i,viewports:n,onViewportActive:s,views:u}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let f=0;f<this.shadowPasses.length;f++)this.shadowPasses[f].render({layers:e,layerFilter:i,viewports:n,onViewportActive:s,views:u,shaderModuleProps:{shadow:{shadowLightId:f,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,i){const n=this.shadow?{project:i.project,shadowMaps:this.shadowPasses.map(f=>f.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(f=>f.getProjectedLight({layer:e})),pointLights:this.pointLights.map(f=>f.getProjectedLight({layer:e}))},u=e.props.material;return{shadow:n,lighting:s,phongMaterial:u,gouraudMaterial:u}}cleanup(e){for(const i of this.shadowPasses)i.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(d3))}_calculateMatrices(){const e=[];for(const i of this.directionalLights){const n=new ro().lookAt({eye:new $o(i.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let i=0;i<this.directionalLights.length;i++){const n=new h9(e);this.shadowPasses[i]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:i,directionalLights:n}=this;!e&&i.length===0&&n.length===0&&(this.ambientLight=new r9(f9),this.directionalLights.push(new p3(g3[0]),new p3(g3[1])))}}class p9{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,i,{size:n=1,type:s,padding:u=0,copy:f=!1,initialize:m=!1,maxCount:o}){const v=s||e&&e.constructor||Float32Array,w=i*n+u;if(ArrayBuffer.isView(e)){if(w<=e.length)return e;if(w*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new v(e.buffer,0,w)}let S=1/0;o&&(S=o*n+u);const R=this._allocate(v,w,m,S);return e&&f?R.set(e):m||R.fill(0,0,4),this._release(e),R}release(e){this._release(e)}_allocate(e,i,n,s){let u=Math.max(Math.ceil(i*this.opts.overAlloc),1);u>s&&(u=s);const f=this._pool,m=e.BYTES_PER_ELEMENT*u,o=f.findIndex(v=>v.byteLength>=m);if(o>=0){const v=new e(f.splice(o,1)[0],0,u);return n&&v.fill(0),v}return new e(u)}_release(e){if(!ArrayBuffer.isView(e))return;const i=this._pool,{buffer:n}=e,{byteLength:s}=n,u=i.findIndex(f=>f.byteLength>=s);u<0?i.push(n):(u>0||i.length<this.opts.poolSize)&&i.splice(u,0,n),i.length>this.opts.poolSize&&i.shift()}}const yp=new p9;function Od(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function m9(t,e){const i=t%e;return i<0?e+i:i}function g9(t){return[t[12],t[13],t[14]]}function _9(t){return{left:lh(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:lh(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:lh(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:lh(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:lh(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:lh(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const _3=new $o;function lh(t,e,i,n){_3.set(t,e,i);const s=_3.len();return{distance:n/s,normal:new $o(-t/s,-e/s,-i/s)}}function y9(t){return t-Math.fround(t)}let bd;function Gx(t,e){const{size:i=1,startIndex:n=0}=e,s=e.endIndex!==void 0?e.endIndex:t.length,u=(s-n)/i;bd=yp.allocate(bd,u,{type:Float32Array,size:i*2});let f=n,m=0;for(;f<s;){for(let o=0;o<i;o++){const v=t[f++];bd[m+o]=v,bd[m+o+i]=y9(v)}m+=i*2}return bd.subarray(0,u*i*2)}function x9(t){let e=null,i=!1;for(const n of t)n&&(e?(i||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],i=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const v9=Math.PI/180,b9=Od(),y3=[0,0,0],w9={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function T9({width:t,height:e,orthographic:i,fovyRadians:n,focalDistance:s,padding:u,near:f,far:m}){const o=t/e,v=i?new ro().orthographic({fovy:n,aspect:o,focalDistance:s,near:f,far:m}):new ro().perspective({fovy:n,aspect:o,near:f,far:m});if(u){const{left:w=0,right:S=0,top:R=0,bottom:L=0}=u,j=No((w+t-S)/2,0,t)-t/2,Z=No((R+e-L)/2,0,e)-e/2;v[8]-=j*2/t,v[9]+=Z*2/e}return v}class Kc{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||w9,this.focalDistance=e.focalDistance||1,this.position=e.position||y3,this.modelMatrix=e.modelMatrix||null;const{longitude:i,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(i),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?gs.WEB_MERCATOR:gs.WEB_MERCATOR_AUTO_OFFSET:gs.IDENTITY}equals(e){return e instanceof Kc?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&pp(e.projectionMatrix,this.projectionMatrix)&&pp(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:i=!0}={}){const n=this.projectPosition(e),s=nP(n,this.pixelProjectionMatrix),[u,f]=s,m=i?f:this.height-f;return e.length===2?[u,m]:[u,m,s[2]]}unproject(e,{topLeft:i=!0,targetZ:n}={}){const[s,u,f]=e,m=i?u:this.height-u,o=n&&n*this.distanceScales.unitsPerMeter[2],v=V1([s,m,f],this.pixelUnprojectionMatrix,o),[w,S,R]=this.unprojectPosition(v);return Number.isFinite(f)?[w,S,R]:Number.isFinite(n)?[w,S,n]:[w,S]}projectPosition(e){const[i,n]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[i,n,s]}unprojectPosition(e){const[i,n]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[i,n,s]}projectFlat(e){if(this.isGeospatial){const i=gp(e);return i[1]=No(i[1],-318,830),i}return e}unprojectFlat(e){return this.isGeospatial?Vh(e):e}getBounds(e={}){const i={targetZ:e.z||0},n=this.unproject([0,0],i),s=this.unproject([this.width,0],i),u=this.unproject([0,this.height],i),f=this.unproject([this.width,this.height],i);return[Math.min(n[0],s[0],u[0],f[0]),Math.min(n[1],s[1],u[1],f[1]),Math.max(n[0],s[0],u[0],f[0]),Math.max(n[1],s[1],u[1],f[1])]}getDistanceScales(e){return e&&this.isGeospatial?vb({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:i,width:n=1,height:s=1}){return e<this.x+this.width&&this.x<e+n&&i<this.y+this.height&&this.y<i+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,_9(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,i){return null}_initProps(e){const i=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=kW({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||vb({latitude:n,longitude:i}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:u,modelMatrix:f}=e;let m=y3;if(u&&(m=f?new ro(f).transformAsVector(u,[]):u),this.isGeospatial){const o=this.projectPosition([i,n,0]);this.center=new $o(m).scale(this.distanceScales.unitsPerMeter).add(o)}else this.center=this.projectPosition(m)}_initMatrices(e){const{viewMatrix:i=b9,projectionMatrix:n=null,orthographic:s=!1,fovyRadians:u,fovy:f=75,near:m=.1,far:o=1e3,padding:v=null,focalDistance:w=1}=e;this.viewMatrixUncentered=i,this.viewMatrix=new ro().multiplyRight(i).translate(new $o(this.center).negate()),this.projectionMatrix=n||T9({width:this.width,height:this.height,orthographic:s,fovyRadians:u||f*v9,focalDistance:w,padding:v,near:m,far:o});const S=Od();Pc(S,S,this.projectionMatrix),Pc(S,S,this.viewMatrix),this.viewProjectionMatrix=S,this.viewMatrixInverse=hb([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=g9(this.viewMatrixInverse);const R=Od(),L=Od();F1(R,R,[this.width/2,-this.height/2,1]),Z_(R,R,[1,-1,0]),Pc(L,R,this.viewProjectionMatrix),this.pixelProjectionMatrix=L,this.pixelUnprojectionMatrix=hb(Od(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Gi.warn("Pixel project matrix not invertible")()}}Kc.displayName="Viewport";class jc extends Kc{constructor(e={}){const{latitude:i=0,longitude:n=0,zoom:s=0,pitch:u=0,bearing:f=0,nearZMultiplier:m=.1,farZMultiplier:o=1.01,nearZ:v,farZ:w,orthographic:S=!1,projectionMatrix:R,repeat:L=!1,worldOffset:j=0,position:Z,padding:re,legacyMeterSizes:xe=!1}=e;let{width:be,height:ue,altitude:oe=1.5}=e;const Ie=Math.pow(2,s);be=be||1,ue=ue||1;let me,ot=null;if(R)oe=R[5]/2,me=_p(oe);else{e.fovy?(me=e.fovy,oe=U1(me)):me=_p(oe);let _t;if(re){const{top:rt=0,bottom:Ge=0}=re;_t=[0,No((rt+ue-Ge)/2,0,ue)-ue/2]}ot=OW({width:be,height:ue,scale:Ie,center:Z&&[0,0,Z[2]*i_(i)],offset:_t,pitch:u,fovy:me,nearZMultiplier:m,farZMultiplier:o}),Number.isFinite(v)&&(ot.near=v),Number.isFinite(w)&&(ot.far=w)}let lt=DW({height:ue,pitch:u,bearing:f,scale:Ie,altitude:oe});j&&(lt=new ro().translate([512*j,0,0]).multiplyLeft(lt)),super({...e,width:be,height:ue,viewMatrix:lt,longitude:n,latitude:i,zoom:s,...ot,fovy:me,focalDistance:oe}),this.latitude=i,this.longitude=n,this.zoom=s,this.pitch=u,this.bearing=f,this.altitude=oe,this.fovy=me,this.orthographic=S,this._subViewports=L?[]:null,this._pseudoMeters=xe,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),i=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let s=i;s<=n;s++){const u=s?new jc({...this,worldOffset:s}):this;this._subViewports.push(u)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[i,n]=this.projectFlat(e),s=(e[2]||0)*i_(e[1]);return[i,n,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[i,n]=this.unprojectFlat(e),s=(e[2]||0)/i_(n);return[i,n,s]}addMetersToLngLat(e,i){return iP(e,i)}panByPosition(e,i){const n=V1(i,this.pixelUnprojectionMatrix),s=this.projectFlat(e),u=jS([],s,cj([],n)),f=jS([],this.center,u),[m,o]=this.unprojectFlat(f);return{longitude:m,latitude:o}}getBounds(e={}){const i=FW(this,e.z||0);return[Math.min(i[0][0],i[1][0],i[2][0],i[3][0]),Math.min(i[0][1],i[1][1],i[2][1],i[3][1]),Math.max(i[0][0],i[1][0],i[2][0],i[3][0]),Math.max(i[0][1],i[1][1],i[2][1],i[3][1])]}fitBounds(e,i={}){const{width:n,height:s}=this,{longitude:u,latitude:f,zoom:m}=LW({width:n,height:s,bounds:e,...i});return new jc({width:n,height:s,longitude:u,latitude:f,zoom:m})}}jc.displayName="WebMercatorViewport";const x3=[0,0,0];function Zx(t,e,i=!1){const n=e.projectPosition(t);if(i&&e instanceof jc){const[s,u,f=0]=t,m=e.getDistanceScales([s,u]);n[2]=f*m.unitsPerMeter[2]}return n}function E9(t){const{viewport:e,modelMatrix:i,coordinateOrigin:n}=t;let{coordinateSystem:s,fromCoordinateSystem:u,fromCoordinateOrigin:f}=t;return s===Pi.DEFAULT&&(s=e.isGeospatial?Pi.LNGLAT:Pi.CARTESIAN),u===void 0&&(u=s),f===void 0&&(f=n),{viewport:e,coordinateSystem:s,coordinateOrigin:n,modelMatrix:i,fromCoordinateSystem:u,fromCoordinateOrigin:f}}function lP(t,{viewport:e,modelMatrix:i,coordinateSystem:n,coordinateOrigin:s,offsetMode:u}){let[f,m,o=0]=t;switch(i&&([f,m,o]=Xh([],[f,m,o,1],i)),n){case Pi.LNGLAT:return Zx([f,m,o],e,u);case Pi.LNGLAT_OFFSETS:return Zx([f+s[0],m+s[1],o+(s[2]||0)],e,u);case Pi.METER_OFFSETS:return Zx(iP(s,[f,m,o]),e,u);case Pi.CARTESIAN:default:return e.isGeospatial?[f+s[0],m+s[1],o+s[2]]:e.projectPosition([f,m,o])}}function A9(t,e){const{viewport:i,coordinateSystem:n,coordinateOrigin:s,modelMatrix:u,fromCoordinateSystem:f,fromCoordinateOrigin:m}=E9(e),{autoOffset:o=!0}=e,{geospatialOrigin:v=x3,shaderCoordinateOrigin:w=x3,offsetMode:S=!1}=o?eP(i,n,s):{},R=lP(t,{viewport:i,modelMatrix:u,coordinateSystem:f,coordinateOrigin:m,offsetMode:S});if(S){const L=i.projectPosition(v||w);DR(R,R,L)}return R}let S9=1,I9=1;class cP{constructor(){q(this,"time",0);q(this,"channels",new Map);q(this,"animations",new Map);q(this,"playing",!1);q(this,"lastEngineTime",-1)}addChannel(e){const{delay:i=0,duration:n=Number.POSITIVE_INFINITY,rate:s=1,repeat:u=1}=e,f=S9++,m={time:0,delay:i,duration:n,rate:s,repeat:u};return this._setChannelTime(m,this.time),this.channels.set(f,m),f}removeChannel(e){this.channels.delete(e);for(const[i,n]of this.animations)n.channel===e&&this.detachAnimation(i)}isFinished(e){const i=this.channels.get(e);return i===void 0?!1:this.time>=i.delay+i.duration*i.repeat}getTime(e){if(e===void 0)return this.time;const i=this.channels.get(e);return i===void 0?-1:i.time}setTime(e){this.time=Math.max(0,e);const i=this.channels.values();for(const s of i)this._setChannelTime(s,this.time);const n=this.animations.values();for(const s of n){const{animation:u,channel:f}=s;u.setTime(this.getTime(f))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,i){const n=I9++;return this.animations.set(n,{animation:e,channel:i}),e.setTime(this.getTime(i)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,i){const n=i-e.delay,s=e.duration*e.repeat;n>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}function C9(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function M9(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let R9=0;const P9={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:tb.stats.get(`animation-loop-${R9++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class k9{constructor(e){q(this,"device",null);q(this,"canvas",null);q(this,"props");q(this,"animationProps",null);q(this,"timeline",null);q(this,"stats");q(this,"cpuTime");q(this,"gpuTime");q(this,"frameRate");q(this,"display");q(this,"needsRedraw","initialized");q(this,"_initialized",!1);q(this,"_running",!1);q(this,"_animationFrameId",null);q(this,"_nextFramePromise",null);q(this,"_resolveNextFrame",null);q(this,"_cpuStartTime",0);q(this,"_error",null);if(this.props={...P9,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:i=!0}=this.props;this.stats=e.stats||new ky({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:i}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var n,s;if(this.props.onError(e),this._error=Error(),((s=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:s.canvas)instanceof HTMLCanvasElement){const u=document.createElement("h1");u.innerHTML=e.message,u.style.position="absolute",u.style.top="20%",u.style.left="10px",u.style.color="black",u.style.backgroundColor="red",document.body.appendChild(u)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const i=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(i),i}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=C9(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(M9(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var i;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(i=this.device)==null||i.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var i,n;const e=(n=(i=this.device)==null?void 0:i.canvasContext)==null?void 0:n.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:i,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=i,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const i=document.createElement("div");i.style.position="absolute",i.style.left="10px",i.style.bottom="10px",i.style.width="300px",i.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(i);const n=this.props.onAddHTML(i);n&&(i.innerHTML=n)}}_getSizeAndAspect(){var u,f,m,o;if(!this.device)return{width:1,height:1,aspect:1};const[e,i]=((f=(u=this.device)==null?void 0:u.canvasContext)==null?void 0:f.getPixelSize())||[1,1];let n=1;const s=(o=(m=this.device)==null?void 0:m.canvasContext)==null?void 0:o.canvas;return s&&s.clientHeight?n=s.clientWidth/s.clientHeight:e>0&&i>0&&(n=e/i),{width:e,height:i,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,i;this.props.autoResizeDrawingBuffer&&((i=(e=this.device)==null?void 0:e.canvasContext)==null||i.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Yx={};function By(t="id"){Yx[t]=Yx[t]||1;const e=Yx[t]++;return`${t}-${e}`}class v3{constructor(e){q(this,"id");q(this,"userData",{});q(this,"topology");q(this,"bufferLayout",[]);q(this,"vertexCount");q(this,"indices");q(this,"attributes");if(this.id=e.id||By("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&yn.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const i of Object.values(this.attributes))i.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function D9(t,e){if(e instanceof v3)return e;const i=O9(t,e),{attributes:n,bufferLayout:s}=L9(t,e);return new v3({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:i,attributes:n})}function O9(t,e){if(!e.indices)return;const i=e.indices.value;return t.createBuffer({usage:yn.INDEX,data:i})}function L9(t,e){const i=[],n={};for(const[u,f]of Object.entries(e.attributes)){let m=u;switch(u){case"POSITION":m="positions";break;case"NORMAL":m="normals";break;case"TEXCOORD_0":m="texCoords";break;case"COLOR_0":m="colors";break}if(f){n[m]=t.createBuffer({data:f.value,id:`${u}-buffer`});const{value:o,size:v,normalized:w}=f;i.push({name:m,format:E8(o,v,w)})}}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:i,vertexCount:s}}const _y=class _y{constructor(e){q(this,"device");q(this,"destroyPolicy");q(this,"_hashCounter",0);q(this,"_hashes",{});q(this,"_renderPipelineCache",{});q(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new _y(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const i={...Bh.defaultProps,...e},n=this._hashRenderPipeline(i);if(!this._renderPipelineCache[n]){const s=this.device.createRenderPipeline({...i,id:i.id?`${i.id}-cached`:void 0});s.hash=n,this._renderPipelineCache[n]={pipeline:s,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const i={...V_.defaultProps,...e},n=this._hashComputePipeline(i);if(!this._computePipelineCache[n]){const s=this.device.createComputePipeline({...i,id:i.id?`${i.id}-cached`:void 0});s.hash=n,this._computePipelineCache[n]={pipeline:s,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const i=e.hash,n=e instanceof V_?this._computePipelineCache:this._renderPipelineCache;n[i].useCount--,n[i].useCount===0&&this.destroyPolicy==="unused"&&(n[i].pipeline.destroy(),delete n[i])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const i=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,s="-",u=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${i}/${n}V${s}BL${u}`;default:const f=this._getHash(JSON.stringify(e.parameters));return`${i}/${n}V${s}T${e.topology}P${f}BL${u}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};q(_y,"defaultProps",{...Bh.defaultProps});let bb=_y;const yy=class yy{constructor(e){q(this,"device");q(this,"destroyPolicy");q(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var i;return(i=e._lumaData).defaultShaderFactory||(i.defaultShaderFactory=new yy(e)),e._lumaData.defaultShaderFactory}createShader(e){const i=this._hashShader(e);let n=this._cache[i];if(!n){const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[i]=n={shader:s,useCount:0}}return n.useCount++,n.shader}release(e){const i=this._hashShader(e),n=this._cache[i];n&&(n.useCount--,n.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[i],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};q(yy,"defaultProps",{...N_.defaultProps});let wb=yy;function B9(t,e){var s;const i={},n="Values";if(t.attributes.length===0&&!((s=t.varyings)!=null&&s.length))return{"No attributes or varyings":{[n]:"N/A"}};for(const u of t.attributes)if(u){const f=`${u.location} ${u.name}: ${u.type}`;i[`in ${f}`]={[n]:u.stepMode||"vertex"}}for(const u of t.varyings||[]){const f=`${u.location} ${u.name}`;i[`out ${f}`]={[n]:JSON.stringify(u)}}return i}let cr=null,bc=null;function F9(t,{id:e,minimap:i,opaque:n,top:s="0",left:u="0",rgbaScale:f=1}){cr||(cr=document.createElement("canvas"),cr.id=e,cr.title=e,cr.style.zIndex="100",cr.style.position="absolute",cr.style.top=s,cr.style.left=u,cr.style.border="blue 5px solid",cr.style.transform="scaleY(-1)",document.body.appendChild(cr),bc=cr.getContext("2d")),(cr.width!==t.width||cr.height!==t.height)&&(cr.width=t.width/2,cr.height=t.height/2,cr.style.width="400px",cr.style.height="400px");const m=t.device.readPixelsToArrayWebGL(t),o=bc==null?void 0:bc.createImageData(t.width,t.height);if(o){for(let w=0;w<m.length;w+=4)o.data[0+w+0]=m[w+0]*f,o.data[0+w+1]=m[w+1]*f,o.data[0+w+2]=m[w+2]*f,o.data[0+w+3]=n?255:m[w+3]*f;bc==null||bc.putImageData(o,0,0)}}function Tb(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Tb(t[n],e[n],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(const u of n)if(!e.hasOwnProperty(u)||!Tb(t[u],e[u],i-1))return!1;return!0}return!1}function N9(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function z9(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function uP(t){return N9(t)||z9(t)}function U9(t){return uP(t)||typeof t=="number"||typeof t=="boolean"}function hP(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(i=>{const n=t[i];U9(n)?e.uniforms[i]=n:e.bindings[i]=n}),e}class V9{constructor(e,i){q(this,"options",{disableWarnings:!1});q(this,"modules");q(this,"moduleUniforms");q(this,"moduleBindings");Object.assign(this.options,i);const n=I1(Object.values(e).filter(s=>s.dependencies));for(const s of n)e[s.name]=s;Et.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[s,u]of Object.entries(e))this._addModule(u),u.name&&s!==u.name&&!this.options.disableWarnings&&Et.warn(`Module name: ${s} vs ${u.name}`)()}destroy(){}setProps(e){var i;for(const n of Object.keys(e)){const s=n,u=e[s]||{},f=this.modules[s];if(!f){this.options.disableWarnings||Et.warn(`Module ${n} not found`)();continue}const m=this.moduleUniforms[s],o=this.moduleBindings[s],v=((i=f.getUniforms)==null?void 0:i.call(f,u,m))||u,{uniforms:w,bindings:S}=hP(v);this.moduleUniforms[s]={...m,...w},this.moduleBindings[s]={...o,...S}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const i of Object.values(this.moduleBindings))Object.assign(e,i);return e}getDebugTable(){var i;const e={};for(const[n,s]of Object.entries(this.moduleUniforms))for(const[u,f]of Object.entries(s))e[`${n}.${u}`]={type:(i=this.modules[n].uniformTypes)==null?void 0:i[u],value:String(f)};return e}_addModule(e){const i=e.name;this.moduleUniforms[i]=e.defaultUniforms||{},this.moduleBindings[i]={}}}let j9="";async function $9(t,e){const i=new Image;return i.crossOrigin="anonymous",i.src=t.startsWith("http")?t:j9+t,await i.decode(),e?await createImageBitmap(i,e):await createImageBitmap(i)}class Kx{constructor(e,i){q(this,"device");q(this,"id");q(this,"texture");q(this,"sampler");q(this,"view");q(this,"ready");q(this,"isReady",!1);q(this,"destroyed",!1);q(this,"resolveReady",()=>{});q(this,"rejectReady",()=>{});this.device=e,this.id=i.id||By("async-texture"),typeof(i==null?void 0:i.data)=="string"&&i.dimension==="2d"&&(i={...i,data:$9(i.data)}),this.ready=new Promise((n,s)=>{this.resolveReady=()=>{this.isReady=!0,n()},this.rejectReady=s}),this.initAsync(i)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){let i,n;const s=e.data,u=await fP(s).then(i,n);if(this.destroyed)return;const f={...e,data:u};this.texture=this.device.createTexture(f),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const i=this.texture;this.texture=i.clone(e),i.destroy()}return!0}}async function fP(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(fP));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,i=await Promise.all(Object.values(e)),n=Object.keys(e),s={};for(let u=0;u<n.length;u++)s[n[u]]=i[u];return s}return t}const wc=2,W9=1e4,xy=class xy{constructor(e,i){q(this,"device");q(this,"id");q(this,"source");q(this,"vs");q(this,"fs");q(this,"pipelineFactory");q(this,"shaderFactory");q(this,"userData",{});q(this,"parameters");q(this,"topology");q(this,"bufferLayout");q(this,"isInstanced");q(this,"instanceCount",0);q(this,"vertexCount");q(this,"indexBuffer",null);q(this,"bufferAttributes",{});q(this,"constantAttributes",{});q(this,"bindings",{});q(this,"uniforms",{});q(this,"vertexArray");q(this,"transformFeedback",null);q(this,"pipeline");q(this,"shaderInputs");q(this,"_uniformStore");q(this,"_attributeInfos",{});q(this,"_gpuGeometry",null);q(this,"_getModuleUniforms");q(this,"props");q(this,"_pipelineNeedsUpdate","newly created");q(this,"_needsRedraw","initializing");q(this,"_destroyed",!1);q(this,"_lastDrawTimestamp",-1);q(this,"_lastLogTime",0);q(this,"_logOpen",!1);q(this,"_drawCount",0);var o,v,w,S;this.props={...xy.defaultProps,...i},i=this.props,this.id=i.id||By("model"),this.device=e,Object.assign(this.userData,i.userData);const n=Object.fromEntries(((o=this.props.modules)==null?void 0:o.map(R=>[R.name,R]))||[]),s=i.shaderInputs||new V9(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);const u=X9(e),f=(((v=this.props.modules)==null?void 0:v.length)>0?this.props.modules:(w=this.shaderInputs)==null?void 0:w.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:R,getUniforms:L}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:u,...this.props,modules:f});this.source=R,this._getModuleUniforms=L,(S=this.props).shaderLayout||(S.shaderLayout=Q8(this.source))}else{const{vs:R,fs:L,getUniforms:j}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:u,...this.props,modules:f});this.vs=R,this.fs=L,this._getModuleUniforms=j}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,i.geometry&&this.setGeometry(i.geometry),this.pipelineFactory=i.pipelineFactory||bb.getDefaultPipelineFactory(this.device),this.shaderFactory=i.shaderFactory||wb.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in i&&(this.isInstanced=i.isInstanced),i.instanceCount&&this.setInstanceCount(i.instanceCount),i.vertexCount&&this.setVertexCount(i.vertexCount),i.indexBuffer&&this.setIndexBuffer(i.indexBuffer),i.attributes&&this.setAttributes(i.attributes),i.constantAttributes&&this.setConstantAttributes(i.constantAttributes),i.bindings&&this.setBindings(i.bindings),i.uniforms&&this.setUniformsWebGL(i.uniforms),i.moduleSettings&&this.updateModuleSettingsWebGL(i.moduleSettings),i.transformFeedback&&(this.transformFeedback=i.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const i=this._areBindingsLoading();if(i)return Et.info(wc,`>>> DRAWING ABORTED ${this.id}: ${i} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings}),Eb(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:u}=this.vertexArray,f=u?u.byteLength/(u.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:f,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var n;(n=this._gpuGeometry)==null||n.destroy();const i=e&&D9(this.device,e);if(i){this.setTopology(i.topology||"triangle-list");const s=new Bx(this.bufferLayout);this.bufferLayout=s.mergeBufferLayouts(i.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(i)}this._gpuGeometry=i}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const i=new Bx(this.bufferLayout);this.bufferLayout=this._gpuGeometry?i.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Tb(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new T8(this.shaderInputs.modules);for(const[i,n]of Object.entries(this.shaderInputs.modules))if(H9(n)){const s=this._uniformStore.getManagedUniformBuffer(this.device,i);this.bindings[`${i}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,i){const n=(i==null?void 0:i.disableWarnings)??this.props.disableWarnings;e.indices&&Et.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();const s=new Bx(this.bufferLayout);for(const[u,f]of Object.entries(e)){const m=s.getBufferLayout(u);if(!m){n||Et.warn(`Model(${this.id}): Missing layout for buffer "${u}".`)();continue}const o=s.getAttributeNamesForBuffer(m);let v=!1;for(const w of o){const S=this._attributeInfos[w];S&&(this.vertexArray.setBuffer(S.location,f),v=!0)}!v&&!n&&Et.warn(`Model(${this.id}): Ignoring buffer "${f.id}" for unknown attribute "${u}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,i){for(const[n,s]of Object.entries(e)){const u=this._attributeInfos[n];u?this.vertexArray.setConstantWebGL(u.location,s):((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)||Et.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){Eb(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:i,uniforms:n}=hP(this._getModuleUniforms(e));Object.assign(this.bindings,i),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Kx&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[i,n]of Object.entries(this.bindings))n instanceof Kx?n.isReady&&(e[i]=n.texture):e[i]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const i of Object.values(this.bindings))i instanceof F_?e=Math.max(e,i.texture.updateTimestamp):i instanceof yn||i instanceof kn?e=Math.max(e,i.updateTimestamp):i instanceof Kx?e=i.texture?Math.max(e,i.texture.updateTimestamp):1/0:i instanceof z_||(e=Math.max(e,i.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const i={...e.attributes};for(const[n]of Object.entries(i))!this.pipeline.shaderLayout.attributes.find(s=>s.name===n)&&n!=="positions"&&delete i[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(i,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,i=null;this.pipeline&&(Et.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,i=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=n:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:s}),this._attributeInfos=rR(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),i&&this.shaderFactory.release(i)}return this.pipeline}_logDrawCallStart(){const e=Et.level>3?0:W9;Et.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Et.group(wc,`>>> DRAWING MODEL ${this.id}`,{collapsed:Et.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=B9(this.pipeline.shaderLayout,this.id);Et.table(wc,e)();const i=this.shaderInputs.getDebugTable();for(const[s,u]of Object.entries(this.uniforms))i[s]={value:u};Et.table(wc,i)();const n=this._getAttributeDebugTable();Et.table(wc,this._attributeInfos)(),Et.table(wc,n)(),Et.groupEnd(wc)(),this._logOpen=!1}}_logFramebuffer(e){const i=this.device.props.debugFramebuffers;if(this._drawCount++,!i)return;const n=e.props.framebuffer;n&&F9(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[i,n]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[n.location];e[n.location]={name:i,type:n.shaderType,values:s?this._getBufferOrConstantValues(s,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:i}=this.vertexArray,n=i.indexType==="uint32"?new Uint32Array(i.debugData):new Uint16Array(i.debugData);e.indices={name:"indices",type:i.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,i){const n=aR(i);return(e instanceof yn?new n(e.debugData):e).toString()}};q(xy,"defaultProps",{...Bh.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:B_.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Wo=xy;function H9(t){return!!(t.uniformTypes&&!Eb(t.uniformTypes))}function X9(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function Eb(t){for(const e in t)return!1;return!0}const ep=class ep{constructor(e,i=ep.defaultProps){q(this,"device");q(this,"model");q(this,"transformFeedback");if(!ep.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Wo(this.device,{id:i.id||"buffer-transform-model",fs:i.fs||YM(),topology:i.topology||"point-list",varyings:i.outputs||i.varyings,...i}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:i.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var i;return((i=e==null?void 0:e.info)==null?void 0:i.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const i=this.device.beginRenderPass(e);this.model.draw(i),i.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const i=this.getBuffer(e);if(!i)throw new Error("BufferTransform#getBuffer");if(i instanceof yn)return i.readAsync();const{buffer:n,byteOffset:s=0,byteLength:u=n.byteLength}=i;return n.readAsync(s,u)}};q(ep,"defaultProps",{...Wo.defaultProps,outputs:void 0,feedbackBuffers:void 0});let jh=ep;const q9="transform_output";class b3{constructor(e,i){q(this,"device");q(this,"model");q(this,"sampler");q(this,"currentIndex",0);q(this,"samplerTextureMap",null);q(this,"bindings",[]);q(this,"resources",{});this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Wo(this.device,{id:i.id||"texture-transform-model",fs:i.fs||YM({input:i.targetTextureVarying,inputChannels:i.targetTextureChannels,output:q9}),vertexCount:i.vertexCount,...i}),this._initialize(i),Object.seal(this)}destroy(){var e;this.model.destroy();for(const i of this.bindings)(e=i.framebuffer)==null||e.destroy()}delete(){this.destroy()}run(e){const{framebuffer:i}=this.bindings[this.currentIndex],n=this.device.beginRenderPass({framebuffer:i,...e});this.model.draw(n),n.end()}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:i,sourceTextures:n,targetTexture:s}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,n),Object.assign(e.sourceBuffers,i),s){e.targetTexture=s;const{width:u,height:f}=s;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:u,height:f,colorAttachments:[s]}),e.framebuffer.resize({width:u,height:f})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:i}=this.bindings[e];for(const n in i)i[n].sampler=this.sampler}}class dP{constructor(e){q(this,"id");q(this,"topology");q(this,"vertexCount");q(this,"indices");q(this,"attributes");q(this,"userData",{});const{attributes:i={},indices:n=null,vertexCount:s=null}=e;this.id=e.id||By("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[u,f]of Object.entries(i)){const m=ArrayBuffer.isView(f)?{value:f}:f;if(!ArrayBuffer.isView(m.value))throw new Error(`${this._print(u)}: must be typed array or object with value as typed array`);if((u==="POSITION"||u==="positions")&&!m.size&&(m.size=3),u==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=m}else this.attributes[u]=m}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,i){return this}_calculateVertexCount(e,i){if(i)return i.value.length;let n=1/0;for(const s of Object.values(e)){const{value:u,size:f,constant:m}=s;!m&&u&&f!==void 0&&f>=1&&(n=Math.min(n,u.length/f))}return n}}const G9={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class pP extends j1{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:i,views:n,viewports:s,onViewportActive:u,pickingFBO:f,deviceRect:{x:m,y:o,width:v,height:w},cullRect:S,effects:R,pass:L="picking",pickZ:j,shaderModuleProps:Z}){this.pickZ=j;const re=this._resetColorEncoder(j),xe=[m,o,v,w],be=super.render({target:f,layers:e,layerFilter:i,views:n,viewports:s,onViewportActive:u,cullRect:S,effects:R==null?void 0:R.filter(oe=>oe.useInPicking),pass:L,isPicking:!0,shaderModuleProps:Z,clearColor:[0,0,0,0],colorMask:15,scissorRect:xe});return this._colorEncoderState=null,{decodePickingColor:re&&Y9.bind(null,re),stats:be}}shouldDrawLayer(e){const{pickable:i,operation:n}=e.props;return i&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,i,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,i,n){const s={...e.props.parameters},{pickable:u,operation:f}=e.props;return!this._colorEncoderState||f.includes("terrain")?s.blend=!1:u&&f.includes("draw")&&(Object.assign(s,G9),s.blend=!0,s.blendColor=Z9(this._colorEncoderState,e,n)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function Z9(t,e,i){const{byLayer:n,byAlpha:s}=t;let u,f=n.get(e);return f?(f.viewports.push(i),u=f.a):(u=n.size+1,u<=255?(f={a:u,layer:e,viewports:[i]},n.set(e,f),s[u]=f):(Gi.warn("Too many pickable layers, only picking the first 255")(),u=0)),[0,0,0,u/255]}function Y9(t,e){const i=t.byAlpha[e[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(e)}}const fh={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Q_=Symbol.for("component"),wl=Symbol.for("propTypes"),Jx=Symbol.for("deprecatedProps"),Sh=Symbol.for("asyncPropDefaults"),$c=Symbol.for("asyncPropOriginal"),yl=Symbol.for("asyncPropResolved");function $h(t,e=()=>!0){return Array.isArray(t)?mP(t,e,[]):e(t)?[t]:[]}function mP(t,e,i){let n=-1;for(;++n<t.length;){const s=t[n];Array.isArray(s)?mP(s,e,i):e(s)&&i.push(s)}return i}function K9({target:t,source:e,start:i=0,count:n=1}){const s=e.length,u=n*s;let f=0;for(let m=i;f<s;f++)t[m++]=e[f];for(;f<u;)f<u-f?(t.copyWithin(i+f,i,i+f),f*=2):(t.copyWithin(i+f,i,i+u-f),f=u);return t}class J9{constructor(e,i,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(i)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,i){if(e===this._data&&!i)return;this._data=e;const n=++this._loadCount;let s=e;typeof e=="string"&&(s=Gv(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(u=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=u)}).catch(u=>{this._loadCount===n&&(this.isLoaded=!0,this._error=u||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const u of this._subscribers)u.onChange(this.getData())}}class Q9{constructor(e){var i;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(i=e.device)==null?void 0:i.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:i,forceUpdate:n=!1,persistent:s=!0}){let u=this._resources[e];u?u.setData(i,n):(u=new J9(e,i,this._context),this._resources[e]=u),u.persistent=s}remove(e){const i=this._resources[e];i&&(i.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const i=this._consumers[e];if(i){for(const n in i){const s=i[n],u=this._resources[s.resourceId];u&&u.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:i,consumerId:n,requestId:s="default"}){const{_resources:u,protocol:f}=this;e.startsWith(f)&&(e=e.replace(f,""),u[e]||this.add({resourceId:e,data:null,persistent:!1}));const m=u[e];if(this._track(n,s,m,i),m)return m.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,i,n,s){const u=this._consumers,f=u[e]=u[e]||{};let m=f[i];const o=m&&m.resourceId&&this._resources[m.resourceId];o&&(o.unsubscribe(m),this.prune()),n&&(m?(m.onChange=s,m.resourceId=n.id):m={onChange:s,resourceId:n.id},f[i]=m,n.subscribe(m))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const i=this._resources[e];!i.persistent&&!i.inUse()&&(i.delete(),delete this._resources[e])}}}const e7="layerManager.setLayers",t7="layerManager.activateViewport";class i7{constructor(e,i){var m;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=o=>{Mr(t7,this,o),o&&(this.context.viewport=o)};const{deck:n,stats:s,viewport:u,timeline:f}=i||{};this.layers=[],this.resourceManager=new Q9({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:n,shaderAssembler:e9(((m=e==null?void 0:e.info)==null?void 0:m.shadingLanguage)||"glsl"),defaultShaderModules:[u$],renderPass:void 0,stats:s||new ky({id:"deck.gl"}),viewport:u||new Kc({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:f||new cP,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const s=n.getNeedsRedraw(e);i=i||s}return i}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(i=>e.find(n=>i.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,i){Mr(e7,this,i,e),this._lastRenderedLayers=e;const n=$h(e,Boolean);for(const s of n)s.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:i}=this.context;i.find(n=>n.name===e.name)||(i.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:i}=this.context,n=i.findIndex(s=>s.name===e.name);n>=0&&(i.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,i,n){n.raiseError(i,`${e} of ${n}`)}_updateLayers(e,i){const n={};for(const f of e)n[f.id]?Gi.warn(`Multiple old layers with same id ${f.id}`)():n[f.id]=f;if(this._defaultShaderModulesChanged){for(const f of e)f.setNeedsUpdate(),f.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(i,n,s),this._finalizeOldLayers(n);let u=!1;for(const f of s)if(f.hasUniformTransition()){u=`Uniform transition in ${f}`;break}this._needsUpdate=u,this.layers=s}_updateSublayersRecursively(e,i,n){for(const s of e){s.context=this.context;const u=i[s.id];u===null&&Gi.warn(`Multiple new layers with same id ${s.id}`)(),i[s.id]=null;let f=null;try{this._debug&&u!==s&&s.validateProps(),u?(this._transferLayerState(u,s),this._updateLayer(s)):this._initializeLayer(s),n.push(s),f=s.isComposite?s.getSubLayers():null}catch(m){this._handleError("matching",m,s)}f&&this._updateSublayersRecursively(f,i,n)}}_finalizeOldLayers(e){for(const i in e){const n=e[i];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=fh.INITIALIZED}catch(i){this._handleError("initialization",i,e)}}_transferLayerState(e,i){i._transferState(e),i.lifecycle=fh.MATCHED,i!==e&&(e.lifecycle=fh.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(i){this._handleError("update",i,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=fh.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=fh.FINALIZED}catch(i){this._handleError("finalization",i,e)}}}function ts(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!ts(t[n],e[n],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(const u of n)if(!e.hasOwnProperty(u)||!ts(t[u],e[u],i-1))return!1;return!0}return!1}class n7{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const i=this.controllers[e];i&&i.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const i=this.controllers[e];i&&i.updateTransition()}}getViewports(e){return e?this._viewports.filter(i=>i.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(i=>{e[i.id]=i}),e}getView(e){return this.views.find(i=>i.id===e)}getViewState(e){const i=typeof e=="string"?this.getView(e):e,n=i&&this.viewState[i.getViewStateId()]||this.viewState;return i?i.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,i){const n=this.getViewports(),s={x:e[0],y:e[1]};for(let u=n.length-1;u>=0;--u){const f=n[u];if(f.containsPixel(s)){const m=e.slice();return m[0]-=f.x,m[1]-=f.y,f.unproject(m,i)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,i){(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,this.setNeedsUpdate("Size changed"))}_setViews(e){e=$h(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!ts(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Gi.warn("missing `viewState` or `initialViewState`")()}_createController(e,i){const n=i.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:u=>{var f;return(f=this.getView(e.id))==null?void 0:f.makeViewport({viewState:u,width:this.width,height:this.height})}})}_updateController(e,i,n,s){const u=e.controller;if(u&&n){const f={...i,...u,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!s||s.constructor!==u.type)&&(s=this._createController(e,f)),s&&s.setProps(f),s}return null}_rebuildViewports(){const{views:e}=this,i=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let s=e.length;s--;){const u=e[s],f=this.getViewState(u),m=u.makeViewport({viewState:f,width:this.width,height:this.height});let o=i[u.id];const v=!!u.controller;v&&!o&&(n=!0),(n||!v)&&o&&(o.finalize(),o=null),this.controllers[u.id]=this._updateController(u,f,m,o),m&&this._viewports.unshift(m)}for(const s in i){const u=i[s];u&&!this.controllers[s]&&u.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,i){return e.length!==i.length?!0:e.some((n,s)=>!e[s].equals(i[s]))}}const r7=/([0-9]+\.?[0-9]*)(%|px)/;function al(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=r7.exec(t);if(e&&e.length>=3){const i=e[2]==="%",n=parseFloat(e[1]);return{position:i?n/100:n,relative:i}}default:throw new Error(`Could not parse position string ${t}`)}}function ll(t,e){return t.relative?Math.round(t.position*e):t.position}class gP{constructor(e){const{id:i,x:n=0,y:s=0,width:u="100%",height:f="100%",padding:m=null}=e;this.id=i||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=al(n),this._y=al(s),this._width=al(u),this._height=al(f),this._padding=m&&{left:al(m.left||0),right:al(m.right||0),top:al(m.top||0),bottom:al(m.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&ts(this.props,e.props,2)}makeViewport({width:e,height:i,viewState:n}){n=this.filterViewState(n);const s=this.getDimensions({width:e,height:i});if(!s.height||!s.width)return null;const u=this.getViewportType(n);return new u({...n,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const i={...e};for(const n in this.props.viewState)n!=="id"&&(i[n]=this.props.viewState[n]);return i}return e}getDimensions({width:e,height:i}){const n={x:ll(this._x,e),y:ll(this._y,i),width:ll(this._width,e),height:ll(this._height,i)};return this._padding&&(n.padding={left:ll(this._padding.left,e),top:ll(this._padding.top,i),right:ll(this._padding.right,e),bottom:ll(this._padding.bottom,i)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Fy{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var i,n;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)==null||n.call(i,this)}end(){var e,i;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(i=(e=this.settings).onEnd)==null||i.call(e,this))}cancel(){var e,i;this._inProgress&&((i=(e=this.settings).onInterrupt)==null||i.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,i;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:s}=this;this._handle=n.addChannel({delay:n.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(i=(e=this.settings).onUpdate)==null||i.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const w3=()=>{},Ab={BREAK:1,SNAP_TO_END:2,IGNORE:3},s7=t=>t,o7=Ab.BREAK;class a7{constructor(e){this._onTransitionUpdate=i=>{const{time:n,settings:{interpolator:s,startProps:u,endProps:f,duration:m,easing:o}}=i,v=o(n/m),w=s.interpolateProps(u,f,v);this.propsInTransition=this.getControllerState({...this.props,...w}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Fy(e.timeline),this.onViewStateChange=e.onViewStateChange||w3,this.onStateChange=e.onStateChange||w3}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let i=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let s=n;if(this.transition.inProgress){const{interruption:u,endProps:f}=this.transition.settings;s={...n,...u===Ab.SNAP_TO_END?f:this.propsInTransition||n}}this._triggerTransition(s,e),i=!0}else this.transition.cancel();return i}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:i,transitionInterpolator:n}=e;return(i>0||i==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,i){return this.transition.inProgress?this.transition.settings.interruption===Ab.IGNORE||this._isUpdateDueToCurrentTransition(i):this._isTransitionEnabled(i)?i.transitionInterpolator.arePropsEqual(e,i):!0}_triggerTransition(e,i){const n=this.getControllerState(e),s=this.getControllerState(i).shortestPathFrom(n),u=i.transitionInterpolator,f=u.getDuration?u.getDuration(e,i):i.transitionDuration;if(f===0)return;const m=u.initializeProps(e,s);this.propsInTransition={};const o={duration:f,easing:i.transitionEasing||s7,interpolator:u,interruption:i.transitionInterruption||o7,startProps:m.start,endProps:m.end,onStart:i.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(i.onTransitionInterrupt),onEnd:this._onTransitionEnd(i.onTransitionEnd)};this.transition.start(o),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return i=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(i)}}}function tr(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class l7{constructor(e){const{compare:i,extract:n,required:s}=e;this._propsToCompare=i,this._propsToExtract=n||i,this._requiredProps=s}arePropsEqual(e,i){for(const n of this._propsToCompare)if(!(n in e)||!(n in i)||!pp(e[n],i[n]))return!1;return!0}initializeProps(e,i){const n={},s={};for(const u of this._propsToExtract)(u in e||u in i)&&(n[u]=e[u],s[u]=i[u]);return this._checkRequiredProps(n),this._checkRequiredProps(s),{start:n,end:s}}getDuration(e,i){return i.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(i=>{const n=e[i];tr(Number.isFinite(n)||Array.isArray(n),`${i} is required for transition`)})}}const c7=["longitude","latitude","zoom","bearing","pitch"],u7=["longitude","latitude","zoom"];class $1 extends l7{constructor(e={}){const i=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(i)?{compare:i,required:i}:i||{compare:c7,required:u7},super(n.transitionProps),this.opts=n}initializeProps(e,i){const n=super.initializeProps(e,i),{makeViewport:s,around:u}=this.opts;if(s&&u){const f=s(e),m=s(i),o=f.unproject(u);n.start.around=u,Object.assign(n.end,{around:m.project(o),aroundPosition:o,width:i.width,height:i.height})}return n}interpolateProps(e,i,n){const s={};for(const u of this._propsToExtract)s[u]=G_(e[u]||0,i[u]||0,n);if(i.aroundPosition&&this.opts.makeViewport){const u=this.opts.makeViewport({...i,...s});Object.assign(s,u.panByPosition(i.aroundPosition,G_(e.around,i.around,n)))}return s}}const cl={transitionDuration:0},h7=300,Lg=t=>1-(1-t)*(1-t),ch={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Tc={};class _P{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new a7({...e,getControllerState:i=>new this.ControllerState(i),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const i in this._events)this._events[i]&&((e=this.eventManager)==null||e.off(i,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const i=this._eventStartBlocked;switch(e.type){case"panstart":return i?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return i?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return i?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:i,y:n}=this.props,{offsetCenter:s}=e;return[s.x-i,s.y-n]}isPointInBounds(e,i){const{width:n,height:s}=this.props;if(i&&i.handled)return!1;const u=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=s;return u&&i&&i.stopPropagation(),u}isFunctionKeyPressed(e){const{srcEvent:i}=e;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const i=setTimeout(()=>{this._eventStartBlocked===i&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=i}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:i}=e;this.inertia=Number.isFinite(i)?i:i===!0?h7:0;const{scrollZoom:n=!0,dragPan:s=!0,dragRotate:u=!0,doubleClickZoom:f=!0,touchZoom:m=!0,touchRotate:o=!1,keyboard:v=!0}=e,w=!!this.onViewStateChange;this.toggleEvents(ch.WHEEL,w&&n),this.toggleEvents(ch.PAN,w),this.toggleEvents(ch.PINCH,w&&(m||o)),this.toggleEvents(ch.MULTI_PAN,w&&o),this.toggleEvents(ch.DOUBLE_CLICK,w&&f),this.toggleEvents(ch.KEYBOARD,w&&v),this.scrollZoom=n,this.dragPan=s,this.dragRotate=u,this.doubleClickZoom=f,this.touchZoom=m,this.touchRotate=o,this.keyboard=v}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,i){this.eventManager&&e.forEach(n=>{this._events[n]!==i&&(this._events[n]=i,i?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,i=null,n={}){const s={...e.getViewportProps(),...i},u=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),u){const f=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:f,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const s=this.controllerState[n?"panStart":"rotateStart"]({pos:i});return this._panMove=n,this.updateViewport(s,cl,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const i=this.getCenter(e),n=this.controllerState.pan({pos:i});return this.updateViewport(n,cl,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:i}=this;if(this.dragPan&&i&&e.velocity){const n=this.getCenter(e),s=[n[0]+e.velocityX*i/2,n[1]+e.velocityY*i/2],u=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:Lg},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const i=this.getCenter(e),n=this.controllerState.rotate({pos:i});return this.updateViewport(n,cl,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:i}=this;if(this.dragRotate&&i&&e.velocity){const n=this.getCenter(e),s=[n[0]+e.velocityX*i/2,n[1]+e.velocityY*i/2],u=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:Lg},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:u}=e;let f=2/(1+Math.exp(-Math.abs(u*n)));u<0&&f!==0&&(f=1/f);const m=this.controllerState.zoom({pos:i,scale:f});return this.updateViewport(m,{...this._getTransitionProps({around:i}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const n=this.controllerState.rotateStart({pos:i});return this.updateViewport(n,cl,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const i=this.getCenter(e);i[0]-=e.deltaX;const n=this.controllerState.rotate({pos:i});return this.updateViewport(n,cl,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this;if(this.touchRotate&&i&&e.velocityY){const n=this.getCenter(e),s=[n[0],n[1]+=e.velocityY*i/2],u=this.controllerState.rotate({pos:s});this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:Lg},{isDragging:!1,isRotating:!0}),this.blockEvents(i)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const n=this.controllerState.zoomStart({pos:i}).rotateStart({pos:i});return Tc._startPinchRotation=e.rotation,Tc._lastPinchEvent=e,this.updateViewport(n,cl,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let i=this.controllerState;if(this.touchZoom){const{scale:n}=e,s=this.getCenter(e);i=i.zoom({pos:s,scale:n})}if(this.touchRotate){const{rotation:n}=e;i=i.rotate({deltaAngleX:Tc._startPinchRotation-n})}return this.updateViewport(i,cl,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Tc._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this,{_lastPinchEvent:n}=Tc;if(this.touchZoom&&i&&n&&e.scale!==n.scale){const s=this.getCenter(e);let u=this.controllerState.rotateEnd();const f=Math.log2(e.scale),m=(f-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),o=Math.pow(2,f+m*i/2);u=u.zoom({pos:s,scale:o}).zoomEnd(),this.updateViewport(u,{...this._getTransitionProps({around:s}),transitionDuration:i,transitionEasing:Lg},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(i)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Tc._startPinchRotation=null,Tc._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const n=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:i,scale:n?.5:2});return this.updateViewport(s,this._getTransitionProps({around:i}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const i=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:s,rotateSpeedX:u,rotateSpeedY:f}=this.keyboard===!0?{}:this.keyboard,{controllerState:m}=this;let o;const v={};switch(e.srcEvent.code){case"Minus":o=i?m.zoomOut(n).zoomOut(n):m.zoomOut(n),v.isZooming=!0;break;case"Equal":o=i?m.zoomIn(n).zoomIn(n):m.zoomIn(n),v.isZooming=!0;break;case"ArrowLeft":i?(o=m.rotateLeft(u),v.isRotating=!0):(o=m.moveLeft(s),v.isPanning=!0);break;case"ArrowRight":i?(o=m.rotateRight(u),v.isRotating=!0):(o=m.moveRight(s),v.isPanning=!0);break;case"ArrowUp":i?(o=m.rotateUp(f),v.isRotating=!0):(o=m.moveUp(s),v.isPanning=!0);break;case"ArrowDown":i?(o=m.rotateDown(f),v.isRotating=!0):(o=m.moveDown(s),v.isPanning=!0);break;default:return!1}return this.updateViewport(o,this._getTransitionProps(),v),!0}_getTransitionProps(e){const{transition:i}=this;return!i||!i.transitionInterpolator?cl:e?{...i,transitionInterpolator:new $1({...e,...i.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:i}}class f7{constructor(e,i){this._viewportProps=this.applyConstraints(e),this._state=i}getViewportProps(){return this._viewportProps}getState(){return this._state}}const T3=5,d7=1.2;class yP extends f7{constructor(e){const{width:i,height:n,latitude:s,longitude:u,zoom:f,bearing:m=0,pitch:o=0,altitude:v=1.5,position:w=[0,0,0],maxZoom:S=20,minZoom:R=0,maxPitch:L=60,minPitch:j=0,startPanLngLat:Z,startZoomLngLat:re,startRotatePos:xe,startBearing:be,startPitch:ue,startZoom:oe,normalize:Ie=!0}=e;tr(Number.isFinite(u)),tr(Number.isFinite(s)),tr(Number.isFinite(f)),super({width:i,height:n,latitude:s,longitude:u,zoom:f,bearing:m,pitch:o,altitude:v,maxZoom:S,minZoom:R,maxPitch:L,minPitch:j,normalize:Ie,position:w},{startPanLngLat:Z,startZoomLngLat:re,startRotatePos:xe,startBearing:be,startPitch:ue,startZoom:oe}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:i}){const n=this.getState().startPanLngLat||this._unproject(i);if(!n)return this;const u=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(u)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:i=0,deltaAngleY:n=0}){const{startRotatePos:s,startBearing:u,startPitch:f}=this.getState();if(!s||u===void 0||f===void 0)return this;let m;return e?m=this._getNewRotation(e,s,f,u):m={bearing:u+i,pitch:f+n},this._getUpdatedState(m)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:i,scale:n}){let{startZoom:s,startZoomLngLat:u}=this.getState();if(u||(s=this.getViewportProps().zoom,u=this._unproject(i)||this._unproject(e)),!u)return this;const{maxZoom:f,minZoom:m}=this.getViewportProps();let o=s+Math.log2(n);o=No(o,m,f);const v=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...v.panByPosition(u,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const i=e.getViewportProps(),n={...this.getViewportProps()},{bearing:s,longitude:u}=n;return Math.abs(s-i.bearing)>180&&(n.bearing=s<0?s+360:s-360),Math.abs(u-i.longitude)>180&&(n.longitude=u<0?u+360:u-360),n}applyConstraints(e){const{maxZoom:i,minZoom:n,zoom:s}=e;e.zoom=No(s,n,i);const{maxPitch:u,minPitch:f,pitch:m}=e;e.pitch=No(m,f,u);const{normalize:o=!0}=e;return o&&Object.assign(e,NW(e)),e}_zoomFromCenter(e){const{width:i,height:n}=this.getViewportProps();return this.zoom({pos:[i/2,n/2],scale:e})}_panFromCenter(e){const{width:i,height:n}=this.getViewportProps();return this.pan({startPos:[i/2,n/2],pos:[i/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const i=this.makeViewport(this.getViewportProps());return e&&i.unproject(e)}_getNewRotation(e,i,n,s){const u=e[0]-i[0],f=e[1]-i[1],m=e[1],o=i[1],{width:v,height:w}=this.getViewportProps(),S=u/v;let R=0;f>0?Math.abs(w-o)>T3&&(R=f/(o-w)*d7):f<0&&o>T3&&(R=1-m/o),R=No(R,-1,1);const{minPitch:L,maxPitch:j}=this.getViewportProps(),Z=s+180*S;let re=n;return R>0?re=n+R*(j-n):R<0&&(re=n-R*(L-n)),{pitch:re,bearing:Z}}}class p7 extends _P{constructor(){super(...arguments),this.ControllerState=yP,this.transition={transitionDuration:300,transitionInterpolator:new $1({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const i=this.props;super.setProps(e),(!i||i.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class W1 extends gP{constructor(e={}){super(e)}getViewportType(){return jc}get ControllerType(){return p7}}W1.displayName="MapView";const m7=new aP;function g7(t,e){const i=t.order??1/0,n=e.order??1/0;return i-n}class _7{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const i=this._defaultEffects;if(!i.find(n=>n.id===e.id)){const n=i.findIndex(s=>g7(s,e)>0);n<0?i.push(e):i.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(ts(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}getEffects(){return this._resolvedEffects}_setEffects(e){const i={};for(const s of this.effects)i[s.id]=s;const n=[];for(const s of e){const u=i[s.id];let f=s;u&&u!==s?u.setProps?(u.setProps(s.props),f=u):u.cleanup(this._context):u||s.setup(this._context),n.push(f),delete i[s.id]}for(const s in i)i[s].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(s=>s instanceof aP)||this._resolvedEffects.push(m7),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class y7 extends j1{shouldDrawLayer(e){const{operation:i}=e.props;return i.includes("draw")||i.includes("terrain")}}const x7="deckRenderer.renderLayers";class v7{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new y7(e),this.pickLayersPass=new pP(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const i=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const s=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const u=i.render({...n,target:s});n.effects&&this._postRender(n.effects,n),this.renderCount++,Mr(x7,this,u,e)}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}finalize(){const{renderBuffers:e}=this;for(const i of e)i.delete();e.length=0}_preRender(e,i){this.lastPostProcessEffect=null,i.preRenderStats=i.preRenderStats||{};for(const n of e)i.preRenderStats[n.id]=n.preRender(i),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,i=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(n=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[s]}))});for(const n of e)n.resize(i)}_postRender(e,i){const{renderBuffers:n}=this,s={...i,inputBuffer:n[0],swapBuffer:n[1]};for(const u of e)if(u.postRender){s.target=u.id===this.lastPostProcessEffect?i.target:void 0;const f=u.postRender(s);s.inputBuffer=f,s.swapBuffer=f===n[0]?n[1]:n[0]}}}const b7={pickedColor:null,pickedObjectIndex:-1};function w7({pickedColors:t,decodePickingColor:e,deviceX:i,deviceY:n,deviceRadius:s,deviceRect:u}){const{x:f,y:m,width:o,height:v}=u;let w=s*s,S=-1,R=0;for(let L=0;L<v;L++){const j=L+m-n,Z=j*j;if(Z>w)R+=4*o;else for(let re=0;re<o;re++){if(t[R+3]-1>=0){const be=re+f-i,ue=be*be+Z;ue<=w&&(w=ue,S=R)}R+=4}}if(S>=0){const L=t.slice(S,S+4),j=e(L);if(j){const Z=Math.floor(S/4/o),re=S/4-Z*o;return{...j,pickedColor:L,pickedX:f+re,pickedY:m+Z}}Gi.error("Picked non-existent layer. Is picking buffer corrupt?")()}return b7}function T7({pickedColors:t,decodePickingColor:e}){const i=new Map;if(t){for(let n=0;n<t.length;n+=4)if(t[n+3]-1>=0){const u=t.slice(n,n+4),f=u.join(",");if(!i.has(f)){const m=e(u);m?i.set(f,{...m,color:u}):Gi.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function xP({pickInfo:t,viewports:e,pixelRatio:i,x:n,y:s,z:u}){let f=e[0];e.length>1&&(f=A7((t==null?void 0:t.pickedViewports)||e,{x:n,y:s}));let m;if(f){const o=[n-f.x,s-f.y];u!==void 0&&(o[2]=u),m=f.unproject(o)}return{color:null,layer:null,viewport:f,index:-1,picked:!1,x:n,y:s,pixel:[n,s],coordinate:m,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:i}}function E7(t){const{pickInfo:e,lastPickedInfo:i,mode:n,layers:s}=t,{pickedColor:u,pickedLayer:f,pickedObjectIndex:m}=e,o=f?[f]:[];if(n==="hover"){const S=i.index,R=i.layerId,L=f?f.props.id:null;if(L!==R||m!==S){if(L!==R){const j=s.find(Z=>Z.props.id===R);j&&o.unshift(j)}i.layerId=L,i.index=m,i.info=null}}const v=xP(t),w=new Map;return w.set(null,v),o.forEach(S=>{let R={...v};S===f&&(R.color=u,R.index=m,R.picked=!0),R=vP({layer:S,info:R,mode:n});const L=R.layer;S===f&&n==="hover"&&(i.info=R),w.set(L.id,R),n==="hover"&&L.updateAutoHighlight(R)}),w}function vP({layer:t,info:e,mode:i}){for(;t&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=t,e=t.getPickingInfo({info:e,mode:i,sourceLayer:n}),t=t.parent}return e}function A7(t,e){for(let i=t.length-1;i>=0;i--){const n=t[i];if(n.containsPixel(e))return n}return t[0]}class S7{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new pP(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:i,layers:n,viewports:s},u=this.lastPickedInfo.info){const f=u&&u.layer&&u.layer.id,m=u&&u.viewport&&u.viewport.id,o=f?n.find(R=>R.id===f):null,v=m&&s.find(R=>R.id===m)||s[0],w=v&&v.unproject([e-v.x,i-v.y]);return{...u,...{x:e,y:i,viewport:v,coordinate:w,layer:o}}}_resizeBuffer(){var i,n;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const s=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=s}const{canvas:e}=this.device.getDefaultCanvasContext();(i=this.pickingFBO)==null||i.resize({width:e.width,height:e.height}),(n=this.depthFBO)==null||n.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const i=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return i.length?i:null}_pickClosestObject({layers:e,views:i,viewports:n,x:s,y:u,radius:f=0,depth:m=1,mode:o="query",unproject3D:v,onViewportActive:w,effects:S}){const R=this.device.canvasContext.cssToDeviceRatio(),L=this._getPickable(e);if(!L||n.length===0)return{result:[],emptyInfo:xP({viewports:n,x:s,y:u,pixelRatio:R})};this._resizeBuffer();const j=this.device.canvasContext.cssToDevicePixels([s,u],!0),Z=[j.x+Math.floor(j.width/2),j.y+Math.floor(j.height/2)],re=Math.round(f*R),{width:xe,height:be}=this.pickingFBO,ue=this._getPickingRect({deviceX:Z[0],deviceY:Z[1],deviceRadius:re,deviceWidth:xe,deviceHeight:be}),oe={x:s-f,y:u-f,width:f*2+1,height:f*2+1};let Ie;const me=[],ot=new Set;for(let lt=0;lt<m;lt++){let _t;if(ue){const Ge=this._drawAndSample({layers:L,views:i,viewports:n,onViewportActive:w,deviceRect:ue,cullRect:oe,effects:S,pass:`picking:${o}`});_t=w7({...Ge,deviceX:Z[0],deviceY:Z[1],deviceRadius:re,deviceRect:ue})}else _t={pickedColor:null,pickedObjectIndex:-1};let rt;if(_t.pickedLayer&&v&&this.depthFBO){const{pickedColors:Ge}=this._drawAndSample({layers:[_t.pickedLayer],views:i,viewports:n,onViewportActive:w,deviceRect:{x:_t.pickedX,y:_t.pickedY,width:1,height:1},cullRect:oe,effects:S,pass:`picking:${o}:z`},!0);Ge[3]&&(rt=Ge[0])}_t.pickedLayer&&lt+1<m&&(ot.add(_t.pickedLayer),_t.pickedLayer.disablePickingIndex(_t.pickedObjectIndex)),Ie=E7({pickInfo:_t,lastPickedInfo:this.lastPickedInfo,mode:o,layers:L,viewports:n,x:s,y:u,z:rt,pixelRatio:R});for(const Ge of Ie.values())Ge.layer&&me.push(Ge);if(!_t.pickedColor)break}for(const lt of ot)lt.restorePickingColors();return{result:me,emptyInfo:Ie.get(null)}}_pickVisibleObjects({layers:e,views:i,viewports:n,x:s,y:u,width:f=1,height:m=1,mode:o="query",maxObjects:v=null,onViewportActive:w,effects:S}){const R=this._getPickable(e);if(!R||n.length===0)return[];this._resizeBuffer();const L=this.device.canvasContext.cssToDeviceRatio(),j=this.device.canvasContext.cssToDevicePixels([s,u],!0),Z=j.x,re=j.y+j.height,xe=this.device.canvasContext.cssToDevicePixels([s+f,u+m],!0),be=xe.x+xe.width,ue=xe.y,oe={x:Z,y:ue,width:be-Z,height:re-ue},Ie=this._drawAndSample({layers:R,views:i,viewports:n,onViewportActive:w,deviceRect:oe,cullRect:{x:s,y:u,width:f,height:m},effects:S,pass:`picking:${o}`}),me=T7(Ie),ot=new Map,lt=[],_t=Number.isFinite(v);for(let rt=0;rt<me.length&&!(_t&&lt.length>=v);rt++){const Ge=me[rt];let Ut={color:Ge.pickedColor,layer:null,index:Ge.pickedObjectIndex,picked:!0,x:s,y:u,pixelRatio:L};Ut=vP({layer:Ge.pickedLayer,info:Ut,mode:o});const Vt=Ut.layer.id;ot.has(Vt)||ot.set(Vt,new Set);const Ot=ot.get(Vt),mt=Ut.object??Ut.index;Ot.has(mt)||(Ot.add(mt),lt.push(Ut))}return lt}_drawAndSample({layers:e,views:i,viewports:n,onViewportActive:s,deviceRect:u,cullRect:f,effects:m,pass:o},v=!1){const w=v?this.depthFBO:this.pickingFBO,S={layers:e,layerFilter:this.layerFilter,views:i,viewports:n,onViewportActive:s,pickingFBO:w,deviceRect:u,cullRect:f,effects:m,pass:o,pickZ:v,preRenderStats:{},isPicking:!0};for(const be of m)be.useInPicking&&(S.preRenderStats[be.id]=be.preRender(S));const{decodePickingColor:R}=this.pickLayersPass.render(S),{x:L,y:j,width:Z,height:re}=u,xe=new(v?Float32Array:Uint8Array)(Z*re*4);return this.device.readPixelsToArrayWebGL(w,{sourceX:L,sourceY:j,sourceWidth:Z,sourceHeight:re,target:xe}),{pickedColors:xe,decodePickingColor:R}}_getPickingRect({deviceX:e,deviceY:i,deviceRadius:n,deviceWidth:s,deviceHeight:u}){const f=Math.max(0,e-n),m=Math.max(0,i-n),o=Math.min(s,e+n+1)-f,v=Math.min(u,i+n+1)-m;return o<=0||v<=0?null:{x:f,y:m,width:o,height:v}}}const I7={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},C7="top-left",E3="__root";class M7{constructor({deck:e,parentElement:i}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=i}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!ts(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(i=>i.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const i={};for(const n of this.resolvedWidgets)i[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)i[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const s=i[n.id];s?s.viewId!==n.viewId||s.placement!==n.placement?(this._remove(s),this._add(n)):n!==s&&(s.setProps(n.props),n=s):this._add(n),i[n.id]=null,this.resolvedWidgets.push(n)}for(const n in i){const s=i[n];s&&this._remove(s)}this.widgets=e}_add(e){const{viewId:i=null,placement:n=C7}=e,s=e.onAdd({deck:this.deck,viewId:i});s&&this._getContainer(i,n).append(s),e._element=s}_remove(e){var i;(i=e.onRemove)==null||i.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,i){var f;const n=e||E3;let s=this.containers[n];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",(f=this.parentElement)==null||f.append(s),this.containers[n]=s);let u=s.querySelector(`.${i}`);return u||(u=document.createElement("div"),u.className=i,u.style.position="absolute",u.style.zIndex="2",Object.assign(u.style,I7[i]),s.append(u)),u}_updateContainers(){const e=this.deck.width,i=this.deck.height;for(const n in this.containers){const s=this.lastViewports[n]||null,u=n===E3||s,f=this.containers[n];u?(f.style.display="block",f.style.left=`${s?s.x:0}px`,f.style.top=`${s?s.y:0}px`,f.style.width=`${s?s.width:e}px`,f.style.height=`${s?s.height:i}px`):f.style.display="none"}}onRedraw({viewports:e,layers:i}){var s,u;const n=e.reduce((f,m)=>(f[m.id]=m,f),{});for(const f of this.getWidgets()){const{viewId:m}=f;if(m){const o=n[m];o&&(f.onViewportChange&&f.onViewportChange(o),(s=f.onRedraw)==null||s.call(f,{viewports:[o],layers:i}))}else{if(f.onViewportChange)for(const o of e)f.onViewportChange(o);(u=f.onRedraw)==null||u.call(f,{viewports:e,layers:i})}}this.lastViewports=n,this._updateContainers()}onHover(e,i){var n,s;for(const u of this.getWidgets()){const{viewId:f}=u;(!f||f===((n=e.viewport)==null?void 0:n.id))&&((s=u.onHover)==null||s.call(u,e,i))}}onEvent(e,i){var s,u;const n=_b[i.type];if(n)for(const f of this.getWidgets()){const{viewId:m}=f;(!m||m===((s=e.viewport)==null?void 0:s.id))&&((u=f[n])==null||u.call(f,e,i))}}}const R7={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class P7{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const i=document.createElement("div");return i.className="deck-tooltip",Object.assign(i.style,R7),this.deck=e,this.element=i,i}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var i;this.isVisible&&e.id===((i=this.lastViewport)==null?void 0:i.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:i}=this,n=i&&i.props.getTooltip;if(!n)return;const s=n(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,i,n){const s=this.element;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${i}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}var mh;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(mh||(mh={}));const H1={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Vn=(t,e,i)=>e?t.enable(i):t.disable(i),A3=(t,e,i)=>t.hint(i,e),cs=(t,e,i)=>t.pixelStorei(i,e),S3=(t,e,i)=>{const n=i===36006?36009:36008;return t.bindFramebuffer(n,e)},wd=(t,e,i)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[i];t.bindBuffer(s,e)};function Qx(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const k7={3042:Vn,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Vn,2885:(t,e)=>t.cullFace(e),2929:Vn,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Vn,35723:A3,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var i;return(i=t.bindTransformFeedback)==null?void 0:i.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:S3,36010:S3,34964:wd,36662:wd,36663:wd,35053:wd,35055:wd,2886:(t,e)=>t.frontFace(e),33170:A3,2849:(t,e)=>t.lineWidth(e),32823:Vn,32824:"polygonOffset",10752:"polygonOffset",35977:Vn,32926:Vn,32928:Vn,32938:"sampleCoverage",32939:"sampleCoverage",3089:Vn,3088:(t,e)=>t.scissor(...e),2960:Vn,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Vn,10754:Vn,12288:Vn,12289:Vn,12290:Vn,12291:Vn,12292:Vn,12293:Vn,12294:Vn,12295:Vn,3333:cs,3317:cs,37440:cs,37441:cs,37443:cs,3330:cs,3332:cs,3331:cs,3314:cs,32878:cs,3316:cs,3315:cs,32877:cs,framebuffer:(t,e)=>{const i=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,i)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const i=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...i)},blendFunc:(t,e)=>{const i=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...i)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Qx(e)?e:[e,e];const[i,n]=e;t.stencilMaskSeparate(1028,i),t.stencilMaskSeparate(1029,n)},stencilFunc:(t,e)=>{e=Qx(e)&&e.length===3?[...e,...e]:e;const[i,n,s,u,f,m]=e;t.stencilFuncSeparate(1028,i,n,s),t.stencilFuncSeparate(1029,u,f,m)},stencilOp:(t,e)=>{e=Qx(e)&&e.length===3?[...e,...e]:e;const[i,n,s,u,f,m]=e;t.stencilOpSeparate(1028,i,n,s),t.stencilOpSeparate(1029,u,f,m)},viewport:(t,e)=>t.viewport(...e)};function Pn(t,e,i){return e[t]!==void 0?e[t]:i[t]}const D7={blendEquation:(t,e,i)=>t.blendEquationSeparate(Pn(32777,e,i),Pn(34877,e,i)),blendFunc:(t,e,i)=>t.blendFuncSeparate(Pn(32969,e,i),Pn(32968,e,i),Pn(32971,e,i),Pn(32970,e,i)),polygonOffset:(t,e,i)=>t.polygonOffset(Pn(32824,e,i),Pn(10752,e,i)),sampleCoverage:(t,e,i)=>t.sampleCoverage(Pn(32938,e,i),Pn(32939,e,i)),stencilFuncFront:(t,e,i)=>t.stencilFuncSeparate(1028,Pn(2962,e,i),Pn(2967,e,i),Pn(2963,e,i)),stencilFuncBack:(t,e,i)=>t.stencilFuncSeparate(1029,Pn(34816,e,i),Pn(36003,e,i),Pn(36004,e,i)),stencilOpFront:(t,e,i)=>t.stencilOpSeparate(1028,Pn(2964,e,i),Pn(2965,e,i),Pn(2966,e,i)),stencilOpBack:(t,e,i)=>t.stencilOpSeparate(1029,Pn(34817,e,i),Pn(34818,e,i),Pn(34819,e,i))},I3={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,i)=>t({[e]:i}),hint:(t,e,i)=>t({[e]:i}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,i)=>t({36007:i}),bindTransformFeedback:(t,e,i)=>t({36389:i}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,i)=>{switch(e){case 36160:return t({36006:i,36010:i});case 36009:return t({36006:i});case 36008:return t({36010:i});default:return null}},bindBuffer:(t,e,i)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?t({[n]:i}):{valueChanged:!0}},blendColor:(t,e,i,n,s)=>t({32773:new Float32Array([e,i,n,s])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,i)=>t({32777:e,34877:i}),blendFunc:(t,e,i)=>t({32969:e,32968:i,32971:e,32970:i}),blendFuncSeparate:(t,e,i,n,s)=>t({32969:e,32968:i,32971:n,32970:s}),clearColor:(t,e,i,n,s)=>t({3106:new Float32Array([e,i,n,s])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,i,n,s)=>t({3107:[e,i,n,s]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,i)=>t({2928:new Float32Array([e,i])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,i)=>t({32824:e,10752:i}),sampleCoverage:(t,e,i)=>t({32938:e,32939:i}),scissor:(t,e,i,n,s)=>t({3088:new Int32Array([e,i,n,s])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,i)=>t({[e===1028?2968:36005]:i}),stencilFunc:(t,e,i,n)=>t({2962:e,2967:i,2963:n,34816:e,36003:i,36004:n}),stencilFuncSeparate:(t,e,i,n,s)=>t({[e===1028?2962:34816]:i,[e===1028?2967:36003]:n,[e===1028?2963:36004]:s}),stencilOp:(t,e,i,n)=>t({2964:e,2965:i,2966:n,34817:e,34818:i,34819:n}),stencilOpSeparate:(t,e,i,n,s)=>t({[e===1028?2964:34817]:i,[e===1028?2965:34818]:n,[e===1028?2966:34819]:s}),viewport:(t,e,i,n,s)=>t({2978:[e,i,n,s]})},Co=(t,e)=>t.isEnabled(e),C3={3042:Co,2884:Co,2929:Co,3024:Co,32823:Co,32926:Co,32928:Co,3089:Co,2960:Co,35977:Co},O7=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function qh(t,e){if(B7(e))return;const i={};for(const s in e){const u=Number(s),f=k7[s];f&&(typeof f=="string"?i[f]=!0:f(t,e[s],u))}const n=t.state&&t.state.cache;if(n)for(const s in i){const u=D7[s];u(t,e,n)}}function bP(t,e=H1){if(typeof e=="number"){const s=e,u=C3[s];return u?u(t,s):t.getParameter(s)}const i=Array.isArray(e)?e:Object.keys(e),n={};for(const s of i){const u=C3[s];n[s]=u?u(t,Number(s)):t.getParameter(Number(s))}return n}function L7(t){qh(t,H1)}function B7(t){for(const e in t)return!1;return!0}function F7(t,e){if(t===e)return!0;const i=Array.isArray(t)||ArrayBuffer.isView(t),n=Array.isArray(e)||ArrayBuffer.isView(e);if(i&&n&&t.length===e.length){for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}return!1}class kc{constructor(e,i){q(this,"gl");q(this,"program",null);q(this,"stateStack",[]);q(this,"enable",!0);q(this,"cache",null);q(this,"log");q(this,"initialized",!1);this.gl=e,this.log=(i==null?void 0:i.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];qh(this.gl,e),this.stateStack.pop()}trackState(e,i){if(this.cache=i.copyState?bP(e):Object.assign({},H1),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,z7(e);for(const n in I3){const s=I3[n];N7(e,n,s)}M3(e,"getParameter"),M3(e,"isEnabled")}_updateCache(e){let i=!1,n;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const u in e){const f=e[u],m=this.cache[u];F7(f,m)||(i=!0,n=m,s&&!(u in s)&&(s[u]=m),this.cache[u]=f)}return{valueChanged:i,oldValue:n}}}function M3(t,e){const i=t[e].bind(t);t[e]=function(s){if(s===void 0||O7.has(s))return i(s);const u=kc.get(t);return s in u.cache||(u.cache[s]=i(s)),u.enable?u.cache[s]:i(s)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function N7(t,e,i){if(!t[e])return;const n=t[e].bind(t);t[e]=function(...u){const f=kc.get(t),{valueChanged:m,oldValue:o}=i(f._updateCache,...u);return m&&n(...u),o},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function z7(t){const e=t.useProgram.bind(t);t.useProgram=function(n){const s=kc.get(t);s.program!==n&&(e(n),s.program=n)}}function U7(t,e,i){let n="";const s={preserveDrawingBuffer:!0,...i};let u=null;if(u||(u=t.getContext("webgl2",s)),s.failIfMajorPerformanceCaveat&&(n||(n="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!u&&!i.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,u=t.getContext("webgl2",s),u.luma||(u.luma={}),u.luma.softwareRenderer=!0),u||(u=t.getContext("webgl",{}),u&&(u=null,n||(n="Your browser only supports WebGL1"))),!u)throw n||(n="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:f,onContextRestored:m}=e;return t.addEventListener("webglcontextlost",o=>f(o),!1),t.addEventListener("webglcontextrestored",o=>m(o),!1),u.luma||(u.luma={}),u}function Wh(t,e,i){return i[e]===void 0&&(i[e]=t.getExtension(e)||null),i[e]}function V7(t,e){const i=t.getParameter(7936),n=t.getParameter(7937);Wh(t,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,u=t.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),f=t.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),m=u||i,o=f||n,v=t.getParameter(7938),w=wP(m,o),S=j7(m,o),R=$7(m,o);return{type:"webgl",gpu:w,gpuType:R,gpuBackend:S,vendor:m,renderer:o,version:v,shadingLanguage:"glsl",shadingLanguageVersion:300}}function wP(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function j7(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function $7(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(wP(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function TP(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Ld="WEBGL_compressed_texture_s3tc",Bd="WEBGL_compressed_texture_s3tc_srgb",gh="EXT_texture_compression_rgtc",_h="EXT_texture_compression_bptc",W7="WEBGL_compressed_texture_etc",H7="WEBGL_compressed_texture_astc",X7="WEBGL_compressed_texture_etc1",q7="WEBGL_compressed_texture_pvrtc",G7="WEBGL_compressed_texture_atc",R3="EXT_texture_norm16",P3="EXT_render_snorm",Z7="EXT_color_buffer_float",X1={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[P3],"norm16-renderable-webgl":[R3],"snorm16-renderable-webgl":[R3,P3],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Ld,Bd,gh,_h],"texture-compression-bc5-webgl":[gh],"texture-compression-bc7-webgl":[_h],"texture-compression-etc2":[W7],"texture-compression-astc":[H7],"texture-compression-etc1-webgl":[X7],"texture-compression-pvrtc-webgl":[q7],"texture-compression-atc-webgl":[G7]};function Y7(t){return t in X1}function K7(t,e,i){return(X1[e]||[]).every(s=>Wh(t,s,i))}const q1={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:Z7,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Ld},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Bd},"bc1-rgba-unorm":{gl:33777,x:Ld},"bc1-rgba-unorm-srgb":{gl:35916,x:Bd},"bc2-rgba-unorm":{gl:33778,x:Ld},"bc2-rgba-unorm-srgb":{gl:35918,x:Bd},"bc3-rgba-unorm":{gl:33779,x:Ld},"bc3-rgba-unorm-srgb":{gl:35919,x:Bd},"bc4-r-unorm":{gl:36283,x:gh},"bc4-r-snorm":{gl:36284,x:gh},"bc5-rg-unorm":{gl:36285,x:gh},"bc5-rg-snorm":{gl:36286,x:gh},"bc6h-rgb-ufloat":{gl:36495,x:_h},"bc6h-rgb-float":{gl:36494,x:_h},"bc7-rgba-unorm":{gl:36492,x:_h},"bc7-rgba-unorm-srgb":{gl:36493,x:_h},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function J7(t,e,i){let n=e.create;const s=q1[e.format];return(s==null?void 0:s.gl)===void 0&&(n=!1),s!=null&&s.x&&(n=n&&!!Wh(t,s.x,i)),{format:e.format,create:n&&e.create,render:n&&e.render,filter:n&&e.filter,blend:n&&e.blend,store:n&&e.store}}function EP(t){var s;const e=q1[t],i=tH(t),n=C1(t);return{internalFormat:i,format:(e==null?void 0:e.dataFormat)||eH(n.channels,n.integer,n.normalized,i),type:n.dataType?TP(n.dataType):((s=e==null?void 0:e.types)==null?void 0:s[0])||5121,compressed:n.compressed||!1}}function Q7(t){switch(C1(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function eH(t,e,i,n){if(n===6408||n===6407)return n;switch(t){case"r":return e&&!i?36244:6403;case"rg":return e&&!i?33320:33319;case"rgb":return e&&!i?36248:6407;case"rgba":return e&&!i?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function tH(t){const e=q1[t],i=e==null?void 0:e.gl;if(i===void 0)throw new Error(`Unsupported texture format ${t}`);return i}const k3={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class iH extends jV{constructor(i,n,s){super([],s);q(this,"gl");q(this,"extensions");q(this,"testedFeatures",new Set);this.gl=i,this.extensions=n,Wh(i,"EXT_color_buffer_float",n)}*[Symbol.iterator](){const i=this.getFeatures();for(const n of i)this.has(n)&&(yield n);return[]}has(i){var n;return(n=this.disabledFeatures)!=null&&n[i]?!1:(this.testedFeatures.has(i)||(this.testedFeatures.add(i),Y7(i)&&K7(this.gl,i,this.extensions)&&this.features.add(i),this.getWebGLFeature(i)&&this.features.add(i)),this.features.has(i))}initializeFeatures(){const i=this.getFeatures().filter(n=>n!=="polygon-mode-webgl");for(const n of i)this.has(n)}getFeatures(){return[...Object.keys(k3),...Object.keys(X1)]}getWebGLFeature(i){const n=k3[i];return typeof n=="string"?!!Wh(this.gl,n,this.extensions):!!n}}class nH extends VV{constructor(i){super();q(this,"gl");q(this,"limits",{});this.gl=i}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(i){return this.limits[i]===void 0&&(this.limits[i]=this.gl.getParameter(i)),this.limits[i]||0}}class Yd extends U_{constructor(i,n){super(i,n);q(this,"device");q(this,"gl");q(this,"handle");q(this,"colorAttachments",[]);q(this,"depthStencilAttachment",null);const s=n.handle===null;this.device=i,this.gl=i.gl,this.handle=this.props.handle||s?this.props.handle:this.gl.createFramebuffer(),s||(i.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const i=this.gl.bindFramebuffer(36160,this.handle);for(let n=0;n<this.colorAttachments.length;++n){const s=this.colorAttachments[n];if(s){const u=36064+n;this._attachTextureView(u,s)}}if(this.depthStencilAttachment){const n=Q7(this.depthStencilAttachment.props.format);this._attachTextureView(n,this.depthStencilAttachment)}if(this.device.props.debug){const n=this.gl.checkFramebufferStatus(36160);if(n!==36053)throw new Error(`Framebuffer ${sH(n)}`)}this.gl.bindFramebuffer(36160,i)}_attachTextureView(i,n){const{gl:s}=this.device,{texture:u}=n,f=n.props.baseMipLevel,m=n.props.baseArrayLayer;switch(s.bindTexture(u.glTarget,u.handle),u.glTarget){case 35866:case 32879:s.framebufferTextureLayer(36160,i,u.handle,f,m);break;case 34067:const o=rH(m);s.framebufferTexture2D(36160,i,o,u.handle,f);break;case 3553:s.framebufferTexture2D(36160,i,3553,u.handle,f);break;default:throw new Error("Illegal texture type")}s.bindTexture(u.glTarget,null)}}function rH(t){return t<34069?t+34069:t}function sH(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class oH extends ib{constructor(i,n){super(n);q(this,"device");q(this,"format","rgba8unorm");q(this,"depthStencilFormat","depth24plus");q(this,"presentationSize");q(this,"_framebuffer",null);this.device=i,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Yd(this.device,{handle:null}),this._framebuffer}update(){const i=this.getPixelSize();(i[0]!==this.presentationSize[0]||i[1]!==this.presentationSize[1])&&(this.presentationSize=i,this.resize())}resize(i){if(this.device.gl&&this.canvas){const n=this.getDevicePixelRatio(i==null?void 0:i.useDevicePixels);this.setDevicePixelRatio(n,i);return}}commit(){}}async function AP(t,e){const i=document.getElementsByTagName("head")[0];if(!i)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",t),new Promise((s,u)=>{n.onload=s,n.onerror=f=>u(new Error(`Unable to load script '${t}': ${f}`)),i.appendChild(n)})}const aH=1;let ln=null,D3=!1;const G1={debugSpectorJS:Et.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function lH(t){if(!globalThis.SPECTOR)try{await AP(t.debugSpectorJSUrl||G1.debugSpectorJSUrl)}catch(e){Et.warn(String(e))}}function cH(t){var e;if(t={...G1,...t},!t.debugSpectorJS)return null;if(!ln&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){Et.probe(aH,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:i}=globalThis.SPECTOR;ln=new i,globalThis.luma&&(globalThis.luma.spector=ln)}if(!ln)return null;if(D3||(D3=!0,ln.spyCanvases(),ln==null||ln.onCaptureStarted.add(i=>Et.info("Spector capture started:",i)()),ln==null||ln.onCapture.add(i=>{Et.info("Spector capture complete:",i)(),ln==null||ln.getResultUI(),ln==null||ln.resultView.display(),ln==null||ln.resultView.addCapture(i)})),t.gl){const i=t.gl,n=i.device;ln==null||ln.startCapture(t.gl,500),i.device=n,new Promise(s=>setTimeout(s,2e3)).then(s=>{Et.info("Spector capture stopped after 2 seconds")(),ln==null||ln.stopCapture()})}return ln}const uH="https://unpkg.com/webgl-debug@2.0.1/index.js";function SP(t){return t.luma=t.luma||{},t.luma}async function hH(){Gc()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await AP(uH))}function fH(t,e={}){return e.debugWebGL||e.traceWebGL?pH(t,e):dH(t)}function dH(t){const e=SP(t);return e.realContext?e.realContext:t}function pH(t,e){if(!globalThis.WebGLDebugUtils)return Et.warn("webgl-debug not loaded")(),t;const i=SP(t);if(i.debugContext)return i.debugContext;globalThis.WebGLDebugUtils.init({...mh,...t});const n=globalThis.WebGLDebugUtils.makeDebugContext(t,mH.bind(null,e),gH.bind(null,e));for(const f in mh)!(f in n)&&typeof mh[f]=="number"&&(n[f]=mh[f]);class s{}Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.setPrototypeOf(s,n);const u=Object.create(s);return i.realContext=t,i.debugContext=u,u.debug=!0,u}function O3(t,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let i=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return i=`${i.slice(0,100)}${i.length>100?"...":""}`,`gl.${t}(${i})`}function mH(t,e,i,n){n=Array.from(n).map(m=>m===void 0?"undefined":m);const s=globalThis.WebGLDebugUtils.glEnumToString(e),u=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,n),f=`${s} in gl.${i}(${u})`;Et.error(f)();debugger}function gH(t,e,i){let n="";Et.level>=1&&(n=O3(e,i),t.traceWebGL&&Et.log(1,n)());for(const s of i)if(s===void 0){n=n||O3(e,i);debugger}}const ev={};function _H(t="id"){ev[t]=ev[t]||1;const e=ev[t]++;return`${t}-${e}`}class Kd extends yn{constructor(i,n={}){super(i,n);q(this,"device");q(this,"gl");q(this,"handle");q(this,"glTarget");q(this,"glUsage");q(this,"glIndexType",5123);q(this,"byteLength");q(this,"bytesUsed");this.device=i,this.gl=this.device.gl;const s=typeof n=="object"?n.handle:void 0;this.handle=s||this.gl.createBuffer(),i.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=yH(this.props.usage),this.glUsage=xH(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,n.data?this._initWithData(n.data,n.byteOffset,n.byteLength):this._initWithByteLength(n.byteLength||0)}_initWithData(i,n=0,s=i.byteLength+n){const u=this.glTarget;this.gl.bindBuffer(u,this.handle),this.gl.bufferData(u,s,this.glUsage),this.gl.bufferSubData(u,n,i),this.gl.bindBuffer(u,null),this.bytesUsed=s,this.byteLength=s,this._setDebugData(i,n,s),this.trackAllocatedMemory(s)}_initWithByteLength(i){let n=i;i===0&&(n=new Float32Array(0));const s=this.glTarget;return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,n,this.glUsage),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(null,0,i),this.trackAllocatedMemory(i),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(i,n=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,n,i),this.gl.bindBuffer(36663,null),this._setDebugData(i,n,i.byteLength)}async readAsync(i=0,n){return this.readSyncWebGL(i,n)}readSyncWebGL(i=0,n){n=n??this.byteLength-i;const s=new Uint8Array(n),u=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,i,s,u,n),this.gl.bindBuffer(36662,null),this._setDebugData(s,i,n),s}}function yH(t){return t&yn.INDEX?34963:t&yn.VERTEX?34962:t&yn.UNIFORM?35345:34962}function xH(t){return t&yn.INDEX||t&yn.VERTEX?35044:t&yn.UNIFORM?35048:35044}function vH(t){const e=t.split(/\r?\n/),i=[];for(const n of e){if(n.length<=1)continue;const s=n.split(":");if(s.length===2){const[S,R]=s;i.push({message:R.trim(),type:L3(S),lineNum:0,linePos:0});continue}const[u,f,m,...o]=s;let v=parseInt(m,10);isNaN(v)&&(v=0);let w=parseInt(f,10);isNaN(w)&&(w=0),i.push({message:o.join(":").trim(),type:L3(u),lineNum:v,linePos:w})}return i}function L3(t){const e=["warning","error","info"],i=t.toLowerCase();return e.includes(i)?i:"info"}class bH extends N_{constructor(i,n){super(i,n);q(this,"device");q(this,"handle");switch(this.device=i,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const i=this.device.gl.getShaderInfoLog(this.handle);return i?vH(i):[]}getTranslatedSource(){const n=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(n==null?void 0:n.getTranslatedShaderSource(this.handle))||null}async _compile(i){i=i.startsWith("#version ")?i:`#version 300 es
${i}`;const{gl:n}=this.device;if(n.shaderSource(this.handle,i),n.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Et.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Et.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const i=async u=>await new Promise(f=>setTimeout(f,u));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:s}=this.device;for(;;){if(s.getShaderParameter(this.handle,37297))return;await i(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function wH(t,e,i,n){if(SH(e))return n(t);const s=t;s.pushState();try{return TH(t,e),qh(s.gl,i),n(t)}finally{s.popState()}}function TH(t,e){const i=t,{gl:n}=i;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(Dc("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const u=i.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,f=Dc("provokingVertex",e.provokingVertex,{first:36429,last:36430});u==null||u.provokingVertexWEBGL(f)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const u=i.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,f=Dc("polygonMode",e.polygonMode,{fill:6914,line:6913});u==null||u.polygonModeWEBGL(1028,f),u==null||u.polygonModeWEBGL(1029,f)}e.polygonOffsetLine&&n.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask(AH("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(Sb("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;n.stencilMaskSeparate(1028,s),n.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&Et.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,u=Sb("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,u,0,s),n.stencilFuncSeparate(1029,u,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=tv("stencilPassOperation",e.stencilPassOperation),u=tv("stencilFailOperation",e.stencilFailOperation),f=tv("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,u,f,s),n.stencilOpSeparate(1029,u,f,s)}switch(e.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const s=B3("blendColorOperation",e.blendColorOperation||"add"),u=B3("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(s,u);const f=Bg("blendColorSrcFactor",e.blendColorSrcFactor||"one"),m=Bg("blendColorDstFactor",e.blendColorDstFactor||"zero"),o=Bg("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),v=Bg("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(f,m,o,v)}}function Sb(t,e){return Dc(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function tv(t,e){return Dc(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function B3(t,e){return Dc(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Bg(t,e){return Dc(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function EH(t,e){return`Illegal parameter ${e} for ${t}`}function Dc(t,e,i){if(!(e in i))throw new Error(EH(t,e));return i[e]}function AH(t,e){return e}function SH(t){let e=!0;for(const i in t){e=!1;break}return e}function IP(t){const e={};return t.addressModeU&&(e[10242]=iv(t.addressModeU)),t.addressModeV&&(e[10243]=iv(t.addressModeV)),t.addressModeW&&(e[32882]=iv(t.addressModeW)),t.magFilter&&(e[10240]=Ib(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=IH(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Sb("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function iv(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Ib(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function IH(t,e="none"){if(!e)return Ib(t);switch(e){case"none":return Ib(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class Cb extends z_{constructor(i,n){super(i,n);q(this,"device");q(this,"handle");q(this,"parameters");this.device=i,this.parameters=IP(n),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(i){for(const[n,s]of Object.entries(i)){const u=Number(n);switch(u){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,u,s);break;default:this.device.gl.samplerParameteri(this.handle,u,s);break}}}}class yh extends F_{constructor(i,n){super(i,{...kn.defaultProps,...n});q(this,"device");q(this,"gl");q(this,"handle");q(this,"texture");this.device=i,this.gl=this.device.gl,this.handle=null,this.texture=n.texture}}const CH="Failed to deduce GL constant from typed array";function MH(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(CH)}}function RH(t,e){const{clamped:i=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return i?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function CP(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function PH(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function ey(t,e,i){if(kH(e))return i(t);const{nocatch:n=!0}=e,s=kc.get(t);s.push(),qh(t,e);let u;if(n)u=i(t),s.pop();else try{u=i(t)}finally{s.pop()}return u}function kH(t){for(const e in t)return!1;return!0}function DH(t,e,i){const{dimension:n,width:s,height:u,depth:f=0}=i,{glInternalFormat:m}=i,o=i.glTarget;switch(n){case"2d-array":case"3d":t.texStorage3D(o,e,m,s,u,f);break;default:t.texStorage2D(o,e,m,s,u)}}function F3(t,e,i,n){const{width:s,height:u}=n,{dimension:f,depth:m=0,mipLevel:o=0}=n,{x:v=0,y:w=0,z:S=0}=n,{glFormat:R,glType:L}=n,j=MP(n.glTarget,f,m),Z=n.flipY?{37440:!0}:{};ey(t,Z,()=>{switch(f){case"2d-array":case"3d":t.bindTexture(j,e),t.texSubImage3D(j,o,v,w,S,s,u,m,R,L,i),t.bindTexture(j,null);break;case"2d":case"cube":t.bindTexture(j,e),t.texSubImage2D(j,o,v,w,s,u,R,L,i),t.bindTexture(j,null);break;default:throw new Error(f)}})}function N3(t,e,i){const{dimension:n,width:s,height:u,depth:f=0,mipLevel:m=0,byteOffset:o=0}=i,{x:v=0,y:w=0,z:S=0}=i,{glFormat:R,glType:L,compressed:j}=i,Z=MP(i.glTarget,n,f);switch(n){case"2d-array":case"3d":j?t.compressedTexSubImage3D(Z,m,v,w,S,s,u,f,R,e,o):t.texSubImage3D(Z,m,v,w,S,s,u,f,R,L,e,o);break;case"2d":case"cube":j?t.compressedTexSubImage2D(Z,m,v,w,s,u,R,e,o):t.texSubImage2D(Z,m,v,w,s,u,R,L,e,o);break;default:throw new Error(n)}}function OH(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function MP(t,e,i){return e==="cube"?34069+i:t}function LH(t,e){var xe;const{sourceX:i=0,sourceY:n=0,sourceAttachment:s=0}=e||{};let{target:u=null,sourceWidth:f,sourceHeight:m,sourceDepth:o,sourceFormat:v,sourceType:w}=e||{};const{framebuffer:S,deleteFramebuffer:R}=RP(t),{gl:L,handle:j}=S;f||(f=S.width),m||(m=S.height);const Z=(xe=S.colorAttachments[s])==null?void 0:xe.texture;if(!Z)throw new Error(`Invalid framebuffer attachment ${s}`);o=(Z==null?void 0:Z.depth)||1,v||(v=(Z==null?void 0:Z.glFormat)||6408),w||(w=(Z==null?void 0:Z.glType)||5121),u=NH(u,w,v,f,m),w=w||MH(u);const re=L.bindFramebuffer(36160,j);return L.readBuffer(36064+s),L.readPixels(i,n,f,m,v,w,u),L.readBuffer(36064),L.bindFramebuffer(36160,re||null),R&&S.destroy(),u}function BH(t,e){const{target:i,sourceX:n=0,sourceY:s=0,sourceFormat:u=6408,targetByteOffset:f=0}=e||{};let{sourceWidth:m,sourceHeight:o,sourceType:v}=e||{};const{framebuffer:w,deleteFramebuffer:S}=RP(t);m=m||w.width,o=o||w.height;const R=w;v=v||5121;let L=i;if(!L){const Z=CP(u),re=PH(v),xe=f+m*o*Z*re;L=R.device.createBuffer({byteLength:xe})}const j=t.device.createCommandEncoder();return j.copyTextureToBuffer({sourceTexture:t,width:m,height:o,origin:[n,s],destinationBuffer:L,byteOffset:f}),j.destroy(),S&&w.destroy(),L}function RP(t){return t instanceof U_?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:FH(t),deleteFramebuffer:!0}}function FH(t,e){const{device:i,width:n,height:s,id:u}=t;return i.createFramebuffer({...e,id:`framebuffer-for-${u}`,width:n,height:s,colorAttachments:[t]})}function NH(t,e,i,n,s,u){if(t)return t;e||(e=5121);const f=RH(e,{clamped:!1}),m=CP(i);return new f(n*s*m)}class Jd extends kn{constructor(i,n){super(i,n);q(this,"device");q(this,"gl");q(this,"handle");q(this,"sampler");q(this,"view");q(this,"mipmaps");q(this,"compressed");q(this,"glTarget");q(this,"glFormat");q(this,"glType");q(this,"glInternalFormat");q(this,"textureUnit",0);const s={...this.props};s.data=n.data,this.device=i,this.gl=this.device.gl,this.glTarget=OH(this.props.dimension);const u=EP(this.props.format);this.glInternalFormat=u.internalFormat,this.glFormat=u.format,this.glType=u.type,this.compressed=u.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(s),Object.seal(this)}_initialize(i){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:i.data});let{width:n,height:s}=i;if(!n||!s){const u=kn.getTextureDataSize(i.data);n=(u==null?void 0:u.width)||1,s=(u==null?void 0:u.height)||1}if(this.width=n,this.height=s,this.depth=i.depth,this.setSampler(i.sampler),this.view=new yh(this.device,{...this.props,texture:this}),this.bind(),DH(this.gl,this.mipLevels,this),i.data)switch(i.dimension){case"1d":this.setTexture1DData(i.data);break;case"2d":this.setTexture2DData(i.data);break;case"3d":this.setTexture3DData(i.data);break;case"cube":this.setTextureCubeData(i.data);break;case"2d-array":this.setTextureArrayData(i.data);break;case"cube-array":this.setTextureCubeArrayData(i.data);break;default:throw new Error(i.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(i){return new yh(this.device,{...i,texture:this})}setSampler(i={}){let n;i instanceof Cb?(this.sampler=i,n=i.props):(this.sampler=new Cb(this.device,i),n=i);const s=IP(n);this._setSamplerParameters(s)}generateMipmap(i){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Et.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(i!=null&&i.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(s){Et.warn(`Error generating mipmap for ${this}: ${s.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(i){const n=kn.getExternalImageSize(i.image),s={...kn.defaultCopyExternalImageOptions,...n,...i},{image:u,depth:f,mipLevel:m,x:o,y:v,z:w,flipY:S}=s;let{width:R,height:L}=s;const{dimension:j,glTarget:Z,glFormat:re,glInternalFormat:xe,glType:be}=this;if(R=Math.min(R,this.width-o),L=Math.min(L,this.height-v),i.sourceX||i.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return F3(this.device.gl,this.handle,u,{dimension:j,mipLevel:m,x:o,y:v,z:w,width:R,height:L,depth:f,glFormat:re,glType:be,glTarget:Z,flipY:S}),{width:s.width,height:s.height}}setTexture1DData(i){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(i,n=0){this.bind();const s=kn.normalizeTextureData(i,this);s.length>1&&this.props.mipmaps!==!1&&Et.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let u=0;u<s.length;u++){const f=s[u];this._setMipLevel(n,u,f)}this.unbind()}setTexture3DData(i){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(i)&&(this.bind(),N3(this.device.gl,i,this),this.unbind())}setTextureCubeData(i,n=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const s of kn.CubeFaces)this.setTextureCubeFaceData(i[s],s)}setTextureArrayData(i){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(i){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(i,n,s=0){Array.isArray(i)&&i.length>1&&this.props.mipmaps!==!1&&Et.warn(`${this.id} has mipmap and multiple LODs.`)();const u=kn.CubeFaces.indexOf(n);this.setTexture2DData(i,u)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(i){const{face:n,width:s,height:u,pixels:f,data:m,format:o=6408,type:v=5121}=i,{gl:w}=this,S=f||m;this.bind(),S instanceof Promise?S.then(R=>this.setImageDataForFace(Object.assign({},i,{face:n,data:R,pixels:R}))):this.width||this.height?w.texImage2D(n,0,o,s,u,0,o,v,S):w.texImage2D(n,0,o,o,v,S)}_getImageDataMap(i){for(let n=0;n<kn.CubeFaces.length;++n){const s=kn.CubeFaces[n];i[s]&&(i[34069+n]=i[s],delete i[s])}return i}_setSamplerParameters(i){Et.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(i))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[n,s]of Object.entries(i)){const u=Number(n),f=s;switch(u){case 33082:case 33083:this.gl.texParameterf(this.glTarget,u,f);break;case 10241:this.gl.texParameteri(this.glTarget,u,f);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,u,f);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,u,f);break;default:this.gl.texParameteri(this.glTarget,u,f);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(i,n,s,u=this.glTarget){if(kn.isExternalImage(s)){F3(this.device.gl,this.handle,s,{...this,depth:i,mipLevel:n,glTarget:u,flipY:this.props.flipY});return}if(kn.isTextureLevelData(s)){N3(this.device.gl,s.data,{...this,depth:i,mipLevel:n,glTarget:u});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(i){const{gl:n}=this;return i!==void 0&&(this.textureUnit=i,n.activeTexture(33984+i)),n.bindTexture(this.glTarget,this.handle),i}unbind(i){const{gl:n}=this;return i!==void 0&&(this.textureUnit=i,n.activeTexture(33984+i)),n.bindTexture(this.glTarget,null),i}}const zH=[1,2,4,8];class UH extends nb{constructor(i,n){var f;super(i,n);q(this,"device");q(this,"glParameters");this.device=i;let s;if(!((f=n==null?void 0:n.parameters)!=null&&f.viewport))if(n!=null&&n.framebuffer){const{width:m,height:o}=n.framebuffer;s=[0,0,m,o]}else{const[m,o]=i.getCanvasContext().getDrawingBufferSize();s=[0,0,m,o]}this.device.pushState(),this.setParameters({viewport:s,...this.props.parameters});const u=this.props.framebuffer;if(u!=null&&u.handle)if(this.props.framebuffer){const m=this.props.framebuffer.colorAttachments.map((o,v)=>36064+v);this.device.gl.drawBuffers(m)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}setParameters(i={}){const n={...this.glParameters};n.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(n.depthMask=!this.props.depthReadOnly),n.stencilMask=this.props.stencilReadOnly?0:1,n[35977]=this.props.discard,i.viewport&&(i.viewport.length>=6?(n.viewport=i.viewport.slice(0,4),n.depthRange=[i.viewport[4],i.viewport[5]]):n.viewport=i.viewport),i.scissorRect&&(n.scissorTest=!0,n.scissor=i.scissorRect),i.blendConstant&&(n.blendColor=i.blendConstant),i.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),i[2967]=i.stencilReference),i.colorMask&&(n.colorMask=zH.map(s=>!!(s&i.colorMask))),this.glParameters=n,qh(this.device.gl,n)}beginOcclusionQuery(i){const n=this.props.occlusionQuerySet;n==null||n.beginOcclusionQuery()}endOcclusionQuery(){const i=this.props.occlusionQuerySet;i==null||i.endOcclusionQuery()}clear(){const i={...this.glParameters};let n=0;this.props.clearColors&&this.props.clearColors.forEach((s,u)=>{s&&this.clearColorBuffer(u,s)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(n|=16384,i.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(n|=256,i.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(n|=1024,i.clearStencil=this.props.clearStencil),n!==0&&ey(this.device.gl,i,()=>{this.device.gl.clear(n)})}clearColorBuffer(i=0,n=[0,0,0,0]){ey(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(n.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,i,n);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,i,n);break;case Float32Array:this.device.gl.clearBufferfv(6144,i,n);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function VH(t){return jH.includes(t)}const jH=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],PP={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function kP(t){const e=PP[t];if(!e)throw new Error("uniform");const[i,n,,s]=e;return{format:s,components:n,glType:i}}function $H(t){const e=PP[t];if(!e)throw new Error("attribute");const[,i,,n,s]=e;return{attributeType:n,vertexFormat:s,components:i}}function WH(t,e){const i={attributes:[],bindings:[]};i.attributes=HH(t,e);const n=GH(t,e);for(const m of n){const o=m.uniforms.map(v=>({name:v.name,format:v.format,byteOffset:v.byteOffset,byteStride:v.byteStride,arrayLength:v.arrayLength}));i.bindings.push({type:"uniform",name:m.name,group:0,location:m.location,visibility:(m.vertex?1:0)&(m.fragment?2:0),minBindingSize:m.byteLength,uniforms:o})}const s=qH(t,e);let u=0;for(const m of s)if(VH(m.type)){const{viewDimension:o,sampleType:v}=YH(m.type);i.bindings.push({type:"texture",name:m.name,group:0,location:u,viewDimension:o,sampleType:v}),m.textureUnit=u,u+=1}s.length&&(i.uniforms=s);const f=XH(t,e);return f!=null&&f.length&&(i.varyings=f),i}function HH(t,e){const i=[],n=t.getProgramParameter(e,35721);for(let s=0;s<n;s++){const u=t.getActiveAttrib(e,s);if(!u)throw new Error("activeInfo");const{name:f,type:m}=u,o=t.getAttribLocation(e,f);if(o>=0){const{attributeType:v}=$H(m),w=/instance/i.test(f)?"instance":"vertex";i.push({name:f,location:o,stepMode:w,type:v})}}return i.sort((s,u)=>s.location-u.location),i}function XH(t,e){const i=[],n=t.getProgramParameter(e,35971);for(let s=0;s<n;s++){const u=t.getTransformFeedbackVarying(e,s);if(!u)throw new Error("activeInfo");const{name:f,type:m,size:o}=u,{glType:v,components:w}=kP(m),S={location:s,name:f,type:v,size:o*w};i.push(S)}return i.sort((s,u)=>s.location-u.location),i}function qH(t,e){const i=[],n=t.getProgramParameter(e,35718);for(let s=0;s<n;s++){const u=t.getActiveUniform(e,s);if(!u)throw new Error("activeInfo");const{name:f,size:m,type:o}=u,{name:v,isArray:w}=KH(f);let S=t.getUniformLocation(e,v);const R={location:S,name:v,size:m,type:o,isArray:w};if(i.push(R),R.size>1)for(let L=0;L<R.size;L++){const j=`${v}[${L}]`;S=t.getUniformLocation(e,j);const Z={...R,name:j,location:S};i.push(Z)}}return i}function GH(t,e){const i=(u,f)=>t.getActiveUniformBlockParameter(e,u,f),n=[],s=t.getProgramParameter(e,35382);for(let u=0;u<s;u++){const f={name:t.getActiveUniformBlockName(e,u)||"",location:i(u,35391),byteLength:i(u,35392),vertex:i(u,35396),fragment:i(u,35398),uniformCount:i(u,35394),uniforms:[]},m=i(u,35395)||[],o=t.getActiveUniforms(e,m,35383),v=t.getActiveUniforms(e,m,35384),w=t.getActiveUniforms(e,m,35387),S=t.getActiveUniforms(e,m,35388);for(let R=0;R<f.uniformCount;++R){const L=t.getActiveUniform(e,m[R]);if(!L)throw new Error("activeInfo");f.uniforms.push({name:L.name,format:kP(o[R]).format,type:o[R],arrayLength:v[R],byteOffset:w[R],byteStride:S[R]})}n.push(f)}return n.sort((u,f)=>u.location-f.location),n}const ZH={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function YH(t){const e=ZH[t];if(!e)throw new Error("sampler");const[i,n]=e;return{viewDimension:i,sampleType:n}}function KH(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const i=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!i||i.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:i[1],length:i[2]?1:0,isArray:!!i[2]}}function JH(t,e,i,n){const s=t;let u=n;u===!0&&(u=1),u===!1&&(u=0);const f=typeof u=="number"?[u]:u;switch(i){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,n);case 5126:return t.uniform1fv(e,f);case 35664:return t.uniform2fv(e,f);case 35665:return t.uniform3fv(e,f);case 35666:return t.uniform4fv(e,f);case 5124:return t.uniform1iv(e,f);case 35667:return t.uniform2iv(e,f);case 35668:return t.uniform3iv(e,f);case 35669:return t.uniform4iv(e,f);case 35670:return t.uniform1iv(e,f);case 35671:return t.uniform2iv(e,f);case 35672:return t.uniform3iv(e,f);case 35673:return t.uniform4iv(e,f);case 5125:return s.uniform1uiv(e,f,1);case 36294:return s.uniform2uiv(e,f,2);case 36295:return s.uniform3uiv(e,f,3);case 36296:return s.uniform4uiv(e,f,4);case 35674:return t.uniformMatrix2fv(e,!1,f);case 35675:return t.uniformMatrix3fv(e,!1,f);case 35676:return t.uniformMatrix4fv(e,!1,f);case 35685:return s.uniformMatrix2x3fv(e,!1,f);case 35686:return s.uniformMatrix2x4fv(e,!1,f);case 35687:return s.uniformMatrix3x2fv(e,!1,f);case 35688:return s.uniformMatrix3x4fv(e,!1,f);case 35689:return s.uniformMatrix4x2fv(e,!1,f);case 35690:return s.uniformMatrix4x3fv(e,!1,f)}throw new Error("Illegal uniform")}function QH(t){return uP(t)!==null||typeof t=="number"||typeof t=="boolean"}function eX(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(i=>{const n=t[i];QH(n)?e.uniforms[i]=n:e.bindings[i]=n}),e}function tX(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function iX(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const z3=4;class nX extends Bh{constructor(i,n){super(i,n);q(this,"device");q(this,"handle");q(this,"vs");q(this,"fs");q(this,"introspectedLayout");q(this,"uniforms",{});q(this,"bindings",{});q(this,"varyings",null);q(this,"_uniformCount",0);q(this,"_uniformSetters",{});this.device=i,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=n.vs,this.fs=n.fs;const{varyings:s,bufferMode:u=35981}=n;s&&s.length>0&&(this.varyings=s,this.device.gl.transformFeedbackVaryings(this.handle,s,u)),this._linkShaders(),Et.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=WH(this.device.gl,this.handle),Et.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=rX(this.introspectedLayout,n.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(i,n){for(const[s,u]of Object.entries(i)){const f=this.shaderLayout.bindings.find(m=>m.name===s)||this.shaderLayout.bindings.find(m=>m.name===`${s}Uniforms`);if(!f){const m=this.shaderLayout.bindings.map(o=>`"${o.name}"`).join(", ");n!=null&&n.disableWarnings||Et.warn(`No binding "${s}" in render pipeline "${this.id}", expected one of ${m}`,u)();continue}switch(u||Et.warn(`Unsetting binding "${s}" in render pipeline "${this.id}"`)(),f.type){case"uniform":if(!(u instanceof Kd)&&!(u.buffer instanceof Kd))throw new Error("buffer value");break;case"texture":if(!(u instanceof yh||u instanceof Jd||u instanceof Yd))throw new Error("texture value");break;case"sampler":Et.warn(`Ignoring sampler ${s}`)();break;default:throw new Error(f.type)}this.bindings[s]=u}}draw(i){var re;const{renderPass:n,parameters:s=this.props.parameters,topology:u=this.props.topology,vertexArray:f,vertexCount:m,instanceCount:o,isInstanced:v=!1,firstVertex:w=0,transformFeedback:S}=i,R=tX(u),L=!!f.indexBuffer,j=(re=f.indexBuffer)==null?void 0:re.glIndexType;if(this.linkStatus!=="success")return Et.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Et.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),f.bindBeforeRender(n),S&&S.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const Z=n;return wH(this.device,s,Z.glParameters,()=>{L&&v?this.device.gl.drawElementsInstanced(R,m||0,j,w,o||0):L?this.device.gl.drawElements(R,m||0,j,w):v?this.device.gl.drawArraysInstanced(R,w,m||0,o||0):this.device.gl.drawArrays(R,w,m||0),S&&S.end()}),f.unbindAfterRender(n),!0}setUniformsWebGL(i){const{bindings:n}=eX(i);Object.keys(n).forEach(s=>{Et.warn(`Unsupported value "${JSON.stringify(n[s])}" used in setUniforms() for key ${s}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,i)}async _linkShaders(){const{gl:i}=this.device;if(i.attachShader(this.handle,this.vs.handle),i.attachShader(this.handle,this.fs.handle),Et.time(z3,`linkProgram for ${this.id}`)(),i.linkProgram(this.handle),Et.timeEnd(z3,`linkProgram for ${this.id}`)(),Et.level,!this.device.features.has("compilation-status-async-webgl")){const s=this._getLinkStatus();this._reportLinkStatus(s);return}Et.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Et.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const n=this._getLinkStatus();this._reportLinkStatus(n)}async _reportLinkStatus(i){var n;switch(i){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((n=this.fs)==null?void 0:n.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const s=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${i}: ${s}`)}}_getLinkStatus(){const{gl:i}=this.device;return i.getProgramParameter(this.handle,35714)?(i.validateProgram(this.handle),i.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const i=async u=>await new Promise(f=>setTimeout(f,u));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:s}=this.device;for(;;){if(s.getProgramParameter(this.handle,37297))return;await i(10)}}_areTexturesRenderable(){let i=!0;for(const n of this.shaderLayout.bindings)!this.bindings[n.name]&&!this.bindings[n.name.replace(/Uniforms$/,"")]&&(Et.warn(`Binding ${n.name} not found in ${this.id}`)(),i=!1);return i}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:i}=this.device;i.useProgram(this.handle);let n=0,s=0;for(const u of this.shaderLayout.bindings){const f=this.bindings[u.name]||this.bindings[u.name.replace(/Uniforms$/,"")];if(!f)throw new Error(`No value for binding ${u.name} in ${this.id}`);switch(u.type){case"uniform":const{name:m}=u,o=i.getUniformBlockIndex(this.handle,m);if(o===4294967295)throw new Error(`Invalid uniform block name ${m}`);i.uniformBlockBinding(this.handle,s,o),f instanceof Kd?i.bindBufferBase(35345,s,f.handle):i.bindBufferRange(35345,s,f.buffer.handle,f.offset||0,f.size||f.buffer.byteLength-f.offset),s+=1;break;case"texture":if(!(f instanceof yh||f instanceof Jd||f instanceof Yd))throw new Error("texture");let v;if(f instanceof yh)v=f.texture;else if(f instanceof Jd)v=f;else if(f instanceof Yd&&f.colorAttachments[0]instanceof yh)Et.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),v=f.colorAttachments[0].texture;else throw new Error("No texture");i.activeTexture(33984+n),i.bindTexture(v.glTarget,v.handle),n+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${u.type}' not supported in WebGL`)}}}_applyUniforms(){for(const i of this.shaderLayout.uniforms||[]){const{name:n,location:s,type:u,textureUnit:f}=i,m=this.uniforms[n]??f;m!==void 0&&JH(this.device.gl,s,u,m)}}}function rX(t,e){const i={...t,attributes:t.attributes.map(n=>({...n}))};for(const n of(e==null?void 0:e.attributes)||[]){const s=i.attributes.find(u=>u.name===n.name);s?(s.type=n.type||s.type,s.stepMode=n.stepMode||s.stepMode):Et.warn(`shader layout attribute ${n.name} not present in shader`)}return i}class sX extends sb{constructor(i){super(i,{});q(this,"device");q(this,"commands",[]);this.device=i}submitCommands(i=this.commands){for(const n of i)switch(n.name){case"copy-buffer-to-buffer":oX(this.device,n.options);break;case"copy-buffer-to-texture":aX(this.device,n.options);break;case"copy-texture-to-buffer":lX(this.device,n.options);break;case"copy-texture-to-texture":cX(this.device,n.options);break;default:throw new Error(n.name)}}}function oX(t,e){const i=e.sourceBuffer,n=e.destinationBuffer;t.gl.bindBuffer(36662,i.handle),t.gl.bindBuffer(36663,n.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function aX(t,e){throw new Error("Not implemented")}function lX(t,e){const{sourceTexture:i,mipLevel:n=0,aspect:s="all",width:u=e.sourceTexture.width,height:f=e.sourceTexture.height,depthOrArrayLayers:m=0,origin:o=[0,0],destinationBuffer:v,byteOffset:w=0,bytesPerRow:S,rowsPerImage:R}=e;if(s!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||m!==0||S||R)throw new Error("not implemented");const{framebuffer:L,destroyFramebuffer:j}=DP(i);let Z;try{const re=v,xe=u||L.width,be=f||L.height,ue=EP(L.colorAttachments[0].texture.props.format),oe=ue.format,Ie=ue.type;t.gl.bindBuffer(35051,re.handle),Z=t.gl.bindFramebuffer(36160,L.handle),t.gl.readPixels(o[0],o[1],xe,be,oe,Ie,w)}finally{t.gl.bindBuffer(35051,null),Z!==void 0&&t.gl.bindFramebuffer(36160,Z),j&&L.destroy()}}function cX(t,e){const{sourceTexture:i,destinationMipLevel:n=0,origin:s=[0,0],destinationOrigin:u=[0,0],destinationTexture:f}=e;let{width:m=e.destinationTexture.width,height:o=e.destinationTexture.height}=e;const{framebuffer:v,destroyFramebuffer:w}=DP(i),[S,R]=s,[L,j,Z]=u,re=t.gl.bindFramebuffer(36160,v.handle);let xe=null,be;if(f instanceof Jd)xe=f,m=Number.isFinite(m)?m:xe.width,o=Number.isFinite(o)?o:xe.height,xe.bind(0),be=xe.glTarget;else throw new Error("invalid destination");switch(be){case 3553:case 34067:t.gl.copyTexSubImage2D(be,n,L,j,S,R,m,o);break;case 35866:case 32879:t.gl.copyTexSubImage3D(be,n,L,j,Z,S,R,m,o);break}xe&&xe.unbind(),t.gl.bindFramebuffer(36160,re),w&&v.destroy()}function DP(t){if(t instanceof kn){const{width:e,height:i,id:n}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:i,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class uX extends rb{constructor(i,n){super(i,n);q(this,"device");q(this,"commandBuffer");this.device=i,this.commandBuffer=new sX(i)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(i){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:i})}copyBufferToTexture(i){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:i})}copyTextureToBuffer(i){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:i})}copyTextureToTexture(i){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:i})}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}resolveQuerySet(i,n,s){}}function hX(t){const{target:e,source:i,start:n=0,count:s=1}=t,u=i.length,f=s*u;let m=0;for(let o=n;m<u;m++)e[o++]=i[m];for(;m<f;)m<f-m?(e.copyWithin(n+m,n,n+m),m*=2):(e.copyWithin(n+m,n,n+f-m),m=f);return t.target}class Z1 extends ob{constructor(i,n){super(i,n);q(this,"device");q(this,"handle");q(this,"buffer",null);q(this,"bufferValue",null);this.device=i,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(i){return kU()==="Chrome"}destroy(){var i;super.destroy(),this.buffer&&((i=this.buffer)==null||i.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(i){const n=i;if(n&&n.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,n?n.handle:null),this.indexBuffer=n,this.device.gl.bindVertexArray(null)}setBuffer(i,n){const s=n;if(s.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:u,type:f,stride:m,offset:o,normalized:v,integer:w,divisor:S}=this._getAccessor(i);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,s.handle),w?this.device.gl.vertexAttribIPointer(i,u,f,m,o):this.device.gl.vertexAttribPointer(i,u,f,v,m,o),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(i),this.device.gl.vertexAttribDivisor(i,S||0),this.attributes[i]=s,this.device.gl.bindVertexArray(null)}setConstantWebGL(i,n){this._enable(i,!1),this.attributes[i]=n}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let i=0;i<this.maxVertexAttributes;++i){const n=this.attributes[i];ArrayBuffer.isView(n)&&this.device.setConstantAttributeWebGL(i,n)}}_getAccessor(i){const n=this.attributeInfos[i];if(!n)throw new Error(`Unknown attribute location ${i}`);const s=TP(n.bufferDataType);return{size:n.bufferComponents,type:s,stride:n.byteStride,offset:n.byteOffset,normalized:n.normalized,integer:n.integer,divisor:n.stepMode==="instance"?1:0}}_enable(i,n=!0){const u=Z1.isConstantAttributeZeroSupported(this.device)||i!==0;(n||u)&&(i=Number(i),this.device.gl.bindVertexArray(this.handle),n?this.device.gl.enableVertexAttribArray(i):this.device.gl.disableVertexAttribArray(i),this.device.gl.bindVertexArray(null))}getConstantBuffer(i,n){const s=fX(n),u=s.byteLength*i,f=s.length*i;if(this.buffer&&u!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${u} !== ${this.buffer.byteLength}.`);let m=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:u}),m=m||!dX(s,this.bufferValue),m){const o=_8(n.constructor,f);hX({target:o,source:s,start:0,count:f}),this.buffer.write(o),this.bufferValue=n}return this.buffer}}function fX(t){return Array.isArray(t)?new Float32Array(t):t}function dX(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}class pX extends ab{constructor(i,n){super(i,n);q(this,"device");q(this,"gl");q(this,"handle");q(this,"layout");q(this,"buffers",{});q(this,"unusedBuffers",{});q(this,"bindOnUse",!0);q(this,"_bound",!1);this.device=i,this.gl=i.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,n.buffers&&this.setBuffers(n.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(i="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(iX(i))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(i){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const n in i)this.setBuffer(n,i[n])})}setBuffer(i,n){const s=this._getVaryingIndex(i),{buffer:u,byteLength:f,byteOffset:m}=this._getBufferRange(n);if(s<0){this.unusedBuffers[i]=u,Et.warn(`${this.id} unusedBuffers varying buffer ${i}`)();return}this.buffers[s]={buffer:u,byteLength:f,byteOffset:m},this.bindOnUse||this._bindBuffer(s,u,m,f)}getBuffer(i){if(U3(i))return this.buffers[i]||null;const n=this._getVaryingIndex(i);return n>=0?this.buffers[n]:null}bind(i=this.handle){if(typeof i!="function")return this.gl.bindTransformFeedback(36386,i),this;let n;return this._bound?n=i():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,n=i(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),n}unbind(){this.bind(null)}_getBufferRange(i){if(i instanceof Kd)return{buffer:i,byteOffset:0,byteLength:i.byteLength};const{buffer:n,byteOffset:s=0,byteLength:u=i.buffer.byteLength}=i;return{buffer:n,byteOffset:s,byteLength:u}}_getVaryingIndex(i){if(U3(i))return Number(i);for(const n of this.layout.varyings)if(i===n.name)return n.location;return-1}_bindBuffers(){for(const i in this.buffers){const{buffer:n,byteLength:s,byteOffset:u}=this._getBufferRange(this.buffers[i]);this._bindBuffer(Number(i),n,u,s)}}_unbindBuffers(){for(const i in this.buffers)this.gl.bindBufferBase(35982,Number(i),null)}_bindBuffer(i,n,s=0,u){const f=n&&n.handle;!f||u===void 0?this.gl.bindBufferBase(35982,i,f):this.gl.bindBufferRange(35982,i,f,s,u)}}function U3(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class mX extends lb{constructor(i,n){super(i,n);q(this,"device");q(this,"handle");q(this,"target",null);q(this,"_queryPending",!1);q(this,"_pollingPromise",null);if(this.device=i,n.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(i){return this._begin(i!=null&&i.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(i){this._queryPending||(this.target=i,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const i=this.device.gl.getQueryParameter(this.handle,34919);return i&&(this._queryPending=!1),i}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(i=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((s,u)=>{const f=()=>{this.isResultAvailable()?(s(this.getResult()),this._pollingPromise=null):n++>i?(u("Timed out"),this._pollingPromise=null):requestAnimationFrame(f)};requestAnimationFrame(f)}),this._pollingPromise}}class xh extends vl{constructor(i){var S,R;super({...i,id:i.id||_H("webgl-device")});q(this,"type","webgl");q(this,"handle");q(this,"features");q(this,"limits");q(this,"info");q(this,"canvasContext");q(this,"lost");q(this,"_resolveContextLost");q(this,"gl");q(this,"debug",!1);q(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});q(this,"_extensions",{});q(this,"_polyfilled",!1);q(this,"spectorJS");q(this,"renderPass",null);q(this,"_constants");const n=vl._getCanvasContextProps(i);if(!n)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let s=(R=(S=n.canvas)==null?void 0:S.gl)==null?void 0:R.device;if(s)throw new Error(`WebGL context already attached to device ${s.id}`);this.canvasContext=new oH(this,n),this.lost=new Promise(L=>{this._resolveContextLost=L});const u={...i.webgl};n.alphaMode==="premultiplied"&&(u.premultipliedAlpha=!0),i.powerPreference!==void 0&&(u.powerPreference=i.powerPreference);const m=this.props._handle||U7(this.canvasContext.canvas,{onContextLost:L=>{var j;return(j=this._resolveContextLost)==null?void 0:j.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:L=>console.log("WebGL context restored")},u);if(!m)throw new Error("WebGL context creation failed");if(s=m.device,s){if(i._reuseDevices)return Et.log(1,`Not creating a new Device, instead returning a reference to Device ${s.id} already attached to WebGL context`,s)(),s._reused=!0,s;throw new Error(`WebGL context already attached to device ${s.id}`)}this.handle=m,this.gl=m,this.spectorJS=cH({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=V7(this.gl,this._extensions),this.limits=new nH(this.gl),this.features=new iH(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),n.autoResize!==!1&&this.canvasContext.resize(),new kc(this.gl,{log:(...L)=>Et.log(1,...L)()}).trackState(this.gl,{copyState:!1});const v=i.debugWebGL||i.debug,w=i.debugWebGL;v&&(this.gl=fH(this.gl,{debugWebGL:v,traceWebGL:w}),Et.warn("WebGL debug mode activated. Performance reduced.")(),i.debugWebGL&&(Et.level=Math.max(Et.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(i){throw new Error("WebGL only supports a single canvas")}createBuffer(i){const n=this._normalizeBufferProps(i);return new Kd(this,n)}createTexture(i){return new Jd(this,i)}createExternalTexture(i){throw new Error("createExternalTexture() not implemented")}createSampler(i){return new Cb(this,i)}createShader(i){return new bH(this,i)}createFramebuffer(i){return new Yd(this,i)}createVertexArray(i){return new Z1(this,i)}createTransformFeedback(i){return new pX(this,i)}createQuerySet(i){return new mX(this,i)}createRenderPipeline(i){return new nX(this,i)}beginRenderPass(i){return new UH(this,i)}createComputePipeline(i){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(i){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(i={}){return new uX(this,i)}submit(){var i;(i=this.renderPass)==null||i.end(),this.renderPass=null}readPixelsToArrayWebGL(i,n){return LH(i,n)}readPixelsToBufferWebGL(i,n){return BH(i,n)}setParametersWebGL(i){qh(this.gl,i)}getParametersWebGL(i){return bP(this.gl,i)}withParametersWebGL(i,n){return ey(this.gl,i,n)}resetWebGL(){Et.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),L7(this.gl)}_getDeviceSpecificTextureFormatCapabilities(i){return J7(this.gl,i,this._extensions)}loseDevice(){var u;let i=!1;const s=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return s&&(i=!0,s.loseContext()),(u=this._resolveContextLost)==null||u.call(this,{reason:"destroyed",message:"Application triggered context loss"}),i}pushState(){kc.get(this.gl).push()}popState(){kc.get(this.gl).pop()}setSpectorMetadata(i,n){i.__SPECTOR_Metadata=n}getGLKey(i,n){const s=Number(i);for(const u in this.gl)if(this.gl[u]===s)return`GL.${u}`;return n!=null&&n.emptyIfUnknown?"":String(i)}getGLKeys(i){const n={emptyIfUnknown:!0};return Object.entries(i).reduce((s,[u,f])=>(s[`${u}:${this.getGLKey(u,n)}`]=`${f}:${this.getGLKey(f,n)}`,s),{})}setConstantAttributeWebGL(i,n){const s=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(s).fill(null);const u=this._constants[i];switch(u&&xX(u,n)&&Et.info(1,`setConstantAttributeWebGL(${i}) could have been skipped, value unchanged`)(),this._constants[i]=n,n.constructor){case Float32Array:gX(this,i,n);break;case Int32Array:_X(this,i,n);break;case Uint32Array:yX(this,i,n);break;default:throw new Error("constant")}}getExtension(i){return Wh(this.gl,i,this._extensions),this._extensions}}function gX(t,e,i){switch(i.length){case 1:t.gl.vertexAttrib1fv(e,i);break;case 2:t.gl.vertexAttrib2fv(e,i);break;case 3:t.gl.vertexAttrib3fv(e,i);break;case 4:t.gl.vertexAttrib4fv(e,i);break}}function _X(t,e,i){t.gl.vertexAttribI4iv(e,i)}function yX(t,e,i){t.gl.vertexAttribI4uiv(e,i)}function xX(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}const vX={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},bX=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),wX=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),TX=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function EX(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(i,n){if(i==="webgl"||i==="experimental-webgl"){const s=this.originalGetContext("webgl2",n);return s instanceof HTMLElement&&AX(s),s}return this.originalGetContext(i,n)}}function AX(t){t.getExtension("EXT_color_buffer_float");const e={...vX,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:bX(t),OES_vertex_array_object:wX(t),ANGLE_instanced_arrays:TX(t)},i=t.getExtension;t.getExtension=function(s){const u=i.call(t,s);return u||(s in e?e[s]:null)};const n=t.getSupportedExtensions;t.getSupportedExtensions=function(){const s=n.apply(t)||[];return s==null?void 0:s.concat(Object.keys(e))}}const Fg=1;class SX extends qV{constructor(){super();q(this,"type","webgl");vl.defaultProps={...vl.defaultProps,...G1},xh.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(i){EX(i)}async attach(i){if(i instanceof xh)return i;if((i==null?void 0:i.device)instanceof vl)return i.device;if(!IX(i))throw new Error("Invalid WebGL2RenderingContext");return new xh({_handle:i,createCanvasContext:{canvas:i.canvas,autoResize:!1}})}async create(i={}){Et.groupCollapsed(Fg,"WebGLDevice created")();const n=[];(i.debugWebGL||i.debug)&&n.push(hH()),i.debugSpectorJS&&n.push(lH(i));const s=await Promise.allSettled(n);for(const m of s)m.status==="rejected"&&Et.error(`Failed to initialize debug libraries ${m.reason}`)();const u=new xh(i),f=`${u._reused?"Reusing":"Created"} device with WebGL2 ${u.debug?"debug ":""}context: ${u.info.vendor}, ${u.info.renderer} for canvas: ${u.canvasContext.id}`;return Et.probe(Fg,f)(),Et.table(Fg,u.info)(),Et.groupEnd(Fg)(),u}}function IX(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const V3=new SX;function ul(){}const CX=({isDragging:t})=>t?"grabbing":"grab",OP={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:ul,onWebGLInitialized:ul,onResize:ul,onViewStateChange:ul,onInteractionStateChange:ul,onBeforeRender:ul,onAfterRender:ul,onLoad:ul,onError:t=>Gi.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:CX,getTooltip:null,debug:!1,drawPickingColors:!1};class xp{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new ky({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:s}=this;if(n.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(n.leftButton||n.rightButton)return;{const u=n.offsetCenter;if(!u)return;s.x=u.x,s.y=u.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=n},this._onEvent=n=>{const s=_b[n.type],u=n.offsetCenter;if(!s||!u||!this.layerManager)return;const f=this.layerManager.getLayers(),m=this.deckPicker.getLastPickedObject({x:u.x,y:u.y,layers:f,viewports:this.getViewports(u)},this._lastPointerDownInfo),{layer:o}=m,v=o&&(o[s]||o.props[s]),w=this.props[s];let S=!1;v&&(S=v.call(o,m,n)),S||(w==null||w(m,n),this.widgetManager.onEvent(m,n))},this._onPointerDown=n=>{var f;if(((f=this.device)==null?void 0:f.type)==="webgpu")return;const s=n.offsetCenter,u=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=u.result[0]||u.emptyInfo},this.props={...OP,...e},e=this.props,e.viewState&&e.initialViewState&&Gi.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let i=this.device;!i&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Gi.error("WebGL1 context not supported.")(),i=V3.attach(e.gl)),i||(i=tb.createDevice({type:"best-available",_reuseDevices:!0,adapters:[V3],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(i,e),this.setProps(e),e._typedArrayManagerProps&&yp.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,i,n,s,u,f,m,o,v,w;(e=this.animationLoop)==null||e.stop(),(i=this.animationLoop)==null||i.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)==null||n.finalize(),this.layerManager=null,(s=this.viewManager)==null||s.finalize(),this.viewManager=null,(u=this.effectManager)==null||u.finalize(),this.effectManager=null,(f=this.deckRenderer)==null||f.finalize(),this.deckRenderer=null,(m=this.deckPicker)==null||m.finalize(),this.deckPicker=null,(o=this.eventManager)==null||o.destroy(),this.eventManager=null,(v=this.widgetManager)==null||v.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((w=this.canvas.parentElement)==null||w.removeChild(this.canvas),this.canvas=null)}setProps(e){var n;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Gi.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Gi.removed("onLayerClick","onClick")(),e.initialViewState&&!ts(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const i=Object.create(this.props);Object.assign(i,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(n=this.animationLoop)==null||n.setProps(i),this.layerManager&&(this.viewManager.setProps(i),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(i),this.effectManager.setProps(i),this.deckRenderer.setProps(i),this.deckPicker.setProps(i),this.widgetManager.setProps(i)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),u=this.effectManager.needsRedraw(e),f=this.deckRenderer.needsRedraw(e);return i=i||n||s||u||f,i}redraw(e){if(!this.layerManager)return;let i=this.needsRedraw({clearRedrawFlags:!0});i=e||i,i&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(i):this._drawLayers(i))}get isInitialized(){return this.viewManager!==null}getViews(){return tr(this.viewManager),this.viewManager.views}getViewports(e){return tr(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const i=this._pick("pickObject","pickObject Time",e).result;return i.length?i[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,i=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:i})}_removeResources(e){for(const i of e)this.layerManager.resourceManager.remove(i)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var i;(i=this.layerManager)==null||i.removeDefaultShaderModule(e)}_pick(e,i,n){tr(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(i).timeStart();const u=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return s.get(i).timeEnd(),u}_createCanvas(e){let i=e.canvas;return typeof i=="string"&&(i=document.getElementById(i),tr(i)),i||(i=document.createElement("canvas"),i.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(i)),Object.assign(i.style,e.style),i}_setCanvasSize(e){var s;if(!this.canvas)return;const{width:i,height:n}=e;if(i||i===0){const u=Number.isFinite(i)?`${i}px`:i;this.canvas.style.width=u}if(n||n===0){const u=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=((s=e.style)==null?void 0:s.position)||"absolute",this.canvas.style.height=u}}_updateCanvasSize(){var s,u;const{canvas:e}=this;if(!e)return;const i=e.clientWidth??e.width,n=e.clientHeight??e.height;(i!==this.width||n!==this.height)&&(this.width=i,this.height=n,(s=this.viewManager)==null||s.setProps({width:i,height:n}),(u=this.layerManager)==null||u.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:n}))}_createAnimationLoop(e,i){const{gl:n,onError:s,useDevicePixels:u}=i;return new k9({device:e,useDevicePixels:u,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:f=>this._setDevice(f.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,i=Array.isArray(e)?e:e?[e]:[new W1({id:"default-view"})];return i.length&&this.props.controller&&(i[0].props.controller=this.props.controller),i}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var i,n,s,u;if(((i=this.device)==null?void 0:i.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:f,emptyInfo:m}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=f.length>0;let o=m,v=!1;for(const w of f)o=w,v=((n=w.layer)==null?void 0:n.onHover(w,e.event))||v;v||((u=(s=this.props).onHover)==null||u.call(s,o,e.event),this.widgetManager.onHover(o,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var s,u;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(s=this.device.canvasContext)==null?void 0:s.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const i=new cP;i.play(),this.animationLoop.attachTimeline(i),this.eventManager=new aW(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(a3).map(f=>{var L;const[m,o,v,w]=a3[f],S=(L=this.props.eventRecognizerOptions)==null?void 0:L[f],R={...o,...S,event:f};return{recognizer:new m(R),recognizeWith:v,requestFailure:w}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const f in _b)this.eventManager.on(f,this._onEvent);this.viewManager=new n7({timeline:i,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new i7(this.device,{deck:this,stats:this.stats,viewport:n,timeline:i}),this.effectManager=new _7({deck:this,device:this.device}),this.deckRenderer=new v7(this.device),this.deckPicker=new S7(this.device),this.widgetManager=new M7({deck:this,parentElement:(u=this.canvas)==null?void 0:u.parentElement}),this.widgetManager.addDefault(new P7),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,i){var f;const{device:n,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:s});const u={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...i};(f=this.deckRenderer)==null||f.renderLayers(u),u.pass==="screen"&&this.widgetManager.onRedraw({viewports:u.viewports,layers:u.layers}),this.props.onAfterRender({device:n,gl:s})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Gi.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const i=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:i},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const i=this.animationLoop.stats;e.get("GPU Time").addTime(i.get("GPU Time").lastTiming),e.get("CPU Time").addTime(i.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:i}=this;e.fps=i.get("frameRate").getHz(),e.setPropsTime=i.get("setProps Time").time,e.updateAttributesTime=i.get("Update Attributes").time,e.framesRedrawn=i.get("Redraw Count").count,e.pickTime=i.get("pickObject Time").time+i.get("pickMultipleObjects Time").time+i.get("pickObjects Time").time,e.pickCount=i.get("Pick Count").count,e.gpuTime=i.get("GPU Time").time,e.cpuTime=i.get("CPU Time").time,e.gpuTimePerFrame=i.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=i.get("CPU Time").getAverageTime();const n=tb.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}xp.defaultProps=OP;xp.VERSION=Q5;function MX(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return aR(t)}}const RX=oR;function Ng(t,e,i){const n=i==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${n}x${e.size}`:e.type,byteOffset:e.offset||0}}function Ic(t){return t.stride||t.size*t.bytesPerElement}function PX(t,e){return t.type===e.type&&t.size===e.size&&Ic(t)===Ic(e)&&(t.offset||0)===(e.offset||0)}function Mb(t,e){e.offset&&Gi.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const i=Ic(t),n=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,s=e.elementOffset||0,u=n*i+s*t.bytesPerElement+(t.offset||0);return{...e,offset:u,stride:i}}function kX(t,e){const i=Mb(t,e);return{high:i,low:{...i,offset:i.offset+t.size*4}}}class DX{constructor(e,i,n){this._buffer=null,this.device=e,this.id=i.id||"",this.size=i.size||1;const s=i.logicalType||i.type,u=s==="float64";let{defaultValue:f}=i;f=Number.isFinite(f)?[f]:f||new Array(this.size).fill(0);let m;u?m="float32":!s&&i.isIndexed?m="uint32":m=s||"float32";let o=MX(s||m);this.doublePrecision=u,u&&i.fp64===!1&&(o=Float32Array),this.value=null,this.settings={...i,defaultType:o,defaultValue:f,logicalType:s,type:m,normalized:m.includes("norm"),size:this.size,bytesPerElement:o.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Ic(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),yp.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,i=null){const n={};if(this.state.constant){const s=this.value;if(i){const u=Mb(this.getAccessor(),i),f=u.offset/s.BYTES_PER_ELEMENT,m=u.size||this.size;n[e]=s.subarray(f,f+m)}else n[e]=s}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,i=null){const n=this.getAccessor(),s=[],u={name:this.id,byteStride:Ic(n),attributes:s};if(this.doublePrecision){const f=kX(n,i||{});s.push(Ng(e,{...n,...f.high},this.device.type),Ng(`${e}64Low`,{...n,...f.low},this.device.type))}else if(i){const f=Mb(n,i);s.push(Ng(e,{...n,...f},this.device.type))}else s.push(Ng(e,n,this.device.type));return u}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const i=Array.from(this.value);e=[i,i]}else{const{value:i,numInstances:n,size:s}=this,u=n*s;if(i&&u&&i.length>=u){const f=new Array(s).fill(1/0),m=new Array(s).fill(-1/0);for(let o=0;o<u;)for(let v=0;v<s;v++){const w=i[o++];w<f[v]&&(f[v]=w),w>m[v]&&(m[v]=w)}e=[f,m]}}return this.state.bounds=e,e}setData(e){const{state:i}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof yn?n={buffer:e}:n=e;const s={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)s.type="float32";else{const f=RX(n.value);s.type=s.normalized?f.replace("int","norm"):f}s.bytesPerElement=n.value.BYTES_PER_ELEMENT,s.stride=Ic(s)}if(i.bounds=null,n.constant){let u=n.value;if(u=this._normalizeValue(u,[],0),this.settings.normalized&&(u=this.normalizeConstant(u)),!(!i.constant||!this._areValuesEqual(u,this.value)))return!1;i.externalBuffer=null,i.constant=!0,this.value=ArrayBuffer.isView(u)?u:new Float32Array(u)}else if(n.buffer){const u=n.buffer;i.externalBuffer=u,i.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let u=n.value;i.externalBuffer=null,i.constant=!1,this.value=u;let{buffer:f}=this;const m=Ic(s),o=(s.vertexOffset||0)*m;if(this.doublePrecision&&u instanceof Float64Array&&(u=Gx(u,s)),this.settings.isIndexed){const w=this.settings.defaultType;u.constructor!==w&&(u=new w(u))}const v=u.byteLength+o+m*2;(!f||f.byteLength<v)&&(f=this._createBuffer(v)),f.write(u,o)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const i=this.value,{startOffset:n=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&i instanceof Float64Array?Gx(i,{size:this.size,startIndex:n,endIndex:s}):i.subarray(n,s),n*i.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,i=!1){const{state:n}=this,s=n.allocatedValue,u=yp.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:i});this.value=u;const{byteOffset:f}=this;let{buffer:m}=this;return(!m||m.byteLength<u.byteLength+f)&&(m=this._createBuffer(u.byteLength+f),i&&s&&m.write(s instanceof Float64Array?Gx(s,this):s,f)),n.allocatedValue=u,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:i}=e;if(!ArrayBuffer.isView(i))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=i.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${i.constructor.name}`);!(i instanceof n)&&this.settings.normalized&&!("normalized"in e)&&Gi.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(i=>(i+128)/255*2-1);case"snorm16":return new Float32Array(e).map(i=>(i+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(i=>i/255);case"unorm16":return new Float32Array(e).map(i=>i/65535);default:return e}}_normalizeValue(e,i,n){const{defaultValue:s,size:u}=this.settings;if(Number.isFinite(e))return i[n]=e,i;if(!e){let f=u;for(;--f>=0;)i[n+f]=s[f];return i}switch(u){case 4:i[n+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:i[n+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:i[n+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:i[n+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let f=u;for(;--f>=0;)i[n+f]=Number.isFinite(e[f])?e[f]:s[f]}return i}_areValuesEqual(e,i){if(!e||!i)return!1;const{size:n}=this;for(let s=0;s<n;s++)if(e[s]!==i[s])return!1;return!0}_createBuffer(e){var s;this._buffer&&this._buffer.destroy();const{isIndexed:i,type:n}=this.settings;return this._buffer=this.device.createBuffer({...(s=this._buffer)==null?void 0:s.props,id:this.id,usage:(i?yn.INDEX:yn.VERTEX)|yn.COPY_DST,indexType:i?n:void 0,byteLength:e}),this._buffer}}const j3=[],$3=[];function LP(t,e=0,i=1/0){let n=j3;const s={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?n=t:t.length>0&&($3.length=t.length,n=$3):n=j3,(e>0||Number.isFinite(i))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,i),s.index=e-1),{iterable:n,objectInfo:s}}function BP(t){return t&&t[Symbol.asyncIterator]}function OX(t,e){const{size:i,stride:n,offset:s,startIndices:u,nested:f}=e,m=t.BYTES_PER_ELEMENT,o=n?n/m:i,v=s?s/m:0,w=Math.floor((t.length-v)/o);return(S,{index:R,target:L})=>{if(!u){const xe=R*o+v;for(let be=0;be<i;be++)L[be]=t[xe+be];return L}const j=u[R],Z=u[R+1]||w;let re;if(f){re=new Array(Z-j);for(let xe=j;xe<Z;xe++){const be=xe*o+v;L=new Array(i);for(let ue=0;ue<i;ue++)L[ue]=t[be+ue];re[xe-j]=L}}else if(o===i)re=t.subarray(j*i+v,Z*i+v);else{re=new t.constructor((Z-j)*i);let xe=0;for(let be=j;be<Z;be++){const ue=be*o+v;for(let oe=0;oe<i;oe++)re[xe++]=t[ue+oe]}}return re}}const LX=[],n_=[[0,1/0]];function BX(t,e){if(t===n_||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const i=[],n=t.length;let s=0;for(let u=0;u<n;u++){const f=t[u];f[1]<e[0]?(i.push(f),s=u+1):f[0]>e[1]?i.push(f):e=[Math.min(f[0],e[0]),Math.max(f[1],e[1])]}return i.splice(s,0,e),i}const FX={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function FP(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const i=t.type||"interpolation";return{...FX[i],...e,...t,type:i}}class NP extends DX{constructor(e,i){super(e,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:n_}),this.constant=!1,this.settings.update=i.update||(i.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const i=this.state.needsRedraw;return this.state.needsRedraw=i&&!e,i}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var i;(i=this.state).layoutChanged||(i.layoutChanged=!PX(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:i}=this.settings,n=this.settings.transition,s=Array.isArray(i)?e[i.find(u=>e[u])]:e[i];return FP(s,n)}setNeedsUpdate(e=this.id,i){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),i){const{startRow:n=0,endRow:s=1/0}=i;this.state.updateRanges=BX(this.state.updateRanges,[n,s])}else this.state.updateRanges=n_}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=LX}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:i,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,i.updateRanges!==n_),!0):!1}updateBuffer({numInstances:e,data:i,props:n,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:u},settings:{update:f,noAlloc:m}}=this;let o=!0;if(f){for(const[v,w]of u)f.call(s,this,{data:i,startRow:v,endRow:w,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[v,w]of u){const S=Number.isFinite(v)?this.getVertexOffset(v):0,R=Number.isFinite(w)?this.getVertexOffset(w):m||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:S,endOffset:R})}this._checkAttributeArray()}else o=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),o}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:i}=this;return e?(this.clearNeedsUpdate(),i.lastExternalBuffer===e||(i.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(i.lastExternalBuffer=null,!1)}setBinaryValue(e,i=null){const{state:n,settings:s}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),s.transform||i!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const f=e;tr(ArrayBuffer.isView(f.value),`invalid ${s.accessor}`);const m=!!f.size&&f.size!==this.size;return n.binaryAccessor=OX(f.value,{size:f.size||this.size,stride:f.stride,offset:f.offset,startIndices:i,nested:m}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:i}=this;return(i?e<i.length?i[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,i=super.getValue();if(!e)return i;for(const n in e)Object.assign(i,super.getValue(n,e[n]));return i}getBufferLayout(e){this.state.layoutChanged=!1;const i=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=s??"vertex",!i)return n;for(const u in i){const f=super._getBufferLayout(u,i[u]);n.attributes.push(...f.attributes)}return n}_autoUpdater(e,{data:i,startRow:n,endRow:s,props:u,numInstances:f}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:m,state:o,value:v,size:w,startIndices:S}=e,{accessor:R,transform:L}=m;let j=o.binaryAccessor||(typeof R=="function"?R:u[R]);typeof j!="function"&&(j=()=>j),tr(typeof j=="function",`accessor "${R}" is not a function`);let Z=e.getVertexOffset(n);const{iterable:re,objectInfo:xe}=LP(i,n,s);for(const be of re){xe.index++;let ue=j(be,xe);if(L&&(ue=L.call(this,ue)),S){const oe=(xe.index<S.length-1?S[xe.index+1]:f)-S[xe.index];if(ue&&Array.isArray(ue[0])){let Ie=Z;for(const me of ue)e._normalizeValue(me,v,Ie),Ie+=w}else ue&&ue.length>w?v.set(ue,Z):(e._normalizeValue(ue,xe.target,0),K9({target:v,source:xe.target,start:Z,count:oe}));Z+=oe*w}else e._normalizeValue(ue,v,Z),Z+=w}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,i=Math.min(4,this.size);if(e&&e.length>=i){let n=!0;switch(i){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function nv(t){const{source:e,target:i,start:n=0,size:s,getData:u}=t,f=t.end||i.length,m=e.length,o=f-n;if(m>o){i.set(e.subarray(0,o),n);return}if(i.set(e,n),!u)return;let v=m;for(;v<o;){const w=u(v,e);for(let S=0;S<s;S++)i[n+v]=w[S]||0,v++}}function NX({source:t,target:e,size:i,getData:n,sourceStartIndices:s,targetStartIndices:u}){if(!s||!u)return nv({source:t,target:e,size:i,getData:n}),e;let f=0,m=0;const o=n&&((w,S)=>n(w+m,S)),v=Math.min(s.length,u.length);for(let w=1;w<v;w++){const S=s[w]*i,R=u[w]*i;nv({source:t.subarray(f,S),target:e,start:m,end:R,size:i,getData:o}),f=S,m=R}return m<e.length&&nv({source:[],target:e,start:m,size:i,getData:o}),e}function zX(t){const{device:e,settings:i,value:n}=t,s=new NP(e,i);return s.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:i.normalized}),s}function zP(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function UP(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function VP(t){t.push(t.shift())}function UX(t,e){const{doublePrecision:i,settings:n,value:s,size:u}=t,f=i&&s instanceof Float64Array?2:1;let m=0;const{shaderAttributes:o}=t.settings;if(o)for(const v of Object.values(o))m=Math.max(m,v.vertexOffset??0);return(n.noAlloc?s.length:(e+m)*u)*f}function jP({device:t,source:e,target:i}){return(!i||i.byteLength<e.byteLength)&&(i==null||i.destroy(),i=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),i}function $P({device:t,buffer:e,attribute:i,fromLength:n,toLength:s,fromStartIndices:u,getData:f=m=>m}){const m=i.doublePrecision&&i.value instanceof Float64Array?2:1,o=i.size*m,v=i.byteOffset,w=i.settings.bytesPerElement<4?v/i.settings.bytesPerElement*4:v,S=i.startIndices,R=u&&S,L=i.isConstant;if(!R&&e&&n>=s)return e;const j=i.value instanceof Float64Array?Float32Array:i.value.constructor,Z=L?i.value:new j(i.getBuffer().readSyncWebGL(v,s*j.BYTES_PER_ELEMENT).buffer);if(i.settings.normalized&&!L){const ue=f;f=(oe,Ie)=>i.normalizeConstant(ue(oe,Ie))}const re=L?(ue,oe)=>f(Z,oe):(ue,oe)=>f(Z.subarray(ue+v,ue+v+o),oe),xe=e?new Float32Array(e.readSyncWebGL(w,n*4).buffer):new Float32Array(0),be=new Float32Array(s);return NX({source:xe,target:be,sourceStartIndices:u,targetStartIndices:S,size:o,getData:re}),(!e||e.byteLength<be.byteLength+w)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:be.byteLength+w,usage:35050})),e.write(be,w),e}class WP{constructor({device:e,attribute:i,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Fy(n),this.attribute=i,this.attributeInTransition=zX(i),this.currentStartIndices=i.startIndices}get inProgress(){return this.transition.inProgress}start(e,i,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=UX(this.attribute,i),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class VX extends WP{constructor({device:e,attribute:i,timeline:n}){super({device:e,attribute:i,timeline:n}),this.type="interpolation",this.transform=HX(e,i)}start(e,i){const n=this.currentLength,s=this.currentStartIndices;if(super.start(e,i,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:u,attribute:f}=this;VP(u),u[0]=$P({device:this.device,buffer:u[0],attribute:f,fromLength:n,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),u[1]=jP({device:this.device,source:u[0],target:u[1]}),this.setBuffer(u[1]);const{transform:m}=this,o=m.model;let v=Math.floor(this.currentLength/f.size);HP(f)&&(v/=2),o.setVertexCount(v),f.isConstant?(o.setAttributes({aFrom:u[0]}),o.setConstantAttributes({aTo:f.value})):o.setAttributes({aFrom:u[0],aTo:f.getBuffer()}),m.transformFeedback.setBuffers({vCurrent:u[1]})}onUpdate(){const{duration:e,easing:i}=this.settings,{time:n}=this.transition;let s=n/e;i&&(s=i(s));const{model:u}=this.transform,f={time:s};u.shaderInputs.setProps({interpolation:f}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const jX=`uniform interpolationUniforms {
  float time;
} interpolation;
`,W3={name:"interpolation",vs:jX,uniformTypes:{time:"f32"}},$X=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,WX=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function HP(t){return t.doublePrecision&&t.value instanceof Float64Array}function HX(t,e){const i=e.size,n=zP(i),s=UP(i),u=e.getBufferLayout();return HP(e)?new jh(t,{vs:WX,bufferLayout:[{name:"aFrom",byteStride:8*i,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*i}]},{name:"aTo",byteStride:8*i,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*i}]}],modules:[e$,W3],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:i},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new jh(t,{vs:$X,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:u.attributes[0].format}],modules:[W3],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class XX extends WP{constructor({device:e,attribute:i,timeline:n}){super({device:e,attribute:i,timeline:n}),this.type="spring",this.texture=JX(e),this.framebuffer=QX(e,this.texture),this.transform=KX(e,i)}start(e,i){const n=this.currentLength,s=this.currentStartIndices;super.start(e,i);const{buffers:u,attribute:f}=this;for(let o=0;o<2;o++)u[o]=$P({device:this.device,buffer:u[o],attribute:f,fromLength:n,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});u[2]=jP({device:this.device,source:u[0],target:u[2]}),this.setBuffer(u[1]);const{model:m}=this.transform;m.setVertexCount(Math.floor(this.currentLength/f.size)),f.isConstant?m.setConstantAttributes({aTo:f.value}):m.setAttributes({aTo:f.getBuffer()})}onUpdate(){const{buffers:e,transform:i,framebuffer:n,transition:s}=this,u=this.settings;i.model.setAttributes({aPrev:e[0],aCur:e[1]}),i.transformFeedback.setBuffers({vNext:e[2]});const f={stiffness:u.stiffness,damping:u.damping};i.model.shaderInputs.setProps({spring:f}),i.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),VP(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const qX=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,GX={name:"spring",vs:qX,uniformTypes:{damping:"f32",stiffness:"f32"}},ZX=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,YX=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function KX(t,e){const i=zP(e.size),n=UP(e.size);return new jh(t,{vs:ZX,fs:YX,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[GX],defines:{ATTRIBUTE_TYPE:i},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function JX(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function QX(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const eq={interpolation:VX,spring:XX};class tq{constructor(e,{id:i,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=i,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:i,numInstances:n}){this.numInstances=n||1;for(const s in e){const u=e[s],f=u.getTransitionSetting(i);f&&this._updateAttribute(s,u,f)}for(const s in this.transitions){const u=e[s];(!u||!u.getTransitionSetting(i))&&this._removeTransition(s)}}hasAttribute(e){const i=this.transitions[e];return i&&i.inProgress}getAttributes(){const e={};for(const i in this.transitions){const n=this.transitions[i];n.inProgress&&(e[i]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const i in this.transitions)this.transitions[i].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,i,n){const s=this.transitions[e];let u=!s||s.type!==n.type;if(u){s&&this._removeTransition(e);const f=eq[n.type];f?this.transitions[e]=new f({attribute:i,timeline:this.timeline,device:this.device}):(Gi.error(`unsupported transition type '${n.type}'`)(),u=!1)}(u||i.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const H3="attributeManager.invalidate",iq="attributeManager.updateStart",nq="attributeManager.updateEnd",rq="attribute.updateStart",sq="attribute.allocate",oq="attribute.updateEnd";class Ny{constructor(e,{id:i="attribute-manager",stats:n,timeline:s}={}){this.mergeBoundsMemoized=Cp(x9),this.id=i,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new tq(e,{id:`${i}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const i=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,i&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const i of e)this.attributes[i]!==void 0&&(this.attributes[i].delete(),delete this.attributes[i])}invalidate(e,i){const n=this._invalidateTrigger(e,i);Mr(H3,this,e,n)}invalidateAll(e){for(const i in this.attributes)this.attributes[i].setNeedsUpdate(i,e);Mr(H3,this,"all")}update({data:e,numInstances:i,startIndices:n=null,transitions:s,props:u={},buffers:f={},context:m={}}){let o=!1;Mr(iq,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const v in this.attributes){const w=this.attributes[v],S=w.settings.accessor;w.startIndices=n,w.numInstances=i,u[v]&&Gi.removed(`props.${v}`,`data.attributes.${v}`)(),w.setExternalBuffer(f[v])||w.setBinaryValue(typeof S=="string"?f[S]:void 0,e.startIndices)||typeof S=="string"&&!f[S]&&w.setConstantValue(u[S])||w.needsUpdate()&&(o=!0,this._updateAttribute({attribute:w,numInstances:i,data:e,props:u,context:m})),this.needsRedraw=this.needsRedraw||w.needsRedraw()}o&&Mr(nq,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,i=e.run();return this.needsRedraw=this.needsRedraw||i,i}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const i=e.map(n=>{var s;return(s=this.attributes[n])==null?void 0:s.getBounds()});return this.mergeBoundsMemoized(i)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:i,attributeTransitionManager:n}=this,s={...n.getAttributes()};for(const u in i){const f=i[u];f.needsRedraw(e)&&!n.hasAttribute(u)&&(s[u]=f)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(i=>i.getBufferLayout(e))}_add(e,i){for(const n in e){const s=e[n],u={...s,id:n,size:s.isIndexed&&1||s.size||1,...i};this.attributes[n]=new NP(this.device,u)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const i in this.attributes)this.attributes[i].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(i)});this.updateTriggers=e}_invalidateTrigger(e,i){const{attributes:n,updateTriggers:s}=this,u=s[e];return u&&u.forEach(f=>{const m=n[f];m&&m.setNeedsUpdate(m.id,i)}),u}_updateAttribute(e){const{attribute:i,numInstances:n}=e;if(Mr(rq,i),i.constant){i.setConstantValue(i.value);return}i.allocate(n)&&Mr(sq,i,n),i.updateBuffer(e)&&(this.needsRedraw=!0,Mr(oq,i,n))}}class aq extends Fy{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:i,toValue:n,duration:s,easing:u}}=this,f=u(e/s);this._value=G_(i,n,f)}}const X3=1e-5;function q3(t,e,i,n,s){const u=e-t,m=(i-e)*s,o=-u*n;return m+o+u+e}function lq(t,e,i,n,s){if(Array.isArray(i)){const u=[];for(let f=0;f<i.length;f++)u[f]=q3(t[f],e[f],i[f],n,s);return u}return q3(t,e,i,n,s)}function G3(t,e){if(Array.isArray(t)){let i=0;for(let n=0;n<t.length;n++){const s=t[n]-e[n];i+=s*s}return Math.sqrt(i)}return Math.abs(t-e)}class cq extends Fy{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:i,damping:n,stiffness:s}=this.settings,{_prevValue:u=e,_currValue:f=e}=this;let m=lq(u,f,i,n,s);const o=G3(m,i),v=G3(m,f);o<X3&&v<X3&&(m=i,this.end()),this._prevValue=f,this._currValue=m}}const uq={interpolation:aq,spring:cq};class hq{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,i,n,s){const{transitions:u}=this;if(u.has(e)){const o=u.get(e),{value:v=o.settings.fromValue}=o;i=v,this.remove(e)}if(s=FP(s),!s)return;const f=uq[s.type];if(!f){Gi.error(`unsupported transition type '${s.type}'`)();return}const m=new f(this.timeline);m.start({...s,fromValue:i,toValue:n}),u.set(e,m)}remove(e){const{transitions:i}=this;i.has(e)&&(i.get(e).cancel(),i.delete(e))}update(){const e={};for(const[i,n]of this.transitions)n.update(),e[i]=n.value,n.inProgress||this.remove(i);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function fq(t){const e=t[wl];for(const i in e){const n=e[i],{validate:s}=n;if(s&&!s(t[i],n))throw new Error(`Invalid prop ${i}: ${t[i]}`)}}function dq(t,e){const i=Y1({newProps:t,oldProps:e,propTypes:t[wl],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=mq(t,e);let s=!1;return n||(s=gq(t,e)),{dataChanged:n,propsChanged:i,updateTriggersChanged:s,extensionsChanged:_q(t,e),transitionsChanged:pq(t,e)}}function pq(t,e){if(!t.transitions)return!1;const i={},n=t[wl];let s=!1;for(const u in t.transitions){const f=n[u],m=f&&f.type;(m==="number"||m==="color"||m==="array")&&Rb(t[u],e[u],f)&&(i[u]=!0,s=!0)}return s?i:!1}function Y1({newProps:t,oldProps:e,ignoreProps:i={},propTypes:n={},triggerName:s="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const u of Object.keys(t))if(!(u in i)){if(!(u in e))return`${s}.${u} added`;const f=Rb(t[u],e[u],n[u]);if(f)return`${s}.${u} ${f}`}for(const u of Object.keys(e))if(!(u in i)){if(!(u in t))return`${s}.${u} dropped`;if(!Object.hasOwnProperty.call(t,u)){const f=Rb(t[u],e[u],n[u]);if(f)return`${s}.${u} ${f}`}}return!1}function Rb(t,e,i){let n=i&&i.equal;return n&&!n(t,e,i)||!n&&(n=t&&e&&t.equals,n&&!n.call(t,e))?"changed deeply":!n&&e!==t?"changed shallowly":null}function mq(t,e){if(e===null)return"oldProps is null, initial diff";let i=!1;const{dataComparator:n,_dataDiff:s}=t;return n?n(t.data,e.data)||(i="Data comparator detected a change"):t.data!==e.data&&(i="A new data container was supplied"),i&&s&&(i=s(t.data,e.data)||i),i}function gq(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&Z3(t,e,"all"))return{all:!0};const i={};let n=!1;for(const s in t.updateTriggers)s!=="all"&&Z3(t,e,s)&&(i[s]=!0,n=!0);return n?i:!1}function _q(t,e){if(e===null)return!0;const i=e.extensions,{extensions:n}=t;if(n===i)return!1;if(!i||!n||n.length!==i.length)return!0;for(let s=0;s<n.length;s++)if(!n[s].equals(i[s]))return!0;return!1}function Z3(t,e,i){let n=t.updateTriggers[i];n=n??{};let s=e.updateTriggers[i];return s=s??{},Y1({oldProps:s,newProps:n,triggerName:i})}const yq="count(): argument not an object",xq="count(): argument not a container";function vq(t){if(!wq(t))throw new Error(yq);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(bq(t))return Object.keys(t).length;throw new Error(xq)}function bq(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function wq(t){return t!==null&&typeof t=="object"}function Y3(t,e){if(!e)return t;const i={...t,...e};if("defines"in e&&(i.defines={...t.defines,...e.defines}),"modules"in e&&(i.modules=(t.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=i.modules.findIndex(s=>s.name==="project32");n>=0&&i.modules.splice(n,1)}if("inject"in e)if(!t.inject)i.inject=e.inject;else{const n={...t.inject};for(const s in e.inject)n[s]=(n[s]||"")+e.inject[s];i.inject=n}return i}const Tq={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Pb={};function Eq(t,e,i,n){if(i instanceof kn)return i;i.constructor&&i.constructor.name!=="Object"&&(i={data:i});let s=null;i.compressed&&(s={minFilter:"linear",mipmapFilter:i.data.length>1?"nearest":"linear"});const u=e.createTexture({...i,sampler:{...Tq,...s,...n},mipmaps:!0});return Pb[u.id]=t,u}function Aq(t,e){!e||!(e instanceof kn)||Pb[e.id]===t&&(e.delete(),delete Pb[e.id])}const Sq={boolean:{validate(t,e){return!0},equal(t,e,i){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||kb(t)&&(t.length===3||t.length===4)},equal(t,e,i){return ts(t,e,1)}},accessor:{validate(t,e){const i=ty(t);return i==="function"||i===ty(e.value)},equal(t,e,i){return typeof e=="function"?!0:ts(t,e,1)}},array:{validate(t,e){return e.optional&&!t||kb(t)},equal(t,e,i){const{compare:n}=i,s=Number.isInteger(n)?n:n?1:0;return n?ts(t,e,s):t===e}},object:{equal(t,e,i){if(i.ignore)return!0;const{compare:n}=i,s=Number.isInteger(n)?n:n?1:0;return n?ts(t,e,s):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,i){return!i.compare&&i.ignore!==!1||t===e}},data:{transform:(t,e,i)=>{if(!t)return t;const{dataTransform:n}=i.props;return n?n(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,i)=>{const n=i.context;return!n||!n.device?null:Eq(i.id,n.device,t,{...e.parameters,...i.props.textureParameters})},release:(t,e,i)=>{Aq(i.id,t)}}};function Iq(t){const e={},i={},n={};for(const[s,u]of Object.entries(t)){const f=u==null?void 0:u.deprecatedFor;if(f)n[s]=Array.isArray(f)?f:[f];else{const m=Cq(s,u);e[s]=m,i[s]=m.value}}return{propTypes:e,defaultProps:i,deprecatedProps:n}}function Cq(t,e){switch(ty(e)){case"object":return Td(t,e);case"array":return Td(t,{type:"array",value:e,compare:!1});case"boolean":return Td(t,{type:"boolean",value:e});case"number":return Td(t,{type:"number",value:e});case"function":return Td(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Td(t,e){return"type"in e?{name:t,...Sq[e.type],...e}:"value"in e?{name:t,type:ty(e.value),...e}:{name:t,type:"object",value:e}}function kb(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function ty(t){return kb(t)?"array":t===null?"null":typeof t}function Mq(t,e){let i;for(let u=e.length-1;u>=0;u--){const f=e[u];"extensions"in f&&(i=f.extensions)}const n=Db(t.constructor,i),s=Object.create(n);s[Q_]=t,s[$c]={},s[yl]={};for(let u=0;u<e.length;++u){const f=e[u];for(const m in f)s[m]=f[m]}return Object.freeze(s),s}const Rq="_mergedDefaultProps";function Db(t,e){if(!(t instanceof zy.constructor))return{};let i=Rq;if(e)for(const s of e){const u=s.constructor;u&&(i+=`:${u.extensionName||u.name}`)}const n=XP(t,i);return n||(t[i]=Pq(t,e||[]))}function Pq(t,e){if(!t.prototype)return null;const n=Object.getPrototypeOf(t),s=Db(n),u=XP(t,"defaultProps")||{},f=Iq(u),m=Object.assign(Object.create(null),s,f.defaultProps),o=Object.assign(Object.create(null),s==null?void 0:s[wl],f.propTypes),v=Object.assign(Object.create(null),s==null?void 0:s[Jx],f.deprecatedProps);for(const w of e){const S=Db(w.constructor);S&&(Object.assign(m,S),Object.assign(o,S[wl]),Object.assign(v,S[Jx]))}return kq(m,t),Oq(m,o),Dq(m,v),m[wl]=o,m[Jx]=v,e.length===0&&!K1(t,"_propTypes")&&(t._propTypes=o),m}function kq(t,e){const i=Bq(e);Object.defineProperties(t,{id:{writable:!0,value:i}})}function Dq(t,e){for(const i in e)Object.defineProperty(t,i,{enumerable:!1,set(n){const s=`${this.id}: ${i}`;for(const u of e[i])K1(this,u)||(this[u]=n);Gi.deprecated(s,e[i].join("/"))()}})}function Oq(t,e){const i={},n={};for(const s in e){const u=e[s],{name:f,value:m}=u;u.async&&(i[f]=m,n[f]=Lq(f))}t[Sh]=i,t[$c]={},Object.defineProperties(t,n)}function Lq(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||BP(e)?this[$c][t]=e:this[yl][t]=e},get(){if(this[yl]){if(t in this[yl])return this[yl][t]||this[Sh][t];if(t in this[$c]){const e=this[Q_]&&this[Q_].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Sh][t]}}return this[Sh][t]}}}function K1(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function XP(t,e){return K1(t,e)&&t[e]}function Bq(t){const e=t.componentName;return e||Gi.warn(`${t.name}.componentName not specified`)(),e||t.name}let Fq=0;class zy{constructor(...e){this.props=Mq(this,e),this.id=this.props.id,this.count=Fq++}clone(e){const{props:i}=this,n={};for(const s in i[Sh])s in i[yl]?n[s]=i[yl][s]:s in i[$c]&&(n[s]=i[$c][s]);return new this.constructor({...i,...n,...e})}}zy.componentName="Component";zy.defaultProps={};const Nq=Object.freeze({});class zq{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const i=this.asyncProps[e];i&&i.type&&i.type.release&&i.type.release(i.resolvedValue,i.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Nq}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const i=this.asyncProps[e];return i&&i.resolvedValue}isAsyncPropLoading(e){if(e){const i=this.asyncProps[e];return!!(i&&i.pendingLoadCount>0&&i.pendingLoadCount!==i.resolvedLoadCount)}for(const i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}reloadAsyncProp(e,i){this._watchPromise(e,Promise.resolve(i))}setAsyncProps(e){this.component=e[Q_]||this.component;const i=e[yl]||{},n=e[$c]||e,s=e[Sh]||{};for(const u in i){const f=i[u];this._createAsyncPropData(u,s[u]),this._updateAsyncProp(u,f),i[u]=this.getAsyncProp(u)}for(const u in n){const f=n[u];this._createAsyncPropData(u,s[u]),this._updateAsyncProp(u,f)}}_fetch(e,i){return null}_onResolve(e,i){}_onError(e,i){}_updateAsyncProp(e,i){if(this._didAsyncInputValueChange(e,i)){if(typeof i=="string"&&(i=this._fetch(e,i)),i instanceof Promise){this._watchPromise(e,i);return}if(BP(i)){this._resolveAsyncIterable(e,i);return}this._setPropValue(e,i)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,i){const n=this.asyncProps[e];return i===n.resolvedValue||i===n.lastValue?!1:(n.lastValue=i,!0)}_setPropValue(e,i){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(i=this._postProcessValue(n,i),n.resolvedValue=i,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,i,n){const s=this.asyncProps[e];s&&n>=s.resolvedLoadCount&&i!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=i,s.resolvedLoadCount=n,this.onAsyncPropUpdated(e,i))}_watchPromise(e,i){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const s=n.pendingLoadCount;i.then(u=>{this.component&&(u=this._postProcessValue(n,u),this._setAsyncPropValue(e,u,s),this._onResolve(e,u))}).catch(u=>{this._onError(e,u)})}}async _resolveAsyncIterable(e,i){if(e!=="data"){this._setPropValue(e,i);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const s=n.pendingLoadCount;let u=[],f=0;for await(const m of i){if(!this.component)return;const{dataTransform:o}=this.component.props;o?u=o(m,u):u=u.concat(m),Object.defineProperty(u,"__diff",{enumerable:!1,value:[{startRow:f,endRow:u.length}]}),f=u.length,this._setAsyncPropValue(e,u,s)}this._onResolve(e,u)}_postProcessValue(e,i){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(i,n,this.component):i}_createAsyncPropData(e,i){if(!this.asyncProps[e]){const s=this.component&&this.component.props[wl];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:i,pendingLoadCount:0,resolvedLoadCount:0}}}}class Uq extends zq{constructor({attributeManager:e,layer:i}){super(i),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,i){const n=this.layer,s=n==null?void 0:n.props.fetch;return s?s(i,{propName:e,layer:n}):super._fetch(e,i)}_onResolve(e,i){const n=this.layer;if(n){const s=n.props.onDataLoad;e==="data"&&s&&s(i,{propName:e,layer:n})}}_onError(e,i){const n=this.layer;n&&n.raiseError(i,`loading ${e} of ${this.layer}`)}}const Vq="layer.changeFlag",jq="layer.initialize",$q="layer.update",Wq="layer.finalize",Hq="layer.matched",K3=2**24-1,Xq=Object.freeze([]),qq=Cp(({oldViewport:t,viewport:e})=>t.equals(e));let Zs=new Uint8ClampedArray(0);const Gq={data:{type:"data",value:Xq,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:i,loaders:n,loadOptions:s,signal:u})=>{const{resourceManager:f}=i.context;s=s||i.getLoadOptions(),n=n||i.props.loaders,u&&(s={...s,fetch:{...s==null?void 0:s.fetch,signal:u}});let m=f.contains(t);return!m&&!s&&(f.add({resourceId:t,data:Gv(t,n),persistent:!1}),m=!0),m?f.subscribe({resourceId:t,onChange:o=>{var v;return(v=i.internalState)==null?void 0:v.reloadAsyncProp(e,o)},consumerId:i.id,requestId:e}):Gv(t,n,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Pi.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Gh extends zy{constructor(){super(...arguments),this.internalState=null,this.lifecycle=fh.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){tr(this.internalState);const i=this.internalState.viewport||this.context.viewport,n=lP(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,u,f]=nP(n,i.pixelProjectionMatrix);return e.length===2?[s,u]:[s,u,f]}unproject(e){return tr(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,i){tr(this.internalState);const n=this.internalState.viewport||this.context.viewport;return A9(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...i})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const i of this.getModels())i.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Pi.DEFAULT||e===Pi.LNGLAT||e===Pi.CARTESIAN}onHover(e,i){return this.props.onHover&&this.props.onHover(e,i)||!1}onClick(e,i){return this.props.onClick&&this.props.onClick(e,i)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,i=[]){return i[0]=e+1&255,i[1]=e+1>>8&255,i[2]=e+1>>8>>8&255,i}decodePickingColor(e){tr(e instanceof Uint8Array);const[i,n,s]=e;return i+n*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:vq(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=Y3(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const i of this.props.extensions)e=Y3(e,i.getShaders.call(this,i));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const i=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&i)if(Array.isArray(n))for(const s of n)i.invalidateAll(s);else i.invalidateAll();if(i){const{props:s}=e,u=this.internalState.hasPickingBuffer,f=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(m=>m.getNeedsPickingBuffer.call(this,m));if(u!==f){this.internalState.hasPickingBuffer=f;const{pickingColors:m,instancePickingColors:o}=i.attributes,v=m||o;v&&(f&&v.constant&&(v.constant=!1,i.invalidate(v.id)),!v.value&&!f&&(v.constant=!0,v.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const i=this.getAttributeManager();i&&i.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const i of this.getModels())i.draw(e.renderPass)}getPickingInfo({info:e,mode:i,sourceLayer:n}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,i){var n,s,u,f;i&&(e=new Error(`${i}: ${e.message}`,{cause:e})),(s=(n=this.props).onError)!=null&&s.call(n,e)||(f=(u=this.context)==null?void 0:u.onError)==null||f.call(u,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const i=this.internalState.viewport;this.internalState.viewport=e,(!i||!qq({oldViewport:i,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const i=this.getAttributeManager();i&&(e==="all"?i.invalidateAll():i.invalidate(e))}updateAttributes(e){let i=!1;for(const n in e)e[n].layoutChanged()&&(i=!0);for(const n of this.getModels())this._setModelAttributes(n,e,i)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const i=this.props,n=this.getNumInstances(),s=this.getStartIndices();e.update({data:i.data,numInstances:n,startIndices:s,props:i,transitions:i.transitions,buffers:i.data.attributes,context:this});const u=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(u)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const i=e.update(),n=Object.create(this.props);for(const s in i)Object.defineProperty(n,s,{value:i[s]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:i}){if(e.constant)return;const n=Math.floor(Zs.length/4);if(this.internalState.usesPickingColorCache=!0,n<i){i>K3&&Gi.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Zs=yp.allocate(Zs,i,{size:4,copy:!0,maxCount:Math.max(i,K3)});const s=Math.floor(Zs.length/4),u=[0,0,0];for(let f=n;f<s;f++)this.encodePickingColor(f,u),Zs[f*4+0]=u[0],Zs[f*4+1]=u[1],Zs[f*4+2]=u[2],Zs[f*4+3]=0}e.value=Zs.subarray(0,i*4)}_setModelAttributes(e,i,n=!1){var m;if(!Object.keys(i).length)return;if(n){const o=this.getAttributeManager();e.setBufferLayout(o.getBufferLayouts(e)),i=o.getAttributes()}const s=((m=e.userData)==null?void 0:m.excludeAttributes)||{},u={},f={};for(const o in i){if(s[o])continue;const v=i[o].getValue();for(const w in v){const S=v[w];S instanceof yn?i[o].settings.isIndexed?e.setIndexBuffer(S):u[w]=S:S&&(f[w]=S)}}e.setAttributes(u),e.setConstantAttributes(f)}disablePickingIndex(e){const i=this.props.data;if(!("attributes"in i)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:s}=this.getAttributeManager().attributes,u=n||s,f=u&&i.attributes&&i.attributes[u.id];if(f&&f.value){const m=f.value,o=this.encodePickingColor(e);for(let v=0;v<i.length;v++){const w=u.getVertexOffset(v);m[w]===o[0]&&m[w+1]===o[1]&&m[w+2]===o[2]&&this._disablePickingIndex(v)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,s=i||n;if(!s)return;const u=s.getVertexOffset(e),f=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(f-u),u)}restorePickingColors(){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,n=e||i;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==Zs.buffer&&(n.value=Zs.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){tr(!this.internalState),tr(Number.isFinite(this.props.coordinateSystem)),Mr(jq,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Uq({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Gi.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new hq(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const i of this.props.extensions)i.initializeState.call(this,this.context,i);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Mr(Hq,this,this===e);const{state:i,internalState:n}=e;this!==e&&(this.internalState=n,this.state=i,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Mr($q,this,e),!e)return;const i=this.props,n=this.context,s=this.internalState,u=n.viewport,f=this._updateUniformTransition();s.propsInTransition=f,n.viewport=s.viewport||u,this.props=f;try{const m=this._getUpdateParams(),o=this.getModels();if(n.device)this.updateState(m);else try{this.updateState(m)}catch{}for(const w of this.props.extensions)w.updateState.call(this,m,w);this.setNeedsRedraw(),this._updateAttributes();const v=this.getModels()[0]!==o[0];this._postUpdate(m,v)}finally{n.viewport=u,this.props=i,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Mr(Wq,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:i=null,uniforms:n={},parameters:s={}}){this._updateAttributeTransition();const u=this.props,f=this.context;this.props=this.internalState.propsInTransition||u;try{i&&this.setShaderModuleProps(i);const{getPolygonOffset:m}=this.props,o=m&&m(n)||[0,0];f.device instanceof xh&&f.device.setParametersWebGL({polygonOffset:o});for(const v of this.getModels())v.device.type==="webgpu"?v.setParameters({...v.parameters,...s}):v.setParameters(s);if(f.device instanceof xh)f.device.withParametersWebGL(s,()=>{const v={renderPass:e,shaderModuleProps:i,uniforms:n,parameters:s,context:f};for(const w of this.props.extensions)w.draw.call(this,v,w);this.draw(v)});else{const v={renderPass:e,shaderModuleProps:i,uniforms:n,parameters:s,context:f};for(const w of this.props.extensions)w.draw.call(this,v,w);this.draw(v)}}finally{this.props=u}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:i}=this.internalState;for(const s in e)if(e[s]){let u=!1;switch(s){case"dataChanged":const f=e[s],m=i[s];f&&Array.isArray(m)&&(i.dataChanged=Array.isArray(f)?m.concat(f):f,u=!0);default:i[s]||(i[s]=e[s],u=!0)}u&&Mr(Vq,this,s,e)}const n=!!(i.dataChanged||i.updateTriggersChanged||i.propsChanged||i.extensionsChanged);i.propsOrDataChanged=n,i.somethingChanged=n||i.viewportChanged||i.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,i){var s;const n=dq(e,i);if(n.updateTriggersChanged)for(const u in n.updateTriggersChanged)n.updateTriggersChanged[u]&&this.invalidateAttribute(u);if(n.transitionsChanged)for(const u in n.transitionsChanged)this.internalState.uniformTransitions.add(u,i[u],e[u],(s=e.transitions)==null?void 0:s[u]);return this.setChangeFlags(n)}validateProps(){fq(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const i={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(i.highlightColor=n(e)),this.setShaderModuleProps({picking:i}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Ny(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,i){const{props:n,oldProps:s}=e,u=this.state.model;u!=null&&u.isInstanced&&u.setInstanceCount(this.getNumInstances());const{autoHighlight:f,highlightedObjectIndex:m,highlightColor:o}=n;if(i||s.autoHighlight!==f||s.highlightedObjectIndex!==m||s.highlightColor!==o){const v={};Array.isArray(o)&&(v.highlightColor=o),(i||s.autoHighlight!==f||m!==s.highlightedObjectIndex)&&(v.highlightedObjectColor=Number.isFinite(m)&&m>=0?this.encodePickingColor(m):null),this.setShaderModuleProps({picking:v})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let i=!1;i=i||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),s=n?n.getNeedsRedraw(e):!1;if(i=i||s,i)for(const u of this.props.extensions)u.onNeedsRedraw.call(this,u);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,i}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Gh.defaultProps=Gq;Gh.layerName="Layer";const Zq="compositeLayer.renderLayers";class J1 extends Gh{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:i}=e;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(e.object=i.__source.object,e.index=i.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,i){return i&&i.length}getSubLayerClass(e,i){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||i}getSubLayerRow(e,i,n){return e.__source={parent:this,object:i,index:n},e}getSubLayerAccessor(e){if(typeof e=="function"){const i={index:-1,data:this.props.data,target:[]};return(n,s)=>n&&n.__source?(i.index=n.__source.index,e(n.__source.object,i)):e(n,s)}return e}getSubLayerProps(e={}){var ot;const{opacity:i,pickable:n,visible:s,parameters:u,getPolygonOffset:f,highlightedObjectIndex:m,autoHighlight:o,highlightColor:v,coordinateSystem:w,coordinateOrigin:S,wrapLongitude:R,positionFormat:L,modelMatrix:j,extensions:Z,fetch:re,operation:xe,_subLayerProps:be}=this.props,ue={id:"",updateTriggers:{},opacity:i,pickable:n,visible:s,parameters:u,getPolygonOffset:f,highlightedObjectIndex:m,autoHighlight:o,highlightColor:v,coordinateSystem:w,coordinateOrigin:S,wrapLongitude:R,positionFormat:L,modelMatrix:j,extensions:Z,fetch:re,operation:xe},oe=be&&e.id&&be[e.id],Ie=oe&&oe.updateTriggers,me=e.id||"sublayer";if(oe){const lt=this.props[wl],_t=e.type?e.type._propTypes:{};for(const rt in oe){const Ge=_t[rt]||lt[rt];Ge&&Ge.type==="accessor"&&(oe[rt]=this.getSubLayerAccessor(oe[rt]))}}Object.assign(ue,e,oe),ue.id=`${this.props.id}-${me}`,ue.updateTriggers={all:(ot=this.props.updateTriggers)==null?void 0:ot.all,...e.updateTriggers,...Ie};for(const lt of Z){const _t=lt.getSubLayerProps.call(this,lt);_t&&Object.assign(ue,_t,{updateTriggers:Object.assign(ue.updateTriggers,_t.updateTriggers)})}return ue}_updateAutoHighlight(e){for(const i of this.getSubLayers())i.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,i){let n=this.internalState.subLayers;const s=!n||this.needsUpdate();if(s){const u=this.renderLayers();n=$h(u,Boolean),this.internalState.subLayers=n}Mr(Zq,this,s,n);for(const u of n)u.parent=this}}J1.layerName="CompositeLayer";const zg=Math.PI/180,J3=180/Math.PI,r_=6370972,vh=256;function Yq(){const t=vh/r_,e=Math.PI/180*vh;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class Kq extends Kc{constructor(e={}){const{longitude:i=0,zoom:n=0,nearZMultiplier:s=.5,farZMultiplier:u=1,resolution:f=10}=e;let{latitude:m=0,height:o,altitude:v=1.5,fovy:w}=e;m=Math.max(Math.min(m,J_),-85.051129),o=o||1,w?v=U1(w):w=_p(v);const S=1/Math.PI/Math.cos(m*Math.PI/180),R=Math.pow(2,n)*S,L=e.nearZ??s,j=e.farZ??(v+vh*2*R/o)*u,Z=new ro().lookAt({eye:[0,-v,0],up:[0,0,1]});Z.rotateX(m*zg),Z.rotateZ(-i*zg),Z.scale(R/o),super({...e,height:o,viewMatrix:Z,longitude:i,latitude:m,zoom:n,distanceScales:Yq(),fovy:w,focalDistance:v,near:L,far:j}),this.scale=R,this.latitude=m,this.longitude=i,this.resolution=f}get projectionMode(){return gs.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const i={targetZ:e.z||0},n=this.unproject([0,this.height/2],i),s=this.unproject([this.width/2,0],i),u=this.unproject([this.width,this.height/2],i),f=this.unproject([this.width/2,this.height],i);return u[0]<this.longitude&&(u[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],u[0],s[0],f[0]),Math.min(n[1],u[1],s[1],f[1]),Math.max(n[0],u[0],s[0],f[0]),Math.max(n[1],u[1],s[1],f[1])]}unproject(e,{topLeft:i=!0,targetZ:n}={}){const[s,u,f]=e,m=i?u:this.height-u,{pixelUnprojectionMatrix:o}=this;let v;if(Number.isFinite(f))v=rv(o,[s,m,f,1]);else{const L=rv(o,[s,m,-1,1]),j=rv(o,[s,m,1,1]),Z=((n||0)/r_+1)*vh,re=Vx(DR([],L,j)),xe=Vx(L),be=Vx(j),oe=4*((4*xe*be-(re-xe-be)**2)/16)/re,Ie=Math.sqrt(xe-oe),me=Math.sqrt(Math.max(0,Z*Z-oe)),ot=(Ie-me)/Math.sqrt(re);v=vj([],L,j,ot)}const[w,S,R]=this.unprojectPosition(v);return Number.isFinite(f)?[w,S,R]:Number.isFinite(n)?[w,S,n]:[w,S]}projectPosition(e){const[i,n,s=0]=e,u=i*zg,f=n*zg,m=Math.cos(f),o=(s/r_+1)*vh;return[Math.sin(u)*m*o,-Math.cos(u)*m*o,Math.sin(f)*o]}unprojectPosition(e){const[i,n,s]=e,u=Ij(e),f=Math.asin(s/u),o=Math.atan2(i,-n)*J3,v=f*J3,w=(u/vh-1)*r_;return[o,v,w]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,i){const n=this.unproject(i);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function rv(t,e){const i=Xh([],e,t);return BR(i,i,1/i[3]),i}class Jq extends yP{applyConstraints(e){const{maxZoom:i,minZoom:n,zoom:s}=e;e.zoom=No(s,n,i);const{longitude:u,latitude:f}=e;return(u<-180||u>180)&&(e.longitude=m9(u+180,360)-180),e.latitude=No(f,-85.051129,J_),e}}class Qq extends _P{constructor(){super(...arguments),this.ControllerState=Jq,this.transition={transitionDuration:300,transitionInterpolator:new $1(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class qP extends gP{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?jc:Kq}get ControllerType(){return Qq}}qP.displayName="GlobeView";const Q3=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,eG={name:"scatterplot",vs:Q3,fs:Q3,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},tG=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,iG=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,nG=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,eI=[0,0,0,255],rG={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:eI},getLineColor:{type:"accessor",value:eI},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Q1 extends Gh{getShaders(){return super.getShaders({vs:tG,fs:iG,source:nG,modules:[Mp,sP,eG]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var i;super.updateState(e),e.changeFlags.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:i,radiusScale:n,radiusMinPixels:s,radiusMaxPixels:u,stroked:f,filled:m,billboard:o,antialiasing:v,lineWidthUnits:w,lineWidthScale:S,lineWidthMinPixels:R,lineWidthMaxPixels:L}=this.props,j={stroked:f,filled:m,billboard:o,antialiasing:v,radiusUnits:Al[i],radiusScale:n,radiusMinPixels:s,radiusMaxPixels:u,lineWidthUnits:Al[w],lineWidthScale:S,lineWidthMinPixels:R,lineWidthMaxPixels:L},Z=this.state.model;Z.shaderInputs.setProps({scatterplot:j}),Z.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Wo(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new dP({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Q1.defaultProps=rG;Q1.layerName="ScatterplotLayer";const sG={COUNTER_CLOCKWISE:-1};function oG(t,e,i={}){return aG(t,i)!==e?(cG(t,i),!0):!1}function aG(t,e={}){return Math.sign(lG(t,e))}const tI={x:0,y:1,z:2};function lG(t,e={}){const{start:i=0,end:n=t.length,plane:s="xy"}=e,u=e.size||2;let f=0;const m=tI[s[0]],o=tI[s[1]];for(let v=i,w=n-u;v<n;v+=u)f+=(t[v+m]-t[w+m])*(t[v+o]+t[w+o]),w=v;return f/2}function cG(t,e){const{start:i=0,end:n=t.length,size:s=2}=e,u=(n-i)/s,f=Math.floor(u/2);for(let m=0;m<f;++m){const o=i+m*s,v=i+(u-1-m)*s;for(let w=0;w<s;++w){const S=t[o+w];t[o+w]=t[v+w],t[v+w]=S}}}class uG extends dP{constructor(e){const{indices:i,attributes:n}=hG(e);super({...e,indices:i,attributes:n})}}function hG(t){const{radius:e,height:i=1,nradial:n=10}=t;let{vertices:s}=t;s&&(Gi.assert(s.length>=n),s=s.flatMap(L=>[L[0],L[1]]),oG(s,sG.COUNTER_CLOCKWISE));const u=i>0,f=n+1,m=u?f*3+1:n,o=Math.PI*2/n,v=new Uint16Array(u?n*3*2:0),w=new Float32Array(m*3),S=new Float32Array(m*3);let R=0;if(u){for(let L=0;L<f;L++){const j=L*o,Z=L%n,re=Math.sin(j),xe=Math.cos(j);for(let be=0;be<2;be++)w[R+0]=s?s[Z*2]:xe*e,w[R+1]=s?s[Z*2+1]:re*e,w[R+2]=(1/2-be)*i,S[R+0]=s?s[Z*2]:xe,S[R+1]=s?s[Z*2+1]:re,R+=3}w[R+0]=w[R-3],w[R+1]=w[R-2],w[R+2]=w[R-1],R+=3}for(let L=u?0:1;L<f;L++){const j=Math.floor(L/2)*Math.sign(.5-L%2),Z=j*o,re=(j+n)%n,xe=Math.sin(Z),be=Math.cos(Z);w[R+0]=s?s[re*2]:be*e,w[R+1]=s?s[re*2+1]:xe*e,w[R+2]=i/2,S[R+2]=1,R+=3}if(u){let L=0;for(let j=0;j<n;j++)v[L++]=j*2+0,v[L++]=j*2+2,v[L++]=j*2+0,v[L++]=j*2+1,v[L++]=j*2+1,v[L++]=j*2+3}return{indices:v,attributes:{POSITION:{size:3,value:w},NORMAL:{size:3,value:S}}}}const iI=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,fG={name:"column",vs:iI,fs:iI,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}},dG=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,pG=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,iy=[0,0,0,255],mG={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:iy},getLineColor:{type:"accessor",value:iy},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class ew extends Gh{getShaders(){const e={},{flatShading:i}=this.props;return i&&(e.FLAT_SHADING=1),super.getShaders({vs:dG,fs:pG,defines:e,modules:[Mp,i?$R:jR,sP,fG]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:iy},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:iy},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){var m;super.updateState(e);const{props:i,oldProps:n,changeFlags:s}=e,u=s.extensionsChanged||i.flatShading!==n.flatShading;u&&((m=this.state.models)==null||m.forEach(o=>o.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const f=this.getNumInstances();this.state.fillModel.setInstanceCount(f),this.state.wireframeModel.setInstanceCount(f),(u||i.diskResolution!==n.diskResolution||i.vertices!==n.vertices||(i.extruded||i.stroked)!==(n.extruded||n.stroked))&&this._updateGeometry(i)}getGeometry(e,i,n){const s=new uG({radius:1,height:n?2:0,vertices:i,nradial:e});let u=0;if(i)for(let f=0;f<e;f++){const m=i[f],o=Math.sqrt(m[0]*m[0]+m[1]*m[1]);u+=o/e}else u=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*u}),s}_getModels(){const e=this.getShaders(),i=this.getAttributeManager().getBufferLayouts(),n=new Wo(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:i,isInstanced:!0}),s=new Wo(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:i,isInstanced:!0});return{fillModel:n,wireframeModel:s,models:[s,n]}}_updateGeometry({diskResolution:e,vertices:i,extruded:n,stroked:s}){const u=this.getGeometry(e,i,n||s);this.setState({fillVertexCount:u.attributes.POSITION.value.length/3});const f=this.state.fillModel,m=this.state.wireframeModel;f.setGeometry(u),f.setTopology("triangle-strip"),f.setIndexBuffer(null),m.setGeometry(u),m.setTopology("line-list")}draw({uniforms:e}){const{lineWidthUnits:i,lineWidthScale:n,lineWidthMinPixels:s,lineWidthMaxPixels:u,radiusUnits:f,elevationScale:m,extruded:o,filled:v,stroked:w,wireframe:S,offset:R,coverage:L,radius:j,angle:Z}=this.props,re=this.state.fillModel,xe=this.state.wireframeModel,{fillVertexCount:be,edgeDistance:ue}=this.state,oe={radius:j,angle:Z/180*Math.PI,offset:R,extruded:o,stroked:w,coverage:L,elevationScale:m,edgeDistance:ue,radiusUnits:Al[f],widthUnits:Al[i],widthScale:n,widthMinPixels:s,widthMaxPixels:u};o&&S&&(xe.shaderInputs.setProps({column:{...oe,isStroke:!0}}),xe.draw(this.context.renderPass)),v&&(re.setVertexCount(be),re.shaderInputs.setProps({column:{...oe,isStroke:!1}}),re.draw(this.context.renderPass)),!o&&w&&(re.setVertexCount(be*2/3),re.shaderInputs.setProps({column:{...oe,isStroke:!0}}),re.draw(this.context.renderPass))}}ew.layerName="ColumnLayer";ew.defaultProps=mG;const sv=512,gG=Math.PI/180;function GP({map:t,gl:e,deck:i}){if(t.__deck)return t.__deck;const n=i==null?void 0:i.props._customRender,s=i==null?void 0:i.props.onLoad,u={...i==null?void 0:i.props,_customRender:()=>{t.triggerRepaint(),n==null||n("")}};u.parameters={...Ob(t,!0),...u.parameters},u.views||(u.views=ny(t));let f;return(!i||i.props.gl===e)&&(Object.assign(u,{gl:e,width:null,height:null,touchAction:"unset",viewState:vp(t)}),i!=null&&i.isInitialized?nI(i,t):u.onLoad=()=>{s==null||s(),nI(f,t)}),i?(f=i,i.setProps(u),i.userData.isExternal=!0):(f=new xp(u),t.on("remove",()=>{ZP(t)})),f.userData.mapboxLayers=new Set,t.__deck=f,t.on("render",()=>{f.isInitialized&&wG(f,t)}),f}function nI(t,e){const i=()=>{t.isInitialized?TG(t,e):e.off("move",i)};e.on("move",i)}function ZP(t){var e;(e=t.__deck)==null||e.finalize(),t.__deck=null}function Ob(t,e){const i=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return YP(t)==="globe"&&(i.cullMode="back"),i}function _G(t,e){t.userData.mapboxLayers.add(e),tw(t)}function yG(t,e){t.userData.mapboxLayers.delete(e),tw(t)}function xG(t,e){tw(t)}function vG(t,e,i,n){let{currentViewport:s}=t.userData,u=!1;s||(s=KP(t,e,n),t.userData.currentViewport=s,u=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[s],layerFilter:({layer:f})=>i.id===f.id||f.props.operation.includes("terrain"),clearStack:u,clearCanvas:!1})}function YP(t){var n;const e=(n=t.getProjection)==null?void 0:n.call(t),i=(e==null?void 0:e.type)||(e==null?void 0:e.name);if(i==="globe")return"globe";if(i&&i!=="mercator")throw new Error("Unsupported projection");return"mercator"}function ny(t){return YP(t)==="globe"?new qP({id:"mapbox"}):new W1({id:"mapbox"})}function vp(t){var s;const{lng:e,lat:i}=t.getCenter(),n={longitude:(e+540)%360-180,latitude:i,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return(s=t.getTerrain)!=null&&s.call(t)&&bG(t,n),n}function bG(t,e){if(t.getFreeCameraOptions){const{position:i}=t.getFreeCameraOptions();if(!i||i.z===void 0)return;const n=t.transform.height,{longitude:s,latitude:u,pitch:f}=e,m=i.x*sv,o=(1-i.y)*sv,v=i.z*sv,w=gp([s,u]),S=m-w[0],R=o-w[1],L=Math.sqrt(S*S+R*R),j=f*gG,Z=1.5*n,re=j<.001?Z*Math.cos(j)/v:Z*Math.sin(j)/L;e.zoom=Math.log2(re);const xe=Z*Math.cos(j)/re,be=v-xe;e.position=[0,0,be/i_(u)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function KP(t,e,i){const n=vp(e),s=ny(e);i&&(s.props.nearZMultiplier=.2);const u=(i==null?void 0:i.nearZ)??e.transform._nearZ,f=(i==null?void 0:i.farZ)??e.transform._farZ;return Number.isFinite(u)&&(n.nearZ=u/e.transform.height,n.farZ=f/e.transform.height),s.makeViewport({width:t.width,height:t.height,viewState:n})}function wG(t,e){const{mapboxLayers:i,isExternal:n}=t.userData;if(n){const s=Array.from(i,w=>w.id),f=$h(t.props.layers,Boolean).some(w=>w&&!s.includes(w.id));let m=t.getViewports();const o=m.findIndex(w=>w.id==="mapbox"),v=m.length>1||o<0;(f||v)&&(o>=0&&(m=m.slice(),m[o]=KP(t,e)),t._drawLayers("mapbox-repaint",{viewports:m,layerFilter:w=>(!t.props.layerFilter||t.props.layerFilter(w))&&(w.viewport.id!=="mapbox"||!s.includes(w.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function TG(t,e){t.setProps({viewState:vp(e)}),t.needsRedraw({clearRedrawFlags:!0})}function tw(t){if(t.userData.isExternal)return;const e=[];t.userData.mapboxLayers.forEach(i=>{const n=i.props.type,s=new n(i.props);e.push(s)}),t.setProps({layers:e})}class EG{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,i){this.map=e,this.deck=GP({map:e,gl:i,deck:this.props.deck}),_G(this.deck,this)}onRemove(){this.deck&&yG(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&xG(this.deck)}render(e,i){vG(this.deck,this.map,this,i)}}const ov="__UNDEFINED__";function Ug(t,e,i,n){if(!t||!e||!t.style||!t.style._loaded)return;const s=$h(n,Boolean);if(i!==n){const m=$h(i,Boolean),o=new Set(m.map(v=>v.id));for(const v of s)o.delete(v.id);for(const v of o)t.getLayer(v)&&t.removeLayer(v)}for(const m of s){const o=t.getLayer(m.id);o?(o.implementation||o).setProps(m.props):t.addLayer(new EG({id:m.id,deck:e,slot:m.props.slot}),m.props.beforeId)}const u=t.style._order,f={};for(const m of s){let{beforeId:o}=m.props;(!o||!u.includes(o))&&(o=ov),f[o]=f[o]||[],f[o].push(m.id)}for(const m in f){const o=f[m];let v=m===ov?u.length:u.indexOf(m),w=m===ov?void 0:m;for(let S=o.length-1;S>=0;S--){const R=o[S],L=u.indexOf(R);L!==v-1&&(t.moveLayer(R,w),L>v&&v++),v--,w=R}}}class iw{constructor(e){this._handleStyleChange=()=>{Ug(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:s,clientHeight:u}=this._map.getContainer();Object.assign(this._container.style,{width:`${s}px`,height:`${u}px`})}},this._updateViewState=()=>{const s=this._deck,u=this._map;s&&u&&(s.setProps({views:this._props.views||ny(u),viewState:vp(u)}),s.isInitialized&&s.redraw())},this._handleMouseEvent=s=>{const u=this._deck;if(!u||!u.isInitialized)return;const f={type:s.type,offsetCenter:s.point,srcEvent:s},m=this._lastMouseDownPoint;switch(!s.point&&m&&(f.deltaX=s.originalEvent.clientX-m.clientX,f.deltaY=s.originalEvent.clientY-m.clientY,f.offsetCenter={x:m.x+f.deltaX,y:m.y+f.deltaY}),f.type){case"mousedown":u._onPointerDown(f),this._lastMouseDownPoint={...s.point,clientX:s.originalEvent.clientX,clientY:s.originalEvent.clientY};break;case"dragstart":f.type="panstart",u._onEvent(f);break;case"drag":f.type="panmove",u._onEvent(f);break;case"dragend":f.type="panend",u._onEvent(f);break;case"click":f.tapCount=1,u._onEvent(f);break;case"dblclick":f.type="click",f.tapCount=2,u._onEvent(f);break;case"mousemove":f.type="pointermove",u._onPointerMove(f);break;case"mouseout":f.type="pointerleave",u._onPointerMove(f);break;default:return}};const{interleaved:i=!1,...n}=e;this._interleaved=i,this._props=n}setProps(e){this._interleaved&&e.layers&&Ug(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...Ob(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const i=document.createElement("div");return Object.assign(i.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=i,this._deck=new xp({...this._props,parent:i,parameters:{...Ob(e,!1),...this._props.parameters},views:this._props.views||ny(e),viewState:vp(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),i}_onAddInterleaved(e){const i=e.painter.context.gl;return i instanceof WebGLRenderingContext&&Gi.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=GP({map:e,gl:i,deck:new xp({...this._props,gl:i})}),e.on("styledata",this._handleStyleChange),Ug(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){var i;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),(i=this._deck)==null||i.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),Ug(e,this._deck,this._props.layers,[]),ZP(e)}getDefaultPosition(){return"top-left"}pickObject(e){return tr(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return tr(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return tr(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}const AG={class:"deckgl-wrapper"},SG={__name:"DeckGLPMScatterplot",setup(t){const e=Ta(null),i="pk.eyJ1IjoidGFudmlzdW4iLCJhIjoiY204emVlbmZrMGJqcjJqb25veHg5NTgwMCJ9.5Bx0EO-D7aEkknmgVK8U_Q";return Hc(async()=>{const s=await(await fetch("/citydata.csv")).text(),f=Py(s).filter(S=>S.Country==="United States of America").map(S=>{var R;return{city:(R=S.City)==null?void 0:R.trim(),pm25:parseFloat(S["PM2.5 AQI Value"]),category:S["PM2.5 AQI Category"],position:[parseFloat(S.lng),parseFloat(S.lat)]}}).filter(S=>!isNaN(S.position[0])&&!isNaN(S.position[1])&&!isNaN(S.pm25)),m=xC(f,S=>S.pm25),o=new Q1({id:"pm25-scatter",data:f,getPosition:S=>S.position,getRadius:S=>S.pm25/m*5e4,getFillColor:S=>S.pm25<50?[119,221,119,200]:S.pm25<100?[255,243,158,200]:[255,182,193,200],pickable:!0,radiusMinPixels:4,radiusMaxPixels:20,onHover:S=>{const R=document.getElementById("deck-tooltip"),L=e.value.getBoundingClientRect();S.object?(R.style.left=`${L.left+S.x+10}px`,R.style.top=`${L.top+S.y+1}px`,R.innerHTML=`<b>${S.object.city}</b><br/>PM2.5: ${S.object.pm25} (${S.object.category})`,R.style.display="block"):R.style.display="none"}});Lh.accessToken=i;const v=new Lh.Map({container:e.value,style:"mapbox://styles/mapbox/dark-v10",center:[-95.7129,37.0902],zoom:4.2}),w=new iw({layers:[o]});v.addControl(w),v.on("load",()=>{v.resize()})}),(n,s)=>(no(),jo("div",AG,[Li("div",{ref_key:"chartContainer",ref:e,class:"map-container"},null,512),s[0]||(s[0]=dC('<div id="deck-tooltip" data-v-bf67e343></div><div id="pm25-legend" data-v-bf67e343><div class="legend-title" data-v-bf67e343>PM2.5 AQI Levels</div><div class="legend-items" data-v-bf67e343><div class="legend-item" data-v-bf67e343><span class="legend-color" style="background-color:#77DD77;" data-v-bf67e343></span><span class="legend-label" data-v-bf67e343>Good (&lt;50)</span></div><div class="legend-item" data-v-bf67e343><span class="legend-color" style="background-color:#FFF39E;" data-v-bf67e343></span><span class="legend-label" data-v-bf67e343>Moderate (50-100)</span></div><div class="legend-item" data-v-bf67e343><span class="legend-color" style="background-color:#FFB6C1;" data-v-bf67e343></span><span class="legend-label" data-v-bf67e343>High (100)</span></div></div></div>',2))]))}},IG=qc(SG,[["__scopeId","data-v-bf67e343"]]);function CG({pointCount:t,getBinId:e}){const i=new Map;for(let n=0;n<t;n++){const s=e(n);if(s===null)continue;let u=i.get(String(s));u?u.points.push(n):(u={id:s,index:i.size,points:[n]},i.set(String(s),u))}return Array.from(i.values())}function MG({bins:t,dimensions:e,target:i}){const n=t.length*e;(!i||i.length<n)&&(i=new Float32Array(n));for(let s=0;s<t.length;s++){const{id:u}=t[s];Array.isArray(u)?i.set(u,s*e):i[s]=u}return i}const RG=t=>t.length,JP=(t,e)=>{let i=0;for(const n of t)i+=e(n);return i},PG=(t,e)=>t.length===0?NaN:JP(t,e)/t.length,kG=(t,e)=>{let i=1/0;for(const n of t){const s=e(n);s<i&&(i=s)}return i},DG=(t,e)=>{let i=-1/0;for(const n of t){const s=e(n);s>i&&(i=s)}return i},OG={COUNT:RG,SUM:JP,MEAN:PG,MIN:kG,MAX:DG};function LG({bins:t,getValue:e,operation:i,target:n}){(!n||n.length<t.length)&&(n=new Float32Array(t.length));let s=1/0,u=-1/0;for(let f=0;f<t.length;f++){const{points:m}=t[f];n[f]=i(m,e),n[f]<s&&(s=n[f]),n[f]>u&&(u=n[f])}return{value:n,domain:[s,u]}}function rI(t,e,i){const n={};for(const u of t.sources||[]){const f=e[u];if(f)n[u]=BG(f);else throw new Error(`Cannot find attribute ${u}`)}const s={};return u=>{for(const f in n)s[f]=n[f](u);return t.getValue(s,u,i)}}function BG(t){const e=t.value,{offset:i=0,stride:n,size:s}=t.getAccessor(),u=e.BYTES_PER_ELEMENT,f=i/u,m=n?n/u:s;if(s===1)return t.isConstant?()=>e[0]:v=>{const w=f+m*v;return e[w]};let o;return t.isConstant?(o=Array.from(e),()=>o):(o=new Array(s),v=>{const w=f+m*v;for(let S=0;S<s;S++)o[S]=e[w+S];return o})}class FG{constructor(e){this.bins=[],this.binIds=null,this.results=[],this.dimensions=e.dimensions,this.channelCount=e.getValue.length,this.props={...e,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(e)}destroy(){}get binCount(){return this.bins.length}setProps(e){const i=this.props;if(e.binOptions&&(ts(e.binOptions,i.binOptions,2)||this.setNeedsUpdate()),e.operations)for(let n=0;n<this.channelCount;n++)e.operations[n]!==i.operations[n]&&this.setNeedsUpdate(n);if(e.customOperations)for(let n=0;n<this.channelCount;n++)!!e.customOperations[n]!=!!i.customOperations[n]&&this.setNeedsUpdate(n);e.pointCount!==void 0&&e.pointCount!==i.pointCount&&this.setNeedsUpdate(),e.attributes&&(e.attributes={...i.attributes,...e.attributes}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[e]=!0)}update(){var e,i,n,s;if(this.needsUpdate===!0){this.bins=CG({pointCount:this.props.pointCount,getBinId:rI(this.props.getBin,this.props.attributes,this.props.binOptions)});const u=MG({bins:this.bins,dimensions:this.dimensions,target:(e=this.binIds)==null?void 0:e.value});this.binIds={value:u,type:"float32",size:this.dimensions}}for(let u=0;u<this.channelCount;u++)if(this.needsUpdate===!0||this.needsUpdate[u]){const f=this.props.customOperations[u]||OG[this.props.operations[u]],{value:m,domain:o}=LG({bins:this.bins,getValue:rI(this.props.getValue[u],this.props.attributes,void 0),operation:f,target:(i=this.results[u])==null?void 0:i.value});this.results[u]={value:m,domain:o,type:"float32",size:1},(s=(n=this.props).onUpdate)==null||s.call(n,{channel:u})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(e){return this.results[e]}getResultDomain(e){var i;return((i=this.results[e])==null?void 0:i.domain)??[1/0,-1/0]}getBin(e){const i=this.bins[e];if(!i)return null;const n=new Array(this.channelCount);for(let s=0;s<n.length;s++){const u=this.results[s];n[s]=u==null?void 0:u.value[e]}return{id:i.id,value:n,count:i.points.length,pointIndices:i.points}}}function QP(t,e,i){return t.createFramebuffer({width:e,height:i,colorAttachments:[t.createTexture({width:e,height:i,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}const NG=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,zG={name:"binSorter",vs:NG,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}},ek=[1,2,4,8],UG=3e38,VG={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},s_=1024;class jG{constructor(e,i){this.binsFBO=null,this.device=e,this.model=WG(e,i)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){var e,i;this.model.destroy(),(e=this.binsFBO)==null||e.colorAttachments[0].texture.destroy(),(i=this.binsFBO)==null||i.destroy()}getBinValues(e){if(!this.binsFBO)return null;const i=e%s_,n=Math.floor(e/s_),s=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:i,sourceY:n,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(s)}setDimensions(e,i){var f,m;const n=s_,s=Math.ceil(e/n);this.binsFBO?this.binsFBO.height<s&&this.binsFBO.resize({width:n,height:s}):this.binsFBO=QP(this.device,n,s);const u={binIdRange:[i[0][0],i[0][1],((f=i[1])==null?void 0:f[0])||0,((m=i[1])==null?void 0:m[1])||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:u})}setModelProps(e){const i=this.model;e.attributes&&i.setAttributes(e.attributes),e.constantAttributes&&i.setConstantAttributes(e.constantAttributes),e.vertexCount!==void 0&&i.setVertexCount(e.vertexCount),e.shaderModuleProps&&i.shaderInputs.setProps(e.shaderModuleProps)}update(e){if(!this.binsFBO)return;const i=$G(e);this._updateBins("SUM",i.SUM+i.MEAN),this._updateBins("MIN",i.MIN),this._updateBins("MAX",i.MAX)}_updateBins(e,i){if(i===0)return;i|=ek[3];const n=this.model,s=this.binsFBO,u=e==="MAX"?-3e38:e==="MIN"?UG:0,f=this.device.beginRenderPass({id:`gpu-aggregation-${e}`,framebuffer:s,parameters:{viewport:[0,0,s.width,s.height],colorMask:i},clearColor:[u,u,u,0],clearDepth:!1,clearStencil:!1});n.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:e==="MAX"?"max":e==="MIN"?"min":"add",blendAlphaOperation:"add"}),n.draw(f),f.end()}}function $G(t){const e={...VG};for(let i=0;i<t.length;i++){const n=t[i];n&&(e[n]+=ek[i])}return e}function WG(t,e){let i=e.vs;e.dimensions===2&&(i+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);const n=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${i}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,s=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new Wo(t,{bufferLayout:e.bufferLayout,modules:[...e.modules||[],zG],defines:{...e.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:e.channelCount},isInstanced:!1,vs:n,fs:s,topology:"point-list",disableWarnings:!0})}const HG=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,XG={name:"aggregatorTransform",vs:HG,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};class qG{constructor(e,i){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=e,this.channelCount=i.channelCount,this.transform=GG(e,i),this.domainFBO=QP(e,2,1)}destroy(){var e,i;this.transform.destroy(),(e=this.binBuffer)==null||e.destroy(),(i=this.valueBuffer)==null||i.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){const e=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,i=new Float32Array(e);this._domains=[[-i[4],i[0]],[-i[5],i[1]],[-i[6],i[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(e,i){var o,v,w,S;const{model:n,transformFeedback:s}=this.transform;n.setVertexCount(e);const u={binIdRange:[i[0][0],i[0][1],((o=i[1])==null?void 0:o[0])||0,((v=i[1])==null?void 0:v[1])||0]};n.shaderInputs.setProps({aggregatorTransform:u});const f=e*i.length*4;(!this.binBuffer||this.binBuffer.byteLength<f)&&((w=this.binBuffer)==null||w.destroy(),this.binBuffer=this.device.createBuffer({byteLength:f}),s.setBuffer("binIds",this.binBuffer));const m=e*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<m)&&((S=this.valueBuffer)==null||S.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:m}),s.setBuffer("values",this.valueBuffer))}update(e,i){if(!e)return;const n=this.transform,s=this.domainFBO,u=[0,1,2].map(o=>i[o]==="COUNT"?1:0),f=[0,1,2].map(o=>i[o]==="MEAN"?1:0),m={isCount:u,isMean:f,bins:e};n.model.shaderInputs.setProps({aggregatorTransform:m}),n.run({id:"gpu-aggregation-domain",framebuffer:s,parameters:{viewport:[0,0,2,1]},clearColor:[-3e38,-3e38,-3e38,0],clearDepth:!1,clearStencil:!1}),this._domains=null}}function GG(t,e){const i=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,n=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new jh(t,{vs:i,fs:n,topology:"point-list",modules:[XG],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:e.dimensions,NUM_CHANNELS:e.channelCount,SAMPLER_WIDTH:s_},varyings:["binIds","values"],disableWarnings:!0})}class sI{static isSupported(e){return e.features.has("float32-renderable-webgl")&&e.features.has("texture-blend-float-webgl")}constructor(e,i){this.binCount=0,this.binIds=null,this.results=[],this.device=e,this.dimensions=i.dimensions,this.channelCount=i.channelCount,this.props={...i,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new jG(e,i),this.aggregationTransform=new qG(e,i),this.setProps(i)}getBins(){var i;const e=this.aggregationTransform.binBuffer;return e?(((i=this.binIds)==null?void 0:i.buffer)!==e&&(this.binIds={buffer:e,type:"float32",size:this.dimensions}),this.binIds):null}getResult(e){var n;const i=this.aggregationTransform.valueBuffer;return!i||e>=this.channelCount?null:(((n=this.results[e])==null?void 0:n.buffer)!==i&&(this.results[e]={buffer:i,type:"float32",size:1,stride:this.channelCount*4,offset:e*4}),this.results[e])}getResultDomain(e){return this.aggregationTransform.domains[e]}getBin(e){if(e<0||e>=this.binCount)return null;const{binIdRange:i}=this.props;let n;if(this.dimensions===1)n=[e+i[0][0]];else{const[[m,o],[v]]=i,w=o-m;n=[e%w+m,Math.floor(e/w)+v]}const s=this.binSorter.getBinValues(e);if(!s)return null;const u=s[3],f=[];for(let m=0;m<this.channelCount;m++){const o=this.props.operations[m];o==="COUNT"?f[m]=u:u===0?f[m]=NaN:f[m]=o==="MEAN"?s[m]/u:s[m]}return{id:n,value:f,count:u}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(e){const i=this.props;if("binIdRange"in e&&!ts(e.binIdRange,i.binIdRange,2)){const n=e.binIdRange;if(Gi.assert(n.length===this.dimensions),this.dimensions===1){const[[s,u]]=n;this.binCount=u-s}else{const[[s,u],[f,m]]=n;this.binCount=(u-s)*(m-f)}this.binSorter.setDimensions(this.binCount,n),this.aggregationTransform.setDimensions(this.binCount,n),this.setNeedsUpdate()}if(e.operations)for(let n=0;n<this.channelCount;n++)e.operations[n]!==i.operations[n]&&this.setNeedsUpdate(n);if(e.pointCount!==void 0&&e.pointCount!==i.pointCount&&(this.binSorter.setModelProps({vertexCount:e.pointCount}),this.setNeedsUpdate()),e.binOptions&&(ts(e.binOptions,i.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:e.binOptions})),e.attributes){const n={},s={};for(const u of Object.values(e.attributes))for(const[f,m]of Object.entries(u.getValue()))ArrayBuffer.isView(m)?s[f]=m:m&&(n[f]=m);this.binSorter.setModelProps({attributes:n,constantAttributes:s})}e.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:e.shaderModuleProps}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate.fill(!0):this.needsUpdate[e]=!0}update(){}preDraw(){var n,s;if(!this.needsUpdate.some(Boolean))return;const{operations:e}=this.props,i=this.needsUpdate.map((u,f)=>u?e[f]:null);this.binSorter.update(i),this.aggregationTransform.update(this.binSorter.texture,e);for(let u=0;u<this.channelCount;u++)this.needsUpdate[u]&&(this.needsUpdate[u]=!1,(s=(n=this.props).onUpdate)==null||s.call(n,{channel:u}))}}let tk=class extends J1{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(e){var n,s;super.updateState(e);const i=this.getAggregatorType();if(e.changeFlags.extensionsChanged||this.state.aggregatorType!==i){(n=this.state.aggregator)==null||n.destroy();const u=this.createAggregator(i);return u.setProps({attributes:(s=this.getAttributeManager())==null?void 0:s.attributes}),this.setState({aggregator:u,aggregatorType:i}),!0}return!1}finalizeState(e){super.finalizeState(e),this.state.aggregator.destroy()}updateAttributes(e){const{aggregator:i}=this.state;i.setProps({attributes:e});for(const n in e)this.onAttributeChange(n);i.update()}draw({shaderModuleProps:e}){const{aggregator:i}=this.state;i.setProps({shaderModuleProps:e}),i.preDraw()}_getAttributeManager(){return new Ny(this.context.device,{id:this.props.id,stats:this.context.stats})}};tk.layerName="AggregationLayer";const ik=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function nk(t,e=!1,i=Float32Array){let n;if(Number.isFinite(t[0]))n=new i(t);else{n=new i(t.length*4);let s=0;for(let u=0;u<t.length;u++){const f=t[u];n[s++]=f[0],n[s++]=f[1],n[s++]=f[2],n[s++]=Number.isFinite(f[3])?f[3]:255}}if(e)for(let s=0;s<n.length;s++)n[s]/=255;return n}const ry={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function ZG(t,e){t.setSampler({minFilter:ry[e],magFilter:ry[e]})}function YG(t,e,i="linear"){const n=nk(e,!1,Uint8Array);return t.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:ry[i],magFilter:ry[i],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:n,width:n.length/4,height:1})}class oI{constructor(e,i){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=e,this.inputLength=i,this.attribute=e}getScalePercentile(){if(!this._percentile){const e=aI(this.input,this.inputLength);this._percentile=JG(e)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){const e=aI(this.input,this.inputLength);this._ordinal=KG(e)}return this._ordinal}getCutoff({scaleType:e,lowerPercentile:i,upperPercentile:n}){if(e==="quantile")return[i,n-1];if(i>0||n<100){const{domain:s}=this.getScalePercentile();let u=s[Math.floor(i)-1]??-1/0,f=s[Math.floor(n)-1]??1/0;if(e==="ordinal"){const{domain:m}=this.getScaleOrdinal();u=m.findIndex(o=>o>=u),f=m.findIndex(o=>o>f)-1,f===-2&&(f=m.length-1)}return[u,f]}return null}update(e){const i=this.props;if(e.scaleType!==i.scaleType)switch(e.scaleType){case"quantile":{const{attribute:n}=this.getScalePercentile();this.attribute=n,this.domain=[0,99];break}case"ordinal":{const{attribute:n,domain:s}=this.getScaleOrdinal();this.attribute=n,this.domain=[0,s.length-1];break}default:this.attribute=this.input,this.domain=null}return(e.scaleType!==i.scaleType||e.lowerPercentile!==i.lowerPercentile||e.upperPercentile!==i.upperPercentile)&&(this.cutoff=this.getCutoff(e)),this.props=e,this}}function KG(t){const e=new Set;for(const s of t)Number.isFinite(s)&&e.add(s);const i=Array.from(e).sort(),n=new Map;for(let s=0;s<i.length;s++)n.set(i[s],s);return{attribute:{value:t.map(s=>Number.isFinite(s)?n.get(s):NaN),type:"float32",size:1},domain:i}}function JG(t,e=100){const i=Array.from(t).filter(Number.isFinite).sort(QG);let n=0;const s=Math.max(1,e),u=new Array(s-1);for(;++n<s;)u[n-1]=eZ(i,n/s);return{attribute:{value:t.map(f=>Number.isFinite(f)?tZ(u,f):NaN),type:"float32",size:1},domain:u}}function aI(t,e){var f;const i=(t.stride??4)/4,n=(t.offset??0)/4;let s=t.value;if(!s){const m=(f=t.buffer)==null?void 0:f.readSyncWebGL(0,i*4*e);m&&(s=new Float32Array(m.buffer),t.value=s)}if(i===1)return s.subarray(0,e);const u=new Float32Array(e);for(let m=0;m<e;m++)u[m]=s[m*i+n];return u}function QG(t,e){return t-e}function eZ(t,e){const i=t.length;if(e<=0||i<2)return t[0];if(e>=1)return t[i-1];const n=(i-1)*e,s=Math.floor(n),u=t[s],f=t[s+1];return u+(f-u)*(n-s)}function tZ(t,e){let i=0,n=t.length;for(;i<n;){const s=i+n>>>1;t[s]>e?n=s:i=s+1}return i}function iZ({dataBounds:t,getBinId:e,padding:i=0}){const n=[t[0],t[1],[t[0][0],t[1][1]],[t[1][0],t[0][1]]].map(o=>e(o)),s=Math.min(...n.map(o=>o[0]))-i,u=Math.min(...n.map(o=>o[1]))-i,f=Math.max(...n.map(o=>o[0]))+i+1,m=Math.max(...n.map(o=>o[1]))+i+1;return[[s,f],[u,m]]}const rk=Math.PI/3,Uy=2*Math.sin(rk),Vy=1.5,nZ=Array.from({length:6},(t,e)=>{const i=e*rk;return[Math.sin(i),-Math.cos(i)]});function av([t,e],i){let n=Math.round(e=e/i/Vy),s=Math.round(t=t/i/Uy-(n&1)/2);const u=e-n;if(Math.abs(u)*3>1){const f=t-s,m=s+(t<s?-1:1)/2,o=n+(e<n?-1:1),v=t-m,w=e-o;f*f+u*u>v*v+w*w&&(s=m+(n&1?1:-1)/2,n=o)}return[s,n]}const rZ=`
const vec2 DIST = vec2(${Uy}, ${Vy});

ivec2 pointToHexbin(vec2 p, float radius) {
  p /= radius * DIST;
  float pj = round(p.y);
  float pjm2 = mod(pj, 2.0);
  p.x -= pjm2 * 0.5;
  float pi = round(p.x);
  vec2 d1 = p - vec2(pi, pj);

  if (abs(d1.y) * 3. > 1.) {
    vec2 v2 = step(0.0, d1) - 0.5;
    v2.y *= 2.0;
    vec2 d2 = d1 - v2;
    if (dot(d1, d1) > dot(d2, d2)) {
      pi += v2.x + pjm2 - 0.5;
      pj += v2.y;
    }
  }
  return ivec2(pi, pj);
}
`;function lI([t,e],i){return[(t+(e&1)/2)*i*Uy,e*i*Vy]}const sZ=`
const vec2 DIST = vec2(${Uy}, ${Vy});

vec2 hexbinCentroid(vec2 binId, float radius) {
  binId.x += fract(binId.y * 0.5);
  return binId * DIST * radius;
}
`,oZ=`#version 300 es
#define SHADER_NAME hexagon-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
${sZ}
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < hexagon.colorDomain.z ||
instanceColorValues > hexagon.colorDomain.w ||
instanceElevationValues < hexagon.elevationDomain.z ||
instanceElevationValues > hexagon.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);
commonPosition += positions.xy * column.radius * column.coverage;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,aZ=`uniform hexagonUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
} hexagon;
`,lZ={name:"hexagon",vs:aZ,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};class sk extends ew{getShaders(){const e=super.getShaders();return e.modules.push(lZ),{...e,vs:oZ}}initializeState(){super.initializeState();const e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){var u;super.updateState(e);const{props:i,oldProps:n}=e,s=this.state.fillModel;if(n.colorRange!==i.colorRange){(u=this.state.colorTexture)==null||u.destroy(),this.state.colorTexture=YG(this.context.device,i.colorRange,i.colorScaleType);const f={colorRange:this.state.colorTexture};s.shaderInputs.setProps({hexagon:f})}else n.colorScaleType!==i.colorScaleType&&ZG(this.state.colorTexture,i.colorScaleType)}finalizeState(e){var i;super.finalizeState(e),(i=this.state.colorTexture)==null||i.destroy()}draw({uniforms:e}){const{radius:i,hexOriginCommon:n,elevationRange:s,elevationScale:u,extruded:f,coverage:m,colorDomain:o,elevationDomain:v}=this.props,w=this.props.colorCutoff||[-1/0,1/0],S=this.props.elevationCutoff||[-1/0,1/0],R=this.state.fillModel;R.vertexArray.indexBuffer&&R.setIndexBuffer(null),R.setVertexCount(this.state.fillVertexCount);const L={colorDomain:[Math.max(o[0],w[0]),Math.min(o[1],w[1]),Math.max(o[0]-1,w[0]),Math.min(o[1]+1,w[1])],elevationDomain:[Math.max(v[0],S[0]),Math.min(v[1],S[1]),Math.max(v[0]-1,S[0]),Math.min(v[1]+1,S[1])],elevationRange:[s[0]*u,s[1]*u],originCommon:n};R.shaderInputs.setProps({column:{extruded:f,coverage:m,radius:i},hexagon:L}),R.draw(this.context.renderPass)}}sk.layerName="HexagonCellLayer";const cZ=`uniform binOptionsUniforms {
  vec2 hexOriginCommon;
  float radiusCommon;
} binOptions;
`,uZ={name:"binOptions",vs:cZ,uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function cI(){}const hZ={gpuAggregation:!0,colorDomain:null,colorRange:ik,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:cI,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:cI,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class nw extends tk{getAggregatorType(){const{gpuAggregation:e,hexagonAggregator:i,getColorValue:n,getElevationValue:s}=this.props;return e&&(i||n||s)?(Gi.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&sI.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){const{hexagonAggregator:i,radius:n}=this.props;return new FG({dimensions:2,getBin:{sources:["positions"],getValue:({positions:s},u,f)=>{if(i)return i(s,n);const o=this.state.aggregatorViewport.projectPosition(s),{radiusCommon:v,hexOriginCommon:w}=f;return av([o[0]-w[0],o[1]-w[1]],v)}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:s})=>s},{sources:["elevationWeights"],getValue:({elevationWeights:s})=>s}]})}return new sI(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Mp,uZ],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;
  
  ${rZ}

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){const i=super.updateState(e),{props:n,oldProps:s,changeFlags:u}=e,{aggregator:f}=this.state;if((u.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(LP(n.data).iterable)),i||u.dataChanged||n.radius!==s.radius||n.getColorValue!==s.getColorValue||n.getElevationValue!==s.getElevationValue||n.colorAggregation!==s.colorAggregation||n.elevationAggregation!==s.elevationAggregation){this._updateBinOptions();const{radiusCommon:m,hexOriginCommon:o,binIdRange:v,dataAsArray:w}=this.state;if(f.setProps({binIdRange:v,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{radiusCommon:m,hexOriginCommon:o},onUpdate:this._onAggregationUpdate.bind(this)}),w){const{getColorValue:S,getElevationValue:R}=this.props;f.setProps({customOperations:[S&&(L=>S(L.map(j=>w[j]),{indices:L,data:n.data})),R&&(L=>R(L.map(j=>w[j]),{indices:L,data:n.data}))]})}}return u.updateTriggersChanged&&u.updateTriggersChanged.getColorValue&&f.setNeedsUpdate(0),u.updateTriggersChanged&&u.updateTriggersChanged.getElevationValue&&f.setNeedsUpdate(1),i}_updateBinOptions(){const e=this.getBounds();let i=1,n=[0,0],s=[[0,1],[0,1]],u=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let f=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{radius:m}=this.props,{unitsPerMeter:o}=u.getDistanceScales(f);i=o[0]*m;const v=av(u.projectFlat(f),i);f=u.unprojectFlat(lI(v,i));const w=u.constructor;u=u.isGeospatial?new w({longitude:f[0],latitude:f[1],zoom:12}):new Kc({position:[f[0],f[1],0],zoom:12}),n=[Math.fround(u.center[0]),Math.fround(u.center[1])],s=iZ({dataBounds:e,getBinId:S=>{const R=u.projectFlat(S);return R[0]-=n[0],R[1]-=n[1],av(R,i)},padding:1})}this.setState({radiusCommon:i,hexOriginCommon:n,binIdRange:s,aggregatorViewport:u})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){const i=this.getCurrentLayer().props,{aggregator:n}=this.state;if(e===0){const s=n.getResult(0);this.setState({colors:new oI(s,n.binCount)}),i.onSetColorDomain(n.getResultDomain(0))}else if(e===1){const s=n.getResult(1);this.setState({elevations:new oI(s,n.binCount)}),i.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(e){const{aggregator:i}=this.state;switch(e){case"positions":i.setNeedsUpdate(),this._updateBinOptions();const{radiusCommon:n,hexOriginCommon:s,binIdRange:u}=this.state;i.setProps({binIdRange:u,binOptions:{radiusCommon:n,hexOriginCommon:s}});break;case"colorWeights":i.setNeedsUpdate(0);break;case"elevationWeights":i.setNeedsUpdate(1);break}}renderLayers(){var ot,lt;const{aggregator:e,radiusCommon:i,hexOriginCommon:n}=this.state,{elevationScale:s,colorRange:u,elevationRange:f,extruded:m,coverage:o,material:v,transitions:w,colorScaleType:S,lowerPercentile:R,upperPercentile:L,colorDomain:j,elevationScaleType:Z,elevationLowerPercentile:re,elevationUpperPercentile:xe,elevationDomain:be}=this.props,ue=this.getSubLayerClass("cells",sk),oe=e.getBins(),Ie=(ot=this.state.colors)==null?void 0:ot.update({scaleType:S,lowerPercentile:R,upperPercentile:L}),me=(lt=this.state.elevations)==null?void 0:lt.update({scaleType:Z,lowerPercentile:re,upperPercentile:xe});return!Ie||!me?null:new ue(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:oe,getColorValue:Ie.attribute,getElevationValue:me.attribute}},dataComparator:(_t,rt)=>_t.length===rt.length,updateTriggers:{getBin:[oe],getColorValue:[Ie.attribute],getElevationValue:[me.attribute]},diskResolution:6,vertices:nZ,radius:i,hexOriginCommon:n,elevationScale:s,colorRange:u,colorScaleType:S,elevationRange:f,extruded:m,coverage:o,material:v,colorDomain:Ie.domain||j||e.getResultDomain(0),elevationDomain:me.domain||be||e.getResultDomain(1),colorCutoff:Ie.cutoff,elevationCutoff:me.cutoff,transitions:w&&{getFillColor:w.getColorValue||w.getColorWeight,getElevation:w.getElevationValue||w.getElevationWeight},extensions:[]})}getPickingInfo(e){const i=e.info,{index:n}=i;if(n>=0){const s=this.state.aggregator.getBin(n);let u;if(s){const f=lI(s.id,this.state.radiusCommon),m=this.context.viewport.unprojectFlat(f);u={col:s.id[0],row:s.id[1],position:m,colorValue:s.value[0],elevationValue:s.value[1],count:s.count},s.pointIndices&&(u.pointIndices=s.pointIndices,u.points=Array.isArray(this.props.data)?s.pointIndices.map(o=>this.props.data[o]):[])}i.object=u}return i}}nw.layerName="HexagonLayer";nw.defaultProps=hZ;function fZ(t){const e=t.map(m=>m[0]),i=t.map(m=>m[1]),n=Math.min.apply(null,e),s=Math.max.apply(null,e),u=Math.min.apply(null,i),f=Math.max.apply(null,i);return[n,u,s,f]}function dZ(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}const uI=new Float32Array(12);function hI(t,e=2){let i=0;for(const n of t)for(let s=0;s<e;s++)uI[i++]=n[s]||0;return uI}function pZ(t,e,i){const[n,s,u,f]=t,m=u-n,o=f-s;let v=m,w=o;m/o<e/i?v=e/i*o:w=i/e*m,v<e&&(v=e,w=i);const S=(u+n)/2,R=(f+s)/2;return[S-v/2,R-w/2,S+v/2,R+w/2]}function mZ(t,e){const[i,n,s,u]=e;return[(t[0]-i)/(s-i),(t[1]-n)/(u-n)]}const gZ=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`,_Z=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`,fI=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,yZ={name:"triangle",vs:fI,fs:fI,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class ok extends Gh{getShaders(){return super.getShaders({vs:gZ,fs:_Z,modules:[Mp,yZ]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){const{vertexCount:i,data:n}=this.props;return new Wo(e,{...this.getShaders(),id:this.props.id,attributes:n.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:i})}draw(){const{model:e}=this.state,{aggregationMode:i,colorDomain:n,intensity:s,threshold:u,colorTexture:f,maxTexture:m,weightsTexture:o}=this.props,v={aggregationMode:i,colorDomain:n,intensity:s,threshold:u,colorTexture:f,maxTexture:m,weightsTexture:o};e.shaderInputs.setProps({triangle:v}),e.draw(this.context.renderPass)}}ok.layerName="TriangleLayer";function xZ(t,e){const i={};for(const n in t)e.includes(n)||(i[n]=t[n]);return i}class ak extends J1{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:xZ(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:i}=e;if(i.extensionsChanged){const n=this.getShaders({});n&&n.defines&&(n.defines.NON_INSTANCED_MODEL=1),this.updateShaders(n)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:i,device:n}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:i,picking:{isActive:0},devicePixelRatio:n.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,i={}){const{props:n,oldProps:s,changeFlags:u}=e,{compareAll:f=!1,dimension:m}=i,{ignoreProps:o}=this.state,{props:v,accessors:w=[]}=m,{updateTriggersChanged:S}=u;if(u.dataChanged)return!0;if(S){if(S.all)return!0;for(const R of w)if(S[R])return!0}if(f)return u.extensionsChanged?!0:Y1({oldProps:s,newProps:n,ignoreProps:o,propTypes:this.constructor._propTypes});for(const R of v)if(n[R]!==s[R])return!0;return!1}isAttributeChanged(e){const{changedAttributes:i}=this.state;return e?i&&i[e]!==void 0:!vZ(i)}_getAttributeManager(){return new Ny(this.context.device,{id:this.props.id,stats:this.context.stats})}}ak.layerName="AggregationLayer";function vZ(t){let e=!0;for(const i in t){e=!1;break}return e}const dI=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,pI=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,bZ=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,wZ=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,TZ=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,EZ={name:"weight",vs:TZ,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},AZ={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}},SZ=2,lv={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},mI=[0,0],IZ={SUM:0,MEAN:1},CZ={getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:ik,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},MZ=["float32-renderable-webgl","texture-blend-float-webgl"],RZ={data:{props:["radiusPixels"]}};class rw extends ak{getShaders(e){let i=[Mp];return e.modules&&(i=[...i,...e.modules]),super.getShaders({...e,modules:i})}initializeState(){super.initializeAggregationLayer(RZ),this.setState({colorDomain:mI}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){const{props:i,oldProps:n}=e,s=this._getChangeFlags(e);(s.dataChanged||s.viewportChanged)&&(s.boundsChanged=this._updateBounds(s.dataChanged),this._updateTextureRenderingBounds()),s.dataChanged||s.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):s.viewportZoomChanged&&this._debouncedUpdateWeightmap(),i.colorRange!==n.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){const{weightsTexture:e,triPositionBuffer:i,triTexCoordBuffer:n,maxWeightsTexture:s,colorTexture:u,colorDomain:f}=this.state,{updateTriggers:m,intensity:o,threshold:v,aggregation:w}=this.props,S=this.getSubLayerClass("triangle",ok);return new S(this.getSubLayerProps({id:"triangle-layer",updateTriggers:m}),{coordinateSystem:Pi.DEFAULT,data:{attributes:{positions:i,texCoords:n}},vertexCount:4,maxTexture:s,colorTexture:u,aggregationMode:IZ[w]||0,weightsTexture:e,intensity:o,threshold:v,colorDomain:f})}finalizeState(e){super.finalizeState(e);const{weightsTransform:i,weightsTexture:n,maxWeightTransform:s,maxWeightsTexture:u,triPositionBuffer:f,triTexCoordBuffer:m,colorTexture:o,updateTimer:v}=this.state;i==null||i.destroy(),n==null||n.destroy(),s==null||s.destroy(),u==null||u.destroy(),f==null||f.destroy(),m==null||m.destroy(),o==null||o.destroy(),v&&clearTimeout(v)}_getAttributeManager(){return new Ny(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const i={},{dimensions:n}=this.state;i.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:n.data})&&"aggregation is dirty",i.viewportChanged=e.changeFlags.viewportChanged;const{zoom:s}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==s)&&(i.viewportZoomChanged=!0),i}_createTextures(){const{textureSize:e,format:i}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...lv,width:e,height:e,format:i}),maxWeightsTexture:this.context.device.createTexture({...lv,width:1,height:1,format:i})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:e}=this.context,{weightsTextureSize:i}=this.props,n=Math.min(i,e.limits.maxTextureDimension2D),s=MZ.every(m=>e.features.has(m)),u=s?"rgba32float":"rgba8unorm",f=s?1:1/255;this.setState({textureSize:n,format:u,weightsScale:f}),s||Gi.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:i}=this.state;const{weightsTexture:n}=this.state,s=this.getAttributeManager();i==null||i.destroy(),i=new b3(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:s.getBufferLayouts(),vertexCount:1,targetTexture:n,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,EZ]}),this.setState({weightsTransform:i})}_setupResources(){this._createTextures();const{device:e}=this.context,{textureSize:i,weightsTexture:n,maxWeightsTexture:s}=this.state,u=this.getShaders({vs:dI,fs:pI});this._createWeightsTransform(u);const f=this.getShaders({vs:bZ,fs:wZ,modules:[AZ]}),m=new b3(e,{id:`${this.id}-max-weights-transform`,targetTexture:s,...f,vertexCount:i*i,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),o={inTexture:n,textureSize:i};m.model.shaderInputs.setProps({maxWeight:o}),this.setState({weightsTexture:n,maxWeightsTexture:s,maxWeightTransform:m,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:dI,fs:pI,...e})}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){const{viewport:i}=this.context,n=[i.unproject([0,0]),i.unproject([i.width,0]),i.unproject([0,i.height]),i.unproject([i.width,i.height])].map(m=>m.map(Math.fround)),s=fZ(n),u={visibleWorldBounds:s,viewportCorners:n};let f=!1;if(e||!this.state.worldBounds||!dZ(this.state.worldBounds,s)){const m=this._worldToCommonBounds(s),o=this._commonToWorldBounds(m);this.props.coordinateSystem===Pi.LNGLAT&&(o[1]=Math.max(o[1],-85.051129),o[3]=Math.min(o[3],85.051129),o[0]=Math.max(o[0],-360),o[2]=Math.min(o[2],360));const v=this._worldToCommonBounds(o);u.worldBounds=o,u.normalizedCommonBounds=v,f=!0}return this.setState(u),f}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:i,normalizedCommonBounds:n,viewportCorners:s}=this.state,{viewport:u}=this.context;e.write(hI(s,3));const f=s.map(m=>mZ(u.projectPosition(m),n));i.write(hI(f,2))}_updateColorTexture(e){const{colorRange:i}=e.props;let{colorTexture:n}=this.state;const s=nk(i,!1,Uint8Array);n&&(n==null?void 0:n.width)===i.length?n.setTexture2DData({data:s}):(n==null||n.destroy(),n=this.context.device.createTexture({...lv,data:s,width:i.length,height:1})),this.setState({colorTexture:n})}_updateWeightmap(){const{radiusPixels:e,colorDomain:i,aggregation:n}=this.props,{worldBounds:s,textureSize:u,weightsScale:f,weightsTexture:m}=this.state,o=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const v=this._worldToCommonBounds(s,{useLayerCoordinateSystem:!0});if(i&&n==="SUM"){const{viewport:ue}=this.context,oe=ue.distanceScales.metersPerUnit[2]*(v[2]-v[0])/u;this.state.colorDomain=i.map(Ie=>Ie*oe*f)}else this.state.colorDomain=i||mI;const S=this.getAttributeManager().getAttributes(),R=this.getModuleSettings();this._setModelAttributes(o.model,S),o.model.setVertexCount(this.getNumInstances());const L={radiusPixels:e,commonBounds:v,textureWidth:u,weightsScale:f,weightsTexture:m},{viewport:j,devicePixelRatio:Z,coordinateSystem:re,coordinateOrigin:xe}=R,{modelMatrix:be}=this.props;o.model.shaderInputs.setProps({project:{viewport:j,devicePixelRatio:Z,modelMatrix:be,coordinateSystem:re,coordinateOrigin:xe},weight:L}),o.run({parameters:{viewport:[0,0,u,u]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:i}=this.state;const{debounceTimeout:n}=this.props;e?(i=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(i),i=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),n)),this.setState({updateTimer:i})}_worldToCommonBounds(e,i={}){const{useLayerCoordinateSystem:n=!1}=i,[s,u,f,m]=e,{viewport:o}=this.context,{textureSize:v}=this.state,{coordinateSystem:w}=this.props,S=n&&(w===Pi.LNGLAT_OFFSETS||w===Pi.METER_OFFSETS),R=S?o.projectPosition(this.props.coordinateOrigin):[0,0],L=v*SZ/o.scale;let j,Z;return n&&!S?(j=this.projectPosition([s,u,0]),Z=this.projectPosition([f,m,0])):(j=o.projectPosition([s,u,0]),Z=o.projectPosition([f,m,0])),pZ([j[0]-R[0],j[1]-R[1],Z[0]-R[0],Z[1]-R[1]],L,L)}_commonToWorldBounds(e){const[i,n,s,u]=e,{viewport:f}=this.context,m=f.unprojectPosition([i,n]),o=f.unprojectPosition([s,u]);return m.slice(0,2).concat(o.slice(0,2))}}rw.layerName="HeatmapLayer";rw.defaultProps=CZ;const PZ={class:"heatmap-wrapper"},kZ={__name:"DeckGLOzoneHeatmap",setup(t){const e=Ta(null),i="pk.eyJ1IjoidGFudmlzdW4iLCJhIjoiY204emVlbmZrMGJqcjJqb25veHg5NTgwMCJ9.5Bx0EO-D7aEkknmgVK8U_Q";return Hc(async()=>{const s=await(await fetch("/citydata.csv")).text(),f=Py(s).filter(w=>w.Country==="United States of America").map(w=>{var j;const S=parseFloat(w.lat),R=parseFloat(w.lng),L=parseFloat(w["Ozone AQI Value"]);return{city:(j=w.City)==null?void 0:j.trim(),ozone:L,position:[R,S]}}).filter(w=>!isNaN(w.ozone)&&!isNaN(w.position[0])&&!isNaN(w.position[1])),m=new rw({id:"ozone-heatmap",data:f,getPosition:w=>w.position,getWeight:w=>w.ozone,radiusPixels:60,intensity:1,threshold:.01,aggregation:"SUM"});Lh.accessToken=i;const o=new Lh.Map({container:e.value,style:"mapbox://styles/mapbox/dark-v10",center:[-95.7129,37.0902],zoom:4.2}),v=new iw({layers:[m]});o.addControl(v),o.on("load",()=>{o.resize()})}),(n,s)=>(no(),jo("div",PZ,[Li("div",{ref_key:"chartContainer",ref:e,class:"map-container"},null,512),s[0]||(s[0]=Li("div",{id:"ozone-legend"},[Li("div",{class:"legend-title"},"Ozone AQI Intensity"),Li("div",{class:"legend-gradient"}),Li("div",{class:"legend-labels"},[Li("span",null,"Low"),Li("span",null,"Moderate"),Li("span",null,"High")])],-1))]))}},DZ=qc(kZ,[["__scopeId","data-v-7c273200"]]),OZ={class:"hexagon-wrapper"},LZ={__name:"DeckGLNO2Hexagon",setup(t){const e=Ta(null),i="pk.eyJ1IjoidGFudmlzdW4iLCJhIjoiY204emVlbmZrMGJqcjJqb25veHg5NTgwMCJ9.5Bx0EO-D7aEkknmgVK8U_Q";return Hc(async()=>{const s=await(await fetch("/citydata.csv")).text(),f=Py(s).filter(w=>w.Country==="United States of America").map(w=>{var S;return{city:(S=w.City)==null?void 0:S.trim(),no2:parseFloat(w["NO2 AQI Value"]),position:[parseFloat(w.lng),parseFloat(w.lat)]}}).filter(w=>!isNaN(w.no2)&&!isNaN(w.position[0])&&!isNaN(w.position[1])),m=new nw({id:"no2-hexagon-layer",data:f,getPosition:w=>w.position,getElevationWeight:w=>w.no2,elevationScale:20,extruded:!0,pickable:!0,radius:16e3,elevationRange:[0,1e3],getColorWeight:w=>w.no2,colorAggregation:"MEAN",elevationAggregation:"MEAN",colorRange:[[255,228,233],[255,182,193],[255,141,161],[255,86,122],[194,24,91]],onHover:({x:w,y:S,object:R})=>{var j,Z;const L=document.getElementById("deck-tooltip");if(R){const re=((j=R.colorValue)==null?void 0:j.toFixed(1))||"N/A";(Z=R.points)!=null&&Z.length,L.innerHTML=`
        <b>Avg NO AQI:</b> ${re}<br/>
       
      `,L.style.left=w+10+"px",L.style.top=S+10+"px",L.style.display="block"}else L.style.display="none"}});Lh.accessToken=i;const o=new Lh.Map({container:e.value,style:"mapbox://styles/mapbox/dark-v10",center:[-95.7129,37.0902],zoom:4.2,pitch:50,bearing:-30}),v=new iw({layers:[m]});o.addControl(v),o.on("load",()=>{o.resize()})}),(n,s)=>(no(),jo("div",OZ,[Li("div",{ref_key:"chartContainer",ref:e,class:"map-container"},null,512),s[0]||(s[0]=dC('<div id="deck-tooltip" data-v-5473a32c></div><div id="no2-legend" data-v-5473a32c><div class="legend-title" data-v-5473a32c>NO AQI Intensity</div><div class="legend-gradient" data-v-5473a32c></div><div class="legend-labels" data-v-5473a32c><span data-v-5473a32c>Low</span><span data-v-5473a32c>Moderate</span><span data-v-5473a32c>High</span></div></div>',2))]))}},BZ=qc(LZ,[["__scopeId","data-v-5473a32c"]]),FZ={class:"app-wrapper"},NZ={class:"map-wrapper"},zZ={class:"map-box"},UZ={class:"map-wrapper"},VZ={class:"map-box"},jZ={class:"map-wrapper"},$Z={class:"map-box"},WZ={class:"map-wrapper"},HZ={class:"map-box"},XZ={class:"map-wrapper"},qZ={class:"map-box"},GZ={class:"map-wrapper"},ZZ={class:"map-box"},YZ={__name:"App",setup(t){return(e,i)=>(no(),jo("div",FZ,[i[6]||(i[6]=Li("h1",{class:"dashboard-title"}," Countries Dashboard",-1)),Li("div",NZ,[Li("div",zZ,[i[0]||(i[0]=Li("h5",{class:"map-title"},"Dot Map for Countries ",-1)),Pr(SU)])]),Li("div",UZ,[Li("div",VZ,[i[1]||(i[1]=Li("h5",{class:"map-title"},"Choropleth Map for GDP of Different Countries",-1)),Pr(TU)])]),Li("div",jZ,[Li("div",$Z,[i[2]||(i[2]=Li("h5",{class:"map-title"},"Proportional Symbol Map to Show Population of Different Countries",-1)),Pr(vU)])]),Li("div",WZ,[Li("div",HZ,[i[3]||(i[3]=Li("h5",{class:"map-title"},"DeckGL Hexagon Map showing NO Air Quality Index",-1)),Pr(BZ)])]),Li("div",XZ,[Li("div",qZ,[i[4]||(i[4]=Li("h5",{class:"map-title"},"DeckGL Scatterplot showing CO Emissions",-1)),Pr(IG)])]),Li("div",GZ,[Li("div",ZZ,[i[5]||(i[5]=Li("h5",{class:"map-title"},"DeckGL Heatmap showing Ozone Air Quality Index",-1)),Pr(DZ)])])]))}},KZ=qc(YZ,[["__scopeId","data-v-15674564"]]);cB(KZ).mount("#app");
